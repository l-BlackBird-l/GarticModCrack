(function() {
    (() => {
        const a = ({
                pos: l,
                prevPos: m
            }) => l !== m,
            b = ({
                minScale: l,
                maxScale: m,
                scale: n
            }) => n <= m && n >= l,
            c = ({
                minScale: l,
                maxScale: m,
                scale: n
            }) => ({
                pos: r,
                prevPos: q,
                translate: p
            }) => b({
                minScale: l,
                maxScale: m,
                scale: n
            }) && a({
                pos: r,
                prevPos: q
            }) ? p + (r - q * n) * (1 - 1 / n) : p,
            d = ({
                scale: l,
                minScale: m,
                maxScale: n,
                scaleSensitivity: r,
                deltaScale: q
            }) => [l, Math.max(m, Math.min(l + q / (r / l), n))],
            e = ({
                scale: l,
                translateX: m,
                translateY: n
            }) => `matrix(${l}, 0, 0, ${l}, ${m}, ${n})`,
            f = ({
                state: l,
                originX: m,
                originY: n
            }) => {
                l.transformation.translateX += m;
                l.transformation.translateY +=
                    n;
                l.element.style.transform = e({
                    scale: l.transformation.scale,
                    translateX: l.transformation.translateX,
                    translateY: l.transformation.translateY
                })
            },
            g = l => ({
                panBy: ({
                    originX: m,
                    originY: n
                }) => f({
                    state: l,
                    originX: m,
                    originY: n
                }),
                panTo: ({
                    originX: m,
                    originY: n,
                    scale: r
                }) => {
                    l.transformation.scale = r;
                    f({
                        state: l,
                        originX: m - l.transformation.translateX,
                        originY: n - l.transformation.translateY
                    })
                }
            }),
            h = l => ({
                zoom: ({
                    x: m,
                    y: n,
                    deltaScale: r,
                    scaleSensitivity: q
                }) => {
                    const {
                        left: p,
                        top: t
                    } = l.element.getBoundingClientRect(), {
                        minScale: v,
                        maxScale: w,
                        defaultScaleSensitivity: u
                    } = l, [y, z] = d({
                        scale: l.transformation.scale,
                        deltaScale: r,
                        minScale: v,
                        maxScale: w,
                        scaleSensitivity: q || u
                    });
                    r = m - p;
                    q = n - t;
                    n = r / y;
                    m = q / y;
                    const x = c({
                        scale: y,
                        minScale: v,
                        maxScale: w
                    });
                    r = x({
                        pos: r,
                        prevPos: l.transformation.originX,
                        translate: l.transformation.translateX
                    });
                    q = x({
                        pos: q,
                        prevPos: l.transformation.originY,
                        translate: l.transformation.translateY
                    });
                    l.element.style.transformOrigin = `${n/l.containerScale}px ${m/l.containerScale}px`;
                    l.element.style.transform = e({
                        scale: z,
                        translateX: r / l.containerScale,
                        translateY: q / l.containerScale
                    });
                    l.transformation = {
                        originX: n,
                        originY: m,
                        translateX: r,
                        translateY: q,
                        scale: z
                    }
                }
            }),
            k = l => ({
                getScale: () => +l.transformation.scale,
                setScale: m => {
                    l.transformation.scale = +m
                },
                getScaleSensitivity: () => +l.defaultScaleSensitivity,
                setScaleSensitivity: m => {
                    l.defaultScaleSensitivity = +m
                },
                setMinScale: m => {
                    l.minScale = +m
                },
                setMaxScale: m => {
                    l.maxScale = +m
                },
                getMinScale: () => +l.minScale,
                getMaxScale: () => +l.maxScale,
                setContainerScale: m => {
                    l.containerScale = +m
                },
                reset: () => {
                    f({
                        state: l,
                        originX: 0 - l.transformation.translateX,
                        originY: 0 - l.transformation.translateY
                    });
                    l.element.style.transformOrigin = "";
                    l.element.style.transform = "";
                    l.transformation = {
                        originX: 0,
                        originY: 0,
                        translateX: 0,
                        translateY: 0,
                        scale: 1
                    }
                },
                setState: ({
                    transformation: m,
                    style: n
                }) => {
                    l.transformation = Object.assign({}, m);
                    l.element.style.transformOrigin = n.transformOrigin;
                    l.element.style.transform = n.transform
                },
                getState: () => ({
                    transformation: Object.assign({}, l.transformation),
                    style: {
                        transformOrigin: l.element.style.transformOrigin,
                        transform: l.element.style.transform
                    }
                })
            });
        window.renderer = ({
            minScale: l,
            maxScale: m,
            element: n,
            containerScale: r = 1,
            scaleSensitivity: q = 10
        }) => {
            l = {
                element: n,
                minScale: l,
                maxScale: m,
                defaultScaleSensitivity: q,
                containerScale: r,
                transformation: {
                    originX: 0,
                    originY: 0,
                    translateX: 0,
                    translateY: 0,
                    scale: 1
                }
            };
            return Object.assign({}, h(l), g(l), k(l))
        }
    })();
    class GPMigration_ {
        static TASKS = [
            [
                [10, 4],
                [() => {
                    const a = JSON.parse(localStorage.getItem("gp_userlist")) ?? {};
                    a && "banTwitchUsers" in a && (a.userBansSyncWithTwitch = a.banTwitchUsers, delete a.banTwitchUsers, localStorage.setItem("gp_userlist", JSON.stringify(a)))
                }, () => {
                    const a = localStorage.getItem("gp_update");
                    if (a) {
                        const b = JSON.parse(localStorage.getItem("gp_about")) ?? {};
                        Object.assign(b, {
                            lastNotifiedVersion: a
                        });
                        localStorage.setItem("gp_about", JSON.stringify(b));
                        localStorage.removeItem("gp_update")
                    }
                }]
            ]
        ];
        static compareVersion(a,
            b) {
            const c = Math.max(a.length, b.length);
            for (let d = 0; d < c; d++) {
                const e = a[d] ?? 0,
                    f = b[d] ?? 0;
                if (e > f) return 1;
                if (e < f) return -1
            }
            return 0
        }
        static migrate(a) {
            a = a.split(".");
            let b = this.TASKS.length;
            for (let c = this.TASKS.length - 1; 0 <= c; c--)
                if (-1 === this.compareVersion(a, this.TASKS[c][0])) b = c;
                else break;
            this.TASKS.slice(b).forEach(([c, d]) => {
                try {
                    d.forEach(e => {
                        e()
                    }), console.log(`gpmod: migrating to v${c.join(".")}`)
                } catch (e) {
                    console.error(`gpmod: migration error to v${c.join(".")} |`, e)
                }
            })
        }
        static init(a) {
            let b = localStorage.getItem("gp_latest-version") ||
                localStorage.getItem("gp_update");
            b !== a && b && (this.migrate(b), localStorage.setItem("gp_latest-version", a))
        }
    };
    (() => {
        function a(d, e, f) {
            c.ws = d;
            c.mm = new GPModulesManager_(e, f);
            c.sm = c.mm.getSettingsManager();
            c.app = b;
            c.mm.setModules([{
                    id: 0,
                    name: "GPProxy_",
                    required: !0,
                    hidden: !0
                }, {
                    id: 6,
                    name: "GPAbout_",
                    required: !0,
                    hidden: !0
                }, {
                    id: 9,
                    name: "GPActivation_",
                    required: !0,
                    hidden: !0
                }, {
                    id: 10,
                    name: "GPAvatars_",
                    required: !0,
                    hiddenSettings: !0
                }, {
                    id: 5,
                    name: "GPAntiCheat_",
                    hiddenSettings: !0
                }, {
                    id: 1,
                    name: "GPModeration_"
                }, {
                    id: 2,
                    name: "GPPlayersManager_"
                }, {
                    id: 3,
                    name: "GPArtBroadcaster_"
                }, {
                    id: 7,
                    name: "GPTimer_"
                }, {
                    id: 8,
                    name: "GPReference_"
                },
                {
                    id: 4,
                    name: "GPPainter_"
                }, {
                    id: 11,
                    name: "GPGlobalBanlist_",
                    required: !0
                }
            ], this, c)
        }
        const b = {
            author: "liliezzzz",
            name: "gp-mod",
            version: "10.4.12",
            changelogURL: "https://discord.com/channels/929715202600095775/953145081471324270/1327585829304012801",
            summaryURL: "https://discord.com/channels/929715202600095775/929715202600095778/1327617058980237343",
            updateNoticeFlag: "true",
            updateNoticeText: "",
            discordURL: "https://discord.gg/xxtCmzt8uA",
            donateURL: "https://boosty.to/gpmod"
        };
        if (function() {
                return navigator?.userAgentData?.brands.some(d =>
                    "Chromium" === d.brand) || navigator.userAgent.toLowerCase().includes("firefox")
            }()) {
            var c = {
                ws: null,
                gpproxy: null,
                tmr: null,
                ref: null,
                act: null,
                av: null,
                ac: null,
                abt: null
            };
            document.addEventListener("_ws", ({
                detail: {
                    ws: d,
                    authData: e,
                    l10n: f
                }
            }) => {
                c.gpproxy ? c.gpproxy.setWebSocket(d) : a(d, e, f);
                window.ws = d
            });
            (function() {
                var d;
                if (null != (d = document.getElementById("__next"))) {
                    d = d.classList;
                    var e = d.toggle;
                    var f = !!document.querySelector("#__next > .side > div")?.firstElementChild?.getBoundingClientRect().height;
                    e.call(d,
                        "gp-ad-not-found_", !f)
                }
            })();
            GPMigration_.init(b.version);
            console.log("gpmod: loaded")
        } else console.error(`${b.name}: Browser not supported`)
    })();
    class GPAbout_ extends EventTarget {
        static ANALYTICS_CHANNEL_URL = "https://discord.com/channels/929715202600095775/1316862441426260000";
        static BOOSTY_URL = "https://boosty.to/gpmod";
        static HEADER_MIN_SCALE = .625;
        static NOTICE_TYPE = {
            SCRIPTS: "scripts",
            ANALYTICS: "analytics",
            DISCONNECTION: "disconnection",
            SUB_EXPIRED: "sub_expired",
            UPDATE: "update",
            TWITCH_OAUTH_TOKEN: "twitch_oauth_token",
            TWITCH_TOKEN: "twitch_token",
            TWITCH_TOKEN2: "twitch_token2",
            RAID: "raid",
            NORMAL: "normal"
        };
        static NOTICE = {
            [this.NOTICE_TYPE.SCRIPTS]: {
                priority: 9,
                unique: !0
            },
            [this.NOTICE_TYPE.ANALYTICS]: {
                priority: 8,
                unique: !0,
                icon: !0
            },
            [this.NOTICE_TYPE.DISCONNECTION]: {
                priority: 7,
                unique: !0,
                icon: !0
            },
            [this.NOTICE_TYPE.SUB_EXPIRED]: {
                priority: 6,
                unique: !0,
                icon: !0
            },
            [this.NOTICE_TYPE.UPDATE]: {
                priority: 5,
                unique: !0,
                icon: !0
            },
            [this.NOTICE_TYPE.TWITCH_OAUTH_TOKEN]: {
                priority: 4,
                unique: !0,
                icon: !0
            },
            [this.NOTICE_TYPE.TWITCH_TOKEN]: {
                priority: 3,
                unique: !0,
                icon: !0
            },
            [this.NOTICE_TYPE.TWITCH_TOKEN2]: {
                priority: 3,
                unique: !0,
                icon: !0
            },
            [this.NOTICE_TYPE.RAID]: {
                priority: 2,
                unique: !0
            },
            [this.NOTICE_TYPE.NORMAL]: {
                priority: 1,
                unique: !1
            }
        };
        static NOTICE_BUTTON_ICONS = {
            DISCORD: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36"><path fill="currentColor" d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/></svg>',
            BOOSTY: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 235.6 292.2" transform="scale(1.5)"><path fill="currentColor" d="M44.3 164.5 76.9 51.6H127l-10.1 35-.3.6L90 179.6h24.8c-10.4 25.9-18.5 46.2-24.3 60.9-45.8-.5-58.6-33.3-47.4-72.1m47.6 72.2 60.4-86.9h-25.6L147.8 98c38.2 4 56.2 34.1 45.6 70.5-11.3 39.1-57.1 72.1-101.7 72.1h-1z"/></svg>'
        };
        static DEFAULT_SETTINGS = {
            windowsInkWarning: null,
            lastNotifiedVersion: null
        };
        static MODULE = {
            title: "About",
            alias: "abt",
            settings: {
                storage: "gp_about",
                defaultSettings: this.DEFAULT_SETTINGS
            }
        };
        constructor(a,
            b) {
            super();
            this.mm = a.mm;
            this.l = b;
            this.s = a.sm.setSettings(this, this.updateSettings);
            const {
                name: c,
                author: d,
                version: e,
                changelogURL: f,
                summaryURL: g,
                updateNoticeFlag: h,
                updateNoticeText: k,
                discordURL: l,
                donateURL: m
            } = a.app;
            this.version = e;
            this.changelogURL = f;
            this.summaryURL = g || f;
            this.updateNoticeFlag = JSON.parse(h);
            this.updateNoticeText = k;
            this.notificationQueue = [];
            this.notificationId = 0;
            this.noticeDurationTimer = this.currentNotice = null;
            this.closeNotice = this.closeNotice.bind(this);
            window.addEventListener("resize",
                this.resizeHandler.bind(this));
            document.addEventListener("_gp_notice", ({
                detail: n
            }) => {
                this.addNotice(n)
            });
            document.addEventListener("_outdated-scripts", ({
                detail: {
                    outdatedScripts: n
                }
            }) => {
                n.size && (this.printOutdatedScripts(n), this.addNotice({
                    type: GPAbout_.NOTICE_TYPE.SCRIPTS,
                    scripts: n
                }))
            });
            this.render(c, d, e, f, l, m);
            this.resizeHandler();
            this.shouldUpdateNoticeBeShown() && (this.mm.isFirstRun() ? this.s.lastNotifiedVersion = this.version : this.showUpdateNotice());
            this.s.windowsInkWarning && this.addNotice({
                type: GPAbout_.NOTICE_TYPE.NORMAL,
                text: this.l.WINDOWS_INK_WARNING,
                onClose: () => {
                    this.s.windowsInkWarning = !1
                }
            });
            this.requestOutdatedScripts()
        }
        render(a, b, c, d, e, f) {
            this.container = document.createElement("div");
            this.container.className = "gp-about_";
            this.container.innerHTML = `${a} <span>v<span class="version_"><a class="changelog-link_" target="_blank" href="${d}" title="${this.l.CHANGELOG_TTL}">${c}</a></span></span>`;
            this.versionElem = this.container.querySelector(".version_");
            e && (a = document.createTextNode("\u00a0\u00a0|\u00a0\u00a0"), this.container.appendChild(a),
                a = document.createElement("a"), a.className = "discord-link_", a.target = "_blank", a.href = e, a.title = this.l.DISCORD_LINK_TTL, a.textContent = e.split("//")[1], this.container.appendChild(a));
            f && (e = document.createTextNode("\u00a0\u00a0|\u00a0\u00a0"), this.container.appendChild(e), e = document.createElement("a"), e.className = "donate-link_", e.target = "_blank", e.href = f, e.title = this.l.DONATE_LINK_TTL, e.textContent = this.l.DONATE_LINK, this.container.appendChild(e));
            document.body.appendChild(this.container)
        }
        resizeHandler(a) {
            a =
                Math.max(GPAbout_.HEADER_MIN_SCALE, this.getContainerScale());
            this.container.style.fontSize = `${16*a}px`;
            this.container.style.lineHeight = `${28*a}px`;
            this.updateUpdateNoticePos()
        }
        getContainerScale() {
            let a = (window.innerWidth - 180) / 1150;
            766 * a > window.innerHeight && (a = window.innerHeight / 766);
            return a
        }
        shouldUpdateNoticeBeShown() {
            return this.updateNoticeFlag ? this.isNewVersion(this.version, this.s.lastNotifiedVersion || "0.0", 2) : !1
        }
        isNewVersion(a, b, c = 0) {
            const [d, e] = [a, b].map(f => f.split(".").map(g => +g));
            a = Math.max(d.length,
                e.length);
            a = c && Math.min(a, c) || a;
            for (c = 0; c < a; c++) {
                b = d[c] ?? 0;
                const f = e[c] ?? 0;
                if (b !== f) return b > f
            }
            return !1
        }
        updateUpdateNoticePos() {
            if (this.notice) {
                var {
                    width: a
                } = this.versionElem.getBoundingClientRect(), {
                    width: b
                } = this.notice.getBoundingClientRect();
                this.notice.style.left = `calc(-${Math.floor((b-a)/2)}px)`
            }
        }
        requestOutdatedScripts() {
            document.dispatchEvent(new Event("_get-outdated-scripts"))
        }
        printOutdatedScripts(a) {
            a.size && console.warn(`Outdated Scripts:\n${[...a.values()].map(b=>`${b.name} (${b.version} \u2794 ${b.latestVersion}): ${b.url}?${Date.now()}.user.js`).join("\n")}`)
        }
        updateScript(a) {
            document.dispatchEvent(new CustomEvent("_update-script", {
                detail: {
                    name: a
                }
            }))
        }
        addNotice(a) {
            const b = Object.assign({}, a, {
                id: ++this.notificationId
            });
            GPAbout_.NOTICE[b.type].unique ? this.currentNotice?.type === b.type ? b.same && b.duration === this.currentNotice?.duration || (this.closeNotice(), this.notificationQueue.push(b)) : (a = this.notificationQueue.findIndex(c => c.type === b.type), ~a && this.notificationQueue.splice(a, 1), this.notificationQueue.push(b)) : this.notificationQueue.push(b);
            this.notificationQueue.sort((c, d) => GPAbout_.NOTICE[d.type].priority - GPAbout_.NOTICE[c.type].priority);
            this.currentNotice && GPAbout_.NOTICE[this.currentNotice.type].priority === GPAbout_.NOTICE[this.notificationQueue[0].type].priority || this.showNotice(this.notificationQueue[0])
        }
        showNotice(a) {
            this.currentNotice = a;
            this.notice?.remove();
            clearTimeout(this.noticeDurationTimer);
            this.notice = document.createElement(a.url ? "a" : "div");
            this.notice.className = "notice_";
            this.notice.dataset.type = a.type;
            var b = a.text || (a.type === GPAbout_.NOTICE_TYPE.UPDATE ? this.l.UPDATE_NOTICE : "");
            if (b) {
                const d = document.createElement("div");
                d.className = "text-container";
                b.split("\n\n").forEach(e => {
                    const f = document.createElement("div");
                    f.className = "text_";
                    f.textContent = e;
                    d.appendChild(f)
                });
                this.notice.appendChild(d);
                b = !1;
                if (a.buttons) {
                    const e = document.createElement("div");
                    e.className = "buttons_";
                    a.buttons.forEach(([f, g, h]) => {
                        const k = document.createElement(h ? "a" : "div");
                        k.className = "btn_";
                        k.textContent = f;
                        h && (h.startsWith("https://discord.com/") ? (f = document.createElement("div"), f.classList.add("icon_"), f.innerHTML = GPAbout_.NOTICE_BUTTON_ICONS.DISCORD,
                            k.appendChild(f)) : h.startsWith("https://boosty.to/") && (f = document.createElement("div"), f.classList.add("icon_"), f.innerHTML = GPAbout_.NOTICE_BUTTON_ICONS.BOOSTY, k.appendChild(f)), k.href = h, k.target = "_blank");
                        g && k.addEventListener("click", l => {
                            g();
                            this.closeNotice()
                        });
                        e.appendChild(k)
                    });
                    this.notice.appendChild(e);
                    this.notice.classList.add("with-buttons_");
                    b = !0
                }
                if (GPAbout_.NOTICE[a.type].icon) {
                    const e = document.createElement("div");
                    e.className = "icon_";
                    e.style.gridRowEnd = (b ? 1 : 0) + 2;
                    this.notice.appendChild(e);
                    this.notice.classList.add("with-icon_");
                    a.type === GPAbout_.NOTICE_TYPE.UPDATE && (e.dataset.version = `v${this.version.split(".").slice(0,2).join(".")}`)
                }
            }
            if (a.style)
                for (var c in a.style) this.notice.style[c] = a.style[c];
            a.url && (this.notice.href = a.url, this.notice.target = "_blank", this.notice.title = this.l.NOTICE_URL_TTL);
            a.onClick && (this.notice.classList.add("clickable_"), this.notice.addEventListener("click", a.onClick));
            (a.url || a.onClick) && this.notice.addEventListener("click", this.closeNotice);
            a.duration &&
                (c = document.createElementNS("http://www.w3.org/2000/svg", "svg"), c.classList.add("timer_"), c.setAttribute("viewBox", "0 0 16 16"), c.innerHTML = "<circle></circle>", c.style.setProperty("--duration", `${a.duration}ms`), this.notice.appendChild(c), this.noticeDurationTimer = setTimeout(this.closeNotice, a.duration));
            a.scripts && (c = this.buildScripts(a.scripts), this.notice.appendChild(c));
            c = document.createElement("div");
            c.className = "close-btn_";
            c.textContent = "\u2716";
            c.title = "";
            c.addEventListener("click", d => {
                if (a.onClose) a.onClose();
                this.closeNotice();
                d.preventDefault();
                d.stopPropagation()
            });
            this.notice.appendChild(c);
            this.versionElem.appendChild(this.notice);
            this.updateUpdateNoticePos()
        }
        closeNotice(a = null) {
            if (a && (this.notificationQueue = this.notificationQueue.filter(c => c.type !== a), a !== this.currentNotice?.type)) return;
            this.currentNotice.type === GPAbout_.NOTICE_TYPE.UPDATE && (this.s.lastNotifiedVersion = this.version);
            this.notice.remove();
            this.notice = null;
            const b = this.notificationQueue.indexOf(this.currentNotice);
            ~b && this.notificationQueue.splice(b,
                1);
            this.currentNotice = null;
            clearTimeout(this.noticeDurationTimer);
            this.showNextNotice()
        }
        showNextNotice() {
            this.notificationQueue.length && this.showNotice(this.notificationQueue[0])
        }
        buildNoticeMessage(a) {
            return a ? a.split("\n\n").map(b => `<div class="text_">${b}</div>`).join("") : ""
        }
        buildScripts(a) {
            const b = document.createElement("div");
            b.className = "scripts_";
            var c = document.createElement("div");
            c.className = "title_";
            c.textContent = this.l.UPDATE_SCRIPTS_TITLE;
            b.appendChild(c);
            const d = document.createElement("div");
            d.className = "reload-row_";
            c = document.createElement("a");
            c.className = "reload-btn_";
            c.href = "/";
            c.textContent = this.l.RELOAD_BTN_LBL;
            c.addEventListener("click", f => {
                f.preventDefault();
                window.onbeforeunload = null;
                location.reload()
            });
            c.addEventListener("auxclick", f => {
                f.preventDefault()
            });
            d.appendChild(c);
            const e = new Set;
            Array.from(a.values()).forEach((f, g) => {
                var h = `${f.url}?${Date.now()}.user.js`;
                const k = document.createElement("div");
                k.className = "oudated-script_";
                var l = document.createElement("div");
                l.textContent =
                    f.name;
                k.appendChild(l);
                l = document.createElement("div");
                l.textContent = `${f.version} \u2794 ${f.latestVersion}`;
                k.appendChild(l);
                l = document.createElement("div");
                k.appendChild(l);
                const m = document.createElement("a");
                m.className = "script-update-link_";
                m.href = h;
                m.target = "_blank";
                m.textContent = this.l.UPDATE_SCRIPT_LBL;
                h = n => {
                    e.add(g);
                    e.size >= a.size && d.classList.add("shown_");
                    m.closest(".oudated-script_").classList.add("clicked_");
                    "click" === n.type && (this.updateScript(f.name), n.preventDefault())
                };
                m.addEventListener("click",
                    h);
                m.addEventListener("auxclick", h);
                l.appendChild(m);
                b.appendChild(k)
            });
            b.appendChild(d);
            return b
        }
        getVersion() {
            return this.version
        }
        getWindowsInkWarningState() {
            return this.s.windowsInkWarning
        }
        setWindowsInkWarningState(a) {
            this.s.windowsInkWarning = a
        }
        showUpdateNotice() {
            const [a, b] = this.l.UPDATE_NOTICE.split("|");
            this.addNotice({
                type: GPAbout_.NOTICE_TYPE.UPDATE,
                text: this.updateNoticeText || a,
                buttons: [
                    [b, () => {}, this.summaryURL]
                ]
            })
        }
        showAnalyticsNotice() {
            const [a, b, c] = this.l.ANALYTICS_NOTICE.split("|");
            this.addNotice({
                type: GPAbout_.NOTICE_TYPE.ANALYTICS,
                text: a,
                buttons: [
                    [b, null, GPAbout_.ANALYTICS_CHANNEL_URL],
                    [c, () => {
                        document.dispatchEvent(new Event("_analytics-consent-granted"))
                    }]
                ]
            })
        }
        showDisconnectionNotice() {
            const [a, b] = this.l.DISCONNECTION_WARNING.split("|");
            this.addNotice({
                type: GPAbout_.NOTICE_TYPE.DISCONNECTION,
                text: a,
                same: !0,
                buttons: [
                    [b, () => {
                        this.mm.reloadPage()
                    }]
                ]
            })
        }
        showSubExpiredNotice() {
            const [a, b] = this.l.SUB_EXPIRED_NOTICE.split("|");
            this.addNotice({
                type: GPAbout_.NOTICE_TYPE.SUB_EXPIRED,
                text: a,
                buttons: [
                    [b, null, GPAbout_.BOOSTY_URL]
                ]
            })
        }
        showTwitchOAuthTokenNotice({
            onButtonClick: a
        }) {
            const [b,
                c
            ] = this.l.INVALID_TWITCH_OAUTH_TOKEN.split("|");
            this.addNotice({
                type: GPAbout_.NOTICE_TYPE.TWITCH_OAUTH_TOKEN,
                text: b,
                buttons: [
                    [c, () => {
                        a()
                    }]
                ]
            })
        }
        showTwitchTokenNotice({
            onButtonClick: a,
            onClose: b
        }) {
            const [c, d] = this.l.INVALID_TWITCH_TOKEN.split("|");
            this.addNotice({
                type: GPAbout_.NOTICE_TYPE.TWITCH_TOKEN,
                text: c,
                buttons: [
                    [d, () => {
                        a()
                    }]
                ],
                onClose: b
            })
        }
        showTwitchToken2Notice({
            onButtonClick: a,
            onClose: b
        }) {
            const [c, d] = this.l.INVALID_TWITCH_TOKEN2.split("|");
            this.addNotice({
                type: GPAbout_.NOTICE_TYPE.TWITCH_TOKEN2,
                text: c,
                buttons: [
                    [d, () => {
                        a()
                    }]
                ],
                onClose: b
            })
        }
    }
    window.GPAbout_ = GPAbout_;
    class GPActivation_ extends EventTarget {
        static AUTH_FILENAME_STORAGE = "gp_auth-filename";
        static ACTIVATION_KEY_PATTERN = /^[a-zA-Z0-9]{32}:\d{14,16}$/;
        static DEFAULT_SETTINGS = {
            activationKey: "",
            publicKey: "",
            filename: ""
        };
        static SETTINGS_UI = {
            activationKey: {
                type: "input",
                args: {
                    secure: !0
                },
                description: "\u041a\u043b\u044e\u0447 \u0430\u043a\u0442\u0438\u0432\u0430\u0446\u0438\u0438"
            }
        };
        static MODULE = {
            title: "Activation",
            alias: "act",
            settings: {
                storage: "gp_activation",
                defaultSettings: this.DEFAULT_SETTINGS,
                ui: this.SETTINGS_UI
            }
        };
        constructor(a) {
            super();
            this.s = a.sm.setSettings(this, this.updateSettings);
            this.subsStatus = !1;
            this.keyHash = null;
            this.updateSubsStatus = this.updateSubsStatus.bind(this);
            this.broadcastSubsStatus = this.broadcastSubsStatus.bind(this);
            this.setActivationKey = this.setActivationKey.bind(this);
            document.addEventListener("_auth_perms", this.updateSubsStatus);
            this.initAuthFilenameStorage();
            this.updateKeyHash();
            this.broadcastPublicKey();
            document.dispatchEvent(new CustomEvent("_act_init", {
                detail: {
                    pasteKey: this.setActivationKey
                }
            }))
        }
        initAuthFilenameStorage() {
            localStorage.setItem(GPActivation_.AUTH_FILENAME_STORAGE,
                this.s.filename)
        }
        broadcastPublicKey() {
            document.dispatchEvent(new CustomEvent("_auth_key", {
                detail: {
                    publicKey: this.s.publicKey
                }
            }))
        }
        updateKeyHash() {
            this.keyHash = this.s.publicKey ? String(GPUtils_.computeHash(this.s.publicKey)) : null
        }
        getKeyHash() {
            return this.keyHash
        }
        updateSubsStatus({
            detail: {
                ps: a
            }
        }) {
            this.subsStatus = !!(256 & a);
            this.broadcastSubsStatus(a)
        }
        broadcastSubsStatus(a) {
            document.dispatchEvent(new CustomEvent("_subs_status", {
                detail: {
                    status: this.subsStatus,
                    ps: a
                }
            }))
        }
        setActivationKey(a) {
            return GPActivation_.ACTIVATION_KEY_PATTERN.test(a) ?
                (this.s.activationKey = a, !0) : !1
        }
        updateSettings({
            detail: {
                settings: a
            }
        }) {
            if ("activationKey" in a) {
                const [b, c] = a.activationKey.split(":");
                this.s.publicKey = b ?? "";
                this.s.filename = c ?? "";
                this.initAuthFilenameStorage();
                this.updateKeyHash();
                this.broadcastPublicKey();
                document.dispatchEvent(new Event("_auth_key_changed"))
            }
        }
    }
    window.GPActivation_ = GPActivation_;
    class GPAntiCheat_ extends EventTarget {
        static MIN_STROKES_TRIGGER = 100;
        static MIN_PERCENTAGE_TRIGGER = 75;
        static SEQUENCE_MIN_SIZE = 5;
        static SEQUENCES_COUNT_TRIGGER = 10;
        static MAX_SEQUENCE_TRIGGER = 80;
        static CM_SEQUENCE_TRIGGER = 4;
        static CANVAS_WIDTH = 758;
        static CANVAS_HEIGHT = 424;
        static M_STROKE_OFFSET = 67;
        static DEFAULT_SETTINGS = {
            enabled: !0,
            activatedForOwnerOnly: !0,
            sendReports: !0
        };
        static SETTINGS_UI = {
            enabled: {
                type: "switch",
                description: "\u0410\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0410\u043d\u0442\u0438-\u0427\u0438\u0442"
            },
            activatedForOwnerOnly: {
                type: "switch",
                description: "\u0410\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0410\u043d\u0442\u0438-\u0427\u0438\u0442, \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0412\u044b \u044f\u0432\u043b\u044f\u0435\u0442\u0435\u0441\u044c \u0432\u043b\u0430\u0434\u0435\u043b\u044c\u0446\u0435\u043c \u043a\u043e\u043c\u043d\u0430\u0442\u044b"
            },
            _1: {
                text: "Reports"
            },
            sendReports: {
                type: "switch",
                description: "\u041e\u0442\u0441\u044b\u043b\u0430\u0442\u044c \u043e\u0442\u0447\u0451\u0442\u044b \u043e \u0440\u0438\u0441\u0443\u043d\u043a\u0430\u0445, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u044b\u043b\u0438 \u043f\u043e\u043c\u0435\u0447\u0435\u043d\u044b \u0430\u043d\u0442\u0438\u0447\u0438\u0442\u043e\u043c \u043a\u0430\u043a \u043f\u043e\u0434\u043e\u0437\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0440\u0438\u0441\u0443\u043d\u043a\u0435 \u0438 \u0430\u0432\u0442\u043e\u0440\u0435"
            }
        };
        static MODULE = {
            title: "Anti-Cheat",
            alias: "ac",
            dependencies: ["GPUtils_", "GPAssets_", "GPAlbumObserver_", "GPImageReportSender_"],
            settings: {
                storage: "gp_anti-cheat",
                defaultSettings: GPAntiCheat_.DEFAULT_SETTINGS,
                ui: GPAntiCheat_.SETTINGS_UI
            },
            useCSS: !0
        };
        constructor(a, b) {
            super();
            this.gpproxy = a.gpproxy;
            this.l = b;
            this.s = a.sm.setSettings(this);
            this.isSubscribed = !1;
            this.itemsTriggers = new Map;
            this.isGameMWActivated = this.isAlbumMWActivated = !1;
            this.suspiciousItems = new Set;
            this.reportSender = new GPImageReportSender_(GPImageReportSender_.ANTI_CHEAT, this.gpproxy,
                a.act);
            this.gameMiddleware = this.gameMiddleware.bind(this);
            this.albumMiddleware = this.albumMiddleware.bind(this);
            this.gpproxy.addEventListener("gallery_started", c => {
                this.itemsTriggers.clear();
                this.suspiciousItems.clear()
            });
            this.gpproxy.addEventListener("rejoin", ({
                detail: {
                    stage: c
                }
            }) => {
                switch (c) {
                    case GPProxy_.STAGE.GAME:
                        this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.TURN_STARTED], this.gameMiddleware);
                        this.isGameMWActivated = !0;
                        break;
                    case GPProxy_.STAGE.ALBUM:
                        this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.ALBUM_ITEM,
                            GPProxy_.EVENT.ALBUM_INFO
                        ], this.albumMiddleware), this.isAlbumMWActivated = !0
                }
            });
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: c
                }
            }) => {
                c === GPProxy_.EVENT.GAME_STARTED ? (this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.TURN_STARTED], this.gameMiddleware), this.isGameMWActivated = !0) : c === GPProxy_.EVENT.GALLERY_SETTINGS ? (this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.ALBUM_ITEM, GPProxy_.EVENT.ALBUM_INFO], this.albumMiddleware), this.isAlbumMWActivated = !0, this.gpproxy.removeWSMsgMiddleware(this.gameMiddleware),
                    this.isGameMWActivated = !1) : this.isAlbumMWActivated && [GPProxy_.EVENT.NEW_GAME, GPProxy_.EVENT.ALBUM_SCORE, GPProxy_.EVENT.GAME_QUIT, GPProxy_.EVENT.GAME_STARTED].includes(c) && (this.gpproxy.removeWSMsgMiddleware(this.albumMiddleware), this.isAlbumMWActivated = !1)
            });
            document.addEventListener("_subs_status", ({
                detail: {
                    status: c
                }
            }) => {
                this.isSubscribed = c;
                GPAntiCheat_.toggleSettingsVisibility(c)
            })
        }
        gameMiddleware([a, b]) {
            if (!this.s.enabled || this.s.activatedForOwnerOnly && !this.gpproxy.isHost()) return [a, b];
            if (a[1] ===
                GPProxy_.EVENT.TURN_STARTED && a[2].previous?.user?.id !== this.gpproxy.getUser().id)
                if (a[2].screen === GPProxy_.SCREEN.DESCRIPTION && a[2].previous?.type === GPProxy_.ALBUM_ITEM_TYPE.IMAGE && a[2].previous?.data?.length) {
                    var c = this.gpproxy.getCurrentTurnId();
                    c = this.getTriggers(`t_${c}`, a[2].previous.data, a[2].previous.user.nick);
                    c.size && this.isSubscribed && (a[2].previous.data = this.getPlaceholder(c), b = !0)
                } else a[2].screen === GPProxy_.SCREEN.PAINTER && (a[2].background?.length || a[2].lastDraw?.length) && (a[2].background &&
                    (c = this.gpproxy.getCurrentTurnId(), this.getTriggers(`tbg_${c}`, a[2].background).size && this.isSubscribed && (a[2].background = [], b = !0)), a[2].lastDraw && a[2].previous?.type === GPProxy_.ALBUM_ITEM_TYPE.IMAGE && (c = this.gpproxy.getCurrentTurnId(), c = this.getTriggers(`t_${c}`, a[2].previous.data, a[2].previous.user.nick), c.size && this.isSubscribed && (a[2].lastDraw = [], a[2].previous.data = this.getPlaceholder(c), b = !0)));
            return [a, b]
        }
        albumMiddleware([a, b]) {
            if (!this.s.enabled || this.s.activatedForOwnerOnly && !this.gpproxy.isHost()) return [a,
                b
            ];
            if (a[1] === GPProxy_.EVENT.ALBUM_ITEM && a[2].user?.id !== this.gpproxy.getUser().id && a[2].type === GPProxy_.ALBUM_ITEM_TYPE.IMAGE && a[2].data)
                if (a[2].bg) {
                    var c = a[2].id,
                        d = this.gpproxy.getCurrentAlbumId(),
                        e = this.getTriggers(`${d}`, this.gpproxy.getAlbumBackground(d));
                    e.size && this.isSubscribed && (a[2].bg = !1, a[2].data = this.getPlaceholder(e), this.dispatchEvent(new CustomEvent("trigger", {
                        detail: {
                            itemId: c,
                            albumId: d
                        }
                    })), b = !0)
                } else a[2].data?.length && (c = a[2].id, d = this.gpproxy.getCurrentAlbumId(), e = this.getTriggers(`${d}_${c}`,
                    a[2].data, a[2].user.nick), e.size && (this.isSubscribed && (a[2].data = this.getPlaceholder(e), this.dispatchEvent(new CustomEvent("trigger", {
                    detail: {
                        itemId: c,
                        albumId: d
                    }
                })), b = !0), !this.s.sendReports && this.isSubscribed || this.reportSender.send({
                    itemId: c,
                    albumId: d,
                    triggers: e
                })));
            else a[1] === GPProxy_.EVENT.ALBUM_INFO && (a[2].background?.length && a[2].bookAuthor.id !== this.gpproxy.getUser().id && (c = this.gpproxy.getCurrentAlbumId(), this.getTriggers(`${c}`, a[2].background, a[2].bookAuthor.nick).size && this.isSubscribed &&
                (a[2].background = [], b = !0)), a[2].timeline?.length && (a[2].timeline = a[2].timeline.map(f => {
                if (!f.type || f.user?.id === this.gpproxy.getUser().id || f.type !== GPProxy_.ALBUM_ITEM_TYPE.IMAGE) return f;
                if (f.bg) {
                    var g = this.gpproxy.getCurrentAlbumId();
                    g = this.getTriggers(`${g}`, this.gpproxy.getAlbumBackground(g));
                    g.size && this.isSubscribed && (f.bg = !1, f.data = this.getPlaceholder(g), b = !0)
                } else f.data?.length && (g = this.gpproxy.getCurrentAlbumId(), g = this.getTriggers(`${g}_${f.id}`, f.data, f.user.nick), g.size && this.isSubscribed &&
                    (f.data = this.getPlaceholder(g), b = !0));
                return f
            })));
            return [a, b]
        }
        getPlaceholder(a) {
            return this.isForgery(a) ? GPAssets_.AC_FORGERY_PH[this.l.lang] ?? Object.values(GPAssets_.AC_FORGERY_PH)[0] : GPAssets_.AC_SUSPICIOUS_PH[this.l.lang] ?? Object.values(GPAssets_.AC_SUSPICIOUS_PH)[0]
        }
        getTriggers(a, b, c) {
            let d = this.itemsTriggers.get(a);
            d || (d = this.calcTriggers(b, c), this.itemsTriggers.set(a, d), d.size && this.isSubscribed && this.suspiciousItems.add(a));
            return d
        }
        calcTriggers(a, b) {
            const c = new Set;
            var d = a.findLastIndex(p =>
                11 === p[0]);
            a = a.slice(d + 1);
            if (!a?.length) return c;
            const {
                animate: e
            } = this.gpproxy.getGameConfig();
            let f = 0;
            var g = 0;
            let h = null,
                k = null,
                l = 0,
                m = 0;
            d = [];
            let n = [],
                r = 0,
                q = 0;
            for (let p = 0; p < a.length; p++) {
                const t = a[p],
                    v = t[0];
                if (b && this.isMStroke(t)) {
                    const {
                        code: w,
                        author: u
                    } = this.decodeMStroke(t);
                    w !== this.gpproxy.getGameCode() && c.add(20);
                    u !== this.gpproxy.formatNickname(b) && c.add(21)
                }
                if (1 === v) {
                    1 === e && 2 === t[2][1] && 4 === t.length && f++;
                    const w = t.length - 3,
                        [u, y] = t[3];
                    u === h && 3 > w ? l++ : (l > GPAntiCheat_.SEQUENCE_MIN_SIZE && (r = Math.max(r,
                        l), d.push(l)), l = 0);
                    y === k && 3 > w ? m++ : (m > GPAntiCheat_.SEQUENCE_MIN_SIZE && (q = Math.max(q, m), n.push(m)), m = 0);
                    h = u;
                    k = y
                } else 8 === v && g++;
                1 !== v && (h = k = null, l = m = 0)
            }
            b = f / a.length * 100;
            g = g / a.length * 100;
            a.length >= GPAntiCheat_.MIN_STROKES_TRIGGER && (b > GPAntiCheat_.MIN_PERCENTAGE_TRIGGER || g > GPAntiCheat_.MIN_PERCENTAGE_TRIGGER) && c.add(1);
            (d.length > GPAntiCheat_.SEQUENCES_COUNT_TRIGGER || n.length > GPAntiCheat_.SEQUENCES_COUNT_TRIGGER) && c.add(2);
            (r > GPAntiCheat_.MAX_SEQUENCE_TRIGGER || q > GPAntiCheat_.MAX_SEQUENCE_TRIGGER) && c.add(3);
            return c
        }
        isForgery(a) {
            return a.has(20) || a.has(21)
        }
        isMStroke(a) {
            return !(1 === a[0] && a[3][0] > GPAntiCheat_.CANVAS_WIDTH && a[3][1] > GPAntiCheat_.CANVAS_HEIGHT) || a[3][0] - GPAntiCheat_.CANVAS_WIDTH - GPAntiCheat_.M_STROKE_OFFSET || a.at(-1)[1] - GPAntiCheat_.CANVAS_HEIGHT - GPAntiCheat_.M_STROKE_OFFSET ? !1 : !0
        }
        decodeMStroke(a) {
            const [b, c, d] = a.slice(3).flat().map((e, f) => e - GPAntiCheat_.M_STROKE_OFFSET - (f % 2 ? GPAntiCheat_.CANVAS_HEIGHT : GPAntiCheat_.CANVAS_WIDTH)).filter(Boolean).map(e => String.fromCodePoint(e)).join("").split("@");
            return {
                code: b,
                author: c,
                timestamp: d
            }
        }
        getSuspiciousItems() {
            return this.suspiciousItems
        }
        isSuspicious(a) {
            return this.suspiciousItems.has(a)
        }
    }
    window.GPAntiCheat_ = GPAntiCheat_;
    class GPArtBroadcaster_ extends EventTarget {
        static SENT_IMAGE_DENSITY = 1;
        static SENT_IMAGE_ORIGINAL_WIDTH = 758;
        static SENT_IMAGE_ORIGINAL_HEIGHT = 424;
        static SENT_IMAGE_BACKGROUND_COLOR = "#ffffff";
        static SERVICES = ["discord", "telegram", "vk"];
        static DEFAULT_SETTINGS = {
            services: [],
            discordBorderColor: "#c958fe",
            discordBotToken: "",
            discordServerID: "",
            discordArtsChannelID: "",
            discordPlayerChannelID: "",
            discordArchiveChannelID: "",
            telegramBotToken: "",
            telegramChannel: "",
            telegramPlayerButton: !0,
            telegramSourceButton: !1,
            vkAccessToken: "",
            vkGroupID: "",
            vkAlbumID: "",
            vkPhotoDescription: "\u0410\u0432\u0442\u043e\u0440: {author}"
        };
        static SETTINGS_UI = {
            services: {
                type: "list-ms",
                args: {
                    items: this.SERVICES
                },
                description: "\u0421\u0435\u0440\u0432\u0438\u0441\u044b \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432"
            },
            _1: {
                text: "Discord"
            },
            discordBorderColor: {
                type: "color",
                description: "\u0426\u0432\u0435\u0442 \u043b\u0435\u0432\u043e\u0439 \u0440\u0430\u043c\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0441 \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043d\u043d\u044b\u043c \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u043c"
            },
            discordBotToken: {
                type: "input",
                args: {
                    secure: !0
                },
                description: "\u0422\u043e\u043a\u0435\u043d Discord-\u0431\u043e\u0442\u0430"
            },
            discordServerID: {
                type: "input",
                description: "ID Discord-\u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e\u0431 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0438\u0433\u0440\u043e\u043a\u0430\u0445"
            },
            discordArtsChannelID: {
                type: "input",
                description: "ID \u043a\u0430\u043d\u0430\u043b\u0430 \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432"
            },
            discordPlayerChannelID: {
                type: "input",
                description: "ID \u043a\u0430\u043d\u0430\u043b\u0430 \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432 \u0441 \u0441\u0441\u044b\u043b\u043a\u043e\u0439 \u043d\u0430 \u043f\u043b\u0435\u0435\u0440 \u0438 \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a"
            },
            discordArchiveChannelID: {
                type: "input",
                hidden: !0,
                description: "ID \u043a\u0430\u043d\u0430\u043b\u0430 \u0434\u043b\u044f \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a\u043e\u0432 \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432"
            },
            _2: {
                text: "Telegram"
            },
            telegramBotToken: {
                type: "input",
                args: {
                    secure: !0
                },
                description: "\u0422\u043e\u043a\u0435\u043d Telegram-\u0431\u043e\u0442\u0430"
            },
            telegramChannel: {
                type: "input",
                description: "\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0438\u043b\u0438 ID \u043a\u0430\u043d\u0430\u043b\u0430 (\u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 @channel_name)"
            },
            telegramPlayerButton: {
                type: "switch",
                description: "\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443 \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0440\u0438\u0441\u043e\u0432\u0430\u043d\u0438\u044f \u0432 \u043f\u043b\u0435\u0435\u0440\u0435"
            },
            telegramSourceButton: {
                type: "switch",
                description: "\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443 \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a\u0430 \u0440\u0438\u0441\u0443\u043d\u043a\u0430"
            },
            _3: {
                text: "VK (\u0412 \u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435)"
            },
            vkAccessToken: {
                type: "input",
                args: {
                    secure: !0
                },
                description: "VK \u0442\u043e\u043a\u0435\u043d"
            },
            vkGroupID: {
                type: "input",
                description: "ID \u0433\u0440\u0443\u043f\u043f\u044b \u0438\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0430 \u0441 \u0430\u043b\u044c\u0431\u043e\u043c\u043e\u043c \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432"
            },
            vkAlbumID: {
                type: "input",
                description: "ID \u0430\u043b\u044c\u0431\u043e\u043c\u0430 \u0434\u043b\u044f \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432"
            },
            vkPhotoDescription: {
                type: "input",
                description: "\u0428\u0430\u0431\u043b\u043e\u043d \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0440\u0438\u0441\u0443\u043d\u043a\u0430 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435 VK. \u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435: {author}, {date}"
            }
        };
        static MODULE = {
            title: "Art Broadcaster",
            alias: "ab",
            dependencies: ["GPUtils_", "GPPacketParser_"],
            settings: {
                storage: "gp_art-broadcaster",
                defaultSettings: this.DEFAULT_SETTINGS,
                ui: this.SETTINGS_UI
            },
            useCSS: !0
        };
        constructor(a) {
            super();
            this.gpproxy = a.gpproxy;
            this.s = a.sm.setSettings(this);
            this.observerConfig = {
                childList: !0,
                subtree: !0
            };
            this.observer = new MutationObserver(this.observerCallback.bind(this));
            this.monitorTimer;
            this.state = {};
            this.itemsElems = [];
            this.buttons = {};
            this.timeline = {};
            this.nextItemID = null;
            this.gpContent = document.querySelector("#content");
            this.sendResultHandler = this.sendResultHandler.bind(this);
            this.sendSocialMediaSettings = this.sendSocialMediaSettings.bind(this);
            this.addEventListener("settings_updated", this.sendSocialMediaSettings);
            this.addEventListener("settings_updated", this.toggleSendButtons);
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: b
                }
            }) => {
                b === GPProxy_.EVENT.GALLERY_SETTINGS ? this.startMonitor() : b === GPProxy_.EVENT.TURNS_ENDED ? this.init() : [GPProxy_.EVENT.NEW_GAME, GPProxy_.EVENT.ALBUM_SCORE, GPProxy_.EVENT.GAME_QUIT, GPProxy_.EVENT.GAME_STARTED].includes(b) ?
                    this.terminate() : b === GPProxy_.EVENT.ALBUM_INFO && (this.itemsElems = [], this.buttons = {}, this.nextItemID = null)
            });
            this.gpproxy.addEventListener("album_item", ({
                detail: {
                    itemId: b,
                    albumId: c,
                    item: d
                }
            }) => {
                this.timeline[c] || (this.timeline[c] = {});
                this.timeline[c][b] = d;
                (c = this.itemsElems[b]) && this.renderButton(c, d, b)
            });
            this.gpproxy.addEventListener("rejoin", ({
                detail: {
                    stage: b
                }
            }) => {
                b === GPProxy_.STAGE.ALBUM && (this.startMonitor(), this.init())
            });
            this.gpproxy.addEventListener("album_item_loading", ({
                detail: {
                    id: b
                }
            }) => {
                this.nextItemID =
                    b
            });
            this.sendSocialMediaSettings();
            this.toggleSendButtons()
        }
        init() {
            document.addEventListener("_send_image_complete", this.sendResultHandler);
            document.dispatchEvent(new CustomEvent("_update_urls_avatars_cache", {
                detail: {
                    users: this.gpproxy.getUsers().map(a => a.nick),
                    authType: this.gpproxy.authType
                }
            }))
        }
        terminate() {
            this.stopMonitor();
            this.itemsElems = [];
            this.timeline = {};
            this.buttons = {};
            this.state = {};
            this.nextItemID = null;
            document.removeEventListener("_send_image_complete", this.sendResultHandler)
        }
        renderButton(a,
            b, c) {
            if (b.type === GPProxy_.ALBUM_ITEM_TYPE.IMAGE) {
                a.style.position = "relative";
                var d = document.createElement("div");
                d.className = "send-drawing-btn_";
                d.classList.add("hidden");
                d.addEventListener("click", f => {
                    d.classList.remove("hidden");
                    f.ctrlKey ? (GPArtBroadcaster_.SERVICES.forEach(g => {
                        delete d.dataset[g]
                    }), this.sendImage(this.s.services, b, c, d)) : (f = this.s.services.filter(g => {
                        if (d.dataset[g] && "false" !== d.dataset[g]) return !1;
                        delete d.dataset[g];
                        return !0
                    }), f.length && this.sendImage(f, b, c, d))
                });
                this.setInitialButtonState(d,
                    c);
                var e = document.createElement("div");
                e.className = "media_";
                GPArtBroadcaster_.SERVICES.forEach(f => {
                    const g = document.createElement("div");
                    g.className = `${f}_ icon_`;
                    e.appendChild(g)
                });
                d.appendChild(e);
                a.appendChild(d);
                this.buttons[c] = d
            }
        }
        startMonitor() {
            if (!this.inProgress) {
                var a = document.querySelector(".scrapbook");
                a ? (this.observer.observe(a, this.observerConfig), this.inProgress = !0) : this.monitorTimer = setTimeout(() => {
                    this.startMonitor()
                }, 200)
            }
        }
        stopMonitor() {
            clearTimeout(this.monitorTimer);
            this.inProgress &&
                (this.observer.disconnect(), this.inProgress = !1)
        }
        observerCallback(a, b) {
            for (const d of a)
                if ("childList" === d.type && d.addedNodes.length && (a = d.addedNodes[0], d.target.classList.contains("scrollElements") && a.classList.contains("item"))) {
                    var c = this.gpproxy.getCurrentAlbumId();
                    b = this.nextItemID;
                    null === b && (b = [...a.parentElement.children].filter(e => e.classList.contains("item")).indexOf(a), (c = this.timeline[c]?.[b]) && this.renderButton(a, c, b));
                    this.itemsElems[b] = a
                }
        }
        sendImage(a, b, c, d) {
            const {
                data: e,
                background: f,
                meta: g
            } = b;
            var h = GPArtBroadcaster_.SENT_IMAGE_DENSITY;
            const k = GPArtBroadcaster_.SENT_IMAGE_ORIGINAL_WIDTH * h,
                l = GPArtBroadcaster_.SENT_IMAGE_ORIGINAL_HEIGHT * h,
                m = document.createElement("canvas");
            m.width = k;
            m.height = l;
            var n = m.getContext("2d");
            n.fillStyle = GPArtBroadcaster_.SENT_IMAGE_BACKGROUND_COLOR;
            n.fillRect(0, 0, k, l);
            f && this.drawFunction(n, f, h, !1);
            n = document.createElement("canvas");
            n.width = k;
            n.height = l;
            var r = n.getContext("2d");
            this.drawFunction(r, e, h, !0);
            h = document.createElement("canvas");
            h.width = k;
            h.height =
                l;
            r = h.getContext("2d");
            r.drawImage(m, 0, 0, k, l);
            r.drawImage(n, 0, 0, k, l);
            h.toBlob(async q => {
                d.classList.remove("complete_");
                d.classList.add("uploading_");
                var p = (new Date(g.date)).toLocaleDateString("ru-RU");
                p = `${g.author} - ${g.title} (${p})`;
                q = new File([q], `${p}.png`);
                const t = await GPUtils_.compressImageData(b);
                p = new File([t], `${p}.gpimg`);
                document.dispatchEvent(new CustomEvent("_send_to_media", {
                    detail: {
                        services: a,
                        artFile: q,
                        sourceFile: p,
                        meta: g,
                        authType: this.gpproxy.authType,
                        albumId: this.gpproxy.getCurrentAlbumId(),
                        itemId: c
                    }
                }))
            })
        }
        sendResultHandler({
            detail: {
                service: a,
                success: b,
                albumId: c,
                itemId: d
            }
        }) {
            this.setState(a, b, c, d);
            if (c === this.gpproxy.getCurrentAlbumId()) {
                const e = this.buttons[d];
                e.dataset[a] = b;
                let f = !0,
                    g = !0;
                this.s.services.forEach(h => {
                    e.dataset[h] ? "true" !== e.dataset[h] && (f = !1) : g = f = !1
                });
                g && (e.classList.remove("uploading_"), f && e.classList.add("complete_"))
            }
        }
        setState(a, b, c, d) {
            let e, f;
            ((f = (e = this.state)[c] ?? (e[c] = {}))[d] ?? (f[d] = {}))[a] = b
        }
        setInitialButtonState(a, b) {
            const c = this.gpproxy.getCurrentAlbumId();
            b =
                this.state[c]?.[b];
            for (const d in b) a.dataset[d] = b[d];
            this.s.services.length && this.s.services.every(d => "true" === a.dataset[d]) ? a.classList.add("complete_") : a.classList.remove("hidden")
        }
        sendSocialMediaSettings() {
            document.dispatchEvent(new CustomEvent("_update_sm_settings", {
                detail: {
                    settings: window.structuredClone(this.settings)
                }
            }))
        }
        toggleSendButtons(a) {
            (a = (a?.detail?.settings || this.settings).services) && this.gpContent.classList.toggle("gp-sm-hidden_", !a.length)
        }
        drawFunction(a, b, c = this.density, d = !1, e = !1) {
            GPUtils_.drawFunction(a, b, c, d, e)
        }
    }
    window.GPArtBroadcaster_ = GPArtBroadcaster_;
    class GPAssets_ {}
    GPAssets_.GIRL_PORTRAIT = [
        [1, 1, ["#FFFFFF", 869, 1],
            [379, 212]
        ],
        [1, 2, ["#000000", 2, 1],
            [152, 185],
            [151, 188],
            [149, 196],
            [148, 208],
            [148, 224],
            [150, 232],
            [153, 239],
            [156, 245],
            [159, 250],
            [162, 253]
        ],
        [1, 3, ["#000000", 2, 1],
            [190, 264],
            [190, 265],
            [191, 265],
            [193, 265],
            [196, 265],
            [201, 265],
            [205, 264],
            [208, 263]
        ],
        [1, 4, ["#000000", 2, 1],
            [248, 228],
            [248, 227],
            [248, 226],
            [248, 227],
            [246, 229],
            [244, 233],
            [241, 240],
            [239, 245],
            [236, 249],
            [232, 254],
            [229, 257],
            [226, 258],
            [223, 260],
            [219, 262],
            [215, 263],
            [211, 264],
            [209, 264]
        ],
        [1, 5, ["#000000", 2, 1],
            [187,
                244
            ],
            [188, 244],
            [190, 244],
            [192, 244],
            [196, 244],
            [198, 244],
            [200, 246],
            [201, 247],
            [202, 247]
        ],
        [1, 6, ["#000000", 2, 1],
            [216, 207],
            [217, 208]
        ],
        [1, 7, ["#000000", 2, 1],
            [214, 210],
            [214, 209],
            [215, 208],
            [216, 207],
            [219, 205],
            [223, 203],
            [229, 202],
            [234, 202],
            [238, 203],
            [241, 204],
            [243, 205],
            [245, 206],
            [246, 207],
            [246, 208],
            [246, 209]
        ],
        [1, 8, ["#000000", 2, 1],
            [246, 209],
            [247, 211],
            [248, 213],
            [248, 214]
        ],
        [1, 9, ["#000000", 2, 1],
            [214, 210],
            [215, 210],
            [215, 209],
            [217, 209],
            [219, 208],
            [223, 206],
            [231, 205],
            [235, 206],
            [237, 208],
            [240, 210],
            [240, 211]
        ],
        [1, 10, ["#000000",
                2, 1
            ],
            [241, 211],
            [242, 212],
            [243, 213],
            [244, 215],
            [244, 216],
            [244, 218]
        ],
        [1, 11, ["#000000", 2, 1],
            [243, 219],
            [244, 218],
            [244, 217],
            [245, 216],
            [246, 215],
            [248, 214],
            [249, 214]
        ],
        [1, 12, ["#000000", 2, 1],
            [219, 208],
            [218, 208],
            [219, 207],
            [220, 207],
            [221, 206],
            [225, 205],
            [232, 204],
            [236, 204],
            [240, 205],
            [241, 206],
            [242, 206]
        ],
        [1, 13, ["#000000", 2, 1],
            [229, 204],
            [230, 204],
            [230, 203],
            [232, 203],
            [235, 203],
            [238, 204],
            [241, 205],
            [243, 207],
            [244, 210],
            [245, 210],
            [245, 211],
            [245, 210],
            [244, 210],
            [244, 209],
            [243, 209],
            [242, 208],
            [240, 208],
            [239, 206],
            [239, 205],
            [238, 205],
            [237, 205],
            [236, 205],
            [237, 206],
            [238, 207],
            [239, 208],
            [240, 208],
            [242, 209],
            [244, 211],
            [245, 212],
            [246, 213],
            [245, 213],
            [244, 213],
            [243, 211],
            [241, 210],
            [240, 207],
            [239, 206],
            [239, 205],
            [239, 206],
            [239, 207],
            [240, 209],
            [243, 212],
            [244, 214],
            [245, 214],
            [245, 213],
            [244, 213],
            [244, 210],
            [244, 209],
            [244, 208],
            [245, 208],
            [245, 209],
            [245, 210],
            [245, 211]
        ],
        [1, 14, ["#000000", 2, 1],
            [149, 204],
            [150, 205],
            [151, 207],
            [152, 208],
            [153, 209],
            [155, 211],
            [157, 213]
        ],
        [1, 15, ["#000000", 2, 1],
            [154, 210],
            [153, 210],
            [153, 208],
            [154, 206],
            [155, 204],
            [158,
                201
            ],
            [163, 198],
            [167, 197],
            [171, 197],
            [173, 197]
        ],
        [1, 16, ["#000000", 2, 1],
            [150, 205],
            [150, 204],
            [150, 203],
            [152, 201],
            [154, 199],
            [157, 197],
            [163, 195],
            [168, 195],
            [172, 196],
            [176, 197],
            [179, 198],
            [180, 199],
            [180, 200],
            [181, 201],
            [182, 201]
        ],
        [1, 17, ["#000000", 2, 1],
            [177, 198],
            [178, 198],
            [179, 198],
            [180, 198],
            [180, 199],
            [181, 200],
            [182, 202],
            [183, 203],
            [184, 204]
        ],
        [1, 18, ["#000000", 2, 1],
            [151, 206],
            [151, 205],
            [152, 204],
            [154, 202],
            [156, 200],
            [160, 198],
            [163, 197],
            [164, 197],
            [166, 197],
            [166, 198],
            [165, 198],
            [164, 198],
            [163, 198],
            [162, 199],
            [161, 199],
            [160, 199],
            [158, 200],
            [157, 201],
            [156, 202],
            [155, 203],
            [154, 204],
            [153, 205],
            [153, 206]
        ],
        [1, 19, ["#000000", 2, 1],
            [234, 206],
            [234, 207],
            [235, 208],
            [236, 211],
            [236, 219],
            [234, 224],
            [232, 228],
            [229, 230],
            [226, 231],
            [225, 230],
            [225, 229]
        ],
        [1, 20, ["#000000", 2, 1],
            [219, 211],
            [218, 215],
            [218, 220],
            [218, 224],
            [220, 227],
            [224, 230],
            [227, 230]
        ],
        [1, 21, ["#000000", 2, 1],
            [169, 197],
            [168, 197],
            [167, 197],
            [166, 198],
            [164, 200],
            [163, 203],
            [162, 206],
            [162, 210],
            [162, 215],
            [164, 218],
            [165, 221],
            [168, 222]
        ],
        [1, 22, ["#000000", 2, 1],
            [168, 223],
            [169, 223],
            [170, 224],
            [171, 224],
            [172, 224],
            [174, 224],
            [176, 222],
            [179, 217],
            [181, 213],
            [181, 208],
            [182, 204],
            [182, 203]
        ],
        [1, 23, ["#000000", 2, 1],
            [178, 200],
            [179, 200],
            [180, 201],
            [180, 203],
            [181, 205],
            [181, 208]
        ],
        [1, 24, ["#000000", 2, 1],
            [166, 218],
            [166, 217],
            [167, 216],
            [168, 215],
            [169, 214],
            [171, 213],
            [173, 213],
            [175, 213],
            [176, 216],
            [177, 218],
            [177, 219]
        ],
        [1, 25, ["#000000", 2, 1],
            [172, 216],
            [171, 216],
            [171, 215],
            [171, 214],
            [171, 213],
            [171, 212],
            [172, 211],
            [173, 211],
            [174, 211],
            [174, 212],
            [174, 213],
            [174, 214],
            [173, 216],
            [172, 216],
            [172, 215],
            [172, 213],
            [172, 212]
        ],
        [1,
            26, ["#000000", 2, 1],
            [220, 224],
            [220, 223],
            [220, 222],
            [222, 220],
            [223, 219],
            [226, 218],
            [228, 218],
            [231, 219],
            [232, 221],
            [233, 223],
            [233, 224],
            [233, 225],
            [234, 225]
        ],
        [1, 27, ["#000000", 2, 1],
            [226, 220],
            [226, 219],
            [226, 218],
            [226, 217],
            [226, 218],
            [227, 218],
            [227, 219],
            [227, 221],
            [226, 221],
            [226, 220],
            [226, 219],
            [226, 217],
            [226, 216],
            [227, 215],
            [228, 216],
            [228, 218],
            [228, 219],
            [227, 220],
            [226, 219],
            [226, 218],
            [227, 218],
            [227, 217],
            [228, 218],
            [228, 219],
            [227, 220],
            [226, 221],
            [226, 220],
            [226, 219],
            [226, 217],
            [228, 217],
            [228, 218],
            [228, 219],
            [228, 221],
            [227, 222],
            [227, 221]
        ],
        [1, 28, ["#000000", 2, 1],
            [220, 207],
            [220, 208],
            [219, 208],
            [219, 209],
            [219, 211],
            [218, 214],
            [218, 215]
        ],
        [8, 29, ["#000000", 1], 220, 209, 14, 5, 0, 234, 210, 1, 4, 0, 220, 213, 1, 8, 0, 220, 214, 6, 1, 0, 228, 214, 7, 1, 0, 221, 209, 13, 1, 0, 222, 208, 12, 1, 0, 223, 208, 11, 1, 0, 224, 207, 9, 1, 0, 227, 207, 6, 1, 0, 220, 215, 1, 5, 0, 219, 217, 1, 5, 0, 229, 215, 7, 1, 0, 229, 215, 6, 1, 0, 229, 216, 6, 2, 0, 221, 215, 5, 1, 0, 230, 217, 5, 1, 0, 221, 215, 1, 4, 0, 220, 220, 1, 1, 0, 231, 218, 4, 1, 0, 222, 215, 4, 2, 0, 222, 217, 1, 2, 0, 235, 213, 1, 2, 0, 222, 217, 2, 1, 0, 232, 218, 3, 1, 0, 232, 219, 3, 1, 0,
            233, 219, 2, 1, 0, 233, 220, 1, 1, 0, 222, 218, 1, 1, 0, 234, 221, 1, 1, 0
        ],
        [8, 30, ["#000000", 1], 164, 205, 16, 5, 0, 180, 206, 1, 4, 0, 163, 208, 1, 6, 0, 164, 210, 8, 1, 0, 175, 210, 5, 1, 0, 164, 204, 16, 1, 0, 164, 204, 15, 1, 0, 165, 202, 15, 2, 0, 165, 201, 14, 1, 0, 165, 201, 12, 1, 0, 166, 200, 12, 1, 0, 166, 200, 11, 1, 0, 167, 199, 11, 1, 0, 167, 199, 9, 1, 0, 169, 198, 7, 1, 0, 164, 211, 7, 1, 0, 164, 211, 7, 2, 0, 164, 213, 6, 1, 0, 164, 213, 5, 1, 0, 175, 211, 5, 1, 0, 176, 212, 4, 1, 0, 164, 214, 4, 1, 0, 164, 214, 4, 1, 0, 176, 213, 4, 1, 0, 177, 213, 3, 1, 0, 164, 215, 3, 1, 0, 164, 215, 2, 1, 0, 177, 214, 3, 1, 0, 177, 214, 2, 1, 0, 177, 215, 2,
            1, 0, 164, 216, 2, 1, 0, 165, 216, 1, 1, 0, 178, 216, 1, 1, 0
        ],
        [8, 31, ["#ffe194", 1], 221, 225, 12, 1, 0, 221, 226, 11, 1, 0, 221, 224, 11, 2, 0, 221, 223, 11, 1, 0, 221, 226, 11, 1, 0, 222, 227, 10, 1, 0, 228, 223, 4, 1, 0, 221, 223, 5, 1, 0, 223, 227, 8, 1, 0, 223, 228, 7, 1, 0, 226, 228, 3, 1, 0, 222, 222, 5, 1, 0, 222, 222, 3, 1, 0, 229, 222, 3, 1, 0, 223, 221, 3, 1, 0, 226, 229, 2, 1, 0, 223, 221, 2, 1, 0, 229, 222, 2, 1, 0, 229, 221, 2, 1, 0, 224, 220, 2, 1, 0, 229, 220, 1, 1, 0],
        [8, 32, ["#ffe194", 1], 167, 218, 9, 3, 0, 176, 219, 1, 2, 0, 166, 219, 1, 1, 0, 169, 221, 7, 1, 0, 168, 217, 8, 1, 0, 174, 217, 2, 1, 0, 168, 217, 2, 1, 0, 169, 221, 6, 1, 0, 169,
            222, 6, 1, 0, 170, 222, 4, 1, 0, 171, 223, 3, 1, 0, 169, 216, 2, 1, 0, 169, 216, 1, 1, 0, 174, 216, 1, 1, 0, 170, 215, 1, 1, 0
        ],
        [1, 33, ["#ffffff", 2, 1],
            [223, 210],
            [223, 211],
            [223, 212],
            [222, 212],
            [221, 212],
            [221, 211],
            [221, 210],
            [222, 211],
            [223, 211],
            [223, 212],
            [223, 211],
            [223, 210],
            [224, 210],
            [224, 211],
            [224, 212],
            [223, 212],
            [222, 212],
            [222, 211],
            [222, 210],
            [223, 210],
            [223, 211],
            [223, 212],
            [222, 212]
        ],
        [1, 34, ["#ffffff", 2, 1],
            [167, 204],
            [166, 205],
            [165, 206],
            [164, 205],
            [165, 205],
            [165, 204],
            [166, 204],
            [166, 205],
            [165, 206],
            [164, 207],
            [163, 206],
            [163, 205],
            [164, 204],
            [165,
                204
            ],
            [166, 203],
            [166, 204],
            [166, 205],
            [165, 206],
            [164, 206],
            [164, 205],
            [165, 204],
            [166, 204]
        ],
        [1, 35, ["#000000", 2, 1],
            [174, 123],
            [173, 124],
            [173, 125],
            [171, 128],
            [168, 134],
            [164, 143],
            [159, 154],
            [154, 171],
            [153, 180],
            [153, 188],
            [155, 193]
        ],
        [1, 36, ["#000000", 2, 1],
            [157, 193],
            [157, 192],
            [157, 191],
            [158, 190],
            [159, 189],
            [160, 189],
            [161, 189],
            [162, 189],
            [163, 190],
            [163, 191]
        ],
        [1, 37, ["#000000", 2, 1],
            [171, 148],
            [170, 150],
            [169, 154],
            [167, 161],
            [165, 170],
            [163, 183],
            [163, 189]
        ],
        [1, 38, ["#000000", 2, 1],
            [172, 148],
            [172, 147],
            [172, 146],
            [171, 148],
            [170,
                153
            ],
            [168, 160],
            [166, 174],
            [166, 182],
            [166, 187],
            [166, 189],
            [167, 190]
        ],
        [1, 39, ["#000000", 2, 1],
            [168, 191],
            [168, 190],
            [169, 190],
            [170, 189],
            [171, 189],
            [172, 189]
        ],
        [1, 40, ["#000000", 2, 1],
            [186, 130],
            [186, 131],
            [184, 133],
            [182, 138],
            [180, 145],
            [176, 154],
            [174, 165],
            [172, 180],
            [172, 186],
            [172, 190]
        ],
        [1, 41, ["#000000", 2, 1],
            [181, 145],
            [181, 146],
            [179, 151],
            [178, 157],
            [177, 165],
            [176, 178],
            [176, 185],
            [176, 189],
            [176, 191]
        ],
        [1, 42, ["#000000", 2, 1],
            [177, 192],
            [178, 191],
            [180, 190],
            [182, 189],
            [184, 189],
            [186, 189],
            [187, 191],
            [187, 193]
        ],
        [1, 43, ["#000000",
                2, 1
            ],
            [199, 130],
            [198, 134],
            [196, 141],
            [193, 151],
            [190, 163],
            [187, 181],
            [187, 188],
            [187, 192]
        ],
        [1, 44, ["#000000", 2, 1],
            [199, 134],
            [199, 136],
            [197, 140],
            [196, 147],
            [193, 161],
            [192, 172],
            [192, 181],
            [192, 187],
            [192, 191]
        ],
        [1, 45, ["#000000", 2, 1],
            [193, 192],
            [194, 192],
            [195, 191],
            [196, 191]
        ],
        [1, 46, ["#000000", 2, 1],
            [200, 154],
            [200, 153],
            [200, 152],
            [200, 153],
            [199, 155],
            [198, 159],
            [197, 165],
            [196, 177],
            [196, 185],
            [196, 190],
            [197, 191]
        ],
        [1, 47, ["#000000", 2, 1],
            [201, 152],
            [201, 153],
            [201, 156],
            [200, 165],
            [199, 173],
            [199, 180],
            [200, 188],
            [201, 190],
            [202,
                191
            ]
        ],
        [1, 48, ["#000000", 2, 1],
            [203, 192],
            [204, 191],
            [205, 190],
            [207, 190],
            [208, 190],
            [210, 192],
            [211, 193]
        ],
        [1, 49, ["#000000", 2, 1],
            [217, 129],
            [217, 133],
            [217, 145],
            [216, 157],
            [215, 170],
            [213, 181],
            [212, 188],
            [211, 192],
            [210, 192]
        ],
        [1, 50, ["#000000", 2, 1],
            [217, 161],
            [217, 160],
            [218, 161],
            [218, 163],
            [218, 169],
            [218, 176],
            [217, 183],
            [216, 188],
            [215, 191]
        ],
        [1, 51, ["#000000", 2, 1],
            [215, 190],
            [216, 190],
            [216, 191],
            [217, 191],
            [217, 192],
            [219, 192],
            [220, 193],
            [221, 195],
            [222, 195],
            [223, 194],
            [224, 193],
            [224, 192],
            [225, 192],
            [226, 191],
            [227, 191],
            [228,
                191
            ]
        ],
        [1, 52, ["#000000", 2, 1],
            [229, 122],
            [230, 123],
            [230, 125],
            [232, 131],
            [234, 140],
            [235, 151],
            [235, 163],
            [234, 173],
            [232, 180],
            [230, 186],
            [229, 188],
            [229, 190]
        ],
        [1, 53, ["#000000", 2, 1],
            [236, 161],
            [237, 164],
            [237, 168],
            [236, 175],
            [235, 182],
            [234, 190],
            [232, 193],
            [232, 194]
        ],
        [1, 54, ["#000000", 2, 1],
            [231, 197],
            [232, 196],
            [233, 196],
            [234, 196],
            [234, 195],
            [235, 195]
        ],
        [1, 55, ["#000000", 2, 1],
            [243, 142],
            [244, 145],
            [244, 149],
            [244, 157],
            [243, 167],
            [240, 182],
            [238, 189],
            [236, 195],
            [235, 197],
            [235, 198]
        ],
        [1, 56, ["#000000", 2, 1],
            [244, 154],
            [244, 153],
            [244,
                154
            ],
            [245, 155],
            [245, 158],
            [245, 164],
            [244, 170],
            [243, 178],
            [241, 187],
            [240, 191],
            [239, 194],
            [239, 195],
            [239, 197],
            [240, 196]
        ],
        [1, 57, ["#000000", 2, 1],
            [239, 196],
            [240, 196],
            [241, 196],
            [243, 197],
            [244, 199],
            [244, 200],
            [244, 201],
            [245, 201]
        ],
        [1, 58, ["#000000", 2, 1],
            [238, 118],
            [240, 120],
            [243, 128],
            [246, 138],
            [249, 152],
            [250, 169],
            [251, 198],
            [250, 216],
            [249, 233],
            [248, 246],
            [246, 258],
            [245, 262],
            [244, 265],
            [244, 266]
        ],
        [1, 59, ["#000000", 2, 1],
            [247, 202],
            [248, 201],
            [248, 198],
            [250, 195],
            [251, 192],
            [252, 192]
        ],
        [1, 60, ["#000000", 2, 1],
            [245, 260],
            [245,
                261
            ],
            [245, 262],
            [245, 263],
            [243, 269],
            [241, 276],
            [238, 282],
            [236, 288],
            [235, 289]
        ],
        [1, 61, ["#000000", 2, 1],
            [244, 277],
            [243, 278],
            [241, 282],
            [239, 286],
            [237, 290],
            [236, 291],
            [236, 292]
        ],
        [1, 62, ["#000000", 2, 1],
            [244, 276],
            [243, 279],
            [243, 282],
            [241, 287],
            [240, 289],
            [240, 290]
        ],
        [1, 63, ["#000000", 2, 1],
            [241, 288],
            [241, 289],
            [242, 288],
            [244, 288],
            [246, 288],
            [249, 288],
            [251, 287]
        ],
        [1, 64, ["#000000", 2, 1],
            [267, 194],
            [267, 193],
            [267, 195],
            [267, 200],
            [267, 209],
            [266, 222],
            [263, 237],
            [259, 260],
            [256, 272],
            [254, 281],
            [252, 286],
            [251, 288]
        ],
        [1, 65, ["#000000",
                2, 1
            ],
            [254, 287],
            [254, 290],
            [254, 298],
            [255, 305],
            [255, 311],
            [256, 314]
        ],
        [1, 66, ["#000000", 2, 1],
            [171, 100],
            [170, 100],
            [169, 101],
            [168, 101],
            [166, 102],
            [163, 104],
            [160, 106],
            [155, 110],
            [149, 115],
            [140, 126],
            [133, 134],
            [126, 145],
            [121, 155],
            [117, 167],
            [114, 181],
            [112, 203],
            [110, 220],
            [108, 235],
            [107, 254],
            [107, 263],
            [107, 267]
        ],
        [1, 67, ["#000000", 2, 1],
            [166, 103],
            [167, 103],
            [168, 102],
            [171, 100],
            [180, 96],
            [190, 95],
            [203, 96],
            [217, 99],
            [235, 104],
            [243, 107]
        ],
        [1, 68, ["#000000", 2, 1],
            [243, 107],
            [246, 107],
            [250, 109],
            [255, 113],
            [262, 119],
            [273, 133],
            [278,
                143
            ],
            [281, 152],
            [283, 159],
            [284, 162]
        ],
        [1, 69, ["#000000", 2, 1],
            [284, 168]
        ],
        [1, 70, ["#000000", 2, 1],
            [282, 159],
            [283, 159],
            [284, 161],
            [285, 164],
            [286, 169],
            [287, 184],
            [288, 201],
            [288, 221],
            [288, 240],
            [289, 266],
            [290, 280],
            [292, 292],
            [294, 302],
            [296, 308],
            [298, 311]
        ],
        [1, 71, ["#000000", 2, 1],
            [172, 251],
            [172, 252],
            [172, 251],
            [172, 250],
            [172, 249],
            [172, 247],
            [172, 244],
            [172, 242],
            [171, 241],
            [171, 240],
            [170, 240],
            [170, 239],
            [169, 239],
            [169, 240],
            [168, 241],
            [168, 242],
            [167, 244],
            [167, 246],
            [166, 248],
            [166, 249],
            [165, 250],
            [165, 251],
            [164, 251],
            [164, 252],
            [163, 252],
            [163, 253],
            [164, 253]
        ],
        [1, 72, ["#000000", 2, 1],
            [163, 253],
            [162, 253],
            [162, 254],
            [162, 255],
            [161, 256],
            [161, 260],
            [161, 262],
            [161, 265],
            [161, 266]
        ],
        [1, 73, ["#000000", 2, 1],
            [172, 254],
            [172, 253],
            [173, 253],
            [174, 253],
            [179, 253],
            [185, 253],
            [192, 253],
            [199, 253],
            [202, 253],
            [203, 254]
        ],
        [1, 74, ["#000000", 2, 1],
            [203, 254],
            [204, 254],
            [205, 254],
            [206, 254],
            [207, 255],
            [207, 256],
            [207, 257],
            [204, 259],
            [201, 260],
            [197, 260],
            [195, 260],
            [192, 260],
            [191, 260]
        ],
        [1, 75, ["#000000", 2, 1],
            [189, 261],
            [189, 262],
            [189, 263],
            [189, 264],
            [189, 265],
            [189, 266],
            [188, 266],
            [187, 266],
            [186, 266],
            [186, 267],
            [187, 267],
            [187, 268],
            [187, 269],
            [186, 269],
            [186, 270],
            [186, 271],
            [186, 272],
            [185, 272],
            [184, 272],
            [183, 272],
            [182, 272],
            [181, 272],
            [181, 273],
            [181, 274],
            [180, 275],
            [180, 276],
            [180, 277]
        ],
        [1, 76, ["#000000", 2, 1],
            [150, 276],
            [150, 277],
            [150, 278],
            [149, 278],
            [149, 276],
            [151, 272],
            [154, 269],
            [157, 266],
            [161, 264],
            [168, 265],
            [173, 268],
            [176, 271],
            [179, 274],
            [181, 276],
            [182, 278],
            [184, 279]
        ],
        [1, 77, ["#000000", 2, 1],
            [183, 277],
            [185, 281],
            [187, 285],
            [189, 290],
            [191, 298],
            [192, 306],
            [193, 316],
            [193, 320],
            [194,
                323
            ]
        ],
        [1, 78, ["#000000", 2, 1],
            [188, 269],
            [190, 270],
            [192, 271],
            [195, 271],
            [198, 271],
            [204, 269],
            [207, 267],
            [209, 266]
        ],
        [1, 79, ["#000000", 2, 1],
            [211, 265],
            [211, 266],
            [211, 267],
            [211, 269],
            [212, 269],
            [213, 270]
        ],
        [1, 80, ["#000000", 2, 1],
            [212, 268],
            [212, 269],
            [211, 269],
            [209, 269],
            [207, 270],
            [204, 272],
            [202, 273],
            [200, 274],
            [199, 275],
            [199, 274],
            [200, 274],
            [201, 273]
        ],
        [1, 81, ["#000000", 2, 1],
            [201, 275],
            [202, 275],
            [204, 275],
            [205, 276],
            [206, 278],
            [207, 282],
            [206, 285],
            [204, 287],
            [203, 288],
            [203, 289]
        ],
        [1, 82, ["#000000", 2, 1],
            [203, 287],
            [204, 288],
            [205,
                289
            ],
            [206, 291],
            [207, 293],
            [208, 294],
            [208, 295]
        ],
        [1, 83, ["#000000", 2, 1],
            [208, 292],
            [208, 293],
            [208, 294],
            [208, 296],
            [208, 297]
        ],
        [1, 84, ["#000000", 2, 1],
            [203, 297],
            [204, 297],
            [205, 297],
            [207, 297]
        ],
        [1, 85, ["#000000", 2, 1],
            [200, 289],
            [200, 291],
            [201, 293],
            [203, 295],
            [203, 296],
            [204, 297]
        ],
        [1, 86, ["#000000", 2, 1],
            [198, 289],
            [198, 290],
            [198, 294],
            [199, 296]
        ],
        [1, 87, ["#000000", 2, 1],
            [199, 295],
            [200, 296],
            [201, 297],
            [201, 298],
            [201, 299]
        ],
        [1, 88, ["#000000", 2, 1],
            [199, 298],
            [200, 298],
            [200, 299],
            [199, 299],
            [198, 300],
            [197, 301],
            [196, 302]
        ],
        [1, 89, ["#000000",
                2, 1
            ],
            [192, 298],
            [193, 298],
            [194, 299],
            [195, 299],
            [197, 299],
            [198, 299]
        ],
        [1, 90, ["#000000", 2, 1],
            [192, 294],
            [192, 295],
            [191, 297],
            [191, 298],
            [191, 299]
        ],
        [1, 91, ["#000000", 2, 1],
            [193, 290],
            [193, 291],
            [193, 293],
            [193, 294],
            [194, 294]
        ],
        [1, 92, ["#000000", 2, 1],
            [186, 280],
            [186, 279],
            [186, 278],
            [186, 277],
            [186, 276],
            [188, 275],
            [189, 274],
            [190, 274]
        ],
        [1, 93, ["#000000", 2, 1],
            [188, 273],
            [188, 274],
            [189, 275],
            [190, 275],
            [193, 275],
            [196, 275],
            [200, 273],
            [201, 273]
        ],
        [1, 94, ["#000000", 2, 1],
            [198, 277],
            [198, 278],
            [199, 278],
            [200, 278],
            [201, 278],
            [203, 279],
            [203,
                281
            ],
            [203, 282],
            [203, 283],
            [203, 284],
            [202, 284]
        ],
        [1, 95, ["#000000", 2, 1],
            [199, 277],
            [199, 278],
            [199, 279],
            [198, 280],
            [198, 281],
            [198, 282],
            [199, 281],
            [200, 281],
            [200, 282],
            [201, 283],
            [201, 284]
        ],
        [1, 96, ["#000000", 2, 1],
            [199, 282],
            [198, 284],
            [198, 285],
            [197, 285]
        ],
        [1, 97, ["#000000", 2, 1],
            [193, 283],
            [193, 284],
            [194, 284],
            [195, 285],
            [196, 285],
            [196, 286],
            [197, 286],
            [197, 287]
        ],
        [1, 98, ["#000000", 2, 1],
            [192, 283],
            [192, 282],
            [192, 281],
            [193, 281],
            [193, 280],
            [194, 280],
            [195, 280]
        ],
        [1, 99, ["#000000", 2, 1],
            [192, 283],
            [193, 279],
            [193, 280],
            [193, 282]
        ],
        [1, 100, ["#000000", 2, 1],
            [193, 277],
            [192, 278],
            [191, 279],
            [190, 280],
            [190, 281],
            [190, 282],
            [190, 283],
            [190, 284],
            [191, 285],
            [193, 286]
        ],
        [1, 101, ["#000000", 2, 1],
            [209, 285],
            [210, 285],
            [210, 284],
            [212, 283],
            [215, 282],
            [219, 282],
            [221, 282],
            [223, 284],
            [224, 284]
        ],
        [1, 102, ["#000000", 2, 1],
            [212, 270],
            [213, 270],
            [213, 271],
            [214, 272],
            [215, 273],
            [217, 275],
            [221, 276],
            [227, 278],
            [231, 278],
            [234, 279],
            [236, 279],
            [238, 279],
            [239, 280],
            [241, 281],
            [241, 282]
        ],
        [1, 103, ["#000000", 2, 1],
            [237, 297],
            [237, 298],
            [236, 298],
            [236, 299],
            [236, 300],
            [236, 303],
            [236, 304],
            [236, 305]
        ],
        [1, 104, ["#000000", 2, 1],
            [195, 307],
            [195, 308],
            [195, 309],
            [195, 310],
            [194, 313],
            [194, 316],
            [195, 319],
            [195, 321],
            [197, 324]
        ],
        [1, 105, ["#000000", 2, 1],
            [191, 306],
            [191, 305],
            [192, 305],
            [193, 305],
            [194, 305],
            [195, 305],
            [196, 305],
            [197, 305],
            [197, 306],
            [196, 306],
            [196, 307],
            [195, 308],
            [196, 308],
            [196, 307],
            [197, 306],
            [200, 305],
            [203, 305],
            [206, 304],
            [209, 304],
            [213, 303]
        ],
        [1, 106, ["#000000", 2, 1],
            [211, 304],
            [212, 304],
            [213, 304],
            [214, 303],
            [215, 303],
            [216, 303],
            [216, 304],
            [216, 305],
            [215, 306],
            [214, 307],
            [213, 308],
            [214, 308],
            [215, 308],
            [216, 307],
            [219, 306],
            [221, 306],
            [224, 305],
            [229, 304],
            [231, 303]
        ],
        [1, 107, ["#000000", 2, 1],
            [215, 308],
            [215, 309],
            [214, 309],
            [213, 312],
            [212, 315],
            [210, 318],
            [209, 321],
            [209, 322],
            [210, 322]
        ],
        [1, 108, ["#000000", 2, 1],
            [195, 326],
            [197, 326],
            [198, 326],
            [201, 326],
            [204, 325],
            [207, 323],
            [209, 321]
        ],
        [1, 109, ["#000000", 2, 1],
            [211, 321],
            [212, 323],
            [214, 323],
            [216, 323],
            [218, 322]
        ],
        [1, 110, ["#000000", 2, 1],
            [232, 302],
            [232, 303],
            [232, 302],
            [233, 302],
            [233, 303],
            [232, 303],
            [231, 304],
            [229, 305],
            [225, 310],
            [222, 314],
            [219, 319],
            [218, 322],
            [218, 324]
        ],
        [1, 111,
            ["#000000", 2, 1],
            [235, 307],
            [232, 309],
            [230, 311],
            [228, 314],
            [225, 319],
            [221, 325],
            [220, 327],
            [220, 328]
        ],
        [1, 112, ["#000000", 2, 1],
            [235, 309],
            [236, 309],
            [237, 309],
            [239, 308],
            [240, 307],
            [242, 307],
            [243, 307],
            [243, 306],
            [244, 306],
            [244, 307],
            [245, 307],
            [245, 308],
            [245, 309],
            [246, 309],
            [246, 308],
            [247, 308],
            [248, 308],
            [249, 307],
            [250, 306],
            [253, 305]
        ],
        [1, 113, ["#000000", 2, 1],
            [245, 309],
            [245, 310],
            [244, 311],
            [243, 313],
            [242, 314],
            [242, 316],
            [243, 316]
        ],
        [1, 114, ["#000000", 2, 1],
            [255, 314],
            [254, 316],
            [253, 319],
            [251, 324],
            [251, 326]
        ],
        [1, 115, ["#000000",
                2, 1
            ],
            [256, 313],
            [257, 313],
            [258, 313],
            [260, 312],
            [263, 311],
            [264, 311],
            [265, 311],
            [265, 312],
            [264, 314],
            [263, 315],
            [262, 317],
            [261, 319],
            [259, 321],
            [258, 324],
            [257, 325]
        ],
        [1, 116, ["#000000", 2, 1],
            [232, 302],
            [232, 303],
            [231, 303],
            [232, 302],
            [233, 302],
            [235, 302],
            [237, 302],
            [238, 303],
            [238, 304],
            [238, 305],
            [238, 306],
            [238, 307]
        ],
        [1, 117, ["#000000", 2, 1],
            [194, 322],
            [193, 322],
            [193, 323],
            [193, 324],
            [193, 325],
            [193, 328],
            [193, 330],
            [194, 331]
        ],
        [1, 118, ["#000000", 2, 1],
            [194, 328],
            [195, 328],
            [196, 328],
            [197, 328],
            [199, 328],
            [203, 328],
            [209, 329],
            [213,
                329
            ],
            [217, 329]
        ],
        [1, 119, ["#000000", 2, 1],
            [241, 318],
            [241, 317],
            [242, 316],
            [243, 316],
            [243, 315],
            [245, 315],
            [246, 315],
            [248, 315],
            [248, 316],
            [249, 316],
            [249, 317],
            [249, 318],
            [249, 319],
            [249, 320],
            [249, 321],
            [250, 321],
            [250, 320]
        ],
        [1, 120, ["#000000", 2, 1],
            [243, 322],
            [242, 322],
            [243, 322],
            [244, 322],
            [245, 322],
            [246, 322],
            [247, 322],
            [249, 322],
            [250, 322]
        ],
        [1, 121, ["#000000", 2, 1],
            [233, 311],
            [233, 312],
            [233, 314],
            [233, 315],
            [234, 316],
            [235, 316]
        ],
        [1, 122, ["#000000", 2, 1],
            [227, 314],
            [228, 314],
            [230, 315],
            [233, 315],
            [234, 316]
        ],
        [1, 123, ["#000000", 2,
                1
            ],
            [226, 320],
            [226, 321],
            [226, 322],
            [227, 323],
            [228, 323],
            [229, 324],
            [230, 324],
            [232, 324],
            [234, 323],
            [235, 323],
            [237, 322],
            [238, 322]
        ],
        [1, 124, ["#000000", 2, 1],
            [234, 322],
            [234, 323],
            [233, 323],
            [232, 323],
            [231, 324],
            [229, 325],
            [228, 325],
            [228, 326],
            [227, 327],
            [228, 328],
            [229, 329],
            [230, 329],
            [231, 330],
            [232, 330]
        ],
        [1, 125, ["#000000", 2, 1],
            [236, 328],
            [235, 329],
            [234, 330]
        ],
        [1, 126, ["#000000", 2, 1],
            [244, 324],
            [245, 326],
            [245, 327],
            [247, 327],
            [248, 328],
            [248, 329]
        ],
        [1, 127, ["#000000", 2, 1],
            [237, 318],
            [236, 318],
            [235, 319],
            [235, 320],
            [235, 322],
            [236,
                323
            ],
            [237, 324],
            [239, 324],
            [240, 324],
            [242, 323],
            [242, 321],
            [242, 320],
            [242, 319],
            [241, 318],
            [240, 317],
            [239, 318],
            [238, 318],
            [237, 318]
        ],
        [1, 128, ["#000000", 2, 1],
            [236, 328],
            [237, 328],
            [238, 327],
            [239, 327],
            [240, 328],
            [241, 329],
            [241, 330],
            [242, 330]
        ],
        [1, 129, ["#000000", 2, 1],
            [242, 330],
            [243, 330],
            [246, 328],
            [247, 328]
        ],
        [1, 130, ["#000000", 2, 1],
            [107, 264],
            [107, 265],
            [107, 268],
            [107, 280],
            [107, 291],
            [107, 303],
            [108, 313],
            [108, 319],
            [109, 322]
        ],
        [4, 131, ["#000000", 1, 1],
            [98, 95],
            [300, 331]
        ],
        [1, 132, ["#000000", 2, 1],
            [253, 326],
            [253, 325],
            [255, 324],
            [256, 324],
            [257, 324]
        ],
        [1, 133, ["#000000", 2, 1],
            [220, 323],
            [221, 323],
            [222, 323]
        ],
        [1, 134, ["#000000", 2, 1],
            [219, 329],
            [219, 328],
            [220, 328],
            [220, 327],
            [221, 327]
        ],
        [8, 135, ["#ff8a8a", 1], 195, 314, 16, 1, 0, 195, 315, 16, 1, 0, 196, 312, 16, 3, 0, 211, 305, 1, 9, 0, 196, 309, 15, 3, 0, 196, 315, 15, 1, 0, 196, 316, 15, 1, 0, 197, 309, 15, 1, 0, 197, 308, 14, 1, 0, 196, 317, 14, 1, 0, 196, 317, 14, 1, 0, 198, 307, 14, 1, 0, 199, 307, 13, 1, 0, 196, 318, 13, 1, 0, 196, 318, 13, 2, 0, 196, 320, 12, 1, 0, 201, 306, 10, 1, 0, 197, 320, 12, 1, 0, 197, 321, 11, 1, 0, 197, 321, 11, 1, 0, 197, 322, 10, 1, 0, 205, 306, 7, 1, 0, 198,
            322, 9, 1, 0, 198, 323, 8, 1, 0, 212, 305, 1, 7, 0, 198, 323, 7, 1, 0, 212, 309, 1, 2, 0, 212, 305, 1, 2, 0, 198, 324, 6, 1, 0, 207, 305, 4, 1, 0, 198, 324, 5, 1, 0, 198, 325, 2, 1, 0, 213, 305, 1, 2, 0, 213, 305, 1, 1, 0, 214, 305, 1, 1, 0
        ],
        [8, 136, ["#ff8a8a", 1], 193, 307, 1, 1, 0],
        [8, 137, ["#ff8a8a", 1], 214, 314, 8, 1, 0, 214, 314, 7, 1, 0, 214, 312, 7, 2, 0, 221, 307, 1, 6, 0, 215, 311, 7, 2, 0, 214, 315, 7, 1, 0, 213, 315, 1, 7, 0, 214, 316, 6, 1, 0, 214, 317, 4, 5, 0, 213, 316, 1, 6, 0, 215, 310, 6, 1, 0, 216, 310, 6, 1, 0, 217, 317, 2, 1, 0, 222, 307, 1, 6, 0, 217, 308, 5, 2, 0, 222, 307, 1, 5, 0, 216, 309, 1, 1, 0, 212, 317, 1, 5, 0, 217, 317, 1, 4, 0,
            214, 322, 2, 1, 0, 212, 318, 1, 3, 0, 223, 307, 1, 5, 0, 223, 307, 1, 4, 0, 224, 307, 1, 3, 0, 218, 317, 1, 2, 0, 224, 306, 1, 3, 0, 225, 306, 1, 3, 0, 225, 306, 1, 2, 0, 211, 319, 1, 2, 0, 226, 306, 1, 1, 0, 218, 317, 1, 1, 0, 211, 320, 1, 1, 0, 218, 308, 4, 1, 0, 220, 307, 2, 1, 0, 226, 306, 1, 1, 0
        ],
        [8, 138, ["#ff8a8a", 1], 245, 312, 10, 2, 0, 254, 313, 1, 1, 0, 244, 313, 1, 1, 0, 249, 314, 5, 1, 0, 245, 312, 9, 1, 0, 246, 311, 9, 1, 0, 246, 310, 8, 1, 0, 247, 310, 8, 1, 0, 247, 309, 7, 1, 0, 249, 309, 5, 1, 0, 250, 308, 5, 1, 0, 249, 315, 5, 1, 0, 250, 315, 4, 1, 0, 250, 308, 4, 1, 0, 251, 307, 4, 1, 0, 252, 307, 3, 1, 0, 250, 316, 3, 1, 0, 250, 316, 3, 2, 0, 250,
            318, 2, 2, 0, 253, 306, 1, 1, 0, 251, 319, 1, 1, 0
        ],
        [8, 139, ["#ff8a8a", 1], 255, 318, 6, 1, 0, 255, 318, 6, 1, 0, 255, 316, 6, 2, 0, 261, 313, 1, 4, 0, 256, 315, 5, 1, 0, 255, 319, 5, 1, 0, 255, 319, 5, 1, 0, 257, 314, 4, 1, 0, 254, 319, 1, 4, 0, 255, 320, 4, 1, 0, 255, 321, 4, 1, 0, 255, 322, 3, 1, 0, 254, 321, 1, 3, 0, 261, 313, 1, 3, 0, 259, 314, 2, 1, 0, 262, 313, 1, 3, 0, 253, 322, 1, 2, 0, 262, 313, 1, 2, 0, 253, 323, 1, 1, 0, 263, 313, 1, 1, 0, 260, 313, 1, 1, 0, 263, 312, 1, 1, 0, 255, 323, 3, 1, 0],
        [8, 140, ["#fbdc89", 1], 234, 310, 9, 1, 0, 234, 311, 9, 1, 0, 238, 310, 5, 1, 0, 234, 312, 8, 1, 0, 234, 313, 8, 1, 0, 234, 314, 7, 1, 0, 235, 315, 7, 1, 0,
            236, 315, 5, 1, 0, 236, 316, 5, 1, 0, 243, 308, 1, 2, 0, 239, 309, 4, 1, 0, 236, 316, 3, 1, 0, 240, 309, 3, 1, 0, 241, 308, 3, 1, 0, 236, 317, 3, 1, 0, 244, 308, 1, 2, 0
        ],
        [8, 141, ["#fbdc89", 1], 243, 317, 5, 4, 0, 243, 317, 1, 1, 0, 244, 317, 4, 1, 0, 244, 316, 3, 1, 0],
        [8, 142, ["#fbdc89", 1], 236, 320, 5, 2, 0, 239, 321, 2, 1, 0, 237, 319, 4, 1, 0, 239, 322, 2, 1, 0, 239, 323, 1, 1, 0],
        [8, 143, ["#fbdc89", 1], 227, 318, 8, 1, 0, 227, 318, 7, 3, 0, 228, 317, 7, 1, 0, 235, 317, 1, 1, 0, 228, 317, 6, 1, 0, 227, 319, 1, 1, 0, 227, 321, 6, 1, 0, 228, 322, 6, 1, 0, 229, 322, 2, 1, 0, 228, 316, 5, 1, 0, 229, 316, 1, 1, 0, 230, 323, 1, 1, 0],
        [8, 144, ["#fbdc89",
            1
        ], 229, 326, 8, 1, 0, 229, 327, 8, 1, 0, 230, 326, 7, 1, 0, 229, 327, 6, 1, 0, 237, 325, 7, 1, 0, 231, 325, 6, 1, 0, 233, 325, 4, 1, 0, 230, 328, 5, 1, 0, 231, 328, 3, 1, 0, 235, 324, 1, 1, 0, 232, 329, 2, 1, 0, 240, 326, 4, 1, 0, 241, 325, 2, 1, 0, 241, 327, 4, 1, 0, 241, 327, 3, 1, 0, 242, 328, 3, 1, 0, 242, 328, 2, 1, 0, 242, 324, 1, 1, 0, 242, 329, 1, 1, 0, 243, 324, 1, 1, 0],
        [1, 145, ["#000000", 2, "1"],
            [150, 275],
            [149, 276],
            [147, 279],
            [145, 285],
            [142, 294],
            [139, 309],
            [138, 316],
            [139, 321],
            [140, 324]
        ],
        [1, 146, ["#000000", 14, "0.61"],
            [115, 311],
            [114, 312],
            [114, 308],
            [114, 299],
            [117, 279],
            [120, 264],
            [121, 252],
            [122,
                245
            ],
            [123, 246],
            [122, 254],
            [121, 267],
            [121, 282],
            [121, 298],
            [121, 310],
            [121, 315],
            [122, 309],
            [124, 296],
            [126, 278],
            [130, 259],
            [133, 240],
            [134, 239],
            [134, 249],
            [131, 276],
            [128, 297],
            [124, 315],
            [122, 324],
            [121, 314],
            [123, 295],
            [128, 270],
            [134, 248],
            [140, 237],
            [144, 239],
            [145, 261],
            [143, 280],
            [140, 296],
            [137, 304],
            [135, 303],
            [135, 284],
            [138, 268],
            [142, 257],
            [146, 256],
            [146, 264],
            [145, 273],
            [142, 278],
            [139, 277],
            [139, 269],
            [139, 257],
            [142, 248],
            [144, 245],
            [147, 248],
            [149, 260],
            [149, 267],
            [148, 268],
            [147, 264],
            [147, 253],
            [147, 236],
            [148, 230],
            [149, 229],
            [149, 237],
            [147, 243],
            [144, 244],
            [142, 242],
            [138, 228],
            [138, 216],
            [138, 204],
            [138, 197],
            [139, 199],
            [141, 208],
            [141, 225],
            [139, 234],
            [138, 237],
            [137, 231],
            [137, 216],
            [139, 187],
            [140, 168],
            [140, 154],
            [141, 154],
            [139, 167],
            [137, 187],
            [132, 209],
            [125, 240],
            [121, 249],
            [120, 248],
            [120, 238],
            [122, 221],
            [127, 199],
            [136, 168],
            [140, 159],
            [141, 160],
            [139, 172],
            [135, 192],
            [126, 224],
            [119, 242],
            [113, 252],
            [109, 249],
            [109, 235],
            [112, 213],
            [120, 186],
            [134, 148],
            [141, 134],
            [144, 129],
            [145, 131],
            [145, 138],
            [142, 150],
            [138, 170],
            [134, 182],
            [132, 189],
            [131, 188],
            [134,
                178
            ],
            [143, 155],
            [150, 140],
            [157, 128],
            [162, 123],
            [161, 130],
            [157, 146],
            [152, 163],
            [144, 183],
            [142, 186],
            [142, 181],
            [146, 167],
            [153, 150],
            [160, 136],
            [166, 127],
            [166, 133],
            [163, 147],
            [158, 165],
            [152, 180],
            [148, 184],
            [149, 174],
            [155, 156],
            [167, 128],
            [174, 118],
            [176, 117],
            [176, 128],
            [170, 154],
            [164, 168],
            [161, 173],
            [160, 168],
            [164, 155],
            [175, 128],
            [182, 116],
            [186, 112],
            [186, 117],
            [182, 131],
            [176, 147],
            [168, 161],
            [166, 160],
            [167, 150],
            [177, 130],
            [184, 120],
            [188, 119],
            [188, 129],
            [181, 153],
            [176, 168],
            [170, 177],
            [167, 178],
            [167, 171],
            [174, 155],
            [180, 145],
            [184, 141],
            [185, 144],
            [183, 155],
            [178, 169],
            [171, 184],
            [168, 186],
            [168, 181],
            [173, 164],
            [180, 152],
            [187, 144],
            [191, 142],
            [191, 151],
            [188, 161],
            [184, 169],
            [182, 171],
            [182, 166],
            [187, 149],
            [194, 136],
            [201, 125],
            [207, 120],
            [209, 125],
            [208, 137],
            [201, 159],
            [196, 168],
            [193, 170],
            [195, 160],
            [201, 147],
            [208, 133],
            [214, 124],
            [217, 126],
            [216, 138],
            [213, 154],
            [208, 168],
            [204, 176],
            [202, 172],
            [203, 162],
            [207, 149],
            [211, 139],
            [212, 135],
            [212, 140],
            [207, 158],
            [202, 169],
            [198, 174],
            [197, 167],
            [200, 156],
            [204, 146],
            [208, 141],
            [210, 149],
            [209, 162],
            [207, 175],
            [205,
                183
            ],
            [205, 182],
            [209, 167],
            [215, 152],
            [222, 137],
            [229, 128],
            [233, 127],
            [234, 136],
            [232, 159],
            [227, 172],
            [224, 179],
            [222, 176],
            [224, 166],
            [227, 153],
            [231, 141],
            [234, 135],
            [234, 142],
            [233, 156],
            [230, 171],
            [227, 181],
            [225, 182],
            [226, 173],
            [230, 158],
            [235, 144],
            [239, 135],
            [242, 133],
            [245, 146],
            [245, 161],
            [244, 174],
            [243, 182],
            [242, 179],
            [244, 169],
            [247, 157],
            [254, 146],
            [257, 148],
            [259, 157],
            [260, 170],
            [259, 184],
            [257, 193],
            [256, 190],
            [256, 181],
            [257, 170],
            [258, 160],
            [259, 158],
            [261, 169],
            [262, 185],
            [263, 202],
            [262, 223],
            [262, 229],
            [261, 228],
            [260, 221],
            [259, 205],
            [260, 197],
            [260, 195],
            [261, 201],
            [261, 216],
            [263, 243],
            [263, 261],
            [262, 274],
            [261, 281],
            [260, 279],
            [259, 270],
            [259, 244],
            [261, 223],
            [263, 208],
            [265, 205],
            [265, 216],
            [263, 232],
            [261, 248],
            [257, 265],
            [255, 270],
            [254, 270],
            [253, 267],
            [253, 264],
            [253, 265],
            [253, 266],
            [252, 269],
            [251, 271],
            [251, 272],
            [250, 273],
            [249, 276],
            [249, 279],
            [248, 281],
            [248, 284],
            [248, 285],
            [249, 285],
            [249, 284],
            [253, 278],
            [256, 272],
            [260, 264],
            [264, 259],
            [268, 258],
            [271, 267],
            [272, 277],
            [273, 288],
            [274, 298],
            [275, 305],
            [275, 307],
            [275, 302],
            [273, 295],
            [270, 286],
            [267,
                279
            ],
            [267, 280],
            [267, 285],
            [269, 293],
            [272, 304],
            [274, 308],
            [274, 309],
            [274, 306],
            [271, 301],
            [268, 294],
            [264, 289],
            [263, 289],
            [262, 293],
            [262, 298],
            [262, 301],
            [263, 302],
            [264, 301],
            [265, 297],
            [268, 290],
            [269, 288],
            [270, 288],
            [272, 292],
            [272, 301],
            [272, 307],
            [273, 310],
            [274, 310],
            [276, 309],
            [278, 307],
            [281, 305],
            [283, 306],
            [284, 309],
            [284, 314],
            [284, 319],
            [284, 323],
            [285, 322],
            [287, 322],
            [288, 322],
            [287, 322],
            [286, 322],
            [282, 322],
            [277, 322],
            [274, 321],
            [273, 319],
            [274, 318],
            [277, 319],
            [281, 322],
            [286, 325],
            [289, 327],
            [291, 328],
            [292, 329],
            [293, 329],
            [294, 328],
            [295, 323],
            [295, 319],
            [294, 316],
            [291, 317],
            [286, 322],
            [282, 325],
            [280, 328],
            [279, 329],
            [282, 327],
            [284, 323],
            [286, 318],
            [286, 309],
            [285, 296],
            [278, 265],
            [271, 241],
            [266, 219],
            [263, 196],
            [262, 186],
            [262, 179],
            [262, 177],
            [262, 184],
            [263, 199],
            [266, 220],
            [269, 244],
            [273, 268],
            [276, 287],
            [278, 298],
            [279, 294],
            [279, 280],
            [277, 257],
            [274, 229],
            [270, 190],
            [269, 177],
            [269, 180],
            [271, 209],
            [273, 234],
            [276, 258],
            [277, 274],
            [278, 274],
            [277, 261],
            [276, 240],
            [274, 215],
            [271, 190],
            [270, 174],
            [269, 176],
            [269, 189],
            [271, 206],
            [272, 219],
            [272, 223],
            [272,
                213
            ],
            [270, 197],
            [267, 177],
            [263, 155],
            [263, 152],
            [264, 159],
            [267, 173],
            [272, 195],
            [274, 202],
            [274, 203],
            [274, 196],
            [273, 183],
            [272, 161],
            [271, 152],
            [271, 153],
            [272, 165],
            [274, 184],
            [277, 207],
            [278, 237],
            [278, 248],
            [277, 250],
            [277, 236],
            [277, 221],
            [278, 202],
            [277, 187],
            [277, 185],
            [276, 199],
            [276, 216],
            [275, 231],
            [273, 239],
            [269, 231],
            [266, 216],
            [263, 197],
            [260, 177],
            [257, 161],
            [254, 154],
            [250, 158],
            [248, 166],
            [246, 171],
            [243, 176],
            [241, 177],
            [239, 177],
            [236, 177],
            [232, 179],
            [231, 180],
            [232, 181],
            [234, 182],
            [236, 182],
            [239, 184],
            [243, 186],
            [246, 188],
            [248, 188],
            [250, 187],
            [250, 185],
            [251, 185],
            [251, 187],
            [251, 191],
            [251, 193],
            [251, 192],
            [251, 191],
            [251, 189],
            [251, 189],
            [251, 191],
            [251, 192],
            [251, 191],
            [249, 187],
            [244, 181],
            [241, 179],
            [237, 179],
            [233, 180],
            [230, 182],
            [228, 184],
            [226, 185],
            [225, 186],
            [225, 187],
            [225, 188],
            [226, 187],
            [226, 185],
            [226, 183],
            [225, 182],
            [224, 183],
            [222, 186],
            [221, 188],
            [221, 189],
            [221, 185],
            [222, 179],
            [224, 174],
            [224, 171],
            [225, 170],
            [224, 171],
            [221, 175],
            [218, 175],
            [216, 172],
            [213, 164],
            [212, 160],
            [211, 159],
            [209, 161],
            [207, 168],
            [204, 170],
            [202, 171],
            [201, 171],
            [200,
                171
            ],
            [200, 176],
            [199, 179],
            [199, 180],
            [199, 181],
            [199, 180],
            [200, 180],
            [204, 179],
            [207, 180],
            [209, 181],
            [209, 180],
            [206, 176],
            [202, 174],
            [198, 174],
            [194, 177],
            [191, 182],
            [189, 185],
            [188, 184],
            [187, 184],
            [185, 184],
            [182, 183],
            [179, 182],
            [177, 179],
            [176, 176],
            [175, 176],
            [175, 178],
            [175, 180],
            [175, 183],
            [174, 184],
            [173, 183],
            [172, 182],
            [170, 181],
            [167, 180],
            [162, 180],
            [160, 180],
            [159, 180],
            [157, 181],
            [156, 183],
            [155, 185],
            [153, 187],
            [150, 190],
            [148, 190],
            [146, 191],
            [143, 191],
            [140, 191],
            [138, 192],
            [137, 192],
            [136, 192],
            [136, 191],
            [136, 195],
            [136, 201],
            [137, 208],
            [138, 220],
            [138, 227],
            [137, 232],
            [137, 234],
            [136, 234],
            [136, 231],
            [136, 223],
            [136, 211],
            [139, 197],
            [144, 183],
            [153, 165],
            [160, 156],
            [166, 148],
            [171, 143],
            [174, 140],
            [176, 136],
            [177, 134],
            [178, 132],
            [179, 130],
            [178, 131],
            [177, 132],
            [173, 137],
            [164, 144],
            [157, 148],
            [151, 151],
            [147, 152],
            [146, 145],
            [151, 137],
            [159, 127],
            [169, 117],
            [180, 111],
            [187, 110],
            [190, 113],
            [187, 123],
            [181, 131],
            [174, 137],
            [161, 143],
            [154, 143],
            [150, 143],
            [150, 141],
            [153, 135],
            [160, 129],
            [169, 121],
            [182, 114],
            [196, 110],
            [211, 112],
            [214, 117],
            [212, 123],
            [205, 129],
            [194,
                134
            ],
            [181, 139],
            [162, 143],
            [155, 143],
            [151, 141],
            [150, 136],
            [153, 131],
            [155, 127],
            [158, 124],
            [160, 122],
            [162, 122],
            [162, 121],
            [163, 121],
            [163, 122],
            [161, 125],
            [157, 129],
            [151, 133],
            [146, 136],
            [143, 137],
            [142, 136],
            [144, 131],
            [149, 125],
            [158, 116],
            [175, 106],
            [185, 104],
            [192, 106],
            [194, 111],
            [191, 119],
            [183, 125],
            [172, 130],
            [161, 134],
            [153, 135],
            [149, 133],
            [150, 126],
            [156, 119],
            [165, 111],
            [179, 104],
            [195, 100],
            [218, 103],
            [229, 109],
            [236, 115],
            [240, 119],
            [239, 119],
            [238, 119],
            [234, 118],
            [224, 116],
            [216, 114],
            [213, 112],
            [212, 111],
            [215, 109],
            [227, 109],
            [237, 112],
            [247, 117],
            [254, 123],
            [257, 129],
            [256, 132],
            [247, 134],
            [236, 132],
            [223, 128],
            [209, 119],
            [207, 116],
            [209, 115],
            [218, 115],
            [239, 122],
            [253, 131],
            [262, 142],
            [267, 150],
            [267, 155],
            [262, 154],
            [257, 149],
            [252, 140],
            [248, 128],
            [247, 120],
            [250, 118],
            [259, 127],
            [265, 140],
            [271, 152],
            [275, 165],
            [275, 167],
            [274, 165],
            [270, 154],
            [268, 146],
            [266, 140],
            [266, 139],
            [267, 144],
            [270, 154],
            [274, 170],
            [276, 178],
            [276, 182],
            [276, 181],
            [276, 179],
            [274, 172],
            [272, 158],
            [270, 151],
            [270, 148],
            [272, 154],
            [275, 163],
            [277, 173],
            [279, 183],
            [280, 193],
            [280, 195],
            [280,
                194
            ],
            [279, 189],
            [279, 181],
            [276, 165],
            [274, 155],
            [273, 149],
            [273, 146],
            [273, 145],
            [273, 144],
            [273, 143],
            [273, 141],
            [272, 140],
            [271, 138],
            [270, 137],
            [270, 138],
            [272, 144],
            [275, 154],
            [278, 167],
            [280, 182],
            [282, 207],
            [283, 223],
            [284, 237],
            [284, 249],
            [285, 259],
            [287, 265],
            [288, 268],
            [288, 265],
            [288, 257],
            [286, 237],
            [284, 220],
            [283, 201],
            [283, 187],
            [283, 180],
            [283, 181],
            [283, 188],
            [283, 196],
            [283, 208],
            [283, 226],
            [284, 238],
            [284, 249],
            [284, 257],
            [285, 265],
            [285, 272],
            [286, 282],
            [287, 287],
            [288, 291],
            [289, 295],
            [291, 298],
            [292, 300],
            [294, 303],
            [296, 306],
            [298, 309],
            [299, 312],
            [300, 314],
            [300, 315],
            [299, 312],
            [295, 305],
            [289, 292],
            [277, 263],
            [271, 242],
            [268, 224],
            [267, 211],
            [266, 203],
            [266, 205],
            [266, 208],
            [265, 211],
            [264, 218],
            [263, 227],
            [262, 236],
            [261, 245],
            [259, 255],
            [259, 259],
            [258, 262],
            [258, 263],
            [257, 262],
            [256, 260],
            [255, 257],
            [255, 253],
            [255, 242],
            [256, 232],
            [257, 221],
            [257, 213],
            [257, 210],
            [257, 212],
            [256, 221],
            [256, 234],
            [257, 248],
            [257, 260],
            [257, 269],
            [257, 268],
            [257, 267],
            [256, 261],
            [256, 253],
            [257, 237],
            [258, 223],
            [259, 210],
            [260, 203],
            [259, 207],
            [258, 217],
            [257, 232],
            [256, 256],
            [255,
                270
            ],
            [255, 276],
            [255, 277],
            [255, 272],
            [256, 262],
            [258, 245],
            [259, 236],
            [259, 232],
            [258, 233],
            [255, 238]
        ],
        [1, 147, ["#000000", 14, "0.61"],
            [147, 253],
            [148, 254],
            [148, 255],
            [149, 258],
            [149, 262],
            [149, 264],
            [149, 263],
            [149, 262],
            [149, 259],
            [149, 257],
            [150, 256],
            [151, 258],
            [152, 260]
        ],
        [1, 148, ["#000000", 14, "0.61"],
            [257, 238],
            [256, 238],
            [255, 239],
            [254, 241],
            [252, 243],
            [248, 247],
            [242, 256],
            [236, 262],
            [232, 267],
            [228, 270],
            [226, 269],
            [226, 267],
            [226, 264],
            [226, 262],
            [225, 262],
            [225, 263],
            [225, 264],
            [224, 265],
            [224, 267],
            [223, 267],
            [223, 268],
            [222, 268],
            [223, 268],
            [224, 268],
            [225, 269],
            [227, 270],
            [230, 271],
            [232, 272],
            [235, 273],
            [240, 273],
            [243, 272],
            [245, 270],
            [246, 269],
            [245, 269],
            [244, 270],
            [242, 271],
            [240, 271],
            [239, 271],
            [238, 269],
            [239, 263],
            [241, 258],
            [243, 252],
            [245, 246],
            [248, 237],
            [248, 235],
            [247, 235],
            [246, 239],
            [243, 248],
            [240, 254],
            [239, 258],
            [238, 260],
            [238, 259],
            [238, 258],
            [238, 254]
        ],
        [1, 149, ["#000000", 14, "0.61"],
            [115, 243],
            [115, 242],
            [115, 243],
            [114, 249],
            [113, 258],
            [113, 271],
            [113, 287],
            [114, 308],
            [116, 318],
            [119, 323],
            [120, 325],
            [121, 324],
            [122, 321],
            [122, 317],
            [123, 312]
        ],
        [1, 150, ["#000000", 14, "0.61"],
            [130, 316],
            [131, 316],
            [132, 316],
            [133, 316],
            [134, 316],
            [135, 317]
        ],
        [1, 151, ["#000000", 14, "0.61"],
            [119, 205],
            [115, 223],
            [112, 238],
            [110, 248],
            [109, 249],
            [110, 241],
            [113, 225],
            [119, 203],
            [127, 177],
            [138, 151],
            [154, 121],
            [162, 111],
            [167, 108],
            [169, 109],
            [169, 114],
            [168, 118],
            [165, 122],
            [161, 126],
            [155, 135],
            [151, 142],
            [145, 149],
            [139, 157],
            [131, 172],
            [127, 183],
            [124, 191],
            [124, 194],
            [125, 192],
            [127, 188],
            [137, 169],
            [146, 153],
            [157, 136],
            [167, 123],
            [174, 116],
            [173, 121],
            [170, 132],
            [165, 146],
            [157, 163],
            [154, 167],
            [154,
                165
            ],
            [156, 158],
            [164, 142],
            [169, 134],
            [172, 130],
            [172, 134],
            [170, 144],
            [166, 159],
            [161, 176],
            [159, 179],
            [161, 174],
            [166, 162],
            [176, 141],
            [182, 131],
            [186, 127],
            [186, 132],
            [183, 151],
            [179, 165],
            [175, 175],
            [174, 177],
            [176, 167],
            [181, 155],
            [186, 143],
            [190, 136],
            [191, 136],
            [191, 144],
            [187, 162],
            [184, 171],
            [183, 173],
            [184, 168],
            [188, 150],
            [192, 137],
            [196, 128],
            [198, 126],
            [198, 138],
            [196, 153],
            [195, 166],
            [193, 172],
            [194, 167],
            [197, 156],
            [201, 144],
            [205, 135],
            [208, 132],
            [209, 136],
            [209, 154],
            [207, 163],
            [206, 166],
            [206, 162],
            [209, 145],
            [211, 133],
            [212, 127],
            [213, 127],
            [213, 144],
            [211, 157],
            [209, 164],
            [207, 164],
            [205, 151],
            [203, 138],
            [201, 127],
            [198, 122],
            [193, 122],
            [187, 129],
            [180, 138],
            [178, 138],
            [178, 135],
            [182, 127],
            [193, 115],
            [201, 109],
            [206, 107],
            [208, 107],
            [206, 111],
            [205, 112],
            [204, 112],
            [205, 112],
            [208, 118],
            [211, 123],
            [214, 127],
            [216, 128],
            [218, 126],
            [220, 125],
            [225, 128],
            [229, 136],
            [231, 146],
            [232, 156],
            [232, 162],
            [231, 160],
            [230, 154],
            [229, 145],
            [228, 137],
            [227, 140],
            [227, 150],
            [226, 170],
            [225, 182],
            [223, 186],
            [221, 182],
            [221, 172],
            [221, 159],
            [223, 143],
            [225, 140],
            [228, 148],
            [231, 162],
            [234,
                178
            ],
            [236, 190],
            [236, 187],
            [236, 176],
            [236, 162],
            [237, 143],
            [240, 138],
            [245, 143],
            [250, 157],
            [258, 180],
            [261, 191],
            [262, 193],
            [261, 189],
            [260, 179],
            [259, 162],
            [259, 156],
            [260, 155],
            [261, 163],
            [263, 177],
            [265, 201],
            [265, 217],
            [266, 228],
            [266, 231],
            [267, 228],
            [267, 221],
            [266, 209],
            [263, 180],
            [262, 162],
            [262, 152],
            [264, 154],
            [266, 165],
            [269, 185],
            [273, 221],
            [274, 241],
            [274, 251],
            [272, 252],
            [270, 241],
            [263, 209],
            [259, 181],
            [256, 156],
            [256, 141],
            [258, 135],
            [260, 138],
            [263, 146],
            [268, 166],
            [273, 186],
            [278, 209],
            [283, 234],
            [286, 258],
            [288, 279],
            [287, 299],
            [286, 303],
            [284, 300],
            [280, 289],
            [276, 270],
            [269, 230],
            [267, 202],
            [266, 180],
            [267, 170],
            [269, 172],
            [271, 187],
            [274, 210],
            [277, 245],
            [277, 259],
            [277, 262],
            [275, 256],
            [272, 239],
            [268, 214],
            [262, 172],
            [260, 157],
            [259, 157],
            [258, 170],
            [257, 192],
            [257, 227],
            [257, 244],
            [257, 253],
            [257, 257],
            [255, 260],
            [255, 264],
            [255, 267],
            [256, 268],
            [256, 266],
            [256, 261],
            [257, 253],
            [257, 246],
            [258, 243],
            [259, 246],
            [263, 264],
            [265, 279],
            [267, 291],
            [268, 299],
            [269, 304],
            [271, 304],
            [272, 304],
            [272, 303],
            [270, 292],
            [268, 277],
            [265, 253],
            [263, 207],
            [265, 179],
            [269, 159],
            [272,
                147
            ],
            [274, 145],
            [275, 150],
            [274, 160],
            [271, 167],
            [267, 165],
            [263, 158],
            [258, 147],
            [253, 132],
            [249, 125],
            [245, 121],
            [241, 119],
            [236, 115],
            [234, 112],
            [231, 111],
            [227, 111],
            [224, 112],
            [220, 116],
            [216, 118],
            [212, 119],
            [209, 117],
            [207, 112],
            [207, 109],
            [208, 108],
            [209, 108],
            [209, 109],
            [206, 110],
            [201, 110],
            [194, 110],
            [186, 111],
            [172, 117],
            [162, 125],
            [151, 136],
            [135, 156],
            [126, 172],
            [120, 186],
            [117, 197],
            [115, 205],
            [115, 211],
            [115, 216],
            [115, 217],
            [116, 216],
            [118, 211],
            [120, 204],
            [124, 192],
            [124, 189],
            [124, 193],
            [122, 205],
            [120, 233],
            [117, 253],
            [116, 269],
            [115, 277],
            [117, 272],
            [120, 260],
            [126, 240],
            [133, 215],
            [140, 190],
            [145, 172],
            [146, 175],
            [143, 188],
            [140, 205],
            [136, 224],
            [133, 244],
            [133, 246],
            [133, 242],
            [136, 230],
            [142, 204],
            [146, 188],
            [149, 178],
            [150, 180],
            [149, 191],
            [147, 207],
            [144, 224],
            [142, 238],
            [141, 247],
            [139, 252],
            [139, 253],
            [139, 256],
            [139, 260],
            [138, 267],
            [136, 274],
            [135, 276],
            [134, 277],
            [134, 278],
            [133, 283],
            [132, 288],
            [130, 293],
            [128, 299],
            [126, 302],
            [125, 304],
            [125, 302],
            [125, 300],
            [127, 293],
            [128, 288],
            [128, 290],
            [127, 297],
            [125, 303],
            [123, 306],
            [122, 302],
            [124, 294],
            [127, 287],
            [130,
                283
            ],
            [131, 284],
            [131, 289],
            [131, 292],
            [131, 291],
            [131, 289],
            [130, 288],
            [128, 290],
            [127, 295],
            [126, 299],
            [125, 300],
            [128, 296],
            [131, 295],
            [133, 295]
        ],
        [1, 152, ["#000000", 14, "0.61"],
            [225, 276],
            [225, 277],
            [225, 276],
            [226, 274],
            [229, 270],
            [233, 264],
            [238, 255],
            [243, 248],
            [246, 244],
            [245, 246],
            [243, 251],
            [239, 257],
            [235, 262],
            [235, 263],
            [236, 263],
            [238, 261],
            [242, 255]
        ],
        [1, 153, ["#000000", 14, "0.61"],
            [281, 318],
            [280, 319],
            [279, 321],
            [278, 321],
            [278, 320],
            [278, 318],
            [278, 315],
            [279, 313],
            [281, 313],
            [284, 315],
            [287, 319],
            [289, 322],
            [290, 323],
            [290, 320],
            [289, 314],
            [288, 306],
            [288, 304],
            [289, 305],
            [291, 308],
            [294, 311],
            [296, 312],
            [296, 309],
            [297, 306],
            [297, 304]
        ],
        [1, 154, ["#000000", 14, "0.61"],
            [179, 182],
            [179, 184],
            [178, 186],
            [178, 185],
            [178, 183],
            [178, 180],
            [181, 168],
            [183, 161],
            [185, 159]
        ],
        [1, 155, ["#000000", 14, "0.61"],
            [206, 178],
            [205, 179],
            [205, 177],
            [205, 171],
            [207, 164],
            [209, 157],
            [211, 155]
        ],
        [1, 156, ["#000000", 14, "0.61"],
            [241, 186],
            [240, 186],
            [239, 183],
            [239, 176],
            [240, 166]
        ],
        [1, 157, ["#000000", 14, "0.61"],
            [178, 109],
            [179, 108],
            [184, 105],
            [192, 102],
            [202, 102],
            [212, 105],
            [225, 115]
        ],
        [1, 158, ["#000000", 14, "0.61"],
            [249, 117],
            [250, 116],
            [255, 117],
            [262, 124],
            [269, 135],
            [277, 152],
            [285, 185],
            [288, 207],
            [290, 224],
            [291, 233]
        ],
        [1, 159, ["#000000", 14, "0.61"],
            [234, 125],
            [237, 132],
            [241, 146],
            [245, 164]
        ],
        [1, 160, ["#000000", 14, "0.61"],
            [129, 247],
            [129, 243],
            [130, 242],
            [132, 247],
            [136, 266],
            [139, 283],
            [140, 292]
        ],
        [1, 161, ["#FEE6DB", 10, "0.61"],
            [155, 225],
            [155, 224],
            [154, 224],
            [154, 223],
            [155, 225],
            [156, 228],
            [157, 230],
            [157, 229],
            [157, 228],
            [156, 224],
            [154, 220],
            [153, 218],
            [153, 217],
            [153, 219],
            [155, 222],
            [157, 226],
            [159, 229],
            [159,
                230
            ],
            [160, 230],
            [160, 228],
            [159, 226],
            [159, 224],
            [159, 225],
            [159, 228],
            [159, 232],
            [159, 237],
            [159, 239],
            [159, 242],
            [159, 244],
            [160, 245],
            [160, 244],
            [160, 243],
            [160, 244],
            [161, 245],
            [161, 244],
            [161, 242],
            [162, 240],
            [164, 238],
            [165, 237],
            [166, 236],
            [167, 236],
            [168, 236],
            [169, 236],
            [170, 236],
            [172, 235],
            [173, 234],
            [174, 234],
            [174, 235],
            [175, 236],
            [176, 237],
            [177, 238],
            [177, 239],
            [177, 240],
            [177, 241],
            [176, 242],
            [177, 242],
            [177, 243],
            [177, 244],
            [177, 245],
            [177, 246],
            [177, 247],
            [177, 246],
            [177, 245],
            [177, 242],
            [178, 238],
            [178, 235],
            [178, 234],
            [177, 234],
            [176, 234],
            [175, 233],
            [174, 232],
            [174, 231],
            [175, 231],
            [176, 230],
            [178, 230],
            [181, 233],
            [183, 234],
            [185, 234],
            [186, 234],
            [185, 233],
            [183, 232],
            [181, 231],
            [181, 229],
            [181, 228],
            [184, 227],
            [187, 225],
            [191, 223],
            [193, 220],
            [195, 217],
            [195, 214],
            [195, 213],
            [195, 211],
            [194, 211],
            [193, 213],
            [192, 215],
            [190, 217],
            [188, 220],
            [185, 222],
            [185, 223],
            [185, 222],
            [187, 216],
            [191, 209],
            [194, 203],
            [197, 197],
            [198, 194],
            [197, 197],
            [195, 203],
            [192, 210],
            [190, 216],
            [188, 220],
            [188, 221],
            [189, 216],
            [192, 210],
            [195, 205],
            [197, 203],
            [198, 207],
            [198, 215],
            [197, 222],
            [195,
                228
            ],
            [195, 229],
            [196, 226],
            [197, 223],
            [199, 221],
            [199, 222],
            [198, 223],
            [196, 224],
            [195, 225],
            [192, 228],
            [191, 230],
            [190, 231],
            [189, 231],
            [189, 232],
            [189, 233],
            [188, 234],
            [187, 234],
            [187, 233],
            [187, 234],
            [187, 235],
            [187, 236],
            [187, 238],
            [186, 239],
            [186, 238],
            [186, 237],
            [186, 238],
            [186, 239],
            [185, 240],
            [184, 241],
            [183, 241],
            [182, 242],
            [182, 243],
            [182, 244],
            [182, 245],
            [183, 246],
            [184, 246],
            [184, 245],
            [183, 245],
            [183, 244],
            [182, 244],
            [182, 245],
            [183, 245],
            [183, 244],
            [182, 243],
            [182, 241],
            [182, 239],
            [182, 237],
            [184, 236],
            [186, 234],
            [190, 233],
            [193, 233],
            [196, 234],
            [199, 235],
            [203, 237],
            [204, 237],
            [204, 236],
            [204, 235],
            [203, 234],
            [201, 234],
            [200, 234],
            [201, 235],
            [202, 235],
            [203, 236],
            [201, 236],
            [199, 236],
            [196, 236],
            [195, 236],
            [196, 236],
            [197, 237],
            [199, 238],
            [200, 238],
            [202, 239],
            [203, 239],
            [204, 240],
            [205, 241],
            [205, 242],
            [206, 242],
            [207, 243],
            [208, 245],
            [209, 246],
            [208, 245],
            [208, 243],
            [207, 240],
            [203, 230],
            [200, 222],
            [198, 217],
            [198, 216],
            [200, 220],
            [202, 226],
            [205, 234],
            [207, 239],
            [207, 240],
            [207, 234],
            [205, 224],
            [203, 213],
            [201, 204],
            [200, 199],
            [201, 203],
            [203, 212],
            [204, 221],
            [206, 227],
            [206,
                228
            ],
            [206, 222],
            [206, 214],
            [206, 203],
            [206, 200],
            [206, 201],
            [206, 205],
            [207, 209],
            [207, 212],
            [207, 213],
            [208, 211],
            [209, 208],
            [209, 205],
            [209, 203],
            [208, 202],
            [208, 201],
            [209, 201],
            [211, 201],
            [212, 201],
            [214, 201],
            [214, 200],
            [215, 199],
            [216, 199],
            [217, 199],
            [217, 198],
            [217, 197],
            [218, 197],
            [218, 196],
            [219, 196],
            [218, 196],
            [216, 196],
            [210, 196],
            [206, 196],
            [202, 196],
            [199, 196],
            [196, 196],
            [194, 196],
            [191, 196],
            [190, 195],
            [189, 195],
            [188, 195],
            [187, 195],
            [186, 195],
            [186, 194],
            [185, 194],
            [185, 195],
            [184, 195],
            [183, 195],
            [185, 196],
            [186, 196],
            [187, 196],
            [188, 197],
            [190, 197],
            [192, 198],
            [193, 198],
            [196, 198],
            [198, 198],
            [203, 198],
            [205, 198],
            [207, 197],
            [209, 196],
            [210, 196],
            [211, 196],
            [212, 196],
            [213, 196],
            [215, 196],
            [216, 197],
            [217, 197],
            [216, 197],
            [215, 197],
            [213, 197],
            [211, 198],
            [208, 199],
            [206, 201],
            [204, 204],
            [203, 206],
            [203, 212],
            [203, 217],
            [205, 222],
            [207, 226],
            [209, 230],
            [209, 232],
            [210, 233],
            [210, 232],
            [210, 229],
            [211, 226],
            [213, 226],
            [215, 230],
            [217, 236],
            [218, 242],
            [218, 243],
            [218, 241],
            [217, 234],
            [215, 229],
            [214, 226],
            [214, 228],
            [215, 229],
            [217, 235],
            [220, 242],
            [221, 244],
            [222, 245],
            [222,
                246
            ],
            [222, 247],
            [222, 248],
            [221, 248],
            [220, 247],
            [220, 246],
            [221, 245],
            [222, 244],
            [224, 242],
            [228, 238],
            [230, 236],
            [233, 234],
            [234, 233],
            [235, 233],
            [235, 232],
            [235, 233],
            [234, 233],
            [234, 234],
            [234, 235],
            [234, 234],
            [235, 230],
            [237, 226],
            [238, 222],
            [239, 221],
            [239, 220],
            [240, 220],
            [241, 219],
            [242, 219],
            [242, 220],
            [243, 220],
            [243, 221],
            [243, 222],
            [242, 223],
            [241, 225],
            [240, 227],
            [239, 229],
            [238, 231],
            [236, 233],
            [235, 234],
            [234, 235],
            [233, 236],
            [232, 237],
            [232, 238],
            [231, 240],
            [231, 242],
            [231, 243],
            [230, 245]
        ],
        [1, 162, ["#FEE6DB", 10, "0.61"],
            [165, 259],
            [165, 260],
            [165, 261],
            [165, 260],
            [165, 259],
            [166, 258],
            [166, 257],
            [167, 256],
            [169, 254],
            [169, 253],
            [171, 251],
            [171, 250],
            [171, 249],
            [171, 248],
            [171, 247],
            [170, 248],
            [170, 250],
            [170, 254],
            [169, 257],
            [169, 259],
            [170, 259],
            [171, 259],
            [172, 260],
            [173, 260],
            [174, 260],
            [176, 261],
            [178, 261],
            [179, 260],
            [181, 259],
            [179, 261],
            [176, 263],
            [176, 264],
            [176, 265],
            [176, 266],
            [177, 267],
            [178, 268],
            [179, 268],
            [179, 267],
            [179, 266],
            [179, 265],
            [179, 264],
            [181, 261],
            [183, 259],
            [186, 256],
            [189, 255],
            [191, 255],
            [192, 255],
            [192, 256],
            [193, 257],
            [194, 257],
            [194, 256],
            [195,
                255
            ],
            [196, 255],
            [197, 255],
            [198, 255],
            [199, 256],
            [200, 256],
            [201, 256],
            [200, 256],
            [199, 256],
            [197, 257],
            [196, 257],
            [195, 257],
            [195, 256],
            [194, 256],
            [194, 255],
            [194, 254],
            [193, 254],
            [192, 253],
            [191, 253],
            [192, 253],
            [193, 253],
            [194, 254],
            [194, 255],
            [195, 255],
            [196, 255]
        ],
        [1, 163, ["#FEE6DB", 10, "0.61"],
            [215, 254],
            [215, 255],
            [215, 254],
            [216, 253],
            [217, 253],
            [219, 252],
            [220, 253],
            [220, 254],
            [220, 256]
        ],
        [1, 164, ["#FEE6DB", 10, "0.61"],
            [212, 278],
            [212, 277],
            [211, 277],
            [212, 279],
            [213, 282],
            [214, 286],
            [215, 290],
            [215, 292],
            [215, 293],
            [215, 294],
            [215, 295],
            [215, 296],
            [214, 297],
            [214, 298],
            [213, 298],
            [213, 297],
            [213, 296],
            [212, 296],
            [211, 296],
            [211, 297],
            [209, 297],
            [209, 298],
            [209, 297],
            [210, 297],
            [213, 296],
            [216, 295],
            [221, 294],
            [225, 293],
            [228, 293],
            [230, 293],
            [231, 294],
            [231, 295],
            [231, 294],
            [230, 292],
            [229, 291],
            [228, 292],
            [227, 293],
            [227, 294],
            [227, 293],
            [228, 292],
            [228, 291],
            [230, 287],
            [230, 285],
            [231, 285],
            [231, 284],
            [231, 283],
            [231, 282],
            [231, 281],
            [232, 281],
            [233, 282],
            [234, 283],
            [235, 285],
            [236, 287],
            [236, 289],
            [237, 291],
            [238, 292],
            [239, 292],
            [241, 293],
            [242, 294],
            [243, 294],
            [243, 295],
            [244,
                296
            ],
            [245, 296],
            [246, 295],
            [247, 295],
            [247, 296],
            [248, 297],
            [248, 299],
            [248, 300],
            [247, 300],
            [247, 301],
            [247, 300],
            [248, 298],
            [248, 297],
            [249, 296],
            [250, 298],
            [251, 300],
            [250, 302],
            [249, 302],
            [247, 301],
            [245, 299],
            [243, 298],
            [244, 298]
        ],
        [8, 165, ["#fbdc89", "1"], 190, 286, 1, 5, 0, 191, 287, 1, 4, 0, 190, 286, 1, 3, 0, 191, 291, 2, 2, 0, 192, 287, 4, 2, 0, 189, 286, 1, 2, 0, 189, 286, 2, 1, 0, 196, 288, 1, 1, 0, 194, 289, 3, 4, 0, 194, 287, 2, 1, 0, 195, 293, 2, 5, 0, 197, 295, 1, 3, 0, 195, 295, 1, 3, 0, 194, 295, 1, 3, 0, 198, 296, 1, 2, 0, 193, 295, 1, 2, 0, 193, 296, 1, 1, 0, 194, 286, 1, 1, 0, 189, 285, 1,
            1, 0, 191, 292, 1, 1, 0, 188, 276, 1, 9, 0, 189, 276, 1, 3, 0, 188, 277, 1, 8, 0, 187, 277, 1, 7, 0, 187, 281, 1, 1, 0, 190, 276, 1, 3, 0, 190, 276, 1, 2, 0, 191, 276, 1, 2, 0, 191, 276, 1, 1, 0, 192, 276, 1, 1, 0
        ],
        [8, 166, ["#fbdc89", "1"], 198, 286, 4, 2, 0, 201, 288, 1, 3, 0, 199, 286, 4, 1, 0, 202, 285, 2, 1, 0, 199, 285, 3, 1, 0, 199, 285, 1, 1, 0, 200, 284, 1, 1, 0, 204, 285, 1, 1, 0, 204, 277, 1, 8, 0, 205, 279, 1, 6, 0, 204, 278, 1, 1, 0, 205, 280, 1, 4, 0, 203, 278, 1, 1, 0, 202, 277, 2, 1, 0, 200, 277, 2, 1, 0, 200, 276, 4, 1, 0, 202, 290, 3, 1, 0, 202, 291, 3, 2, 0, 205, 291, 1, 1, 0, 202, 292, 4, 1, 0, 203, 293, 3, 1, 0, 203, 293, 3, 1, 0, 204, 294, 2, 1,
            0, 204, 294, 1, 1, 0, 204, 295, 1, 1, 0
        ],
        [8, 167, ["#fbdc89", "1"], 194, 276, 3, 3, 0, 197, 279, 1, 1, 0, 194, 278, 1, 1, 0, 196, 279, 1, 5, 0, 197, 283, 1, 1, 0, 196, 281, 1, 3, 0, 195, 281, 1, 3, 0, 194, 281, 1, 2, 0],
        [8, 168, ["#fbdc89", "1"], 189, 271, 1, 2, 0, 190, 272, 1, 2, 0, 187, 271, 2, 1, 0, 191, 272, 7, 1, 0, 198, 272, 1, 1, 0, 191, 273, 6, 1, 0, 191, 274, 4, 1, 0, 187, 271, 2, 1, 0, 187, 270, 1, 1, 0],
        [8, 169, ["#fbdc89", "1"], 205, 269, 1, 1, 0],
        [1, 170, ["#FEE6DB", 6, "0.59"],
            [194, 268],
            [195, 268],
            [196, 268],
            [197, 268],
            [197, 267],
            [198, 267],
            [200, 267],
            [201, 266],
            [203, 266],
            [204, 265]
        ],
        [1, 171, ["#99BCFF",
                6, "0.59"
            ],
            [96, 110],
            [95, 110],
            [95, 109],
            [96, 108],
            [99, 104],
            [104, 99],
            [109, 94],
            [112, 92],
            [113, 93],
            [108, 101],
            [102, 109],
            [95, 117],
            [90, 122],
            [89, 123],
            [95, 117],
            [104, 108],
            [119, 98],
            [124, 97],
            [123, 102],
            [117, 113],
            [107, 125],
            [95, 137],
            [93, 137],
            [98, 131],
            [109, 121],
            [122, 110],
            [133, 103],
            [136, 103],
            [129, 110],
            [116, 121],
            [103, 131],
            [94, 136],
            [99, 132],
            [110, 122],
            [133, 104],
            [144, 97],
            [146, 96],
            [140, 103],
            [127, 113],
            [105, 130],
            [97, 135],
            [98, 133],
            [108, 123],
            [122, 110],
            [138, 98],
            [150, 90],
            [147, 95],
            [135, 107],
            [120, 122],
            [98, 144],
            [91, 150],
            [94, 148],
            [113,
                131
            ],
            [130, 115],
            [144, 101],
            [150, 95],
            [146, 99],
            [127, 120],
            [110, 137],
            [97, 152],
            [91, 158],
            [94, 156],
            [105, 144],
            [129, 119],
            [142, 105],
            [148, 101],
            [144, 108],
            [127, 132],
            [113, 149],
            [102, 160],
            [100, 162],
            [108, 153],
            [120, 140],
            [130, 130],
            [135, 128],
            [130, 143],
            [120, 160],
            [109, 177],
            [99, 194],
            [92, 206],
            [90, 210],
            [95, 209],
            [98, 207]
        ],
        [1, 172, ["#99BCFF", 6, "0.59"],
            [236, 101],
            [238, 101],
            [243, 102],
            [251, 105],
            [261, 111],
            [272, 120],
            [286, 139],
            [292, 153],
            [296, 165],
            [298, 175],
            [298, 177],
            [298, 178],
            [298, 175],
            [294, 163],
            [289, 150],
            [281, 135],
            [272, 120],
            [264, 109],
            [256, 100],
            [254, 98],
            [253, 98],
            [252, 97],
            [251, 97],
            [252, 97],
            [253, 98],
            [255, 100],
            [261, 107],
            [276, 122],
            [285, 132],
            [293, 141],
            [297, 147],
            [298, 150],
            [296, 148],
            [292, 141],
            [285, 130],
            [271, 111],
            [263, 100],
            [258, 95],
            [257, 94],
            [260, 98],
            [266, 108],
            [281, 127],
            [291, 139],
            [299, 146],
            [301, 148],
            [296, 139],
            [289, 127],
            [279, 114],
            [273, 105],
            [274, 104],
            [280, 112],
            [289, 122],
            [296, 129],
            [299, 131],
            [296, 126],
            [291, 117],
            [285, 109],
            [281, 104],
            [282, 104],
            [289, 114],
            [293, 120],
            [294, 121],
            [291, 117],
            [284, 104],
            [281, 97],
            [282, 97],
            [287, 102],
            [294, 111],
            [296, 112],
            [296,
                108
            ],
            [296, 100],
            [303, 97]
        ],
        [1, 173, ["#99BCFF", 6, "0.59"],
            [296, 174],
            [296, 173],
            [296, 171],
            [296, 170],
            [296, 171],
            [296, 176],
            [297, 188],
            [297, 208],
            [297, 232],
            [297, 267],
            [298, 281],
            [298, 287],
            [298, 289],
            [298, 288],
            [298, 285]
        ],
        [1, 174, ["#99BCFF", 6, "0.59"],
            [108, 185],
            [107, 185]
        ],
        [1, 175, ["#99BCFF", 6, "0.59"],
            [108, 185],
            [108, 180],
            [108, 178],
            [107, 179],
            [107, 181],
            [106, 184],
            [104, 193],
            [101, 220],
            [100, 246],
            [99, 273],
            [99, 293],
            [101, 309],
            [102, 315],
            [103, 317],
            [104, 318],
            [104, 319],
            [103, 319],
            [102, 319],
            [101, 318],
            [100, 318],
            [100, 319],
            [101, 319],
            [101,
                322
            ],
            [102, 323],
            [103, 325],
            [104, 327],
            [105, 327],
            [106, 327],
            [106, 326],
            [106, 324],
            [106, 323],
            [106, 317],
            [106, 306],
            [106, 291],
            [106, 268],
            [106, 256]
        ],
        [1, 176, ["#99BCFF", 6, "0.59"],
            [99, 185],
            [99, 183],
            [101, 177],
            [106, 167],
            [121, 142],
            [135, 123],
            [149, 107],
            [161, 96],
            [168, 89],
            [171, 89],
            [171, 92],
            [168, 96],
            [164, 100],
            [160, 104],
            [155, 107],
            [149, 111]
        ],
        [1, 177, ["#99BCFF", 6, "0.59"],
            [111, 111],
            [116, 106],
            [123, 101],
            [125, 100]
        ],
        [1, 178, ["#99BCFF", 6, "0.59"],
            [98, 127],
            [98, 126],
            [100, 123],
            [111, 110],
            [122, 100],
            [130, 91],
            [135, 88],
            [135, 90],
            [126, 104],
            [117,
                115
            ],
            [108, 125],
            [102, 133],
            [100, 135],
            [103, 132],
            [114, 121],
            [123, 114],
            [128, 111],
            [127, 118],
            [121, 130],
            [113, 143],
            [107, 152],
            [105, 156],
            [109, 152],
            [116, 144],
            [123, 135],
            [128, 130],
            [127, 134],
            [121, 142],
            [114, 151],
            [108, 158],
            [106, 159],
            [108, 157],
            [117, 146],
            [124, 139],
            [128, 136],
            [126, 143],
            [119, 156],
            [112, 169],
            [106, 182],
            [100, 194],
            [100, 196],
            [102, 195],
            [103, 193]
        ]
    ];
    GPAssets_.AC_SUSPICIOUS_PH = {
        ru: [...GPAssets_.GIRL_PORTRAIT, [1, 200, ["#cc6969", 4, 1],
                [369, 156.5],
                [369, 160],
                [369.5, 163.5],
                [370.5, 167.5],
                [371, 172.5],
                [371.5, 177],
                [371.5, 181.5],
                [372, 186],
                [372, 188.5],
                [372, 190.5],
                [372, 190.5],
                [372, 190.5],
                [372, 190]
            ],
            [1, 201, ["#cc6969", 4, 1],
                [371.5, 156.5],
                [371.5, 156],
                [372.5, 156],
                [374, 156],
                [376.5, 156],
                [380.5, 155],
                [383, 155],
                [384.5, 154.5],
                [386, 154.5],
                [386.5, 154.5],
                [387, 154.5],
                [387, 155],
                [387, 155.5],
                [386.5, 156],
                [386.5, 158.5],
                [386.5, 161],
                [386.5, 163.5],
                [386.5, 166],
                [386.5, 169.5],
                [387,
                    174
                ],
                [387, 177],
                [387, 180],
                [387, 182.5],
                [387, 186],
                [387.5, 187.5],
                [388, 188],
                [388, 189],
                [388.5, 189],
                [388.5, 189.5],
                [388.5, 189],
                [388.5, 188.5]
            ],
            [1, 202, ["#cc6969", 4, 1],
                [401, 172.5],
                [400, 173.5],
                [399.5, 176.5],
                [399.5, 179],
                [399.5, 181],
                [399.5, 183],
                [400.5, 184.5],
                [403, 186.5],
                [404.5, 187],
                [406.5, 187.5],
                [408.5, 187],
                [411, 186],
                [411.5, 185],
                [413, 182.5],
                [413.5, 180.5],
                [414, 178.5],
                [413.5, 175],
                [413, 173.5],
                [411, 172.5],
                [409.5, 171.5],
                [406.5, 171.5],
                [404.5, 171.5],
                [403.5, 172.5],
                [402.5, 174],
                [402.5, 175]
            ],
            [1, 203, ["#cc6969", 4, 1],
                [434, 174],
                [433, 172],
                [432.5, 171],
                [430, 171],
                [428.5, 171],
                [426, 171.5],
                [425, 173],
                [424, 175],
                [423, 177.5],
                [422.5, 181.5],
                [423, 183.5],
                [424, 185.5],
                [427, 187],
                [429, 187.5],
                [431, 187.5],
                [432.5, 187],
                [433.5, 186],
                [435, 183.5],
                [435.5, 181.5],
                [436, 178.5],
                [436, 176],
                [436, 174.5],
                [436, 175],
                [436, 176],
                [436.5, 177],
                [437, 180],
                [438, 185],
                [439.5, 188.5],
                [441.5, 192.5],
                [443.5, 195.5],
                [447, 199.5],
                [448.5, 201.5],
                [449.5, 203],
                [449.5, 204],
                [449, 204.5],
                [448, 205],
                [445, 205],
                [442, 205],
                [439.5, 205],
                [435.5, 205],
                [434, 204],
                [433, 203],
                [433, 201.5],
                [433, 199.5],
                [434,
                    197
                ],
                [436, 195.5],
                [437.5, 195]
            ],
            [1, 204, ["#cc6969", 4, 1],
                [447, 174.5],
                [446.5, 174.5],
                [446.5, 176.5],
                [446.5, 179],
                [446.5, 181.5],
                [448.5, 184],
                [449.5, 185.5],
                [451.5, 186],
                [453, 186],
                [455, 186],
                [457.5, 184.5],
                [459, 183],
                [459.5, 181.5],
                [459.5, 179],
                [458, 175.5],
                [456.5, 173],
                [455, 172],
                [453.5, 171.5],
                [452, 171.5],
                [449, 173],
                [447.5, 174.5],
                [447.5, 177.5],
                [447.5, 179]
            ],
            [1, 205, ["#cc6969", 4, 1],
                [466.5, 173.5],
                [466, 172.5],
                [467.5, 170],
                [469, 169.5],
                [471, 169],
                [473, 169],
                [475, 170],
                [475.5, 171],
                [475.5, 174],
                [474.5, 176.5],
                [473, 178],
                [472.5, 179],
                [473, 179],
                [476, 178.5],
                [479, 178.5],
                [481.5, 179],
                [483.5, 181],
                [484.5, 182.5],
                [485.5, 185],
                [485.5, 186.5],
                [485, 188.5],
                [484, 190],
                [481.5, 192],
                [479.5, 192.5],
                [477, 193],
                [474.5, 193],
                [472, 192.5],
                [469.5, 192],
                [469, 191.5],
                [468.5, 190.5],
                [470, 189],
                [471, 188.5]
            ],
            [1, 206, ["#cc6969", 4, 1],
                [488, 171.5],
                [489.5, 174.5],
                [491, 178.5],
                [492.5, 182],
                [494.5, 186],
                [495.5, 189.5],
                [496, 191],
                [496.5, 192.5],
                [496.5, 193],
                [496.5, 193.5]
            ],
            [1, 207, ["#cc6969", 4, 1],
                [490, 171.5],
                [491, 169.5],
                [493.5, 169],
                [496.5, 169],
                [499, 169.5],
                [501.5, 170],
                [503, 171.5],
                [504.5,
                    174
                ],
                [505, 175],
                [505, 177],
                [504.5, 178.5],
                [503.5, 179.5],
                [502, 180.5],
                [501.5, 181.5],
                [499.5, 181.5],
                [498.5, 181.5],
                [498, 181.5]
            ],
            [1, 208, ["#cc6969", 4, 1],
                [512.5, 168],
                [512.5, 168],
                [512.5, 169],
                [512.5, 172],
                [513, 173.5],
                [514, 175.5],
                [514.5, 177],
                [516.5, 179],
                [517.5, 179],
                [519, 179],
                [519.5, 179],
                [520.5, 179],
                [522, 176.5],
                [523, 175],
                [523.5, 173.5]
            ],
            [1, 209, ["#cc6969", 4, 1],
                [525.5, 166],
                [525.5, 167],
                [525.5, 169.5],
                [526.5, 171.5],
                [527, 173.5],
                [528, 175.5],
                [528.5, 177.5],
                [528.5, 179],
                [529, 179.5],
                [530, 180],
                [530, 180.5]
            ],
            [1, 210, ["#cc6969", 4,
                    1
                ],
                [542.5, 167.5],
                [542.5, 168.5],
                [543.5, 170.5],
                [544, 174],
                [544.5, 176],
                [545, 177],
                [545, 178],
                [545, 178.5]
            ],
            [1, 211, ["#cc6969", 4, 1],
                [536.5, 168.5],
                [537, 168],
                [537.5, 168],
                [539, 168],
                [543, 167],
                [545.5, 166],
                [547.5, 165.5],
                [550, 164.5],
                [551.5, 164],
                [552, 163.5],
                [552.5, 163.5]
            ],
            [1, 212, ["#cc6969", 4, 1],
                [564.5, 174.5],
                [565.5, 174],
                [567.5, 172.5],
                [569.5, 172],
                [570.5, 171],
                [571.5, 170],
                [572, 169.5],
                [572, 168.5],
                [572, 168],
                [571, 167.5],
                [569.5, 166.5],
                [567.5, 166.5],
                [566.5, 166.5],
                [565, 167],
                [564, 168],
                [563, 168.5],
                [561.5, 170],
                [561, 171.5],
                [561,
                    172.5
                ],
                [561, 174.5],
                [562, 177],
                [563, 179],
                [564, 180],
                [565, 180.5],
                [567, 181],
                [568.5, 181],
                [571, 181],
                [572, 180],
                [574, 179.5],
                [576, 179]
            ],
            [1, 213, ["#cc6969", 4, 1],
                [587.5, 165.5],
                [587, 168.5],
                [586.5, 170.5],
                [586.5, 173],
                [586, 175],
                [585, 178],
                [585, 179],
                [585, 179.5],
                [585, 180]
            ],
            [1, 214, ["#cc6969", 4, 1],
                [589.5, 164.5],
                [592, 168.5],
                [594.5, 172],
                [596, 174],
                [597.5, 176],
                [598.5, 177.5],
                [599.5, 179],
                [599.5, 179.5],
                [600, 180],
                [600, 180.5]
            ],
            [1, 215, ["#cc6969", 4, 1],
                [603, 163.5],
                [602.5, 163.5],
                [602.5, 164.5],
                [603.5, 166.5],
                [604.5, 169.5],
                [605, 172.5],
                [606, 175],
                [607, 178],
                [607, 179],
                [607, 179.5],
                [607, 180]
            ],
            [1, 216, ["#cc6969", 4, 1],
                [606.5, 170],
                [611.5, 168.5],
                [613.5, 168.5],
                [615.5, 168.5],
                [618, 170],
                [619.5, 171],
                [620, 173],
                [620, 174.5],
                [620, 175.5],
                [619, 176.5],
                [617.5, 177.5],
                [616, 178.5],
                [615, 179],
                [613.5, 179],
                [613.5, 179.5],
                [613, 179.5]
            ],
            [1, 217, ["#cc6969", 4, 1],
                [627.5, 164],
                [630, 170],
                [631, 172.5],
                [631.5, 174.5],
                [632.5, 177],
                [633, 178],
                [633, 179],
                [633, 180],
                [633.5, 180]
            ],
            [1, 218, ["#cc6969", 4, 1],
                [635, 173.5],
                [635.5, 173.5],
                [637.5, 173],
                [638.5, 172.5],
                [639, 172.5],
                [639.5, 172],
                [640,
                    172
                ]
            ],
            [1, 219, ["#cc6969", 4, 1],
                [641.5, 165],
                [641, 165.5],
                [642, 169],
                [642.5, 171.5],
                [643, 173.5],
                [644, 175.5],
                [644, 177],
                [645, 178],
                [645.5, 178.5],
                [646, 179],
                [646.5, 179],
                [647, 179]
            ],
            [1, 220, ["#cc6969", 4, 1],
                [661.5, 168],
                [659, 165],
                [657.5, 163.5],
                [656.5, 163],
                [654.5, 162.5],
                [653, 162.5],
                [652.5, 163],
                [651, 163.5],
                [650.5, 165],
                [650.5, 166.5],
                [650.5, 170],
                [650.5, 172.5],
                [651, 174.5],
                [652.5, 177],
                [653, 178],
                [654, 179],
                [655, 179],
                [656, 179],
                [657.5, 178.5],
                [659, 177],
                [659.5, 175.5],
                [660.5, 174],
                [661, 171.5],
                [661, 169.5],
                [661, 168],
                [661, 167],
                [661,
                    167.5
                ],
                [662, 169],
                [662, 171],
                [662.5, 174.5],
                [662.5, 176],
                [663, 177],
                [663, 178.5],
                [663.5, 179],
                [663.5, 179],
                [664, 179],
                [664, 179.5]
            ],
            [1, 221, ["#cc6969", 4, 1],
                [672.5, 172.5],
                [672.5, 173.5],
                [673, 174.5],
                [673, 176],
                [674, 176.5],
                [675, 177],
                [676, 177],
                [678, 175],
                [679, 174.5],
                [681, 172.5],
                [682, 171],
                [683.5, 169.5],
                [684, 166],
                [684, 164.5],
                [684, 163],
                [684, 161.5],
                [683, 160.5],
                [682, 160],
                [680.5, 159.5],
                [679, 159.5],
                [677.5, 160],
                [675.5, 161],
                [675, 162],
                [675, 163],
                [675, 163.5],
                [675.5, 165],
                [676.5, 165.5],
                [677.5, 166.5],
                [679, 167.5],
                [680, 168],
                [682.5,
                    168.5
                ],
                [684.5, 169],
                [686.5, 169.5],
                [688.5, 170],
                [690.5, 171],
                [690.5, 172],
                [691, 172.5],
                [691, 173.5],
                [690.5, 174.5],
                [690, 175.5],
                [689.5, 176.5],
                [689.5, 177]
            ],
            [1, 222, ["#cc6969", 4, 1],
                [395.5, 234],
                [395.5, 231],
                [395.5, 230.5],
                [395.5, 230],
                [395.5, 229.5],
                [395.5, 230.5],
                [395.5, 231],
                [394.5, 235.5],
                [394, 240.5],
                [393, 246.5],
                [392, 253],
                [391.5, 258.5],
                [391, 264.5],
                [391, 267.5],
                [391, 269],
                [391, 269.5],
                [391, 268.5],
                [391, 266.5]
            ],
            [1, 223, ["#cc6969", 4, 1],
                [397.5, 233.5],
                [397.5, 232.5],
                [397.5, 232],
                [397.5, 231.5],
                [397.5, 231],
                [397.5, 231.5],
                [398.5,
                    233
                ],
                [399.5, 235],
                [400.5, 238.5],
                [402.5, 244],
                [404, 248.5],
                [404.5, 253],
                [406, 257],
                [406.5, 259.5],
                [407.5, 263],
                [408, 264.5],
                [408, 265.5],
                [408, 266],
                [408, 265.5],
                [408, 264.5],
                [408, 264],
                [407.5, 262.5],
                [407.5, 262]
            ],
            [1, 224, ["#cc6969", 4, 1],
                [397, 255],
                [398, 255],
                [399, 255],
                [400, 254],
                [401, 253.5],
                [402, 253.5],
                [403, 253.5]
            ],
            [1, 225, ["#cc6969", 4, 1],
                [415, 246],
                [414.5, 245.5],
                [415, 246.5],
                [416, 248.5],
                [417.5, 252.5],
                [419, 257.5],
                [419.5, 260.5],
                [420, 262.5],
                [420, 264],
                [420, 265],
                [420, 265.5],
                [420, 264.5],
                [420, 264]
            ],
            [1, 226, ["#cc6969", 4, 1],
                [424,
                    244
                ],
                [426, 244.5],
                [426, 245.5],
                [426, 246.5],
                [426, 249],
                [425.5, 251],
                [424.5, 253],
                [424, 254.5],
                [423.5, 256],
                [423, 257],
                [422.5, 257.5],
                [422, 258],
                [422, 258.5],
                [422.5, 258.5],
                [423, 258.5],
                [423.5, 258.5],
                [424.5, 259],
                [426.5, 260],
                [428, 261],
                [430, 262],
                [430.5, 262.5],
                [432, 263],
                [433, 264]
            ],
            [1, 227, ["#cc6969", 4, 1],
                [438, 246.5],
                [439, 251],
                [441, 254],
                [442, 256.5],
                [443, 258.5],
                [443.5, 260.5],
                [443.5, 261.5],
                [443.5, 262],
                [443.5, 262],
                [443.5, 261.5]
            ],
            [1, 228, ["#cc6969", 4, 1],
                [433, 248],
                [433.5, 248],
                [434, 248],
                [436.5, 248],
                [439, 247],
                [441, 246.5],
                [443.5,
                    245.5
                ],
                [446, 244.5],
                [447, 244],
                [447.5, 244],
                [448, 244]
            ],
            [1, 229, ["#cc6969", 4, 1],
                [455.5, 245.5],
                [455.5, 246.5],
                [456, 248.5],
                [456.5, 251],
                [457.5, 253],
                [458.5, 255],
                [460.5, 257.5],
                [461.5, 258],
                [463, 258],
                [464.5, 257.5],
                [465.5, 256],
                [465.5, 254.5],
                [466, 253],
                [466, 250.5],
                [466, 248.5],
                [466, 246],
                [465.5, 245],
                [465.5, 244],
                [465.5, 243.5],
                [465.5, 244],
                [465.5, 246],
                [466, 248.5],
                [467.5, 252.5],
                [468, 255],
                [469, 257],
                [470, 258.5],
                [470, 259.5],
                [470.5, 259.5],
                [471, 259.5]
            ],
            [1, 230, ["#cc6969", 4, 1],
                [477, 243.5],
                [479, 241],
                [480, 240],
                [481, 239],
                [483.5,
                    237
                ],
                [486.5, 233],
                [488, 231],
                [489, 229],
                [489.5, 227],
                [489.5, 225.5],
                [488, 224],
                [486, 223],
                [484, 222.5],
                [482, 222.5],
                [479, 224.5],
                [476.5, 226],
                [474.5, 228.5],
                [473.5, 231.5],
                [472.5, 235],
                [472.5, 238],
                [473.5, 243.5],
                [474.5, 246.5],
                [475.5, 250],
                [478.5, 254],
                [480.5, 256],
                [482, 257.5],
                [484, 258],
                [485.5, 258],
                [487, 258],
                [489, 256],
                [490, 254.5],
                [490.5, 252.5],
                [490.5, 249.5],
                [490.5, 248],
                [489.5, 246.5],
                [487.5, 245],
                [486, 244.5],
                [484.5, 244],
                [482, 245.5],
                [480.5, 247],
                [479.5, 249],
                [479.5, 250]
            ],
            [1, 231, ["#cc6969", 4, 1],
                [497, 242],
                [497.5, 243.5],
                [498.5,
                    245.5
                ],
                [499, 248],
                [500, 250.5],
                [501, 252.5],
                [501, 255],
                [501.5, 255],
                [502, 255.5]
            ],
            [1, 232, ["#cc6969", 4, 1],
                [503, 249.5],
                [504.5, 249.5],
                [505.5, 249],
                [506.5, 248.5],
                [507.5, 248.5],
                [507.5, 248.5],
                [508, 247.5],
                [508.5, 247]
            ],
            [1, 233, ["#cc6969", 4, 1],
                [510, 242],
                [510, 244],
                [510.5, 246],
                [511, 248],
                [511.5, 251],
                [512, 252],
                [512.5, 253],
                [513, 253.5],
                [513.5, 253.5],
                [514, 253.5]
            ],
            [1, 234, ["#cc6969", 4, 1],
                [518, 243],
                [518, 246],
                [518.5, 248.5],
                [520, 250.5],
                [520.5, 251.5],
                [521.5, 252.5],
                [523, 253],
                [524, 253],
                [525, 253],
                [526, 252.5],
                [527, 251],
                [528.5, 248.5],
                [529.5, 247],
                [529.5, 245.5],
                [529.5, 244],
                [529, 242],
                [527.5, 241],
                [526.5, 239.5],
                [525, 239.5],
                [523, 239],
                [520.5, 239],
                [518, 239.5],
                [517, 241],
                [516.5, 242.5],
                [517.5, 245.5]
            ],
            [1, 235, ["#cc6969", 4, 1],
                [546.5, 239.5],
                [546, 238.5],
                [545, 237.5],
                [543, 237.5],
                [542, 237],
                [540.5, 237],
                [539, 238],
                [538, 241.5],
                [538, 244],
                [538, 246.5],
                [539.5, 248.5],
                [542, 250.5],
                [544.5, 251],
                [547, 251],
                [549.5, 250.5],
                [551, 249],
                [553.5, 247.5]
            ],
            [1, 236, ["#cc6969", 4, 1],
                [560, 238.5],
                [559.5, 239.5],
                [560, 242],
                [560, 244],
                [560.5, 246.5],
                [561, 248.5],
                [561.5, 249.5],
                [561.5,
                    250
                ],
                [562, 250.5],
                [562, 250]
            ],
            [1, 237, ["#cc6969", 4, 1],
                [556.5, 238.5],
                [555, 238],
                [555.5, 238],
                [556, 238],
                [557.5, 238],
                [559.5, 238],
                [561, 237.5],
                [563, 237.5],
                [565.5, 237.5],
                [566.5, 237.5],
                [567.5, 237]
            ],
            [1, 238, ["#cc6969", 4, 1],
                [576, 235],
                [576, 236.5],
                [577, 238.5],
                [577.5, 240.5],
                [578, 243],
                [578.5, 245],
                [579.5, 247],
                [580, 248],
                [580, 248.5],
                [580, 248.5],
                [580, 248]
            ],
            [1, 239, ["#cc6969", 4, 1],
                [580.5, 242],
                [583.5, 240],
                [586, 240],
                [587.5, 240],
                [589, 241],
                [590.5, 241.5],
                [591, 242.5],
                [592, 243.5],
                [592, 244],
                [592, 244.5],
                [592, 245],
                [591, 246],
                [590.5,
                    246.5
                ],
                [589, 247],
                [588.5, 248],
                [587, 248],
                [586, 248.5]
            ]
        ],
        en: [...GPAssets_.GIRL_PORTRAIT, [1, 4, ["#cc6969", 4, 1],
                [389, 160],
                [388, 152],
                [385, 146],
                [378, 144],
                [371, 149],
                [367, 160],
                [370, 166],
                [382, 175],
                [392, 185],
                [396, 195],
                [388, 207],
                [375, 209],
                [364, 205],
                [361, 199]
            ],
            [1, 7, ["#cc6969", 4, 1],
                [404, 174],
                [403, 183],
                [404, 193],
                [408, 205],
                [414, 212],
                [422, 213],
                [428, 205],
                [430, 190],
                [429, 181],
                [428, 178],
                [427, 178]
            ],
            [1, 8, ["#cc6969", 4, 1],
                [445, 175],
                [438, 181],
                [436, 185],
                [437, 188],
                [442, 188],
                [450, 192],
                [455, 195],
                [454, 202],
                [447, 205],
                [439, 207],
                [436,
                    206
                ],
                [436, 205]
            ],
            [1, 9, ["#cc6969", 4, 1],
                [455, 179],
                [458, 187],
                [463, 200],
                [465, 208],
                [467, 211],
                [462, 203],
                [459, 194],
                [458, 181],
                [461, 174],
                [468, 170],
                [475, 170],
                [481, 175],
                [483, 185],
                [480, 192],
                [473, 195],
                [468, 196]
            ],
            [1, 10, ["#cc6969", 4, 1],
                [492, 174],
                [492, 182],
                [492, 190],
                [493, 195]
            ],
            [1, 11, ["#cc6969", 4, 1],
                [495, 158],
                [493, 156],
                [491, 156],
                [488, 156],
                [487, 160],
                [491, 162],
                [495, 160],
                [495, 158],
                [492, 159],
                [492, 159]
            ],
            [1, 13, ["#cc6969", 4, 1],
                [520, 173],
                [512, 171],
                [508, 172],
                [505, 176],
                [503, 185],
                [504, 192],
                [508, 197],
                [515, 197],
                [522, 195],
                [525,
                    194
                ]
            ],
            [1, 14, ["#cc6969", 4, 1],
                [531, 174],
                [532, 184],
                [534, 193],
                [534, 196],
                [534, 198],
                [535, 197]
            ],
            [1, 15, ["#cc6969", 4, 1],
                [530, 156],
                [528, 156],
                [527, 158],
                [526, 162],
                [527, 164],
                [531, 164],
                [534, 163],
                [534, 160],
                [532, 158],
                [529, 157],
                [528, 157]
            ],
            [1, 16, ["#cc6969", 4, 1],
                [529, 160],
                [532, 161],
                [532, 160],
                [531, 159],
                [530, 159],
                [530, 159]
            ],
            [1, 17, ["#cc6969", 4, 1],
                [552, 173],
                [547, 171],
                [544, 171],
                [540, 172],
                [538, 175],
                [538, 183],
                [539, 191],
                [545, 197],
                [552, 198],
                [559, 197],
                [565, 190],
                [563, 180],
                [558, 174],
                [552, 172],
                [548, 173]
            ],
            [1, 21, ["#cc6969", 4, 1],
                [572,
                    170
                ],
                [572, 175],
                [572, 180],
                [575, 189],
                [578, 194],
                [583, 195],
                [589, 192],
                [593, 184],
                [595, 178],
                [593, 174],
                [590, 170],
                [589, 168],
                [589, 169]
            ],
            [1, 22, ["#cc6969", 4, 1],
                [607, 168],
                [605, 167],
                [602, 168],
                [598, 173],
                [598, 175],
                [602, 178],
                [608, 178],
                [615, 179],
                [620, 184],
                [620, 188],
                [614, 192],
                [608, 193],
                [603, 193],
                [602, 192],
                [602, 192]
            ],
            [1, 23, ["#cc6969", 4, 1],
                [503, 272],
                [506, 258],
                [511, 242],
                [516, 225],
                [518, 216],
                [519, 213],
                [522, 215],
                [525, 228],
                [530, 245],
                [533, 262],
                [535, 269],
                [535, 272],
                [535, 272]
            ],
            [1, 24, ["#cc6969", 4, 1],
                [515, 258],
                [516, 258],
                [522, 258],
                [529, 258],
                [533, 258],
                [533, 259],
                [533, 259]
            ],
            [1, 26, ["#cc6969", 4, 1],
                [553, 245],
                [550, 245],
                [545, 245],
                [541, 248],
                [539, 258],
                [542, 266],
                [552, 272],
                [558, 271],
                [561, 270]
            ],
            [1, 29, ["#cc6969", 4, 1],
                [565, 221],
                [565, 235],
                [567, 251],
                [568, 258],
                [568, 260],
                [568, 262],
                [568, 260],
                [568, 260]
            ],
            [1, 30, ["#cc6969", 4, 1],
                [552, 238],
                [562, 238],
                [570, 235],
                [576, 235],
                [578, 235]
            ],
            [1, 31, ["#cc6969", 4, 1],
                [586, 244],
                [587, 251],
                [588, 259],
                [588, 263],
                [588, 264]
            ],
            [1, 32, ["#cc6969", 4, 1],
                [588, 224],
                [585, 222],
                [584, 223],
                [584, 225],
                [585, 227],
                [588, 227],
                [590, 226],
                [590, 225],
                [587, 224],
                [586, 225],
                [586, 225]
            ],
            [1, 37, ["#cc6969", 4, 1],
                [596, 241],
                [600, 247],
                [604, 254],
                [605, 260],
                [607, 264],
                [608, 265],
                [608, 264],
                [608, 258],
                [609, 251],
                [612, 242],
                [612, 238]
            ],
            [1, 38, ["#cc6969", 4, 1],
                [622, 239],
                [623, 246],
                [624, 252],
                [625, 259],
                [625, 262],
                [625, 262],
                [625, 262]
            ],
            [1, 39, ["#cc6969", 4, 1],
                [620, 225],
                [619, 225],
                [618, 225],
                [616, 226],
                [616, 228],
                [618, 231],
                [619, 231],
                [622, 229],
                [622, 228],
                [622, 226],
                [620, 225],
                [619, 225]
            ],
            [1, 40, ["#cc6969", 4, 1],
                [635, 211],
                [638, 227],
                [639, 240],
                [641, 252],
                [642, 255]
            ],
            [1, 41, ["#cc6969", 4, 1],
                [629, 232],
                [631, 232],
                [636, 232],
                [645, 230],
                [649, 228]
            ],
            [1, 49, ["#cc6969", 4, 1],
                [653, 235],
                [652, 238],
                [652, 242],
                [655, 248],
                [665, 251],
                [672, 250],
                [678, 242],
                [678, 238],
                [678, 235],
                [678, 234],
                [678, 233],
                [678, 235],
                [679, 239],
                [682, 248],
                [683, 262],
                [680, 272],
                [672, 279],
                [661, 280],
                [652, 278],
                [649, 274],
                [650, 271],
                [654, 270]
            ]
        ],
        es: [...GPAssets_.GIRL_PORTRAIT, [1, 200, ["#cc6969", 4, 1],
                [400, 217],
                [402, 203],
                [406, 174],
                [412, 152],
                [417, 134],
                [420, 129],
                [421, 128],
                [422, 132],
                [425, 148],
                [428, 172],
                [433, 195],
                [438, 211],
                [439, 214],
                [438, 215],
                [437, 215],
                [437, 215]
            ],
            [1,
                201, ["#cc6969", 4, 1],
                [411, 195],
                [420, 195],
                [427, 195],
                [432, 195],
                [434, 195],
                [435, 195]
            ],
            [1, 202, ["#cc6969", 4, 1],
                [463, 187],
                [463, 181],
                [460, 175],
                [455, 172],
                [448, 172],
                [444, 179],
                [443, 189],
                [445, 199],
                [452, 205],
                [461, 205],
                [463, 203],
                [463, 203]
            ],
            [1, 203, ["#cc6969", 4, 1],
                [472, 152],
                [474, 169],
                [477, 188],
                [478, 205],
                [479, 210],
                [479, 210],
                [479, 208],
                [479, 208]
            ],
            [1, 204, ["#cc6969", 4, 1],
                [457, 164],
                [461, 164],
                [469, 164],
                [476, 164],
                [481, 164],
                [484, 165]
            ],
            [1, 205, ["#cc6969", 4, 1],
                [491, 174],
                [492, 182],
                [494, 192],
                [495, 198],
                [495, 202],
                [495, 202]
            ],
            [1, 206,
                ["#cc6969", 4, 1],
                [493, 152],
                [492, 150],
                [491, 148],
                [489, 148],
                [489, 150],
                [491, 153],
                [494, 152],
                [495, 148],
                [492, 146],
                [489, 147]
            ],
            [1, 207, ["#cc6969", 4, 1],
                [503, 170],
                [504, 174],
                [507, 182],
                [511, 193],
                [511, 198],
                [513, 202],
                [514, 203],
                [514, 202],
                [516, 195],
                [518, 187],
                [521, 174],
                [521, 168],
                [521, 166],
                [521, 166],
                [521, 166]
            ],
            [1, 208, ["#cc6969", 4, 1],
                [532, 167],
                [534, 175],
                [535, 186],
                [536, 195],
                [536, 197],
                [536, 197]
            ],
            [1, 209, ["#cc6969", 4, 1],
                [560, 175],
                [554, 171],
                [551, 169],
                [548, 169],
                [545, 175],
                [545, 183],
                [546, 189],
                [550, 196],
                [555, 198],
                [562, 194],
                [564,
                    187
                ],
                [564, 179],
                [563, 178]
            ],
            [1, 210, ["#cc6969", 4, 1],
                [565, 184],
                [565, 172],
                [563, 156],
                [562, 146],
                [560, 139],
                [560, 138],
                [560, 138]
            ],
            [1, 211, ["#cc6969", 4, 1],
                [577, 172],
                [576, 164],
                [578, 159],
                [585, 156],
                [590, 157],
                [596, 167],
                [598, 178],
                [599, 188],
                [600, 192]
            ],
            [1, 212, ["#cc6969", 4, 1],
                [594, 181],
                [588, 178],
                [582, 178],
                [577, 178],
                [575, 181],
                [574, 186],
                [574, 190],
                [580, 193],
                [586, 193],
                [591, 192],
                [594, 190]
            ],
            [1, 213, ["#cc6969", 4, 1],
                [629, 178],
                [621, 172],
                [616, 172],
                [611, 172],
                [609, 175],
                [607, 182],
                [609, 188],
                [613, 192],
                [621, 193],
                [625, 192],
                [628, 190],
                [629, 189],
                [631, 188],
                [631, 186],
                [631, 185]
            ],
            [1, 214, ["#cc6969", 4, 1],
                [632, 188],
                [631, 171],
                [629, 153],
                [629, 138],
                [629, 135],
                [630, 135],
                [630, 135]
            ],
            [1, 215, ["#cc6969", 4, 1],
                [412, 244],
                [409, 238],
                [403, 236],
                [395, 238],
                [385, 244],
                [382, 249],
                [382, 253],
                [387, 254],
                [398, 256],
                [408, 260],
                [418, 268],
                [421, 277],
                [417, 282],
                [403, 282],
                [388, 278],
                [382, 275],
                [381, 274],
                [382, 273],
                [382, 273]
            ],
            [1, 216, ["#cc6969", 4, 1],
                [445, 262],
                [443, 258],
                [440, 257],
                [436, 257],
                [431, 258],
                [429, 262],
                [428, 265],
                [428, 268],
                [430, 272],
                [434, 274],
                [437, 275],
                [441, 275],
                [445, 273],
                [447, 268],
                [447, 264],
                [447, 262],
                [446, 260]
            ],
            [1, 217, ["#cc6969", 4, 1],
                [472, 252],
                [466, 249],
                [461, 250],
                [458, 254],
                [458, 257],
                [461, 258],
                [468, 262],
                [473, 265],
                [476, 270],
                [472, 275],
                [465, 275],
                [460, 275],
                [459, 273],
                [459, 273]
            ],
            [1, 218, ["#cc6969", 4, 1],
                [485, 261],
                [488, 272],
                [489, 280],
                [489, 284],
                [489, 285]
            ],
            [1, 219, ["#cc6969", 4, 1],
                [486, 264],
                [484, 258],
                [485, 254],
                [491, 250],
                [495, 250],
                [502, 252],
                [505, 257],
                [506, 262],
                [501, 268],
                [494, 271],
                [488, 272],
                [487, 272]
            ],
            [1, 220, ["#cc6969", 4, 1],
                [523, 261],
                [528, 257],
                [530, 253],
                [531, 250],
                [528, 248],
                [523,
                    249
                ],
                [517, 252],
                [515, 258],
                [515, 265],
                [521, 272],
                [529, 275],
                [534, 274],
                [536, 272],
                [536, 271],
                [536, 271]
            ],
            [1, 221, ["#cc6969", 4, 1],
                [559, 251],
                [553, 250],
                [548, 250],
                [544, 252],
                [542, 258],
                [543, 262],
                [548, 267],
                [554, 268],
                [560, 268],
                [562, 266],
                [562, 266],
                [562, 266]
            ],
            [1, 222, ["#cc6969", 4, 1],
                [569, 233],
                [571, 241],
                [573, 252],
                [574, 261],
                [576, 266],
                [576, 266],
                [576, 264],
                [576, 258],
                [579, 251],
                [584, 248],
                [590, 248],
                [594, 252],
                [597, 260],
                [597, 265],
                [597, 270],
                [597, 270],
                [597, 270]
            ],
            [1, 223, ["#cc6969", 4, 1],
                [617, 250],
                [615, 248],
                [612, 248],
                [609, 250],
                [607,
                    252
                ],
                [607, 257],
                [609, 262],
                [612, 264],
                [618, 265],
                [622, 265],
                [626, 263],
                [627, 259],
                [626, 254],
                [623, 251],
                [619, 250],
                [619, 250],
                [619, 250]
            ],
            [1, 224, ["#cc6969", 4, 1],
                [647, 249],
                [647, 246],
                [644, 245],
                [639, 245],
                [635, 247],
                [634, 250],
                [634, 252],
                [641, 255],
                [646, 258],
                [649, 262],
                [650, 267],
                [644, 270],
                [637, 270],
                [634, 268],
                [633, 265],
                [634, 264],
                [634, 264]
            ],
            [1, 225, ["#cc6969", 4, 1],
                [660, 248],
                [659, 247],
                [659, 243],
                [660, 240],
                [663, 238],
                [668, 238],
                [673, 246],
                [676, 254],
                [677, 260],
                [678, 265],
                [678, 267]
            ],
            [1, 226, ["#cc6969", 4, 1],
                [674, 256],
                [669, 254],
                [664,
                    252
                ],
                [662, 252],
                [659, 253],
                [658, 258],
                [659, 262],
                [664, 268],
                [669, 268],
                [676, 266],
                [678, 264],
                [678, 262],
                [678, 262]
            ],
            [1, 227, ["#cc6969", 4, 1],
                [530, 152],
                [529, 151],
                [528, 151],
                [526, 152],
                [526, 155],
                [530, 158],
                [531, 158],
                [532, 156],
                [532, 153],
                [532, 151],
                [530, 150],
                [529, 150],
                [529, 152],
                [530, 152],
                [530, 152]
            ]
        ]
    };
    GPAssets_.AC_FORGERY_PH = {
        ru: [...GPAssets_.GIRL_PORTRAIT, [1, 200, ["#cc6969", 4, 1],
                [425, 196.5],
                [425, 200],
                [425.5, 203.5],
                [426.5, 207.5],
                [427, 212.5],
                [427.5, 217],
                [427.5, 221.5],
                [428, 226],
                [428, 228.5],
                [428, 230.5],
                [428, 230.5],
                [428, 230.5],
                [428, 230]
            ],
            [1, 201, ["#cc6969", 4, 1],
                [427.5, 196.5],
                [427.5, 196],
                [428.5, 196],
                [430, 196],
                [432.5, 196],
                [436.5, 195],
                [439, 195],
                [440.5, 194.5],
                [442, 194.5],
                [442.5, 194.5],
                [443, 194.5],
                [443, 195],
                [443, 195.5],
                [442.5, 196],
                [442.5, 198.5],
                [442.5, 201],
                [442.5, 203.5],
                [442.5, 206],
                [442.5, 209.5],
                [443, 214],
                [443, 217],
                [443, 220],
                [443, 222.5],
                [443, 226],
                [443.5, 227.5],
                [444, 228],
                [444, 229],
                [444.5, 229],
                [444.5, 229.5],
                [444.5, 229],
                [444.5, 228.5]
            ],
            [1, 202, ["#cc6969", 4, 1],
                [458, 212.5],
                [457, 213.5],
                [456.5, 216.5],
                [456.5, 219],
                [456.5, 221],
                [456.5, 223],
                [457.5, 224.5],
                [460, 226.5],
                [461.5, 227],
                [463.5, 227.5],
                [465.5, 227],
                [468, 226],
                [468.5, 225],
                [470, 222.5],
                [470.5, 220.5],
                [471, 218.5],
                [470.5, 215],
                [470, 213.5],
                [468, 212.5],
                [466.5, 211.5],
                [463.5, 211.5],
                [461.5, 211.5],
                [460.5, 212.5],
                [459.5, 214],
                [459.5, 215]
            ],
            [1, 203, ["#cc6969", 4, 1],
                [492, 214],
                [491,
                    212
                ],
                [490.5, 211],
                [488, 211],
                [486.5, 211],
                [484, 211.5],
                [483, 213],
                [482, 215],
                [481, 217.5],
                [480.5, 221.5],
                [481, 223.5],
                [482, 225.5],
                [485, 227],
                [487, 227.5],
                [489, 227.5],
                [490.5, 227],
                [491.5, 226],
                [493, 223.5],
                [493.5, 221.5],
                [494, 218.5],
                [494, 216],
                [494, 214.5],
                [494, 215],
                [494, 216],
                [494.5, 217],
                [495, 220],
                [496, 225],
                [497.5, 228.5],
                [499.5, 232.5],
                [501.5, 235.5],
                [505, 239.5],
                [506.5, 241.5],
                [507.5, 243],
                [507.5, 244],
                [507, 244.5],
                [506, 245],
                [503, 245],
                [500, 245],
                [497.5, 245],
                [493.5, 245],
                [492, 244],
                [491, 243],
                [491, 241.5],
                [491, 239.5],
                [492, 237],
                [494, 235.5],
                [495.5, 235]
            ],
            [1, 204, ["#cc6969", 4, 1],
                [518, 213],
                [517, 211],
                [516.5, 210],
                [514, 210],
                [512.5, 210],
                [510, 210.5],
                [509, 212],
                [508, 214],
                [507, 216.5],
                [506.5, 220.5],
                [507, 222.5],
                [508, 224.5],
                [511, 226],
                [513, 226.5],
                [515, 226.5],
                [516.5, 226],
                [517.5, 225],
                [519, 222.5],
                [519.5, 220.5],
                [520, 217.5],
                [520, 215],
                [520, 213.5],
                [520, 214],
                [520, 215],
                [520.5, 216],
                [521, 219],
                [522, 224],
                [523.5, 227.5],
                [525.5, 231.5],
                [527.5, 234.5],
                [531, 238.5],
                [532.5, 240.5],
                [533.5, 242],
                [533.5, 243],
                [533, 243.5],
                [532, 244],
                [529, 244],
                [526, 244],
                [523.5, 244],
                [519.5,
                    244
                ],
                [518, 243],
                [517, 242],
                [517, 240.5],
                [517, 238.5],
                [518, 236],
                [520, 234.5],
                [521.5, 234]
            ],
            [1, 205, ["#cc6969", 4, 1],
                [536.5, 217.5],
                [537.5, 217],
                [539.5, 215.5],
                [541.5, 215],
                [542.5, 214],
                [543.5, 213],
                [544, 212.5],
                [544, 211.5],
                [544, 211],
                [543, 210.5],
                [541.5, 209.5],
                [539.5, 209.5],
                [538.5, 209.5],
                [537, 210],
                [536, 211],
                [535, 211.5],
                [533.5, 213],
                [533, 214.5],
                [533, 215.5],
                [533, 217.5],
                [534, 220],
                [535, 222],
                [536, 223],
                [537, 223.5],
                [539, 224],
                [540.5, 224],
                [543, 224],
                [544, 223],
                [546, 222.5],
                [548, 222]
            ],
            [1, 206, ["#cc6969", 4, 1],
                [560.5, 209.5],
                [560, 212.5],
                [559.5, 214.5],
                [559.5, 217],
                [559, 219],
                [558, 222],
                [558, 223],
                [558, 223.5],
                [558, 224]
            ],
            [1, 207, ["#cc6969", 4, 1],
                [562.5, 208.5],
                [565, 212.5],
                [567.5, 216],
                [569, 218],
                [570.5, 220],
                [571.5, 221.5],
                [572.5, 223],
                [572.5, 223.5],
                [573, 224],
                [573, 224.5]
            ],
            [1, 208, ["#cc6969", 4, 1],
                [579, 207],
                [578.5, 206.5],
                [579, 207.5],
                [580, 209.5],
                [581.5, 213.5],
                [583, 218.5],
                [583.5, 221.5],
                [584, 223.5],
                [584, 225],
                [584, 226],
                [584, 226.5],
                [584, 225.5],
                [584, 225]
            ],
            [1, 209, ["#cc6969", 4, 1],
                [588, 205],
                [590, 205.5],
                [590, 206.5],
                [590, 207.5],
                [590, 210],
                [589.5, 212],
                [588.5,
                    214
                ],
                [588, 215.5],
                [587.5, 217],
                [587, 218],
                [586.5, 218.5],
                [586, 219],
                [586, 219.5],
                [586.5, 219.5],
                [587, 219.5],
                [587.5, 219.5],
                [588.5, 220],
                [590.5, 221],
                [592, 222],
                [594, 223],
                [594.5, 223.5],
                [596, 224],
                [597, 225]
            ],
            [1, 210, ["#cc6969", 4, 1],
                [614.5, 211],
                [612, 208],
                [610.5, 206.5],
                [609.5, 206],
                [607.5, 205.5],
                [606, 205.5],
                [605.5, 206],
                [604, 206.5],
                [603.5, 208],
                [603.5, 209.5],
                [603.5, 213],
                [603.5, 215.5],
                [604, 217.5],
                [605.5, 220],
                [606, 221],
                [607, 222],
                [608, 222],
                [609, 222],
                [610.5, 221.5],
                [612, 220],
                [612.5, 218.5],
                [613.5, 217],
                [614, 214.5],
                [614, 212.5],
                [614, 211],
                [614, 210],
                [614, 210.5],
                [615, 212],
                [615, 214],
                [615.5, 217.5],
                [615.5, 219],
                [616, 220],
                [616, 221.5],
                [616.5, 222],
                [616.5, 222],
                [617, 222],
                [617, 222.5]
            ]
        ],
        en: [...GPAssets_.GIRL_PORTRAIT, [1, 45, ["#cc6969", 4, 1],
                [440, 243],
                [439, 245],
                [438, 243],
                [435, 232],
                [433, 213],
                [432, 186],
                [435, 169],
                [438, 160],
                [443, 157],
                [448, 158],
                [452, 165],
                [456, 178],
                [458, 190],
                [460, 198],
                [460, 201]
            ],
            [1, 46, ["#cc6969", 4, 1],
                [427, 210],
                [437, 210],
                [442, 210]
            ],
            [1, 49, ["#cc6969", 4, 1],
                [460, 215],
                [458, 215],
                [455, 215],
                [450, 218],
                [448, 222],
                [448, 228],
                [452, 235],
                [458,
                    241
                ],
                [466, 241],
                [472, 238],
                [476, 229],
                [475, 223],
                [468, 217],
                [464, 215],
                [461, 215],
                [461, 215]
            ],
            [1, 72, ["#cc6969", 4, 1],
                [482, 212],
                [482, 216],
                [485, 225],
                [488, 232],
                [489, 235],
                [489, 235],
                [489, 232],
                [488, 225],
                [487, 218],
                [488, 212],
                [492, 210],
                [496, 208],
                [498, 208],
                [498, 208],
                [499, 209],
                [501, 209],
                [502, 209],
                [502, 211],
                [502, 211]
            ],
            [1, 75, ["#cc6969", 4, 1],
                [519, 215],
                [514, 213],
                [509, 213],
                [505, 215],
                [504, 222],
                [505, 227],
                [509, 233],
                [515, 234],
                [521, 232],
                [525, 228],
                [525, 225],
                [523, 222],
                [522, 221],
                [525, 223],
                [528, 230],
                [531, 241],
                [529, 252],
                [521, 258],
                [508, 262],
                [502, 260],
                [499, 255],
                [499, 252],
                [503, 249],
                [508, 248],
                [512, 248],
                [512, 248]
            ],
            [1, 78, ["#cc6969", 4, 1],
                [538, 222],
                [543, 221],
                [548, 218],
                [551, 213],
                [551, 208],
                [547, 206],
                [539, 206],
                [535, 212],
                [532, 222],
                [532, 228],
                [539, 234],
                [548, 235],
                [556, 232],
                [561, 229],
                [561, 228],
                [561, 228]
            ],
            [1, 79, ["#cc6969", 4, 1],
                [559, 211],
                [559, 212],
                [562, 215],
                [566, 224],
                [568, 229],
                [568, 231],
                [568, 229],
                [565, 224],
                [565, 216],
                [566, 210],
                [572, 208],
                [579, 208],
                [584, 208],
                [584, 207],
                [584, 207]
            ],
            [1, 80, ["#cc6969", 4, 1],
                [579, 217],
                [579, 218],
                [581, 223],
                [585, 227],
                [592,
                    228
                ],
                [598, 225],
                [602, 218],
                [603, 213],
                [602, 211],
                [600, 210],
                [600, 212],
                [605, 218],
                [608, 228],
                [610, 244],
                [606, 253],
                [595, 258],
                [586, 258],
                [581, 257],
                [580, 248],
                [584, 243],
                [592, 240],
                [599, 240],
                [603, 240],
                [603, 240],
                [603, 240]
            ]
        ],
        es: [...GPAssets_.GIRL_PORTRAIT, [1, 117, ["#cc6969", 4, 1],
                [438, 205],
                [441, 225],
                [445, 246],
                [445, 254]
            ],
            [1, 120, ["#cc6969", 4, 1],
                [436, 208],
                [442, 202],
                [449, 199],
                [459, 199],
                [466, 205],
                [468, 215],
                [463, 224],
                [454, 228],
                [449, 228],
                [448, 228],
                [448, 228]
            ],
            [1, 122, ["#cc6969", 4, 1],
                [472, 196],
                [473, 209],
                [477, 224],
                [480, 236],
                [481,
                    245
                ]
            ],
            [1, 125, ["#cc6969", 4, 1],
                [484, 220],
                [484, 215],
                [488, 210],
                [495, 208],
                [501, 211],
                [508, 219],
                [511, 228],
                [512, 234],
                [512, 235],
                [511, 238],
                [511, 238]
            ],
            [1, 126, ["#cc6969", 4, 1],
                [508, 226],
                [503, 222],
                [499, 222],
                [495, 222],
                [490, 225],
                [487, 229],
                [485, 234],
                [487, 237],
                [494, 240],
                [501, 240],
                [507, 239],
                [508, 238],
                [509, 237]
            ],
            [1, 129, ["#cc6969", 4, 1],
                [539, 218],
                [538, 214],
                [535, 212],
                [529, 210],
                [525, 211],
                [521, 214],
                [518, 219],
                [518, 225],
                [521, 231],
                [525, 234],
                [533, 235],
                [538, 232],
                [542, 228],
                [542, 225]
            ],
            [1, 130, ["#cc6969", 4, 1],
                [541, 218],
                [541, 220],
                [543, 225],
                [546, 235],
                [546, 245],
                [542, 255],
                [535, 259],
                [526, 259],
                [522, 256],
                [518, 250],
                [517, 246],
                [519, 246],
                [519, 246]
            ],
            [1, 131, ["#cc6969", 4, 1],
                [552, 210],
                [553, 215],
                [555, 222],
                [558, 228]
            ],
            [1, 133, ["#cc6969", 4, 1],
                [549, 195],
                [549, 194],
                [549, 194],
                [548, 194],
                [547, 195],
                [547, 198],
                [549, 198],
                [552, 198],
                [553, 196],
                [552, 194],
                [552, 193],
                [549, 192]
            ],
            [1, 140, ["#cc6969", 4, 1],
                [578, 208],
                [574, 206],
                [571, 206],
                [567, 207],
                [566, 208],
                [565, 213],
                [565, 218],
                [567, 222],
                [570, 226],
                [575, 227],
                [580, 227],
                [585, 225],
                [588, 218],
                [588, 215],
                [585, 208],
                [582, 206]
            ]
        ]
    };
    window.GPAssets_ = GPAssets_;
    class GPAvatarEditor_ extends EventTarget {
        static AVATAR_WIDTH = 42;
        static AVATAR_HEIGHT = 50;
        static AVATAR_PADDING = 1;
        static AVATAR_SMOOTH_DENSITY = 2;
        static AVATAR_DENSITY = 3;
        static AVATAR_FRAME_WIDTH = 46;
        static AVATAR_FRAME_BORDER_WIDTH = 2;
        static VIEWFINDER_WIDTH = 380;
        static VIEWFINDER_HEIGHT = 240;
        static OVERFLOWING_AREA_BORDER_WIDTH = 2;
        static COLOR_PICKER_UPDATE_INTERVAL = 50;
        static LIVE_PREVIEW_ENABLED = !0;
        static ZOOM_SENSITIVITY = 1.03;
        static IMAGE_SMOOTHING_ENABLED = !0;
        static HAS_FOREGROUND = !0;
        static BACKGROUND_COLOR = "#eaf1fd";
        static AVATAR_TYPE = "image/webp";
        static AVATAR_QUALITY = 1;
        static IMAGE_TYPES = new Set("image/jpeg image/png image/gif image/webp image/svg+xml image/bmp image/avif".split(" "));
        static IMAGE_TYPES_WITHOUT_TRANSPARENCY = ["image/jpeg"];
        static CHANGE = {
            LOADED: "loaded",
            POSITION: "position",
            SCALE: "scale",
            RESET: "reset",
            MIRROR: "mirror",
            FOREGROUND: "foreground",
            BACKGROUND: "background",
            SMOOTHING: "smoothing"
        };
        constructor(a, b, c, d, e, f) {
            super();
            this.l = f;
            this.updatePreview = this.updatePreview.bind(this);
            this.onZoomerChange = this.onZoomerChange.bind(this);
            this.onZoomerReset = this.onZoomerReset.bind(this);
            this.handleFile = this.handleFile.bind(this);
            this.livePreviewEnabled = a ?? GPAvatarEditor_.LIVE_PREVIEW_ENABLED;
            this.zoomSensitivity = b ?? GPAvatarEditor_.ZOOM_SENSITIVITY;
            this.imageSmoothingEnabled =
                c ?? GPAvatarEditor_.IMAGE_SMOOTHING_ENABLED;
            this.hasForeground = d ?? GPAvatarEditor_.HAS_FOREGROUND;
            this.backgroundColor = e ?? GPAvatarEditor_.BACKGROUND_COLOR;
            this.previewCanvas = null;
            this.isChanged = this.isDragging = !1;
            this.addEventListener("change", ({
                detail: {
                    type: g
                }
            }) => {
                this.hasForeground ? g !== GPAvatarEditor_.CHANGE.BACKGROUND && this.setOpaqueBackgroundState(this.hasOpaqueBackground()) : this.setOpaqueBackgroundState(!1)
            });
            this.render();
            this.updateAvatarViews()
        }
        getElement() {
            return this.container
        }
        render() {
            this.container =
                document.createElement("div");
            this.container.className = "avatar-editor_";
            this.container.dataset.lang = this.l.lang;
            this.container.classList.toggle("has-foreground_", this.hasForeground);
            this.container.style.setProperty("--av-editor-viewfinder-width", `${GPAvatarEditor_.VIEWFINDER_WIDTH}px`);
            this.container.style.setProperty("--av-editor-viewfinder-height", `${GPAvatarEditor_.VIEWFINDER_HEIGHT}px`);
            this.container.style.setProperty("--av-editor-focus-width", `${GPAvatarEditor_.AVATAR_WIDTH*GPAvatarEditor_.AVATAR_DENSITY}px`);
            this.container.style.setProperty("--av-editor-focus-height", `${GPAvatarEditor_.AVATAR_HEIGHT*GPAvatarEditor_.AVATAR_DENSITY}px`);
            this.container.style.setProperty("--av-editor-focus-frame-width", `${GPAvatarEditor_.AVATAR_FRAME_WIDTH*GPAvatarEditor_.AVATAR_DENSITY}px`);
            this.container.style.setProperty("--av-editor-focus-frame-border-width", `${GPAvatarEditor_.AVATAR_FRAME_BORDER_WIDTH*GPAvatarEditor_.AVATAR_DENSITY}px`);
            this.container.style.setProperty("--av-editor-focus-frame-shadow-radius", `${(Math.ceil(Math.sqrt(GPAvatarEditor_.VIEWFINDER_WIDTH**
2+GPAvatarEditor_.VIEWFINDER_HEIGHT**2))-GPAvatarEditor_.AVATAR_FRAME_WIDTH)/2}px`);
            this.container.style.setProperty("--av-editor-overflowing-area-width", `${GPAvatarEditor_.AVATAR_WIDTH*GPAvatarEditor_.AVATAR_DENSITY+2*GPAvatarEditor_.OVERFLOWING_AREA_BORDER_WIDTH}px`);
            this.container.style.setProperty("--av-editor-overflowing-area-height", `${(GPAvatarEditor_.AVATAR_HEIGHT-GPAvatarEditor_.AVATAR_WIDTH/2)*GPAvatarEditor_.AVATAR_DENSITY+2*GPAvatarEditor_.OVERFLOWING_AREA_BORDER_WIDTH}px`);
            this.container.style.setProperty("--av-editor-overflowing-area-border-width",
                `${GPAvatarEditor_.OVERFLOWING_AREA_BORDER_WIDTH}px`);
            this.container.style.setProperty("--av-editor-avatar-background", this.backgroundColor);
            this.viewfinder = document.createElement("div");
            this.viewfinder.className = "viewfinder_";
            this.container.appendChild(this.viewfinder);
            this.viewfinder.addEventListener("pointerdown", g => {
                if (0 !== g.button || g.ctrlKey)(1 === g.button || 0 === g.button && g.ctrlKey) && this.isChanged && this.saveCanvas(this.previewCanvas);
                else {
                    this.isDragging = !0;
                    this.livePreviewEnabled || (this.clearViewfinderFocus(),
                        this.focusFrame.classList.remove("rendered_"));
                    const h = g.pageX,
                        k = g.pageY;
                    this.viewfinder.addEventListener("pointerup", l => {
                        this.isDragging = !1;
                        if (h !== l.pageX || k !== l.pageY) this.onZoomerChange(l)
                    }, {
                        once: !0
                    })
                }
            });
            this.viewfinder.addEventListener("wheel", g => {
                this.onZoomerChange(g);
                !this.livePreviewEnabled && this.isDragging && this.clearViewfinderFocus()
            });
            const a = this.container;
            let b;
            a.addEventListener("dragenter", g => {
                g.preventDefault();
                b = g.target;
                a.classList.add("drop_")
            });
            a.addEventListener("dragleave", g => {
                g.target === b && (g.preventDefault(), a.classList.remove("drop_"))
            });
            a.addEventListener("drop", g => {
                g.preventDefault();
                this.handleFile(g);
                a.classList.remove("drop_")
            });
            a.addEventListener("dragover", g => {
                g.preventDefault();
                g.dataTransfer.dropEffect = "move"
            });
            this.source = document.createElement("canvas");
            this.source.className = "source_ inactive_";
            this.source.width = GPAvatarEditor_.VIEWFINDER_WIDTH;
            this.source.height = GPAvatarEditor_.VIEWFINDER_HEIGHT;
            this.viewfinder.appendChild(this.source);
            this.sourceCtx = this.source.getContext("2d");
            this.zoomer = new GPCanvasZoomer_(this.source, null, this.zoomSensitivity);
            this.zoomer.addEventListener("change", this.onZoomerChange);
            this.zoomer.addEventListener("reset", this.onZoomerReset);
            var c = document.createElement("div");
            c.className = "blackout_";
            this.viewfinder.appendChild(c);
            c = document.createElement("div");
            c.className = "overflowing-area_";
            this.viewfinder.appendChild(c);
            this.focusFrame = document.createElement("div");
            this.focusFrame.className = "focus-frame_";
            this.viewfinder.appendChild(this.focusFrame);
            this.focus = document.createElement("canvas");
            this.focus.className = "focus_";
            this.focus.width = GPAvatarEditor_.AVATAR_WIDTH * GPAvatarEditor_.AVATAR_DENSITY * 2;
            this.focus.height = GPAvatarEditor_.AVATAR_HEIGHT * GPAvatarEditor_.AVATAR_DENSITY * 2;
            this.viewfinder.appendChild(this.focus);
            this.focusCtx = this.focus.getContext("2d");
            this.focusCtx.imageSmoothingEnabled = this.imageSmoothingEnabled;
            this.focusCtx.imageSmoothingQuality = "high";
            this.preview = document.createElement("div");
            this.preview.className = "preview_";
            this.preview.innerHTML =
                '<div class="user_"><div class="avatar_"><div class="icon_"></div></div></div>';
            this.container.appendChild(this.preview);
            this.previewAvatar = this.preview.querySelector(".icon_");
            c = document.createElement("div");
            c.className = "buttons_";
            this.fgModeBtn = document.createElement("div");
            this.fgModeBtn.className = "fg-mode_ btn_";
            this.fgModeBtn.title = this.l.FG_MODE_BTN_TTL;
            this.fgModeBtn.addEventListener("click", this.toggleForegroundMode.bind(this));
            c.appendChild(this.fgModeBtn);
            var d = document.createElement("div");
            d.className = "mirror_ btn_";
            d.title = this.l.MIRROR_BTN_TTL;
            d.addEventListener("click", g => {
                this.mirror()
            });
            c.appendChild(d);
            const e = document.createElement("input");
            e.className = "bg-color-input_";
            e.type = "color";
            e.addEventListener("input", g => {
                this.container.style.setProperty("--av-editor-avatar-background", g.target.value);
                clearTimeout(this.bgColorTimer);
                this.bgColorTimer = setTimeout(() => {
                    this.setBackground(g.target.value, !1)
                }, GPAvatarEditor_.COLOR_PICKER_UPDATE_INTERVAL)
            });
            e.addEventListener("change", g => {
                clearTimeout(this.bgColorTimer);
                this.setBackground(g.target.value)
            });
            d = document.createElement("div");
            d.className = "bg-color_ btn_";
            d.title = this.l.BG_COLOR_BTN_TTL;
            d.appendChild(e);
            d.addEventListener("click", g => {
                e.showPicker()
            });
            c.appendChild(d);
            const f = document.createElement("input");
            f.type = "file";
            f.accept = [...GPAvatarEditor_.IMAGE_TYPES].join();
            f.addEventListener("change", this.handleFile);
            d = document.createElement("div");
            d.className = "open-image_ btn_";
            d.title = this.l.OPEN_IMAGE_BTN_TTL;
            d.addEventListener("click",
                g => {
                    f.click()
                });
            c.appendChild(d);
            this.container.appendChild(c);
            this.dragFileHint = document.createElement("div");
            this.dragFileHint.className = "drag-file-hint_";
            this.dragFileHint.textContent = this.l.DRAG_FILE_HINT;
            this.dragFileHint.addEventListener("click", g => {
                f.click()
            });
            this.container.appendChild(this.dragFileHint)
        }
        buildAvatar() {
            const a = GPAvatarEditor_.AVATAR_SMOOTH_DENSITY;
            var b = GPAvatarEditor_.AVATAR_WIDTH * GPAvatarEditor_.AVATAR_DENSITY * a,
                c = GPAvatarEditor_.AVATAR_HEIGHT * GPAvatarEditor_.AVATAR_DENSITY *
                a;
            const d = b / 2,
                e = document.createElement("canvas");
            e.width = b;
            e.height = c;
            var f = e.getContext("2d");
            f.beginPath();
            f.arc(d, c - d, d, 0, 2 * Math.PI);
            f.fill();
            this.hasForeground && f.fillRect(0, 0, b, c - b / 2);
            f = document.createElement("canvas");
            f.width = b;
            f.height = c;
            const g = f.getContext("2d");
            g.fillStyle = this.backgroundColor;
            g.beginPath();
            g.arc(d, c - d, d, 0, 2 * Math.PI);
            g.fill();
            g.drawImage(this.source, (GPAvatarEditor_.VIEWFINDER_WIDTH - b / a) / 2, (GPAvatarEditor_.VIEWFINDER_HEIGHT - (c / a * 2 - b / a)) / 2, b / a, c / a, 0, 0, b, c);
            g.globalCompositeOperation =
                "destination-in";
            g.drawImage(e, 0, 0);
            b = document.createElement("canvas");
            b.width = f.width / a + 2 * GPAvatarEditor_.AVATAR_PADDING * GPAvatarEditor_.AVATAR_DENSITY;
            b.height = f.height / a;
            c = b.getContext("2d");
            c.imageSmoothingEnabled = this.imageSmoothingEnabled;
            c.imageSmoothingQuality = "high";
            c.drawImage(f, GPAvatarEditor_.AVATAR_PADDING * GPAvatarEditor_.AVATAR_DENSITY, 0, f.width / a, f.height / a);
            return b
        }
        saveCanvas(a) {
            const b = document.createElement("canvas");
            b.width = a.width;
            b.height = a.height;
            b.getContext("2d").drawImage(a,
                0, 0, a.width, a.height);
            a = document.createElement("a");
            a.href = b.toDataURL(GPAvatarEditor_.AVATAR_TYPE, GPAvatarEditor_.AVATAR_QUALITY);
            a.download = `gp-avatar.${GPAvatarEditor_.AVATAR_TYPE.split("/")[1]}`;
            a.click()
        }
        onZoomerChange(a) {
            if ("change" === a.type || 0 === a.button)
                if (this.livePreviewEnabled || "pointerup" === a.type || "wheel" === a.type) {
                    this.updateAvatarViews();
                    let b;
                    switch (a.type) {
                        case "pointerup":
                            b = GPAvatarEditor_.CHANGE.POSITION;
                            break;
                        case "wheel":
                            b = GPAvatarEditor_.CHANGE.SCALE
                    }
                    b && this.dispatchChange(b)
                }
        }
        onZoomerReset(a) {
            this.dispatchChange(GPAvatarEditor_.CHANGE.RESET)
        }
        updateAvatarViews() {
            this.updateViewfinderFocus();
            this.updatePreview()
        }
        updatePreview() {
            this.previewCanvas = this.buildAvatar();
            const a = this.previewCanvas.toDataURL(GPAvatarEditor_.AVATAR_TYPE, GPAvatarEditor_.AVATAR_QUALITY);
            this.previewAvatar.style.backgroundImage = `url(${a})`
        }
        updateViewfinderFocus() {
            this.focusFrame.classList.add("rendered_");
            this.focusCtx.save();
            const a = GPAvatarEditor_.AVATAR_WIDTH * GPAvatarEditor_.AVATAR_DENSITY * 2,
                b = GPAvatarEditor_.AVATAR_HEIGHT * GPAvatarEditor_.AVATAR_DENSITY * 2,
                c = a / 2,
                d = document.createElement("canvas");
            d.width = a;
            d.height =
                b;
            const e = d.getContext("2d");
            e.beginPath();
            e.arc(c, b - c, c, 0, 2 * Math.PI);
            e.fill();
            this.hasForeground && e.fillRect(0, 0, a, b - a / 2);
            this.focusCtx.clearRect(0, 0, a, b);
            this.focusCtx.fillStyle = this.backgroundColor;
            this.focusCtx.beginPath();
            this.focusCtx.arc(c, b - c, c, 0, 2 * Math.PI);
            this.focusCtx.fill();
            this.focusCtx.drawImage(this.source, (GPAvatarEditor_.VIEWFINDER_WIDTH - a / 2) / 2, (GPAvatarEditor_.VIEWFINDER_HEIGHT - (b / 2 * 2 - a / 2)) / 2, a / 2, b / 2, 0, 0, a, b);
            this.focusCtx.globalCompositeOperation = "destination-in";
            this.focusCtx.drawImage(d,
                0, 0);
            this.focusCtx.restore()
        }
        clearViewfinderFocus() {
            this.focusCtx.clearRect(0, 0, this.focus.width, this.focus.height)
        }
        setSource(a) {
            const b = new Image;
            b.src = a;
            b.decode().then(() => {
                this.zoomer.setImage(b);
                this.updateAvatarViews();
                this.isChanged || (this.dragFileHint.classList.add("hidden"), this.isChanged = !0);
                this.dispatchChange(GPAvatarEditor_.CHANGE.LOADED)
            })
        }
        async imageCantHaveAlphaChannel(a) {
            return GPAvatarEditor_.IMAGE_TYPES_WITHOUT_TRANSPARENCY.includes(a.type) ? !0 : !1
        }
        pngHasAlpha(a) {
            a = new DataView(a);
            if (2303741511 === a.getUint32(0) && 218765834 === a.getUint32(4)) return a = a.getUint8(25), 4 === a || 6 === a
        }
        async handleFile(a) {
            a.preventDefault();
            a = a.target.files || a.dataTransfer.files;
            if (a?.length && (a = Array.from(a).find(b => GPAvatarEditor_.IMAGE_TYPES.has(b.type)))) {
                const b = await this.imageCantHaveAlphaChannel(a);
                b && this.setForegroundState(!1);
                this.changeFgModeBtnState(b);
                const c = new FileReader;
                c.addEventListener("loadend", d => {
                    this.setSource(c.result)
                });
                c.readAsDataURL(a)
            }
        }
        dispatchChange(a) {
            this.isChanged &&
                this.dispatchEvent(new CustomEvent("change", {
                    detail: {
                        type: a
                    }
                }))
        }
        setLivePreview(a) {
            this.livePreviewEnabled = !!a
        }
        setBackground(a, b = !0) {
            this.backgroundColor = a;
            this.isDragging || (this.updateAvatarViews(), b && this.dispatchChange(GPAvatarEditor_.CHANGE.BACKGROUND));
            this.dispatchEvent(new CustomEvent("background-color-changed", {
                detail: {
                    backgroundColor: a
                }
            }))
        }
        setForegroundState(a) {
            a !== this.hasForeground && (this.hasForeground = a, this.container.classList.toggle("has-foreground_", this.hasForeground), this.updateAvatarViews(),
                this.dispatchChange(GPAvatarEditor_.CHANGE.FOREGROUND), this.dispatchEvent(new CustomEvent("foreground-mode-changed", {
                    detail: {
                        foregroundMode: a
                    }
                })))
        }
        setOpaqueBackgroundState(a) {
            this.container.classList.toggle("has-opaque-background_", a);
            this.dispatchEvent(new CustomEvent("opaque-bg-blocker-update_", {
                detail: {
                    state: a
                }
            }))
        }
        hasOpaqueBackground() {
            var a = this.previewCanvas.getContext("2d");
            const b = a.getImageData(0, 0, a.canvas.width, a.canvas.height).data,
                c = GPAvatarEditor_.AVATAR_PADDING * GPAvatarEditor_.AVATAR_DENSITY;
            a = a.canvas.width - 2 * c;
            for (let d = 4 * c; d < 4 * (a + c); d += 8)
                if (255 !== b[d + 3]) return !1;
            return !0
        }
        setZoomSensitivity(a) {
            this.zoomSensitivity = a;
            this.zoomer.setScaleFactor(a)
        }
        setImageSmoothing(a) {
            this.imageSmoothingEnabled = !!a;
            this.focusCtx.imageSmoothingEnabled = !!a;
            this.updateAvatarViews();
            this.dispatchChange(GPAvatarEditor_.CHANGE.SMOOTHING)
        }
        toggleForegroundMode() {
            this.setForegroundState(!this.hasForeground)
        }
        changeFgModeBtnState(a) {
            this.fgModeBtn.classList.toggle("disabled_", !!a)
        }
        mirror() {
            this.zoomer.mirror();
            this.updateAvatarViews();
            this.dispatchChange(GPAvatarEditor_.CHANGE.MIRROR)
        }
        requestAvatar() {
            return this.isChanged ? new Promise(a => {
                this.previewCanvas.toBlob(a, GPAvatarEditor_.AVATAR_TYPE, GPAvatarEditor_.AVATAR_QUALITY)
            }) : Promise.reject()
        }
        getPreviewCanvas() {
            return this.previewCanvas
        }
    }
    window.GPAvatarEditor_ = GPAvatarEditor_;
    class GPAvatars_ extends EventTarget {
        static URL = "https://gpmod.github.io/avatars/{service}/{filename}";
        static NOTICE_COLORS = {
            REVIEW: 11726246,
            REMOVAL: 12467260
        };
        static REQUEST_TYPE = {
            REVIEW: "review",
            REMOVAL: "removal"
        };
        static DEFAULT_SETTINGS = {
            zoomSensitivity: 1.03,
            livePreview: !0,
            imageSmoothing: !0,
            hasForeground: !1,
            backgroundColor: "#cb55e2"
        };
        static SETTINGS_UI = {
            editor: {
                type: "component",
                getElement: this.getEditor
            },
            reviewButtons: {
                type: "buttons",
                getButtons: this.getButtons
            },
            _: {
                size: "small"
            },
            livePreview: {
                type: "switch",
                description: "\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044e \u043f\u0440\u0435\u0432\u044c\u044e \u0430\u0432\u0430\u0442\u0430\u0440\u0430 \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (\u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u0438 \u043f\u043e\u0437\u0438\u0446\u0438\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0430\u0432\u0430\u0442\u0430\u0440\u0430 \u0432 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0435)"
            },
            zoomSensitivity: {
                type: "slider",
                args: {
                    min: 1.01,
                    max: 1.1,
                    step: .01
                },
                formatter: this.zoomSensitivityFormatter,
                description: "\u0427\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0430\u0432\u0430\u0442\u0430\u0440\u0430 \u0432 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0435"
            },
            imageSmoothing: {
                type: "switch",
                description: "\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u0441\u0433\u043b\u0430\u0436\u0438\u0432\u0430\u043d\u0438\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f"
            }
        };
        static zoomSensitivityFormatter(a) {
            return Math.trunc(100 *
                (a - 1))
        }
        static getEditor() {
            return GPAvatars_.instance.getEditor()
        }
        static getButtons() {
            return [GPAvatars_.instance.reviewBtn, GPAvatars_.instance.removalBtn]
        }
        static MODULE = {
            title: "Avatars",
            alias: "av",
            dependencies: ["GPAvatarEditor_"],
            settings: {
                storage: "gp_avatars",
                defaultSettings: this.DEFAULT_SETTINGS,
                ui: this.SETTINGS_UI
            },
            useCSS: !0
        };
        constructor(a, b) {
            if (GPAvatars_.instance) return GPAvatars_.instance;
            super();
            GPAvatars_.instance = this;
            this.gpproxy = a.gpproxy;
            this.act = a.act;
            this.l = b;
            this.s = a.sm.setSettings(this,
                this.updateSettings);
            this.avatarStates = new Map;
            this.pendingStates = new Set;
            this.isSubscribed = !1;
            this.handlePlayer = this.handlePlayer.bind(this);
            this.handleAlbumItem = this.handleAlbumItem.bind(this);
            this.sendToReview = this.sendToReview.bind(this);
            this.submitRemovalRequest = this.submitRemovalRequest.bind(this);
            this.reviewBtn = document.createElement("div");
            this.reviewBtn.className = "av-review-btn_";
            this.reviewBtn.classList.add("disabled_");
            this.reviewBtn.classList.toggle("inactivated_", !this.isSubscribed);
            this.reviewBtn.title = this.l.REVIEW_BTN_TTL;
            this.reviewBtn.textContent = this.l.REVIEW_BTN_LBL;
            this.reviewBtn.addEventListener("click", this.sendToReview);
            this.reviewBtn.addEventListener("animationend", () => {
                this.reviewBtn.classList.remove("complete_")
            });
            this.removalBtn = document.createElement("div");
            this.removalBtn.className = "av-removal-btn_";
            this.removalBtn.classList.toggle("inactivated_", !this.isSubscribed);
            this.removalBtn.title = this.l.REMOVAL_BTN_TTL;
            this.removalBtn.textContent = this.l.REMOVAL_BTN_LBL;
            this.removalBtn.addEventListener("click", this.submitRemovalRequest);
            this.removalBtn.addEventListener("animationend", () => {
                this.removalBtn.classList.remove("complete_")
            });
            this.gpproxy.isAuthorized && (this.url = GPAvatars_.URL.replace("{service}", this.gpproxy.getAuthType()?.[0]), b = this.gpproxy.getUsername(), this.requestAvatarURL(b, () => {
                this.removalBtn.classList.remove("disabled_")
            }));
            a = new GPContentObserver_(a.gpproxy);
            this.gpproxy.isAuthorized && (a.addPlayerListHandler(this.handlePlayer.bind(this)), a.addAlbumItemsHandler(this.handleAlbumItem.bind(this)),
                a.addAlbumRankingHandler(this.handlePlayer.bind(this)), a.getPlayerItems().forEach(c => {
                    this.handlePlayer(c)
                }));
            this.editor = new GPAvatarEditor_(this.s.livePreview, this.s.zoomSensitivity, this.s.imageSmoothing, this.s.hasForeground, this.s.backgroundColor, this.l);
            this.editor.addEventListener("foreground-mode-changed", ({
                detail: {
                    foregroundMode: c
                }
            }) => {
                this.s.hasForeground = c
            });
            this.editor.addEventListener("background-color-changed", ({
                detail: {
                    backgroundColor: c
                }
            }) => {
                this.s.backgroundColor = c
            });
            this.editor.addEventListener("change",
                ({}) => {
                    this.reviewBtn.classList.remove("disabled_")
                });
            this.editor.addEventListener("opaque-bg-blocker-update_", ({
                detail: {
                    state: c
                }
            }) => {
                this.reviewBtn.classList.toggle("opaque-bg-blocker_", c)
            });
            document.addEventListener("_av_complete", ({
                detail: {
                    type: c
                }
            }) => {
                c === GPAvatars_.REQUEST_TYPE.REVIEW && this.removalBtn.classList.remove("disabled_")
            }, {
                once: !0
            });
            document.addEventListener("_av_complete", ({
                detail: {
                    type: c
                }
            }) => {
                c === GPAvatars_.REQUEST_TYPE.REVIEW ? (this.reviewBtn.classList.add("complete_"), this.removalBtn.classList.remove("disabled_")) :
                    (this.removalBtn.classList.add("complete_"), this.editor.isChanged && this.reviewBtn.classList.remove("disabled_"))
            });
            document.addEventListener("_av_error", ({
                detail: {
                    type: c
                }
            }) => {
                c === GPAvatars_.REQUEST_TYPE.REVIEW ? this.reviewBtn.classList.remove("disabled_") : this.removalBtn.classList.remove("disabled_")
            });
            document.addEventListener("_subs_status", ({
                detail: {
                    status: c
                }
            }) => {
                this.isSubscribed = c;
                this.reviewBtn.classList.toggle("inactivated_", !c);
                this.removalBtn.classList.toggle("inactivated_", !c);
                GPAvatars_.toggleSettingsVisibility(c)
            })
        }
        sendToReview() {
            this.editor.isChanged &&
                this.editor.requestAvatar().then(a => {
                    this.sendRequest(GPAvatars_.REQUEST_TYPE.REVIEW, a);
                    this.reviewBtn.classList.add("disabled_")
                })
        }
        submitRemovalRequest() {
            this.sendRequest(GPAvatars_.REQUEST_TYPE.REMOVAL);
            this.removalBtn.classList.add("disabled_")
        }
        sendRequest(a, b) {
            if (this.isSubscribed) {
                var {
                    authId: c,
                    nick: d
                } = this.gpproxy.getUser(), e = this.gpproxy.getAuthType(), f = this.act.getKeyHash(), g = this.usernameHash(this.gpproxy.formatNickname(d));
                switch (a) {
                    case GPAvatars_.REQUEST_TYPE.REVIEW:
                        a = new File([b], `${g}.${b.type.split("/")[1]}`);
                        document.dispatchEvent(new CustomEvent("_av_review", {
                            detail: {
                                sender: d,
                                senderId: c,
                                service: e,
                                keyHash: f,
                                imageFile: a,
                                filename: g,
                                noticeColor: GPAvatars_.NOTICE_COLORS.REVIEW
                            }
                        }));
                        break;
                    case GPAvatars_.REQUEST_TYPE.REMOVAL:
                        document.dispatchEvent(new CustomEvent("_av_removal", {
                            detail: {
                                sender: d,
                                senderId: c,
                                service: e,
                                keyHash: f,
                                filename: g,
                                noticeColor: GPAvatars_.NOTICE_COLORS.REMOVAL
                            }
                        }))
                }
            }
        }
        getEditor() {
            return this.editor.getElement()
        }
        handlePlayer(a) {
            const b = a.querySelector(".avatar > span");
            a = a.querySelector(".nick")?.textContent;
            a = this.gpproxy.formatNickname(a);
            this.insertAvatar(a, b)
        }
        handleAlbumItem(a) {
            const b = a.querySelector(".avatar > span");
            a = a.querySelector(":scope > div > :not(.avatar) > span")?.textContent;
            a = this.gpproxy.formatNickname(a);
            this.insertAvatar(a, b)
        }
        insertAvatar(a, b) {
            this.requestAvatarURL(a, c => {
                b.style.backgroundImage = `url(${c})`
            })
        }
        requestAvatarURL(a, b) {
            if (this.pendingStates.has(a)) {
                const c = ({
                    detail: {
                        username: d,
                        url: e,
                        isExists: f
                    }
                }) => {
                    d === a && (f && b(e), this.removeEventListener("state-changed", c))
                };
                this.addEventListener("state-changed",
                    c)
            } else {
                const c = this.buildURL(a),
                    d = this.avatarStates.get(a);
                d ? b(c) : void 0 === d && (this.pendingStates.add(a), fetch(c, {
                    method: "HEAD"
                }).then(e => {
                    e.ok ? (b(c), this.avatarStates.set(a, !0)) : this.avatarStates.set(a, !1)
                }).finally(() => {
                    this.pendingStates.delete(a);
                    this.dispatchEvent(new CustomEvent("state-changed", {
                        detail: {
                            username: a,
                            url: c,
                            isExists: this.avatarStates.get(a)
                        }
                    }))
                }))
            }
        }
        buildURL(a) {
            a = this.usernameHash(a);
            return this.url.replace("{filename}", a)
        }
        usernameHash(a) {
            return GPUtils_.computeHash(a, 16).toString(36)
        }
        updateSettings({
            detail: {
                settings: a
            }
        }) {
            "livePreview" in
            a && this.editor.setLivePreview(a.livePreview);
            "zoomSensitivity" in a && this.editor.setZoomSensitivity(a.zoomSensitivity);
            "imageSmoothing" in a && this.editor.setImageSmoothing(a.imageSmoothing)
        }
    }
    window.GPAvatars_ = GPAvatars_;
    class GPCanvasZoomer_ extends EventTarget {
        static SCALE_FACTOR = 1.05;
        constructor(a, b, c) {
            super();
            this.scaleFactor = c ?? GPCanvasZoomer_.SCALE_FACTOR;
            this.canvas = a;
            this.canvas.addEventListener("contextmenu", d => {
                d.preventDefault()
            });
            this.canvas.addEventListener("pointerdown", d => {
                d.preventDefault();
                0 !== d.button || d.ctrlKey ? 2 === d.button && this.reset() : (this.canvas.setPointerCapture(d.pointerId), this.lastX = d.offsetX, this.lastY = d.offsetY, this.dragStartPoint = this.ctx.transformedPoint(this.lastX, this.lastY))
            });
            this.canvas.addEventListener("pointermove",
                d => {
                    this.lastX = d.offsetX;
                    this.lastY = d.offsetY;
                    this.dragStartPoint && (d = this.ctx.transformedPoint(this.lastX, this.lastY), this.ctx.translate(d.x - this.dragStartPoint.x, d.y - this.dragStartPoint.y), this.redraw())
                });
            this.canvas.addEventListener("pointerup", d => {
                this.dragStartPoint = null
            });
            this.canvas.addEventListener("wheel", d => {
                this.zoom(-d.deltaY / 40);
                d.preventDefault()
            });
            this.ctx = a.getContext("2d");
            this.ctx.imageSmoothingQuality = "high";
            this.trackTransforms(this.ctx);
            this.image = b;
            this.lastX = a.width / 2;
            this.lastY =
                a.height / 2;
            this.dragStartPoint;
            this.mirror = this.mirror.bind(this)
        }
        reset() {
            this.ctx.resetTransform();
            this.redraw();
            this.dispatchEvent(new Event("reset"))
        }
        redraw() {
            if (this.image) {
                var a = this.ctx.transformedPoint(0, 0),
                    b = this.ctx.transformedPoint(this.canvas.width, this.canvas.height);
                this.ctx.clearRect(a.x, a.y, b.x - a.x, b.y - a.y);
                this.ctx.drawImage(this.image, -(this.image.width - this.canvas.width) / 2, -(this.image.height - this.canvas.height) / 2);
                this.dispatchEvent(new Event("change"))
            }
        }
        zoom(a) {
            const b = this.ctx.transformedPoint(this.lastX,
                this.lastY);
            this.ctx.translate(b.x, b.y);
            a = Math.pow(this.scaleFactor, a);
            this.ctx.scale(a, a);
            this.ctx.translate(-b.x, -b.y);
            this.redraw()
        }
        setTransform(a, b, c, d, e, f) {
            this.ctx.setTransform(a, b, c, d, e, f);
            this.redraw()
        }
        trackTransforms(a) {
            const b = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            let c = b.createSVGMatrix();
            a.getTransform = function() {
                return c
            };
            const d = [],
                e = a.save;
            a.save = function() {
                d.push(c.translate(0, 0));
                return e.call(a)
            };
            const f = a.restore;
            a.restore = function() {
                c = d.pop();
                return f.call(a)
            };
            const g = a.scale;
            a.scale = function(q, p) {
                c = c.scaleNonUniform(q, p);
                return g.call(a, q, p)
            };
            const h = a.rotate;
            a.rotate = function(q) {
                c = c.rotate(180 * q / Math.PI);
                return h.call(a, q)
            };
            const k = a.translate;
            a.translate = function(q, p) {
                c = c.translate(q, p);
                return k.call(a, q, p)
            };
            const l = a.transform;
            a.transform = function(q, p, t, v, w, u) {
                const y = b.createSVGMatrix();
                y.a = q;
                y.b = p;
                y.c = t;
                y.d = v;
                y.e = w;
                y.f = u;
                c = c.multiply(y);
                return l.call(a, q, p, t, v, w, u)
            };
            const m = a.setTransform;
            a.setTransform = function(q, p, t, v, w, u) {
                c.a = q;
                c.b = p;
                c.c = t;
                c.d =
                    v;
                c.e = w;
                c.f = u;
                return m.call(a, q, p, t, v, w, u)
            };
            const n = a.resetTransform;
            a.resetTransform = function() {
                c = b.createSVGMatrix();
                d.length = 0;
                return n.call(a)
            };
            const r = b.createSVGPoint();
            a.transformedPoint = function(q, p) {
                r.x = q;
                r.y = p;
                return r.matrixTransform(c.inverse())
            }
        }
        setImage(a) {
            this.image = a;
            this.reset()
        }
        setScaleFactor(a) {
            this.scaleFactor = a
        }
        mirror() {
            this.image && (this.ctx.translate(this.canvas.width, 0), this.ctx.scale(-1, 1), this.ctx.drawImage(this.image, 0, 0), this.redraw())
        }
    };
    class GPAlbumObserver_ {
        static MONITOR_INTERVAL = 200;
        static ITEM_TYPE = {
            IMAGE: "image",
            TEXT: "text",
            ANIMATION: "animation",
            MULTI_PIECE: "multi-piece",
            AI_IMAGE: "ai-image"
        };
        constructor(a) {
            if (GPAlbumObserver_.instance) return GPAlbumObserver_.instance;
            GPAlbumObserver_.instance = this;
            this.gpproxy = a;
            this.isInitialized = !1;
            this.monitorTimer;
            this.inObserving = !1;
            this.nextItemId = null;
            this.items = [];
            this.endTitle = this.title = null;
            this.observerConfig = {
                childList: !0,
                subtree: !0
            };
            this.observer = new MutationObserver(this.observerCallback.bind(this));
            this.titleObserverConfig = {
                characterData: !0,
                subtree: !0
            };
            this.titleObserver = new MutationObserver(this.titleObserverCallback.bind(this));
            this.handlers = new Set;
            this.endHandlers = new Set;
            this.titleHandlers = new Set
        }
        init() {
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: a
                }
            }) => {
                if (this.gpproxy.isAuthorized || this.gpproxy.isTwitchOAuth) a === GPProxy_.EVENT.ALBUM_INFO ? this.terminate() : a === GPProxy_.EVENT.GALLERY_SETTINGS ? this.startMonitor() : [GPProxy_.EVENT.NEW_GAME, GPProxy_.EVENT.ALBUM_SCORE, GPProxy_.EVENT.GAME_QUIT,
                    GPProxy_.EVENT.GAME_STARTED
                ].includes(a) && (this.stopMonitor(), this.terminate())
            });
            this.gpproxy.addEventListener("rejoin", ({
                detail: {
                    stage: a
                }
            }) => {
                a === GPProxy_.STAGE.ALBUM && ((this.gpproxy.isAuthorized || this.gpproxy.isTwitchOAuth) && this.startMonitor(), this.gpproxy.isTwitchAuth() && (this.title = document.querySelector(".scrapbook > h4"), this.endTitle = document.querySelector(".scrapbook .end > p")))
            });
            this.gpproxy.addEventListener("album_item_loading", ({
                detail: {
                    id: a
                }
            }) => {
                this.nextItemId = a
            });
            this.isInitialized = !0
        }
        terminate() {
            this.nextItemId = null;
            this.items.length = 0;
            this.endTitle = this.title = null
        }
        addHandler(a) {
            this.handlers.add(a);
            this.isInitialized || this.init()
        }
        removeHandler(a) {
            this.handlers.remove(a)
        }
        getItems() {
            return this.items
        }
        addTitleHandler(a) {
            this.titleHandlers.add(a)
        }
        removeTitleHandler(a) {
            this.titleHandlers.remove(a)
        }
        getTitle() {
            return this.title
        }
        startMonitor() {
            if (!this.inObserving) {
                var a = document.querySelector(".scrapbook");
                if (a) {
                    const b = a.querySelector(":scope > h4");
                    this.observer.observe(a, this.observerConfig);
                    this.titleObserver.observe(b, this.titleObserverConfig);
                    this.inObserving = !0
                } else this.monitorTimer = setTimeout(() => {
                    this.startMonitor()
                }, GPAlbumObserver_.MONITOR_INTERVAL)
            }
        }
        stopMonitor() {
            clearTimeout(this.monitorTimer);
            this.inObserving && (this.observer.disconnect(), this.titleObserver.disconnect(), this.inObserving = !1)
        }
        titleObserverCallback(a, b) {
            this.title = a[0].target.parentElement;
            this.titleHandlers.forEach(c => c(this.title))
        }
        observerCallback(a, b) {
            for (const c of a)
                if ("childList" === c.type && c.addedNodes.length &&
                    c.target.classList.contains("scrollElements") && c.addedNodes[0].classList.contains("item")) {
                    const d = c.addedNodes[0];
                    this.items.push(d);
                    a = this.nextItemId ?? [...d.parentElement.children].filter(e => e.classList.contains("item")).indexOf(d);
                    b = null;
                    d.querySelector(":scope > .drawing") ? b = GPAlbumObserver_.ITEM_TYPE.IMAGE : d.querySelector(":scope > .answer") ? b = GPAlbumObserver_.ITEM_TYPE.TEXT : d.querySelector(":scope > section > .animationmode") ? b = GPAlbumObserver_.ITEM_TYPE.ANIMATION : d.querySelector(":scope > section > .loopmode") ?
                        b = GPAlbumObserver_.ITEM_TYPE.MULTI_PIECE : d.querySelector(":scope > .img") && (b = GPAlbumObserver_.ITEM_TYPE.AI_IMAGE);
                    d.dataset.id = a;
                    d.dataset.type = b;
                    this.handlers.forEach(e => e(d))
                }
        }
    }
    window.GPAlbumObserver_ = GPAlbumObserver_;
    class GPScreenObserver_ extends EventTarget {
        constructor() {
            if (GPScreenObserver_.instance) return GPScreenObserver_.instance;
            super();
            GPScreenObserver_.instance = this;
            this.currentScreen = null;
            this.areModulesLoaded = !1;
            document.addEventListener("_modules-loaded", () => {
                this.areModulesLoaded = !0;
                this.currentScreen && this.dispatchEvent(new CustomEvent("screen-changed", {
                    detail: {
                        screen: this.currentScreen
                    }
                }))
            });
            this.init()
        }
        init() {
            (new MutationObserver((a, b) => {
                for (const c of a)
                    if (a = c.addedNodes?.[0], a?.classList.contains("screen")) {
                        a = [...a.firstElementChild.classList].find(d => !d.startsWith("jsx-"));
                        if (!a) break;
                        a !== this.currentScreen && (this.currentScreen = a, this.areModulesLoaded && this.dispatchEvent(new CustomEvent("screen-changed", {
                            detail: {
                                screen: a
                            }
                        })))
                    }
            })).observe(document.getElementById("content"), {
                childList: !0
            })
        }
        getCurrentScreen() {
            return this.currentScreen
        }
    }
    class GPStaticObserver_ {
        static MONITOR_INTERVAL = 200;
        static MAX_ATTEMPTS = 5;
        static handlers = new Map;
        static {
            this.isInitialized = !1, this.timer = null, this.handlers = new Map
        }
        static init() {
            this.so = new GPScreenObserver_;
            this.so.addEventListener("screen", this.onScreenChange.bind(this));
            this.isInitialized = !0
        }
        static addHandler(a, b, c) {
            a = [a].flat();
            a.forEach(d => {
                const e = this.handlers.get(d) ?? [];
                e.push([b, c]);
                this.handlers.set(d, e)
            });
            a.find(d => d === this.so.getCurrentScreen()) && this.startMonitor([
                [b, c]
            ])
        }
        static removeHandler(a,
            b, c) {
            a = [a].flat();
            a.forEach(d => {
                const e = this.handlers.get(d);
                if (e) {
                    var f = e.findIndex(([g, h]) => g === b && h === c);
                    ~f && (e.splice(f, 1), e.length || this.handlers.delete(d))
                }
            })
        }
        static onScreenChange({
            detail: {
                screen: a
            }
        }) {
            (a = this.handlers.get(a)) ? this.startMonitor([...a]): this.stopMonitor()
        }
        static startMonitor(a, b = 1) {
            this.stopMonitor();
            a = a.filter(([c, d]) => {
                (c = document.querySelector(c)) && d(c);
                return !c
            });
            a.length && b < this.MAX_ATTEMPTS && (this.timer = setTimeout(() => {
                this.startMonitor(a, b + 1)
            }, this.MONITOR_INTERVAL))
        }
        static stopMonitor() {
            clearTimeout(this.timer)
        }
        static SCREEN = {
            START: "start",
            LOBBY: "lobby",
            FIRST: "first",
            DRAW: "draw",
            WRITE: "write",
            REPLY: "reply",
            MEMORY: "memory",
            BOOK: "book",
            RESULT: "result"
        };
        static PRESET = {
            PAINTER_HEADER: [
                [this.SCREEN.DRAW], ".screen > .draw .header"
            ],
            PREVIEW: [
                [this.SCREEN.WRITE, this.SCREEN.MEMORY], ".screen > :is(.write, .memory) .core > div"
            ]
        };
        constructor() {
            GPStaticObserver_.isInitialized || GPStaticObserver_.init()
        }
        addHandler(a, b, c) {
            GPStaticObserver_.addHandler(a, b, c)
        }
        removeHandler(a, b, c) {
            GPStaticObserver_.removeHandler(a, b, c)
        }
    }
    class GPContentObserver_ {
        static SCREEN = {
            START: "start",
            LOBBY: "lobby",
            FIRST: "first",
            DRAW: "draw",
            WRITE: "write",
            REPLY: "reply",
            MEMORY: "memory",
            BOOK: "book",
            RESULT: "result"
        };
        static STAGE_ID = {
            LOBBY: 1,
            GAME: 2,
            GALLERY_SETTINGS: 5,
            ALBUM: 3,
            SCORE: 4
        };
        static ALBUM_ITEM_TYPE = {
            IMAGE: "image",
            TEXT: "text",
            ANIMATION: "animation",
            MULTI_PIECE: "multi-piece",
            AI_IMAGE: "ai-image"
        };
        constructor(a) {
            if (GPContentObserver_.instance) return GPContentObserver_.instance;
            GPContentObserver_.instance = this;
            this.gpproxy = a;
            this.playerListHandlers =
                new Set;
            this.painterHeaderHandlers = new Set;
            this.drawingPreviewHandlers = new Set;
            this.rankingUsersHandlers = new Set;
            this.albumHeaderHandlers = new Set;
            this.albumItemsHandlers = new Set;
            this.albumFooterHandlers = new Set;
            this.players = new Map;
            this.albumHeader = this.drawingPreview = this.painterHeader = null;
            this.albumItems = [];
            this.albumFooter = null;
            this.rankingUsers = [];
            this.nextAlbumItemId = null;
            this.so = new GPScreenObserver_;
            this.so.addEventListener("screen-changed", ({
                detail: {
                    screen: b
                }
            }) => {
                this.terminate();
                this.observe(b)
            });
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: b
                }
            }) => {
                b === GPProxy_.EVENT.ALBUM_INFO && (this.albumItems.length = 0, this.nextAlbumItemId = null)
            });
            this.gpproxy.addEventListener("album_item_loading", ({
                detail: {
                    id: b
                }
            }) => {
                this.nextAlbumItemId = b
            });
            this.observers = {
                playerList: {
                    observer: new MutationObserver(this.playerListCallback.bind(this)),
                    config: {
                        childList: !0,
                        subtree: !0
                    },
                    selector: "#content > .screen .players",
                    handler: this.handlePlayerList.bind(this),
                    screens: [GPContentObserver_.SCREEN.LOBBY, GPContentObserver_.SCREEN.BOOK,
                        GPContentObserver_.SCREEN.RESULT
                    ],
                    stageIds: [GPContentObserver_.STAGE_ID.LOBBY, GPContentObserver_.STAGE_ID.ALBUM, GPContentObserver_.STAGE_ID.SCORE]
                },
                painterHeader: {
                    static: !0,
                    selector: "#content > .screen .draw .book > .header",
                    handler: this.handlePainterHeader.bind(this),
                    screens: [GPContentObserver_.SCREEN.DRAW],
                    stageIds: [GPContentObserver_.STAGE_ID.GAME]
                },
                drawingPreview: {
                    static: !0,
                    selector: "#content > .screen > :is(.write, .memory) .core > div",
                    handler: this.handleDrawingPreview.bind(this),
                    screens: [GPContentObserver_.SCREEN.WRITE,
                        GPContentObserver_.SCREEN.MEMORY
                    ],
                    stageIds: [GPContentObserver_.STAGE_ID.GAME]
                },
                album: {
                    observer: new MutationObserver(this.albumCallback.bind(this)),
                    config: {
                        childList: !0,
                        subtree: !0
                    },
                    selector: "#content > .screen .timeline",
                    handler: this.handleAlbum.bind(this),
                    screens: [GPContentObserver_.SCREEN.BOOK],
                    stageIds: [GPContentObserver_.STAGE_ID.ALBUM]
                },
                albumHeader: {
                    observer: new MutationObserver(this.albumHeaderCallback.bind(this)),
                    config: {
                        characterData: !0,
                        subtree: !0
                    },
                    selector: "#content > .screen .scrapbook > h4",
                    handler: this.handleAlbumHeader.bind(this),
                    screens: [GPContentObserver_.SCREEN.BOOK],
                    stageIds: [GPContentObserver_.STAGE_ID.ALBUM]
                },
                rankingUsers: {
                    static: !0,
                    selector: "#content > .screen .ranking",
                    handler: this.handleRankingUsers.bind(this),
                    screens: [GPContentObserver_.SCREEN.RESULT],
                    stageIds: [GPContentObserver_.STAGE_ID.SCORE]
                }
            }
        }
        observe(a) {
            Object.values(this.observers).forEach(b => {
                if (b.screens.includes(a)) {
                    const c = document.querySelector(b.selector);
                    b.observer && b.observer?.observe(c, b.config);
                    c && b.handler(c)
                }
            })
        }
        addPlayerListHandler(...a) {
            a.forEach(b => {
                this.playerListHandlers.add(b)
            })
        }
        addPainterHeaderHandler(...a) {
            a.forEach(b => {
                this.painterHeaderHandlers.add(b)
            })
        }
        addDrawingPreviewHandler(...a) {
            a.forEach(b => {
                this.drawingPreviewHandlers.add(b)
            })
        }
        addAlbumItemsHandler(...a) {
            a.forEach(b => {
                this.albumItemsHandlers.add(b)
            })
        }
        addAlbumHeaderHandler(...a) {
            a.forEach(b => {
                this.albumHeaderHandlers.add(b)
            })
        }
        addAlbumFooterHandler(...a) {
            a.forEach(b => {
                this.albumFooterHandlers.add(b)
            })
        }
        addAlbumRankingHandler(...a) {
            a.forEach(b => {
                this.rankingUsersHandlers.add(b)
            })
        }
        getPlayerItems() {
            return this.players
        }
        getPainterHeader() {
            return this.painterHeader
        }
        getDrawingPreview() {
            return this.drawingPreview
        }
        getAlbumHeader() {
            return this.albumHeader
        }
        getAlbumItems() {
            return this.albumItems
        }
        getAlbumFooter() {
            return this.albumFooter
        }
        getRankingUsers() {
            return this.rankingUsers
        }
        terminate() {
            this.players.clear();
            this.albumHeader = this.drawingPreview = this.painterHeader = null;
            this.albumItems.length = 0;
            this.albumFooter = null;
            this.rankingUsers.length = 0;
            this.nextAlbumItemId = null;
            this.disconnectObservers()
        }
        disconnectObservers() {
            Object.values(this.observers).forEach(a => {
                a.observer?.disconnect()
            })
        }
        playerListCallback(a, b) {
            for (const c of a)
                if ("childList" === c.type && c.addedNodes.length && c.target.classList.contains("scrollElements") && c.addedNodes[0].matches(".user:not(.empty)")) {
                    const d = c.addedNodes[0];
                    this.cachePlayer(d);
                    this.playerListHandlers.forEach(e => e(d))
                }
        }
        albumHeaderCallback(a, b) {
            for (const c of a)
                if ("characterData" === c.type) {
                    const d = a[0].target.parentElement;
                    this.albumHeader = d;
                    this.albumHeaderHandlers.forEach(e => e(d))
                }
        }
        albumCallback(a, b) {
            for (const c of a)
                if ("childList" === c.type && c.addedNodes.length && 1 === c.addedNodes[0].nodeType)
                    if (c.addedNodes[0].classList.contains("item")) {
                        const d = c.addedNodes[0];
                        this.injectAlbumItemMetadata(d);
                        this.albumItems.push(d);
                        this.albumItemsHandlers.forEach(e => e(d))
                    } else if (c.addedNodes[0].matches("section:has(> .end)")) {
                const d =
                    c.addedNodes[0].querySelector(":scope > .end > p");
                this.albumFooter = d;
                this.albumFooterHandlers.forEach(e => e(d))
            }
        }
        handlePlayerList(a) {
            a = a.querySelectorAll(".user:not(.empty)");
            Array.from(a).forEach(b => {
                this.cachePlayer(b);
                this.playerListHandlers.forEach(c => c(b))
            })
        }
        cachePlayer(a) {
            const b = a.querySelector(".nick")?.textContent;
            b && this.players.set(b, a)
        }
        handlePainterHeader(a) {
            this.painterHeader = a;
            this.painterHeaderHandlers.forEach(b => b(a))
        }
        handleDrawingPreview(a) {
            this.drawingPreview = a;
            this.drawingPreviewHandlers.forEach(b =>
                b(a))
        }
        handleAlbumHeader(a) {
            this.albumHeader = a;
            this.albumHeaderHandlers.forEach(b => b(a))
        }
        handleAlbum(a) {
            this.handleAlbumItems(a);
            this.handleAlbumFooter(a)
        }
        handleAlbumItems(a) {
            a = a.querySelectorAll(".item:has(> :is(.answerBalloon, .drawBalloon, .imgBalloon))");
            Array.from(a).forEach(b => {
                this.injectAlbumItemMetadata(b);
                this.albumItems.push(b);
                this.albumItemsHandlers.forEach(c => c(b))
            })
        }
        injectAlbumItemMetadata(a) {
            const b = this.nextAlbumItemId ?? [...a.parentElement.children].filter(d => d.classList.contains("item")).indexOf(a);
            let c = null;
            a.querySelector(":scope > .drawing") ? c = GPContentObserver_.ALBUM_ITEM_TYPE.IMAGE : a.querySelector(":scope > .answer") ? c = GPContentObserver_.ALBUM_ITEM_TYPE.TEXT : a.querySelector(":scope > section > .animationmode") ? c = GPContentObserver_.ALBUM_ITEM_TYPE.ANIMATION : a.querySelector(":scope > section > .loopmode") ? c = GPContentObserver_.ALBUM_ITEM_TYPE.MULTI_PIECE : a.querySelector(":scope > .img") && (c = GPContentObserver_.ALBUM_ITEM_TYPE.AI_IMAGE);
            a.dataset.id = b;
            a.dataset.type = c
        }
        handleAlbumFooter(a) {
            const b =
                a.querySelector("section > .end > p");
            b && (this.albumFooter = b, this.albumFooterHandlers.forEach(c => c(b)))
        }
        handleRankingUsers(a) {
            a = a.querySelectorAll(".user");
            Array.from(a).forEach(b => {
                this.rankingUsers.push(b);
                this.rankingUsersHandlers.forEach(c => c(b))
            })
        }
    }
    window.GPContentObserver_ = GPContentObserver_;
    class GPImageReportSender_ extends EventTarget {
        static ANTI_CHEAT = "ANTI_CHEAT";
        static BAN = "BAN";
        static EVENTS = {
            ANTI_CHEAT: "_ac_report",
            BAN: "_ban_report"
        };
        static COLORS = {
            ANTI_CHEAT: 5358253,
            BAN: 12467260
        };
        static ITEM_TYPE = {
            IMAGE: 1,
            TEXT: 2
        };
        constructor(a, b, c) {
            super();
            this.gpproxy = b;
            this.eventType = GPImageReportSender_.EVENTS[a];
            this.noticeColor = GPImageReportSender_.COLORS[a];
            this.keyHash = c.getKeyHash();
            this.twitchIdsCache = new Map;
            this.reportedItems = new Set;
            document.addEventListener("_tw_ids_usernames", ({
                detail: {
                    usernamesMap: d
                }
            }) => {
                this.updateTwitchIdsCache(d)
            });
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: d
                }
            }) => {
                d === GPProxy_.EVENT.GALLERY_SETTINGS && this.reportedItems.clear()
            })
        }
        async send({
            itemId: a,
            albumId: b,
            ...c
        }) {
            var d = `${b}_${a}`;
            if (!this.reportedItems.has(d)) {
                this.reportedItems.add(d);
                var e = this.gpproxy.getAlbumItem(a, b);
                if (e) {
                    var {
                        first: f,
                        turns: g,
                        animate: h,
                        keep: k
                    } = this.gpproxy.getGameConfig();
                    d = {
                        first: f,
                        turns: g,
                        animate: h,
                        keep: k
                    };
                    var {
                        authId: l,
                        nick: m
                    } = this.gpproxy.getUser(), {
                        meta: {
                            author: n,
                            title: r,
                            date: q
                        },
                        data: p,
                        type: t
                    } = e, v = (new Date(q)).toLocaleDateString("ru-RU"), w = t === GPImageReportSender_.ITEM_TYPE.IMAGE;
                    switch (t) {
                        case GPImageReportSender_.ITEM_TYPE.IMAGE:
                            var u = `${n} - ${r} (${v})`;
                            v = await GPUtils_.compressImageData(e);
                            u = new File([v], `${u}.gpimg`);
                            break;
                        case GPImageReportSender_.ITEM_TYPE.TEXT:
                            u = `${n} - ${p} (${v})`, v = new Blob([p], {
                                type: "text/plain"
                            }), u = new File([v], `${u}.txt`)
                    }
                    v = Object.keys(GPProxy_.AUTH_TYPE_IDS).find(z => GPProxy_.AUTH_TYPE_IDS[z] === e.auth);
                    var y = this.gpproxy.isTwitchAuth() ? this.twitchIdsCache.get(n.toLowerCase()) ??
                        null : null;
                    document.dispatchEvent(new CustomEvent(this.eventType, {
                        detail: {
                            noticeColor: this.noticeColor,
                            author: n,
                            authorId: y,
                            sender: m,
                            senderId: l,
                            itemData: e,
                            sourceFile: u,
                            service: v,
                            itemId: a,
                            albumId: b,
                            isImage: w,
                            gameCode: this.gpproxy.getGameCode(),
                            gameConfig: d,
                            keyHash: this.keyHash,
                            ...c
                        }
                    }))
                }
            }
        }
        updateTwitchIdsCache(a) {
            a.forEach((b, c) => {
                this.twitchIdsCache.set(b, c)
            })
        }
    }
    window.GPImageReportSender_ = GPImageReportSender_;
    class GPLocalization_ {
        static LANGUAGE = {
            RU: "ru",
            EN: "en",
            ES: "es"
        };
        static MISSING_STR = "N/A";
        static DEFAULT_DATA = {
            lang: "ru",
            entries: {}
        };
        constructor(a = GPLocalization_.DEFAULT_DATA) {
            this.lang = a.lang;
            this.entries = this.initEntries(a.entries)
        }
        get(a) {
            return this.entries[a]
        }
        getLang() {
            return this.lang
        }
        initEntries(a = {}) {
            return new Proxy(a, {
                get: (b, c) => new Proxy(b[c] ?? {}, {
                    get: (d, e) => "lang" === e ? this.lang : d[e] ?? GPLocalization_.MISSING_STR
                })
            })
        }
    };
    class GPUtils_ {
        static async compressImageData(a, b = !0) {
            const {
                data: c,
                background: d,
                auth: e,
                meta: f
            } = a;
            a = {
                m: {
                    a: f.author,
                    t: f.title,
                    d: (new Date(f.date)).toISOString()
                },
                d: c
            };
            d && (a.b = d);
            e && (a.a = e);
            return b ? this.wCompressData(a) : this.compressData(a)
        }
        static async compressData(a) {
            a = JSON.stringify(a);
            a = this.stringToArrayBuffer(a);
            a = await this.compressArrayBuffer(a);
            return this.arrayBufferToBlob(a)
        }
        static arrayBufferToBlob(a) {
            return new Blob([a], {
                type: "octet/stream"
            })
        }
        static async compressArrayBuffer(a) {
            var b =
                new CompressionStream("deflate"),
                c = b.writable.getWriter();
            c.write(a);
            c.close();
            a = [];
            b = b.readable.getReader();
            for (c = 0;;) {
                const {
                    value: d,
                    done: e
                } = await b.read();
                if (e) break;
                a.push(d);
                c += d.byteLength
            }
            b = new Uint8Array(c);
            c = 0;
            for (const d of a) b.set(d, c), c += d.byteLength;
            return b
        }
        static stringToArrayBuffer(a) {
            return (new TextEncoder).encode(a)
        }
        static async decompressFile(a) {
            return JSON.parse(await this.decompressBlob(a))
        }
        static async decompressBlob(a) {
            let b = new DecompressionStream("deflate");
            a = a.stream().pipeThrough(b);
            return await (new Response(a)).text()
        }
        static saveBlob(a, b = "") {
            a = window.URL.createObjectURL(a);
            const c = document.createElement("a");
            c.href = a;
            c.download = b;
            c.click();
            window.URL.revokeObjectURL(a)
        }
        static wCompressData(a) {
            return new Promise(b => {
                const c = this.createWorker(this.compressWorkerBody);
                c.addEventListener("message", ({
                    data: d
                }) => {
                    c.terminate();
                    b(d)
                });
                c.postMessage(a)
            })
        }
        static compressWorkerBody() {
            self.work = new async function() {}.constructor("a", 'a=JSON.stringify(a);a=(new TextEncoder).encode(a);var c=new CompressionStream("deflate"),b=c.writable.getWriter();b.write(a);b.close();a=[];c=c.readable.getReader();for(b=0;;){const {value:d,done:e}=await c.read();if(e)break;a.push(d);b+=d.byteLength}c=new Uint8Array(b);b=0;for(const d of a)c.set(d,b),b+=d.byteLength;return new Blob([c],{type:"octet/stream"})');
            self.addEventListener("message", async ({
                data: a
            }) => {
                self.postMessage(await self.work(a))
            })
        }
        static createWorker(a) {
            a = URL.createObjectURL(new Blob([this.getFuncBody(a)]));
            const b = new Worker(a);
            URL.revokeObjectURL(a);
            return b
        }
        static getFuncBody(a) {
            a = a.toString();
            return a.substring(a.indexOf("{") + 1, a.lastIndexOf("}"))
        }
        static setInputFocusBlurHandler(a) {
            const b = c => {
                c.target !== a && (a.blur(), document.removeEventListener("pointerdown", b, !0))
            };
            a.addEventListener("focus", c => {
                c.target.select();
                document.addEventListener("pointerdown",
                    b, !0)
            });
            a.addEventListener("blur", c => {
                window.getSelection().removeAllRanges()
            })
        }
        static drawFunctionString = 'function(a,c,d,t,D,f){f&&(a.beginPath(),a.rect(0,0,1,1),a.fill());a.lineCap=a.lineJoin="round";a.save();if(c){f=[];let E=!0,O=!1,P=void 0;try{for(var C,F=c[Symbol.iterator]();!(E=(C=F.next()).done);E=!0){const x=C.value,w=x[0],b=x.slice(2);if(10!=w){c=void 0;a.save();if(12==w)t?a.clearRect(0,32*d,758*d,424*d):(a.fillStyle="#FFFFFF",a.beginPath(),a.rect(0,32*d,758*d,424*d),a.fill());else if(8!=w){for(var e=1;e<b.length;e++)b[e]=[b[e][0]*d,b[e][1]*d];if(2<b.length)switch(w){case 1:var G=b[0];a.strokeStyle=G[0];a.lineWidth=G[1];a.globalAlpha=G[2];a.lineWidth*=d;c=[b[1][0],b[1][1]];a.beginPath();a.moveTo.apply(a,c);for(e=2;e<b.length;e++){c=[b[e][0],b[e][1]];var y=[b[e-1][0],b[e-1][1]];a.quadraticCurveTo(y[0],y[1],y[0]+(c[0]-y[0])/2,y[1]+(c[1]-y[1])/2)}a.lineTo(c[0],c[1]);a.stroke();break;case 2:a.strokeStyle="#FFFFFF";a.lineWidth=b[0]*d;c=[b[1][0],b[1][1]];t&&(a.globalCompositeOperation="destination-out");a.beginPath();a.moveTo.apply(a,c);for(e=2;e<b.length;e++){c=[b[e][0],b[e][1]];var z=[b[e-1][0],b[e-1][1]];a.quadraticCurveTo(z[0],z[1],z[0]+(c[0]-z[0])/2,z[1]+(c[1]-z[1])/2)}a.lineTo(c[0],c[1]);a.stroke();t&&(a.globalCompositeOperation="source-over");break;case 3:var H=b[0];a.strokeStyle=H[0];a.lineWidth=H[1];a.globalAlpha=H[2];a.lineWidth*=d;a.beginPath();a.moveTo(b[1][0],b[1][1]);a.lineTo(b[2][0],b[2][1]);a.stroke();break;case 4:var I=b[0];a.strokeStyle=I[0];a.lineWidth=I[1];a.globalAlpha=I[2];a.lineWidth*=d;a.beginPath();a.rect(b[1][0],b[1][1],b[2][0]-b[1][0],b[2][1]-b[1][1]);a.stroke();break;case 6:var J=b[0];a.fillStyle=J[0];a.lineWidth=J[1];a.globalAlpha=J[2];a.lineWidth*=d;a.beginPath();a.rect(b[1][0],b[1][1],b[2][0]-b[1][0],b[2][1]-b[1][1]);a.fill();break;case 5:var K=b[0];a.strokeStyle=K[0];a.lineWidth=K[1];a.globalAlpha=K[2];a.lineWidth*=d;var p=(b[2][0]-b[1][0])/2,m=(b[2][1]-b[1][1])/2,g=Math.round(b[1][0]+p),h=Math.round(b[1][1]+m),u=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(g,h-m);a.bezierCurveTo(g+u*p,h-m,g+p,h-u*m,g+p,h);a.bezierCurveTo(g+p,h+u*m,g+u*p,h+m,g,h+m);a.bezierCurveTo(g-u*p,h+m,g-p,h+u*m,g-p,h);a.bezierCurveTo(g-p,h-u*m,g-u*p,h-m,g,h-m);a.stroke();break;case 7:var L=b[0];a.fillStyle=L[0];a.lineWidth=L[1];a.globalAlpha=L[2];a.lineWidth*=d;var q=(b[2][0]-b[1][0])/2,n=(b[2][1]-b[1][1])/2,k=Math.round(b[1][0]+q),l=Math.round(b[1][1]+n),v=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(k,l-n);a.bezierCurveTo(k+v*q,l-n,k+q,l-v*n,k+q,l);a.bezierCurveTo(k+q,l+v*n,k+v*q,l+n,k,l+n);a.bezierCurveTo(k-v*q,l+n,k-q,l+v*n,k-q,l);a.bezierCurveTo(k-q,l-v*n,k-v*q,l-n,k,l-n);a.fill()}else if(![6,7,11].includes(w)){switch(w){case 2:a.fillStyle="#FFFFFF";a.lineWidth=b[0]*d;c=b[1];t&&(a.globalCompositeOperation="destination-out");break;case 10:a.fillStyle="#FF0000";a.lineWidth=2*d;a.globalAlpha=1;c=b[1];break;default:var M=b[0];a.fillStyle=M[0];a.lineWidth=M[1];a.globalAlpha=M[2];a.lineWidth*=d;c=b[1]}a.beginPath();a.arc(c[0],c[1],a.lineWidth/2,0,2*Math.PI);a.fill();2==w&&t&&(a.globalCompositeOperation="source-over")}}else{var Q=b[0];a.fillStyle=Q[0];a.globalAlpha=Q[1];a.beginPath();for(c=1;c<b.length;c+=5)a.rect(b[c]*d,b[c+1]*d,b[c+2]*d,b[c+3]*d);a.fill()}a.restore()}else D&&f.push(b)}}catch(x){O=!0,P=x}finally{try{E||null==F.return||F.return()}finally{if(O)throw P;}}t=!0;D=!1;C=void 0;try{for(var R,N=f[Symbol.iterator]();!(t=(R=N.next()).done);t=!0){var r=R.value;for(f=1;f<r.length;f++)r[f]=[r[f][0]*d,r[f][1]*d];a.strokeStyle="#CC0053";a.lineWidth=2*d;a.globalAlpha=1;var A=[r[1][0],r[1][1]];a.beginPath();a.moveTo.apply(a,A);for(f=2;f<r.length;f++){A=[r[f][0],r[f][1]];var B=[r[f-1][0],r[f-1][1]];a.quadraticCurveTo(B[0],B[1],B[0]+(A[0]-B[0])/2,B[1]+(A[1]-B[1])/2)}a.lineTo(A[0],A[1]);a.stroke()}}catch(x){D=!0,C=x}finally{try{t||null==N.return||N.return()}finally{if(D)throw C;}}}a.restore()}';
        static drawFunction = (new Function(`return ${this.drawFunctionString}`))();
        static bindMethods(a,
            b) {
            a.forEach(c => {
                b[c.name] = c.bind(b)
            })
        }
        static computeHash(a, b = 0) {
            let c = 3735928559 ^ b;
            b ^= 1103547991;
            for (let d = 0, e; d < a.length; d++) e = a.charCodeAt(d), c = Math.imul(c ^ e, 2654435761), b = Math.imul(b ^ e, 1597334677);
            c = Math.imul(c ^ c >>> 16, 2246822507) ^ Math.imul(b ^ b >>> 13, 3266489909);
            b = Math.imul(b ^ b >>> 16, 2246822507) ^ Math.imul(c ^ c >>> 13, 3266489909);
            return 4294967296 * (2097151 & b) + (c >>> 0)
        }
    }
    window.GPUtils_ = GPUtils_;
    class GPGlobalBanlist_ extends EventTarget {
        static MODULE = {
            title: "Global Banlist",
            alias: "gb"
        };
        constructor(a, b) {
            super();
            this.gpproxy = a.gpproxy;
            this.abt = a.abt;
            this.l = b;
            this.isSubscribed = !1;
            this.globalBanlist = new Set;
            this.globalBanlistIds = new Set;
            this.twitchUsernamesCache = new Map;
            this.twitchCachedUsers = new Set;
            this.addEventListener("global_banlist_updated", c => {
                this.clearPlayersByGlobalBanlist()
            });
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: c
                }
            }) => {
                c === GPProxy_.EVENT.NEW_GAME && this.gpproxy.isAuthorized &&
                    this.requestGlobalBanlist()
            });
            this.gpproxy.addEventListener("users_updated", ({}) => {
                this.clearPlayersByGlobalBanlist()
            });
            document.addEventListener("_global_banlist_received", ({
                detail: {
                    ids: c
                }
            }) => {
                this.globalBanlistIds = new Set(c);
                this.updateGlobalBanlist()
            });
            document.addEventListener("_tw_ids_usernames", ({
                detail: {
                    usernamesMap: c
                }
            }) => {
                this.updateTwitchUsernamesCache(c);
                this.updateGlobalBanlist(c)
            });
            document.addEventListener("_subs_status", ({
                detail: {
                    status: c,
                    ps: d
                }
            }) => {
                this.isSubscribed = c;
                2 & d || this.gpproxy.addEventListener("users_updated",
                    ({
                        detail: {
                            users: e
                        }
                    }) => {
                        this.requestIdsUsernames(e)
                    })
            });
            this.clearPlayersByGlobalBanlist();
            this.requestGlobalBanlist()
        }
        requestGlobalBanlist() {
            document.dispatchEvent(new CustomEvent("_request_global_banlist"))
        }
        clearPlayersByGlobalBanlist() {
            this.gpproxy.isHost() && this.gpproxy.isTwitchAuth() && this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.LOBBY) && this.gpproxy.getUsers().forEach(a => {
                !this.gpproxy.isYou(a.nick) && this.globalBanlist.has(this.gpproxy.formatNickname(a.nick)) && this.gpproxy.kickPlayer(a.id)
            })
        }
        updateGlobalBanlist(a) {
            a ||
                this.globalBanlist.clear();
            const b = a || this.twitchUsernamesCache;
            if (b.size) {
                var c = !1;
                this.globalBanlistIds.forEach(d => {
                    d = b.get(d);
                    void 0 !== d && (this.globalBanlist.add(d), c = !0)
                });
                c && this.dispatchEvent(new CustomEvent("global_banlist_updated"))
            }
        }
        requestIdsUsernames(a) {
            this.gpproxy.isHost() && this.gpproxy.isTwitchAuth() && (a = a.filter(b => !this.twitchCachedUsers.has(this.gpproxy.formatNickname(b.nick)) && !this.gpproxy.isYou(b.nick) && !this.gpproxy.isViewer(b)).map(b => this.gpproxy.formatNickname(b.nick)), a.length &&
                document.dispatchEvent(new CustomEvent("_request_ids_usernames", {
                    detail: {
                        users: a
                    }
                })))
        }
        updateTwitchUsernamesCache(a) {
            a.forEach((b, c) => {
                this.twitchUsernamesCache.set(c, b);
                this.twitchCachedUsers.add(b)
            })
        }
    }
    window.GPGlobalBanlist_ = GPGlobalBanlist_;
    class GPPacketParser_ {
        constructor() {
            this.socketIOParser = new SocketIOParser_;
            this.engineIOClient = new EngineIOClient_;
            return {
                encodeString: this.socketIOParser.encodeString,
                add: this.socketIOParser.add,
                decodeString: this.socketIOParser.decodeString,
                decodePayload: this.engineIOClient.decodePayload,
                decode: this.decode.bind(this)
            }
        }
        decode(a, b) {
            if (b) {
                const {
                    type: c,
                    data: d
                } = this.engineIOClient.decodePayload(a);
                return "message" === c ? this.socketIOParser.add(d).data : null
            }
            return this.socketIOParser.add(a).data
        }
    }
    class SocketIOParser_ {
        constructor() {
            function a(d) {
                var e = 0,
                    f = {
                        type: Number(d.charAt(0))
                    };
                if (null == c.types[f.type]) return {
                    type: c.ERROR,
                    data: null
                };
                if (c.BINARY_EVENT === f.type || c.BINARY_ACK === f.type) {
                    for (var g = e + 1;
                        "-" !== d.charAt(++e) && e != d.length;);
                    g = d.substring(g, e);
                    if (g != Number(g) || "-" !== d.charAt(e)) throw Error("Illegal attachments");
                    f.attachments = Number(g)
                }
                if ("/" === d.charAt(e + 1)) {
                    for (g = e + 1; ++e;) {
                        var h = d.charAt(e);
                        if ("," === h) break;
                        if (e === d.length) break
                    }
                    f.nsp = d.substring(g, e)
                } else f.nsp = "/";
                g = d.charAt(e +
                    1);
                if ("" !== g && Number(g) == g) {
                    for (g = e + 1; ++e;) {
                        h = d.charAt(e);
                        if (null == h || Number(h) != h) {
                            --e;
                            break
                        }
                        if (e === d.length) break
                    }
                    f.id = Number(d.substring(g, e + 1))
                }
                "4" === d.charAt(0) && "5" === d.charAt(1) && e++;
                if (d.charAt(++e)) {
                    d = d.substr(e);
                    try {
                        var k = JSON.parse(d)
                    } catch (l) {
                        k = !1
                    }
                    if (!1 === k || f.type !== c.ERROR && !Array.isArray(k)) return {
                        type: c.ERROR,
                        data: null
                    };
                    f.data = k
                }
                return f
            }
            var b = "function" === typeof ArrayBuffer;
            const c = {
                protocol: 4,
                types: "CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" "),
                CONNECT: 0,
                DISCONNECT: 1,
                EVENT: 2,
                ACK: 3,
                ERROR: 4,
                BINARY_EVENT: 5,
                BINARY_ACK: 6
            };
            return {
                add: function(d) {
                    if ("string" === typeof d)
                        if (d = a(d), c.BINARY_EVENT === d.type || c.BINARY_ACK === d.type) {
                            if (this.reconstructor = new window.BinaryReconstructor(d), 0 === this.reconstructor.reconPack.attachments) return d
                        } else return d;
                    else {
                        var e;
                        if (e = b)(e = d instanceof ArrayBuffer) || (e = "function" === typeof ArrayBuffer.isView ? ArrayBuffer.isView(d) : d.buffer instanceof ArrayBuffer);
                        if (e || d.base64)
                            if (this.reconstructor) {
                                if (d = this.reconstructor.takeBinaryData(d)) return this.reconstructor =
                                    null, d
                            } else throw Error("got binary data when not reconstructing a packet");
                        else throw Error("Unknown type: " + d);
                    }
                },
                decodeString: a,
                encodeString: function(d) {
                    let e, f = !1;
                    e = "" + d.type;
                    if (c.BINARY_EVENT == d.type || c.BINARY_ACK == d.type) e += d.attachments, e += "-";
                    d.nsp && "/" != d.nsp && (f = !0, e += d.nsp);
                    null != d.id && (f && (e += ",", f = !1), e += d.id);
                    null != d.data && (f && (e += ","), e += JSON.stringify(d.data));
                    return e
                }
            }
        }
    }
    class EngineIOClient_ {
        constructor() {
            function a(e, f, g) {
                if (void 0 === e) return d;
                if ("string" === typeof e) {
                    if ("b" === e.charAt(0)) return g = e.substr(1), e = c[g.charAt(0)], window.base64encoder ? (g = window.base64encoder.decode(g.substr(1)), "blob" === f && Blob && (g = new Blob([g])), f = {
                        type: e,
                        data: g
                    }) : f = {
                        type: e,
                        data: {
                            base64: !0,
                            data: g.substr(1)
                        }
                    }, f;
                    if (g) {
                        a: {
                            f = e;
                            try {
                                f = window.utf8.decode(f, {
                                    strict: !1
                                })
                            } catch (h) {
                                e = !1;
                                break a
                            }
                            e = f
                        }
                        if (!1 === e) return d
                    }
                    g = e.charAt(0);
                    return Number(g) == g && c[g] ? 1 < e.length ? {
                        type: c[g],
                        data: e.substring(1)
                    } : {
                        type: c[g]
                    } : d
                }
                g = (new Uint8Array(e))[0];
                e = e.slice(1);
                Blob && "blob" === f && (e = new Blob([e]));
                return {
                    type: c[g],
                    data: e
                }
            }

            function b(e, f, g) {
                "function" === typeof f && (g = f, f = null);
                for (var h = []; 0 < e.byteLength;) {
                    for (var k = new Uint8Array(e), l = 0 === k[0], m = "", n = 1; 255 !== k[n]; n++) {
                        if (310 < m.length) return g(d, 0, 1);
                        m += k[n]
                    }
                    e = e.slice(2 + m.length);
                    m = parseInt(m);
                    k = e.slice(0, m);
                    if (l) try {
                        k = String.fromCharCode.apply(null, new Uint8Array(k))
                    } catch (q) {
                        for (l = new Uint8Array(k), k = "", n = 0; n < l.length; n++) k += String.fromCharCode(l[n])
                    }
                    h.push(k);
                    e = e.slice(m)
                }
                var r = h.length;
                h.forEach(function(q, p) {
                    g(a(q, f, !0), p, r)
                })
            }
            var c = Object.keys({
                    open: 0,
                    close: 1,
                    ping: 2,
                    pong: 3,
                    message: 4,
                    upgrade: 5,
                    noop: 6
                }),
                d = {
                    type: "error",
                    data: "parser error"
                };
            return {
                decodePayload: function(e, f, g) {
                    if ("string" !== typeof e) return b(e, f, g);
                    "function" === typeof f && (f = null);
                    if ("" === e) return d;
                    g = "";
                    for (var h, k, l = 0, m = e.length; l < m; l++)
                        if (k = e.charAt(l), ":" !== k) g += k;
                        else {
                            if ("" === g || g != (h = Number(g))) return d;
                            k = e.substr(l + 1, h);
                            if (g != k.length) return d;
                            if (k.length) return e = a(k, f, !1), d.type ===
                                e.type && d.data === e.data ? d : e;
                            l += h;
                            g = ""
                        } if ("" !== g) return d
                }
            }
        }
    }
    window.GPPacketParser_ = GPPacketParser_;
    class GPProxy_ extends EventTarget {
        static EVENT = {
            GAME_QUIT: 28,
            CHANGE_GAME_MODE: 26,
            CHANGE_LOBBY_SCREEN: 27,
            CHANGE_GAME_SETTINGS: 18,
            GAME_STARTED: 5,
            DESCRIPTION_INPUT: 6,
            TOOL: 7,
            READY: 15,
            GALLERY_SETTINGS: 23,
            NEW_GAME: 20,
            PLAYER_JOINED: 2,
            PLAYER_LEFT: 3,
            PLAYER_KICKED: 14,
            PLAYER_LEFT_GAME: 21,
            PLAYER_RETURNED: 22,
            TURN_STARTED: 11,
            TURNS_ENDED: 24,
            TIMER_STARTED: 25,
            ALBUM_INFO: 12,
            ALBUM_ITEM: 9,
            ALBUM_NEXT: 16,
            ALBUM_BACK: 17,
            ALBUM_SCORE: 35,
            CHANGE_ANIMATION_SETTINGS: 36
        };
        static GAME_TIME = {
            FAST: 3,
            NORMAL: 2,
            SLOW: 1,
            REGRESSIVE: 5,
            PROGRESSIVE: 8,
            DYNAMIC: 4,
            INFINITE: 6,
            HOSTS_DECISION: 7,
            FASTER_FIRST_TURN: 9,
            SLOWER_FIRST_TURN: 10
        };
        static GAME_ORDER = {
            WRITING_DRAWING: 1,
            DRAWING_WRITING: 2,
            ONLY_DRAWINGS: 3,
            WRITING_ONLY_AT_THE_BEGINNING_AND_THE_END: 4,
            WRITING_ONLY_AT_THE_BEGINNING: 5,
            WRITING_ONLY_AT_THE_END: 6,
            SINGLE_SENTENCE: 7,
            SINGLE_DRAWING: 8,
            SOLO_DRAWING: 9,
            DRAWINGS_WITH_A_BACKGROUND: 10,
            DRAWINGS_WITH_A_BACKGROUND_NO_PREVIEW: 11
        };
        static INITIAL_STATE = {
            screen: null,
            user: {
                owner: !1
            },
            users: [],
            turn: {},
            turnNum: 0,
            turnMax: 0,
            roundNum: 0,
            bookAuthor: {
                id: 0,
                nick: ""
            },
            bookNum: -1,
            bookLoaded: !1,
            bookAutomatic: !0,
            bookVoice: !1,
            timeline: [],
            previous: {
                user: {
                    id: 0,
                    nick: ""
                },
                type: 2,
                data: ""
            },
            active: !1,
            sentence: "",
            write: "",
            draw: [],
            lastDraw: null,
            background: null,
            configs: {
                tab: 1,
                mode: 1,
                maxUsers: 14,
                visible: !0,
                speed: 2,
                turns: 3,
                first: 1,
                score: 2,
                animate: 2,
                keep: 2
            },
            animationConfigs: {
                speed: 3,
                loop: 1
            },
            timeStarted: !1,
            elapsedBase: 0,
            elapsedTime: 0,
            modList: 0
        };
        static PAYLOAD_TYPE = {
            PRESETS: 1,
            DATA: 2
        };
        static GAME_STAGE = {
            LOBBY: 1,
            GAME: 2,
            GALLERY_SETTINGS: 5,
            ALBUM: 3,
            SCORE: 4
        };
        static ALBUM_ITEM_TYPE = {
            TEXT: 2,
            IMAGE: 1,
            ANIMATION: 5,
            MULTI_PIECE: 10,
            AI_IMAGE: 6
        };
        static AUTH_TYPE = {
            DISCORD: "discord",
            TWITCH: "twitch"
        };
        static AUTH_TYPE_IDS = {
            twitch: 1,
            discord: 2
        };
        static GAME_MODES_PRESETS = {
            1: {
                mode: 1,
                visible: 1,
                speed: 2,
                turns: 3,
                first: 1,
                score: 2,
                animate: 2,
                keep: 2
            },
            2: {
                mode: 2,
                speed: 4
            },
            3: {
                mode: 3,
                visible: 2,
                speed: 3
            },
            4: {
                mode: 4,
                turns: 3
            },
            5: {
                mode: 5,
                first: 4
            },
            6: {
                mode: 6,
                speed: 3
            },
            7: {
                mode: 7,
                speed: 3,
                turns: 1
            },
            8: {
                mode: 8,
                speed: 5,
                first: 3
            },
            9: {
                mode: 9,
                first: 7,
                turns: 12
            },
            10: {
                mode: 10,
                score: 1
            },
            11: {
                mode: 11,
                first: 3,
                animate: 1
            },
            12: {
                mode: 12,
                speed: 6,
                turns: 4,
                first: 7,
                animate: 1
            },
            13: {
                mode: 13,
                speed: 4,
                turns: 7,
                first: 9,
                animate: 1
            },
            14: {
                mode: 14,
                speed: 10,
                turns: 4,
                first: 10,
                animate: 1
            },
            15: {
                mode: 15,
                speed: 9,
                turns: 12,
                first: 11
            },
            16: {
                mode: 16,
                first: 13,
                turns: 1
            },
            17: {
                mode: 17,
                first: 12
            },
            18: {
                mode: 18,
                speed: 3,
                turns: 13,
                first: 7,
                keep: 1
            },
            19: {
                mode: 19,
                first: 3,
                animate: 1,
                keep: 1
            },
            20: {
                mode: 20,
                speed: 7,
                turns: 6,
                first: 9
            },
            21: {
                mode: 21,
                first: 3,
                keep: 3
            },
            24: {
                mode: 24,
                speed: 1,
                turns: 11,
                first: 3,
                keep: 4
            }
        };
        static SCREEN = {
            LOBBY: 1,
            PHRASE: 3,
            DESCRIPTION: 4,
            PAINTER: 5,
            ALBUM: 7
        };
        static SCREEN_NAMES = {
            1: "lobby",
            3: "phrase",
            4: "description",
            5: "painter",
            7: "album"
        };
        static REJOIN_STAGES = {
            LOBBY: ["lobby"],
            GAME: ["start", "draw", "write", "memory", "reply"],
            ALBUM: ["book"],
            SCORE: ["rank"]
        };
        static STAGE = {
            LOBBY: "lobby",
            GAME: "game",
            ALBUM: "album",
            SCORE: "score"
        };
        static SEND_QUEUE_DELAY = 130;
        static MODULE = {
            title: "GP Proxy",
            alias: "gpproxy",
            dependencies: ["GPPacketParser_"]
        };
        constructor(a, b) {
            super();
            this.abt = null;
            this.ws;
            this.l = b;
            document.addEventListener("_modules-loaded", c => {
                this.abt = a.abt;
                window.closeNotice = a.abt?.closeNotice.bind(a.abt);
                window.addNotice =
                    a.abt?.addNotice.bind(a.abt)
            }, {
                once: !0
            });
            this.state = GPProxy_.INITIAL_STATE;
            this.albums = [];
            this.albumsCount = 0;
            this.isTwitchOAuth = this.isAuthorized = !1;
            this.twitchOAuthLogin = null;
            this.gameStage = GPProxy_.GAME_STAGE.LOBBY;
            this.rejoinFlag = !1;
            this.rejoinEvent = null;
            this.isRejoinEventRequested = !1;
            this.stateUpdateHandler = this.stateUpdateHandler.bind(this);
            this.wsMessageHandler = this.wsMessageHandler.bind(this);
            this.wsOpenHandler = this.wsOpenHandler.bind(this);
            this.dataEventHandler = this.dataEventHandler.bind(this);
            this.rejoinHandler = this.rejoinHandler.bind(this);
            this.sendQueueHandler = this.sendQueueHandler.bind(this);
            this.resetSendQueue = this.resetSendQueue.bind(this);
            this.setAlbumItem = this.setAlbumItem.bind(this);
            this.parser = new GPPacketParser_;
            this.localization = {};
            this.wsMsgMiddlewares = new Map;
            this.sendQueue = [];
            this.sendInProcess = !1;
            this.sendQueueTimeLeft = 0;
            this.lastSendTime = Date.now();
            this.sendQueueTimer;
            document.addEventListener("_xhr_data", ({
                detail: {
                    encodedPacket: c
                }
            }) => {
                (c = this.parser.decode(c, !0)) && this.setPresets(c[1])
            });
            document.addEventListener("_ws_send_data", ({
                detail: {
                    encodedPacket: c
                }
            }) => {
                c && 3 < c.length && (c = this.parser.decode(c)) && this.wsSendHandler(c)
            });
            document.addEventListener("_onmessage_intercept", ({
                detail: {
                    handler: c,
                    e: d
                }
            }) => {
                if (this.wsMsgMiddlewares.size)
                    if ("string" !== typeof d.data) c(d);
                    else {
                        var [, e, f] = d.data.match(/4(?:(?:2)|(51-))\[2,(\d+)/) || [];
                        if (void 0 !== f && this.wsMsgMiddlewares.has(+f)) {
                            var g = this.wsMsgMiddlewares.get(+f),
                                h = this.parser.decodeString(d.data).data;
                            if (h) {
                                var [k, l] = [...g].reduce((m, n) =>
                                    n(m), [h, !1]);
                                l ? (g = this.encodePacket(k, !!e), d = this.buildMessageEvent(d, g), c(d)) : c(d)
                            } else c(d)
                        } else c(d)
                    }
                else c(d)
            });
            this.addEventListener("data", this.stateUpdateHandler);
            this.addEventListener("data", this.gameStageUpdateHandler);
            this.addEventListener("data", this.usersUpdateHandler);
            this.addEventListener("data", this.albumUpdateHandler);
            this.addEventListener("data", this.dataEventHandler);
            this.addEventListener("data", this.sendQueueHandler);
            this.addEventListener("presets", this.resetSendQueue);
            this.addEventListener("album_reconnect",
                () => {
                    this.albumsCount = this.getAlbumsCount()
                });
            document.addEventListener("_url_changed", this.rejoinHandler, {
                once: !0
            });
            this.setWebSocket(a.ws);
            this.requestLocalization("draw").then(({
                data: c,
                type: d
            }) => {
                this.localization[d] = c;
                this.dispatchEvent(new CustomEvent("localization", {
                    detail: {
                        data: c,
                        type: d
                    }
                }))
            }).catch(({
                err: c,
                type: d
            }) => {
                console.error(c);
                this.localization[d] = {}
            })
        }
        setWebSocket(a) {
            this.ws && (this.ws.removeEventListener("message", this.wsMessageHandler), this.ws.removeEventListener("open", this.wsOpenHandler));
            this.ws = a;
            this.ws.addEventListener("message", this.wsMessageHandler);
            this.ws.addEventListener("open", this.wsOpenHandler)
        }
        addWSMsgMiddleware(a, b) {
            a.forEach(c => {
                const d = this.wsMsgMiddlewares.get(c) || new Set;
                d.add(b);
                this.wsMsgMiddlewares.set(c, d)
            })
        }
        removeWSMsgMiddleware(a) {
            this.wsMsgMiddlewares.forEach((b, c) => {
                b.delete(a);
                b.size || this.wsMsgMiddlewares.delete(c)
            })
        }
        encodePacket([a, b, c, d], e) {
            e = e ? "51-" : 2;
            a = [a, b, c];
            void 0 !== d && a.push(d);
            return this.parser.encodeString({
                type: 4,
                nsp: "/",
                id: e,
                data: a
            })
        }
        buildMessageEvent(a,
            b) {
            return new MessageEvent("message", {
                data: b,
                origin: a.origin,
                lastEventId: a.lastEventId,
                source: a.source,
                ports: a.ports
            })
        }
        setPresets(a) {
            if (a.error) console.warn("Presets Error:", a);
            else try {
                this.state = Object.assign(GPProxy_.INITIAL_STATE, this.state, a);
                this.state.users.find(c => c.id === a.user.id).you = !0;
                this.isAuthorized = this.state.user.uid !== this.state.user.authId;
                this.authTypeId = (this.authType = this.calcAuthType()) ? GPProxy_.AUTH_TYPE_IDS[this.authType] : 0;
                if (a.users) {
                    const c = new CustomEvent("users_updated", {
                        detail: {
                            users: this.state.users
                        }
                    });
                    this.dispatchEvent(c)
                }
                a.timeline?.length && (this.albums[a.bookNum] = {
                    items: [],
                    background: a.background
                }, a.timeline.forEach(this.setAlbumItem));
                this.dispatchEvent(new CustomEvent("presets", {
                    detail: {
                        state: this.state
                    }
                }));
                if (1 !== a.screen) {
                    var b = GPProxy_.SCREEN_NAMES[a.screen];
                    b && this.dispatchEvent(new CustomEvent(`${b}_reconnect`));
                    this.rejoinFlag = !0
                }
            } catch (c) {
                console.warn("Presets Data Error:", {
                    error: c,
                    data: a
                })
            }
        }
        wsMessageHandler({
            data: a
        }) {
            if ("string" === typeof a && (a = this.parser.decodeString(a).data)) {
                const [,
                    b, c
                ] = a;
                this.dispatchEvent(new CustomEvent("data", {
                    detail: {
                        event: b,
                        data: c
                    }
                }))
            }
        }
        wsOpenHandler(a) {
            this.abt?.closeNotice(GPAbout_.NOTICE_TYPE.DISCONNECTION)
        }
        wsSendHandler(a) {
            const [, b, c] = a;
            b !== GPProxy_.EVENT.CHANGE_GAME_SETTINGS && b !== GPProxy_.EVENT.CHANGE_ANIMATION_SETTINGS && b !== GPProxy_.EVENT.GAME_QUIT || this.dispatchEvent(new CustomEvent("data", {
                detail: {
                    event: b,
                    data: c
                }
            }))
        }
        stateUpdateHandler({
            detail: {
                event: a,
                data: b
            }
        }) {
            switch (a) {
                case GPProxy_.EVENT.CHANGE_GAME_MODE:
                    a = GPProxy_.GAME_MODES_PRESETS;
                    b = Object.assign({},
                        a[1], a[b]);
                    this.state.configs = Object.assign({}, this.state.configs, b);
                    break;
                case GPProxy_.EVENT.CHANGE_LOBBY_SCREEN:
                    b = GPProxy_.GAME_MODES_PRESETS[1];
                    this.state.configs = Object.assign({}, this.state.configs, b);
                    break;
                case GPProxy_.EVENT.CHANGE_GAME_SETTINGS:
                    this.state.configs = Object.assign({}, this.state.configs, b);
                    break;
                case GPProxy_.EVENT.GAME_STARTED:
                    this.state = Object.assign({}, this.state, {
                        countDown: !0,
                        previous: null,
                        turnNum: 0,
                        roundNum: this.state.roundNum + 1,
                        bookNum: 0,
                        turnMax: b,
                        timeline: [],
                        background: null
                    });
                    break;
                case GPProxy_.EVENT.TURN_STARTED:
                    this.state = Object.assign({}, this.state, {
                        draw: [],
                        lastDraw: null
                    }, b);
                    [3, 4, 9].includes(this.state.screen) ? this.state.write = b.write || "" : this.state.draw = b.draw || [];
                    break;
                case GPProxy_.EVENT.TURNS_ENDED:
                    this.state = Object.assign({}, this.state, {
                        screen: 7,
                        bookNum: -1
                    });
                    break;
                case GPProxy_.EVENT.GALLERY_SETTINGS:
                    this.state = Object.assign({}, this.state, {
                        background: null
                    }, b);
                    break;
                case GPProxy_.EVENT.ALBUM_INFO:
                    this.state = Object.assign({}, this.state, {
                        timeline: []
                    }, b);
                    break;
                case GPProxy_.EVENT.ALBUM_ITEM:
                    this.state =
                        Object.assign({}, this.state, {
                            timeline: [...(b.load || !b.type ? this.state.timeline : this.state.timeline.slice(0, this.state.timeline.length - 1)), b]
                        });
                    break;
                case GPProxy_.EVENT.NEW_GAME:
                    this.state = Object.assign({}, this.state, {
                        screen: 1,
                        roundNum: 0
                    });
                    break;
                case GPProxy_.EVENT.ALBUM_SCORE:
                    this.state = Object.assign({}, this.state, {
                        screen: 8
                    });
                    break;
                case GPProxy_.EVENT.CHANGE_ANIMATION_SETTINGS:
                    this.state = Object.assign({}, this.state, {
                        animationConfigs: Object.assign({}, this.state.animationConfigs, b)
                    })
            }
        }
        gameStageUpdateHandler({
            detail: {
                event: a
            }
        }) {
            switch (a) {
                case GPProxy_.EVENT.NEW_GAME:
                    this.gameStage =
                        GPProxy_.GAME_STAGE.LOBBY;
                    break;
                case GPProxy_.EVENT.GAME_STARTED:
                    this.gameStage = GPProxy_.GAME_STAGE.GAME;
                    break;
                case GPProxy_.EVENT.TURNS_ENDED:
                    this.gameStage = GPProxy_.GAME_STAGE.GALLERY_SETTINGS;
                    break;
                case GPProxy_.EVENT.GALLERY_SETTINGS:
                    this.gameStage = GPProxy_.GAME_STAGE.ALBUM;
                    break;
                case GPProxy_.EVENT.ALBUM_SCORE:
                    this.gameStage = GPProxy_.GAME_STAGE.SCORE
            }
        }
        dataEventHandler({
            detail: {
                event: a,
                data: b
            }
        }) {
            let c = !0,
                d;
            switch (a) {
                case GPProxy_.EVENT.PLAYER_JOINED:
                    d = "player_joined";
                    break;
                case GPProxy_.EVENT.TURN_STARTED:
                    d =
                        "turn_started";
                    break;
                case GPProxy_.EVENT.TURNS_ENDED:
                    d = "turns_ended";
                    break;
                case GPProxy_.EVENT.GALLERY_SETTINGS:
                    d = "gallery_started";
                    break;
                default:
                    c = !1
            }
            c && (a = new CustomEvent(d, {
                detail: {
                    ...b
                }
            }), this.dispatchEvent(a))
        }
        sendQueueHandler({
            detail: {
                event: a
            }
        }) {
            a !== GPProxy_.EVENT.TURN_STARTED && a !== GPProxy_.EVENT.TURNS_ENDED || this.resetSendQueue()
        }
        rejoinHandler({
            detail: {
                path: a
            }
        }) {
            if (this.rejoinFlag) {
                var b = a.slice(1),
                    c = Object.keys(GPProxy_.REJOIN_STAGES).find(d => GPProxy_.REJOIN_STAGES[d].find(e => e === b));
                this.gameStage =
                    GPProxy_.GAME_STAGE[c];
                this.rejoinEvent = new CustomEvent("rejoin", {
                    detail: {
                        screen: this.state.screen,
                        stage: c?.toLowerCase(),
                        path: a
                    }
                });
                this.isRejoinEventRequested && this.dispatchEvent(this.rejoinEvent)
            }
        }
        requestRejoinEvent() {
            this.rejoinEvent ? this.dispatchEvent(this.rejoinEvent) : this.isRejoinEventRequested = !0
        }
        usersUpdateHandler({
            detail: {
                event: a,
                data: b
            }
        }) {
            let c = !0,
                d = !1;
            switch (a) {
                case GPProxy_.EVENT.NEW_GAME:
                    this.state.users = this.state.users.filter(k => !k.away).map(k => {
                        k.viewer = void 0;
                        k.ready = !1;
                        return k
                    });
                    break;
                case GPProxy_.EVENT.ALBUM_SCORE:
                    this.state.users = this.state.users.map(k => {
                        k.viewer = void 0;
                        return k
                    });
                    break;
                case GPProxy_.EVENT.TURN_STARTED:
                    this.state.user.ready = !1;
                    this.state.users = this.state.users.map(k => {
                        k.ready = !1;
                        return k
                    });
                    break;
                case GPProxy_.EVENT.PLAYER_JOINED:
                    this.state.users.push(b);
                    break;
                case GPProxy_.EVENT.PLAYER_LEFT:
                    var {
                        userLeft: e, newOwner: f
                    } = b;
                    this.state.users = this.state.users.filter(k => k.id !== e);
                    f && (d = this.state.user.id === f, this.state.user.owner = d, this.state.users = this.state.users.map(k => {
                        k.owner = k.id === f;
                        return k
                    }));
                    break;
                case GPProxy_.EVENT.PLAYER_LEFT_GAME:
                    var {
                        userLeft: e, newOwner: f
                    } = b;
                    this.state.users = this.state.users.map(k => {
                        k.away = k.id === e || k.away;
                        return k
                    });
                    f && (d = this.state.user.id === f, this.state.user.owner = d, this.state.users = this.state.users.map(k => {
                        k.owner = k.id === f;
                        return k
                    }));
                    break;
                case GPProxy_.EVENT.PLAYER_RETURNED:
                    this.state.users = this.state.users.map(k => {
                        k.away = k.away && k.id !== b;
                        return k
                    });
                    break;
                case GPProxy_.EVENT.PLAYER_KICKED:
                    this.state.users = this.state.users.filter(k =>
                        k.id !== b);
                    break;
                case GPProxy_.EVENT.READY:
                    var {
                        user: g, ready: h
                    } = b;
                    this.state.users = this.state.users.map(k => {
                        k.ready = k.id === g ? h : k.ready;
                        return k
                    });
                    g === this.state.user.id && (this.state.user.ready = h);
                    break;
                case GPProxy_.EVENT.GAME_QUIT:
                    this.state.users = [];
                    break;
                default:
                    c = !1
            }
            c && this.dispatchEvent(new CustomEvent("users_updated", {
                detail: {
                    users: this.state.users
                }
            }));
            d && this.dispatchEvent(new Event("owner_status"))
        }
        albumUpdateHandler({
            detail: {
                event: a,
                data: b
            }
        }) {
            switch (a) {
                case GPProxy_.EVENT.ALBUM_INFO:
                    this.albums[b.bookNum] = {
                        items: [],
                        background: b.background,
                        bookAuthor: b.bookAuthor
                    };
                    b.timeline && b.timeline.forEach(this.setAlbumItem);
                    break;
                case GPProxy_.EVENT.ALBUM_ITEM:
                    if (void 0 === b.id) {
                        this.state.bookNum + 1 >= this.albumsCount && this.dispatchEvent(new Event("albums_ended"));
                        break
                    }
                    if (b.type === GPProxy_.ALBUM_ITEM_TYPE.ANIMATION || b.type === GPProxy_.ALBUM_ITEM_TYPE.MULTI_PIECE) {
                        this.dispatchEvent(new CustomEvent("album_item_loading", {
                            detail: {
                                id: null
                            }
                        }));
                        break
                    }
                    b.user && !b.data ? this.dispatchEvent(new CustomEvent("album_item_loading", {
                        detail: {
                            id: b.id
                        }
                    })) : this.setAlbumItem(b);
                    break;
                case GPProxy_.EVENT.GALLERY_SETTINGS:
                    this.albumsCount = this.getAlbumsCount()
            }
        }
        getAlbumsCount() {
            return this.getUsers().filter(a => !a.viewer).length
        }
        getAlbum(a = this.state.bookNum) {
            return this.albums[a]
        }
        getAlbumBackground(a = this.state.bookNum) {
            return this.albums[a]?.background ?? null
        }
        setAlbumItem({
            user: a,
            id: b,
            data: c,
            type: d,
            active: e
        }) {
            if (e && c && a && (d === GPProxy_.ALBUM_ITEM_TYPE.TEXT || d === GPProxy_.ALBUM_ITEM_TYPE.IMAGE)) {
                a = a.nick;
                e = d === GPProxy_.ALBUM_ITEM_TYPE.IMAGE ?
                    this.getItemTitle(b) : null;
                var f = (new Date).toISOString(),
                    g = this.albums[this.state.bookNum].background;
                0 === b && g && !c?.length && (c = g, g = void 0);
                c = {
                    data: c,
                    background: g,
                    type: d,
                    meta: {
                        author: a,
                        title: e,
                        date: f
                    }
                };
                this.isAuthorized && (c.auth = this.authTypeId);
                this.albums[this.state.bookNum].items[b] = c;
                this.dispatchEvent(new CustomEvent("album_item", {
                    detail: {
                        itemId: b,
                        albumId: this.state.bookNum,
                        item: c
                    }
                }))
            }
        }
        getItemTitle(a) {
            if (!a) return this.l.ITEM_FREE_TITLE;
            const b = Object.values(this.albums[this.state.bookNum].items),
                {
                    first: c,
                    animate: d
                } = this.state.configs;
            let e;
            if (1 === d) return this.l.ITEM_ANIM_FRAME_TITLE;
            if (1 === c || 2 === c) {
                for (a = b.length; 0 < a--;)
                    if (2 === b[a].type) {
                        e = b[a].data;
                        break
                    } return e || this.l.ITEM_FREE_TITLE
            }
            return 3 === c || 6 === c ? this.l.ITEM_REDRAWN_TITLE : 4 === c || 5 === c ? 1 < a ? this.l.ITEM_REDRAWN_TITLE : b[0].data : 7 === c ? b[0].data : 9 === c ? this.l.ITEM_FREE_TITLE : 10 === c || 11 === c ? 0 < a ? this.l.ITEM_COMPLEMENTED_TITLE : this.l.ITEM_FREE_TITLE : this.l.ITEM_FREE_TITLE
        }
        getAlbumItem(a, b = this.state.bookNum) {
            return this.albums[b]?.items[a] ??
                null
        }
        calcAuthType() {
            return this.isAuthorized ? 17 <= this.state.user.authId.length ? GPProxy_.AUTH_TYPE.DISCORD : GPProxy_.AUTH_TYPE.TWITCH : null
        }
        isConnected() {
            return this.ws?.readyState === WebSocket.OPEN
        }
        send(a, b, c = 4, d = 2, e) {
            c = this.parser.encodeString({
                type: c,
                nsp: "/",
                id: d,
                data: [GPProxy_.PAYLOAD_TYPE.DATA, a, b]
            });
            if (this.sendQueue.length || e) {
                if (a = a === GPProxy_.EVENT.TOOL && Number.isInteger(b?.v)) {
                    const f = b.v;
                    b = this.sendQueue.findLastIndex(g => g[2] === f);
                    ~b ? (this.sendQueue.splice(b, 1), this.sendQueueTimeLeft -= GPProxy_.SEND_QUEUE_DELAY) :
                        this.sendQueue.push([c, a, f])
                } else this.sendQueue.push([c, a, b.v[1]]), this.sendQueueTimeLeft += GPProxy_.SEND_QUEUE_DELAY;
                this.sendInProcess || this.delayedSend()
            } else this.ws.send(c), this.lastSendTime = Date.now()
        }
        delayedSend(a = GPProxy_.SEND_QUEUE_DELAY) {
            if (this.sendQueue.length) {
                this.sendInProcess = !0;
                var b = Date.now() - this.lastSendTime;
                if (b > a || this.sendQueue[0][1]) {
                    const [c, d] = this.sendQueue.shift();
                    this.sendQueueTimeLeft -= d ? 0 : GPProxy_.SEND_QUEUE_DELAY;
                    this.ws.send(c);
                    this.lastSendTime = Date.now();
                    this.dispatchEvent(new CustomEvent("send_queue_updated", {
                        detail: {
                            size: this.sendQueue.length,
                            timeLeft: this.sendQueueTimeLeft
                        }
                    }));
                    0 < this.sendQueue.length && (this.sendQueueTimer = setTimeout(() => {
                        this.delayedSend()
                    }, d ? 0 : a));
                    this.sendInProcess = !1
                } else this.sendQueueTimer = setTimeout(() => {
                    this.delayedSend()
                }, a - b)
            } else this.sendInProcess = !1, this.sendQueueTimeLeft = 0, this.dispatchEvent(new CustomEvent("send_queue_updated", {
                detail: {
                    size: this.sendQueue.length,
                    timeLeft: this.sendQueueTimeLeft
                }
            }))
        }
        resetSendQueue() {
            clearTimeout(this.sendQueueTimer);
            this.sendQueue = [];
            this.sendInProcess = !1;
            this.sendQueueTimeLeft = 0
        }
        getSendQueueSize() {
            return this.sendQueue.length
        }
        kickPlayer(a) {
            this.send(GPProxy_.EVENT.PLAYER_KICKED, a)
        }
        tool(a, b, c) {
            this.send(GPProxy_.EVENT.TOOL, {
                t: this.state.turnNum,
                d: a,
                v: b
            }, void 0, void 0, c)
        }
        undo(a, b) {
            this.tool(2, a, b)
        }
        redo(a, b) {
            this.tool(1, a, b)
        }
        ready() {
            this.send(GPProxy_.EVENT.READY, !this.state.user.ready)
        }
        getState() {
            return this.state
        }
        isRejoined() {
            return this.rejoinFlag
        }
        getUser() {
            return this.state.user
        }
        getNickname() {
            return this.state.user.nick
        }
        getUsername() {
            return this.formatNickname(this.getNickname())
        }
        formatNickname(a) {
            return this.isDiscordAuth() ?
                a : a.toLowerCase()
        }
        getUsers() {
            return this.state.users.slice()
        }
        requestAuthId() {
            document.dispatchEvent(new CustomEvent("_auth_id", {
                detail: {
                    authId: this.state.user.authId,
                    authTypeId: this.authTypeId,
                    isAuthorized: this.isAuthorized
                }
            }))
        }
        getAuthType() {
            return this.authType
        }
        isTwitchAuth() {
            return this.authType === GPProxy_.AUTH_TYPE.TWITCH
        }
        isDiscordAuth() {
            return this.authType === GPProxy_.AUTH_TYPE.DISCORD
        }
        setTwitchOAuth(a) {
            this.isTwitchOAuth = !0;
            this.twitchOAuthLogin = a
        }
        getTwitchOAuthLogin() {
            return this.twitchOAuthLogin
        }
        isReady() {
            return !!this.state.user.ready
        }
        isHost() {
            return !!this.state.user.owner
        }
        isViewer(a) {
            return !!a.viewer
        }
        isYou(a) {
            return void 0 ===
                a ? !1 : this.state.user["number" === typeof a ? "id" : "nick"] === a
        }
        isAnimateMode() {
            return 1 === this.state.configs.animate
        }
        isMultiPieceMode() {
            return 4 === this.state.configs.keep
        }
        isScreen(...a) {
            return a.some(b => b === this.state.screen)
        }
        isGameStage(a) {
            return this.gameStage === a
        }
        isGameStages(...a) {
            return a.some(b => b === this.gameStage)
        }
        isGameTime(a) {
            return this.state.configs.speed === a
        }
        isGameOrder(a) {
            return this.state.configs.first === a
        }
        isAlbumAutoShow() {
            return this.state.bookAutomatic
        }
        isSoloGame() {
            return this.state.screen ===
                GPProxy_.SCREEN.PAINTER && 1 === this.state.users.filter(a => !a.viewer).length
        }
        getGameConfig() {
            return Object.assign({}, this.state.configs)
        }
        getCurrentAlbumId() {
            return this.state.bookNum
        }
        getCurrentTurnId() {
            return this.state.turnNum
        }
        getAlbumAuthor() {
            return this.state.bookAuthor.nick
        }
        getGameCode() {
            return this.state.user.access
        }
        getPrevImageData() {
            return this.state.previous.data
        }
        getPrevData() {
            return this.state.previous
        }
        getLocalization(a) {
            return this.localization[a] || {}
        }
        requestLocalization(a) {
            return new Promise((b,
                c) => {
                window.__NEXT_DATA__ ? fetch(`${location.origin}/_next/data/${window.__NEXT_DATA__.buildId}/${window.__NEXT_DATA__.locale}/${a}.json`).then(d => d.json()).then(d => {
                    (d = d.pageProps?.texts?.page) ? b({
                        data: d,
                        type: a
                    }): c({
                        error: "localization data not found",
                        type: a
                    })
                }).catch(d => {
                    c({
                        error: d,
                        type: a
                    })
                }) : c({
                    error: "__NEXT_DATA__ is undefined",
                    type: a
                })
            })
        }
    }
    window.GPProxy_ = GPProxy_;
    class GPModulesManager_ extends EventTarget {
        static FORCE_RELOAD = !0;
        static DEFAULT_PERMISSIONS = 3685;
        static STATE = {
            ANALYTICS: "analytics",
            KEY: "key",
            AUTH: "auth",
            SUBSCRIBE: "subscribe",
            SUBSCRIPTION: "subscription",
            TIME_LEFT: "time-left",
            EXPIRED: "expired",
            GIFT: "gift"
        };
        static TWITCH_APP_CLIENT_ID = "lxn2nh0bxpwhqnmo840o0pf9bzotgu";
        static TWITCH_APP_REDIRECT_URI = "https://gpmod.github.io/twitch-token-auth?WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW";
        static TWITCH_AUTH_URL = `https://id.twitch.tv/oauth2/authorize?client_id=${this.TWITCH_APP_CLIENT_ID}&redirect_uri=${encodeURIComponent(this.TWITCH_APP_REDIRECT_URI)}&response_type=token&scope=`;
        static LANGUAGES = {
            ru: "\u0420\u0443\u0441\u0441\u043a\u0438\u0439",
            en: "English",
            es: "Espa\u00f1ol"
        };
        static RELOAD_BTN_L10N = {
            ru: "\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c",
            en: "Reload page",
            es: "Recarga la pesta\u00f1a"
        };
        static DEFAULT_SETTINGS = {
            disabledList: [],
            twitchAuth: null,
            allowAnalytics: !1,
            lastAuthSuccess: null
        };
        static MODULE = {
            title: "Modules Manager",
            alias: "mm",
            settings: {
                storage: "gp_mm",
                defaultSettings: this.DEFAULT_SETTINGS
            }
        };
        constructor(a, b) {
            super();
            this.loc = new GPLocalization_(b);
            this.l = this.loc.get(this.constructor.name);
            this.lang =
                this.loc.getLang();
            this.settingsManager = new GPSettingsManager_(this, this.loc.get("GPSettingsManager_"));
            this.s = this.settingsManager.setSettings(this);
            this.disabledList = new Set(this.s.disabledList);
            this.modules = [];
            this.lm = [];
            this.hiddenSettings = new Set;
            this.initialState = {};
            this.rootThis;
            this.publicKey;
            this.pasteKey = null;
            this.onMListClick = this.onMListClick.bind(this);
            this.renderModulesList = this.renderModulesList.bind(this);
            this.renderError = this.renderError.bind(this);
            this.toggleSettingsVisibility = this.toggleSettingsVisibility.bind(this);
            this.reloadBtnClickHandler = this.reloadBtnClickHandler.bind(this);
            this.addEventListener("modules-loaded", ({
                detail: {
                    decryptedData: c,
                    authTypeId: d,
                    isAuthorized: e,
                    isSubscribed: f
                }
            }) => {
                this.settingsManager.initImporterExporter(this.root.abt.getVersion(), this.root.gpproxy.getNickname());
                this.root.gpproxy.requestRejoinEvent();
                document.dispatchEvent(new Event("_modules-loaded"));
                document.dispatchEvent(new CustomEvent("_analytics-report", {
                    detail: {
                        mv: this.root.abt.getVersion(),
                        kh: this.root.act.getKeyHash(),
                        ke: c.e ??
                            null,
                        kg: Number(c.g ?? !1),
                        km: Number(c.m ?? !1),
                        at: d,
                        af: Number(e),
                        ss: Number(f)
                    }
                }))
            });
            document.addEventListener("_auth_id", async ({
                detail: {
                    authId: c,
                    authTypeId: d,
                    isAuthorized: e
                }
            }) => {
                function f(p) {
                    this.lm = this.lm.filter(t => 1 << t.id & p ? (t.disabled || t.initialized || this.initModuleInstance(t, this.root, this.loc.get(t.name)), t.locked = !1) : t.locked = !0);
                    this.renderModulesList()
                }
                async function g(p, t) {
                    t = (new TextEncoder).encode(t);
                    var v = await crypto.subtle.digest("SHA-256", t);
                    t = window.atob(p).slice(0, 12);
                    t = {
                        name: "AES-GCM",
                        iv: new Uint8Array(Array.from(t).map(w => w.charCodeAt(0)))
                    };
                    v = await crypto.subtle.importKey("raw", v, t, !1, ["decrypt"]);
                    p = window.atob(p).slice(12);
                    p = new Uint8Array(Array.from(p).map(w => w.charCodeAt(0)));
                    try {
                        const w = await crypto.subtle.decrypt(t, v, p);
                        return (new TextDecoder).decode(w)
                    } catch (w) {
                        throw new GPDecryptError_;
                    }
                }

                function h(p) {
                    document.dispatchEvent(new CustomEvent("_auth_perms", {
                        detail: {
                            ps: p
                        }
                    }))
                }
                async function k(p) {
                    p = await g(p, l());
                    return fetch("https://id.twitch.tv/oauth2/validate", {
                        headers: {
                            Authorization: `OAuth ${p}`
                        },
                        credentials: "omit",
                        cache: "no-cache"
                    }).then(t => {
                        if (t.ok) return t.json();
                        throw Error();
                    }).then(t => [t.user_id, t.login]).catch(() => [])
                }

                function l() {
                    function p(x, A) {
                        const C = t();
                        return p = function(I, M) {
                            I -= 195;
                            let B = C[I];
                            void 0 === p.IvNImK && (p.biwoho = function(D) {
                                let F = "",
                                    H = "";
                                for (let J = 0, L, K, N = 0; K = D.charAt(N++); ~K && (L = J % 4 ? 64 * L + K : K, J++ % 4) ? F += String.fromCharCode(255 & L >> (-2 * J & 6)) : 0) K = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(K);
                                for (let J = 0, L = F.length; J < L; J++) H += "%" + ("00" + F.charCodeAt(J).toString(16)).slice(-2);
                                return decodeURIComponent(H)
                            }, x = arguments, p.IvNImK = !0);
                            const G = I + C[0],
                                E = x[G];
                            return E ? B = E : (B = p.biwoho(B), x[G] = B), B
                        }, p(x, A)
                    }

                    function t() {
                        const x = "mZmYvMvlr1vW yxrVyG ndq1mJu4offSB0n4Aa mJqZnZKYvwvXC0TJ yJnoAMni uNbIv1zhyJnkDa vMHAmLu9 yuDgEvPi zgHKrZL5 EeLAv2XUyuHrpq yKDgDvOZ mJmZmtvWze92EgO EdjAv1jqy0HsCa uKDgmfPw BwfW mJm0BNnKqvHr zfHoBgnR yvCXmwjb nZyYmZG4ohvMwM96ra rM5AvZuWuKDgma zgHJBvzeyJi1AG sw50Ba nM9RwxbMEq mJCZody2mhjjweLLrq y21wEMiY y0D4Agrh wvHrpq mZu3m1nVA1f5Bq zeDSDfPw wvHAAgfx wKDwmMfx y2HHCKnVzgvbDa mZy4mZCXu1LtDvvr yM1gmMfx".split(" ");
                        t = function() {
                            return x
                        };
                        return t()
                    }(function(x, A) {
                        const C = p;
                        for (x = x();;) try {
                            if (parseInt(C(219)) / 1 + parseInt(C(202)) / 2 * (-parseInt(C(214)) / 3) + -parseInt(C(221)) / 4 * (-parseInt(C(198)) / 5) + parseInt(C(209)) / 6 * (parseInt(C(223)) / 7) + -parseInt(C(205)) / 8 + -parseInt(C(224)) / 9 + parseInt(C(210)) / 10 === A) break;
                            else x.push(x.shift())
                        } catch (I) {
                            x.push(x.shift())
                        }
                    })(t, 545929);
                    const v = p,
                        w = [v(220) + v(195), v(203) + (v(206) + "YQ=="), "", "", v(212) + "Zvcm0=", v(228) + (v(207) + "dXJyZW5jeQ=="), "c2NyZWVu", v(216) + "xXaWR0aA==", "YXZhaW" + v(196),
                            v(197) + v(227), "", v(225) + "U=", v(217) + "NlTWVtb3J5", v(200) + (v(226) + v(213)), v(211) + (v(199) + "b25z"), v(215) + "pvbmU=", v(204) + "=="
                        ][v(201)](window[v(222)]),
                        u = JSON.stringify([window[w[0]][w[1]]?.[w[4]], window[w[0]][w[5]], window[w[6]][w[7]], window[w[6]][w[8]], window[w[0]][w[9]], window[w[0]][w[4]], window[w[0]][w[11]], window[w[0]][w[12]], (new(window[v(208)]?.[w[13]]))[w[14]]()[w[15]]]);
                    let y = -559038803,
                        z = 1103547925;
                    for (let x = 0, A; x < u.length; x++) A = u[v(218)](x), y = Math[w[16]](y ^ A, 2654435761), z = Math[w[16]](z ^ A, 1597334677);
                    return y = Math[w[16]](y ^ y >>> 16, 2246822507) ^ Math[w[16]](z ^ z >>> 13, 3266489909), z = Math[w[16]](z ^ z >>> 16, 2246822507) ^ Math[w[16]](y ^ y >>> 13, 3266489909), String(4294967296 * (2097151 & z) + (y >>> 0))
                }
                if (this.s.allowAnalytics) {
                    var m = !1,
                        n = {};
                    if (this.lm.length) {
                        var r = GPModulesManager_.DEFAULT_PERMISSIONS,
                            q = null;
                        try {
                            if (!a || !this.publicKey) throw q = [GPModulesManager_.STATE.KEY], new GPAuthError_;
                            if (!d)
                                if (this.s.twitchAuth) {
                                    d = 1;
                                    const [v, w] = await k(this.s.twitchAuth);
                                    if (c = v) this.root.gpproxy.setTwitchOAuth(w);
                                    else throw this.s.twitchAuth =
                                        null, this.root.abt?.showTwitchOAuthTokenNotice({
                                            onButtonClick: () => {
                                                this.requestTwitchToken()
                                            }
                                        }), new GPAuthError_;
                                }
                            const p = 1 === d ? "t" : "d";
                            n = JSON.parse(await g(a, this.publicKey));
                            const t = JSON.parse(await g(n[p], c));
                            n.e && this.setEditionTitle("Black Bird", n.m);
                            n.g && (q = [GPModulesManager_.STATE.GIFT]);
                            if (t.ed) {
                                if (t.ed < Date.now()) throw q = [GPModulesManager_.STATE.EXPIRED], 2 & t.p && (r |= 16), new GPAuthError_;
                                q = [GPModulesManager_.STATE.TIME_LEFT, t.ed - Date.now()]
                            } else n.g || (q = [GPModulesManager_.STATE.SUBSCRIPTION]);
                            q && this.setEditionState(...q);
                            f.call(this, r | t.p);
                            h.call(this, r | t.p);
                            this.renderModulesList();
                            m = !0
                        } catch (p) {
                            p instanceof GPAuthError_ || p instanceof GPDecryptError_ || console.error(p), e ? q ??= [GPModulesManager_.STATE.SUBSCRIBE] : this.publicKey && (q ??= [GPModulesManager_.STATE.AUTH]), q && this.setEditionState(...q), f.call(this, r), h.call(this, r)
                        }
                        this.dispatchEvent(new CustomEvent("modules-loaded", {
                            detail: {
                                decryptedData: n,
                                authTypeId: d,
                                isAuthorized: e,
                                isSubscribed: m
                            }
                        }));
                        this.handleSubExpiration(q)
                    } else this.dispatchEvent(new CustomEvent("modules-loaded", {
                        detail: {
                            decryptedData: n,
                            authTypeId: d,
                            isAuthorized: e,
                            isSubscribed: m
                        }
                    }))
                } else this.setEditionState(GPModulesManager_.STATE.ANALYTICS), this.root.abt?.showAnalyticsNotice()
            });
            document.addEventListener("_auth_key_changed", c => {
                this.container.classList.add("reload-required_")
            });
            document.addEventListener("_auth_key", ({
                detail: {
                    publicKey: c
                }
            }) => {
                this.publicKey = c
            });
            document.addEventListener("_act_init", ({
                detail: {
                    pasteKey: c
                }
            }) => {
                this.pasteKey = c
            });
            document.addEventListener("_analytics-consent-granted", () => {
                this.s.allowAnalytics = !0;
                this.reloadPage(!0)
            });
            window.addEventListener("message", c => {
                "https://gpmod.github.io" !== c.origin && "https://localhost" !== c.origin || "gp-twitch-auth" !== c.data?.type || (this.twitchAuthWindow.postMessage({
                    type: "close"
                }, c.origin), this.twitchAuthWindow = null, this.s.twitchAuth = c.data.token, this.reloadPage())
            });
            this.firstRunInit();
            this.render()
        }
        getElement() {
            return this.container
        }
        getSettingsManager() {
            return this.settingsManager
        }
        render() {
            this.container = document.createElement("div");
            this.container.className =
                "gp-mm_";
            this.container.style.setProperty("--icon-analytics-label", `'${this.l.ICON_ANALYTICS_LBL}'`);
            this.container.style.setProperty("--icon-key-label", `'${this.l.ICON_KEY_LBL}'`);
            this.container.style.setProperty("--icon-auth-label", `'${this.l.ICON_AUTH_LBL}'`);
            this.container.style.setProperty("--icon-sign-in-label", `'${this.l.ICON_SIGN_IN_LBL}'`);
            this.container.style.setProperty("--icon-subscribe-label", `'${this.l.ICON_SUBSCRIBE_LBL}'`);
            this.container.style.setProperty("--icon-subscription-label",
                `'${this.l.ICON_SUBSCRIPTION_LBL}'`);
            this.container.style.setProperty("--icon-expired-label", `'${this.l.ICON_EXPIRED_LBL}'`);
            this.container.style.setProperty("--icon-gift-label", `'${this.l.ICON_GIFT_LBL}'`);
            this.edition = document.createElement("div");
            this.edition.className = "edition_ hidden";
            this.edition.addEventListener("click", g => {
                switch (this.container.dataset.state) {
                    case GPModulesManager_.STATE.SUBSCRIBE:
                    case GPModulesManager_.STATE.EXPIRED:
                        g = document.createElement("a");
                        g.href = "https://boosty.to/gpmod";
                        g.target = "_blank";
                        g.click();
                        break;
                    case GPModulesManager_.STATE.AUTH:
                        this.requestTwitchToken();
                        break;
                    case GPModulesManager_.STATE.KEY:
                        this.container.classList.contains("key-input-opened_") || this.keyBtn.click()
                }
            });
            this.container.appendChild(this.edition);
            this.editionTitle = document.createElement("div");
            this.editionTitle.className = "edition-title_";
            this.edition.appendChild(this.editionTitle);
            this.setEditionTitle("base");
            var a = document.createElement("div");
            a.className = "ribbon_";
            this.edition.appendChild(a);
            this.modulesList = document.createElement("div");
            this.modulesList.className = "modules-list_";
            this.modulesList.addEventListener("pointerup", this.onMListClick);
            this.container.appendChild(this.modulesList);
            this.reloadBtn = document.createElement("div");
            this.reloadBtn.className = "gp-ui-btn_ reload-btn_";
            this.reloadBtn.classList.add("disabled_");
            this.reloadBtn.textContent = this.l.RELOAD_BTN_LBL;
            this.reloadBtn.addEventListener("click", this.reloadBtnClickHandler);
            this.container.appendChild(this.reloadBtn);
            a = document.createElement("div");
            a.className = "footer_";
            this.container.appendChild(a);
            var b = document.createElement("div");
            b.className = "buttons_";
            a.appendChild(b);
            const c = document.createElement("div");
            c.className = "show-btn_ gp-module-btn_ btn_";
            c.title = this.l.MODULE_BTN_TTL;
            c.addEventListener("pointerup", g => {
                g = this.container.classList.contains("shown_");
                this.container.classList.toggle("shown_", !g);
                g && (this.settingsManager.close(), this.settingsManager.closeImporter());
                c.classList.toggle("pressed_", !g)
            });
            b.appendChild(c);
            this.settingsBtn =
                document.createElement("div");
            this.settingsBtn.className = "settings-btn_ btn_";
            this.settingsBtn.title = this.l.SETTINGS_BTN_TTL;
            this.settingsBtn.addEventListener("pointerup", g => {
                this.settingsManager.toggle(void 0, void 0, g.ctrlKey || 1 === g.button)
            });
            b.appendChild(this.settingsBtn);
            this.keyBtn = document.createElement("div");
            this.keyBtn.className = "key-btn_ btn_";
            this.keyBtn.title = this.l.KEY_BTN_TTL;
            this.keyBtn.addEventListener("click", g => {
                g = !this.container.classList.contains("key-input-opened_");
                this.container.classList.toggle("key-input-opened_",
                    g);
                g && this.keyInput.focus();
                this.settingsManager.close()
            });
            this.keyBtn.addEventListener("pointerdown", g => {
                this.keyInput.preventHiding = !0
            });
            b.appendChild(this.keyBtn);
            this.keyInput = document.createElement("input");
            this.keyInput.className = "key-input_ gp-ui-input_ secure-input_";
            this.keyInput.placeholder = this.l.KEY_INPUT_PH;
            this.keyInput.spellcheck = !1;
            this.keyInput.autocomplete = "off";
            this.keyInput.preventHiding = !1;
            this.keyInput.addEventListener("input", g => {
                if (this.pasteKey) {
                    g = g.target.value.trim();
                    var h =
                        this.pasteKey(g);
                    this.container.classList.toggle("key-input-opened_", !h);
                    this.keyInput.classList.toggle("invalid_", g && !h)
                }
            });
            this.keyInput.addEventListener("keydown", g => {
                switch (g.key) {
                    case "Escape":
                        g.target.blur()
                }
            });
            this.keyInput.addEventListener("focus", g => {
                g.target.value = "";
                g.target.preventHiding = !1
            });
            this.keyInput.addEventListener("blur", g => {
                g.target.value = "";
                g.target.classList.remove("invalid_");
                g.target.preventHiding ? g.target.preventHiding = !1 : this.container.classList.remove("key-input-opened_")
            });
            GPUtils_.setInputFocusBlurHandler(this.keyInput);
            this.container.appendChild(this.keyInput);
            this.langBtn = document.createElement("div");
            this.langBtn.className = "lang-btn_ btn_";
            this.langBtn.title = this.l.LANGUAGE_BTN_TTL;
            this.langBtn.dataset.lang = this.lang;
            this.langBtn.addEventListener("pointerdown", g => {
                0 === g.button && (this.langBtn.classList.add("shown_"), this.settingsManager.close(), this.langBtn.classList.contains("shown_") && document.addEventListener("click", h => {
                    document.addEventListener("pointerdown",
                        k => {
                            this.langBtn.classList.remove("shown_")
                        }, {
                            once: !0,
                            capture: !0
                        })
                }, {
                    once: !0
                }))
            });
            b.appendChild(this.langBtn);
            const d = document.createElement("div");
            d.className = "lang-list_";
            d.addEventListener("click", g => {
                this.langBtn.classList.remove("shown_")
            });
            d.addEventListener("pointerup", g => {
                if (g.target.classList.contains("btn_")) {
                    var h = g.target.dataset.lang,
                        k = h !== this.lang;
                    this.langBtn.dataset.lang = h;
                    k && (this.setLanguage(h), Array.from(d.children).forEach(l => {
                        l.classList.toggle("selected_", l === g.target)
                    }), this.langBtn.classList.remove("shown_"))
                }
            });
            Object.entries(GPModulesManager_.LANGUAGES).forEach(([g, h]) => {
                const k = document.createElement("div");
                k.className = "btn_";
                k.title = h;
                k.dataset.lang = g;
                d.appendChild(k);
                g === this.lang && k.classList.add("selected_")
            });
            this.langBtn.appendChild(d);
            const e = document.createElement("div");
            e.className = "dots-btn_ btn_";
            e.addEventListener("pointerdown", g => {
                0 === g.button && (e.classList.add("shown_"), this.settingsManager.close(), e.classList.contains("shown_") && document.addEventListener("click", h => {
                    document.addEventListener("pointerdown",
                        k => {
                            e.classList.remove("shown_")
                        }, {
                            once: !0,
                            capture: !0
                        })
                }, {
                    once: !0
                }))
            });
            b.appendChild(e);
            b = document.createElement("div");
            b.className = "dots-menu_";
            b.addEventListener("click", g => {
                e.classList.remove("shown_")
            });
            b.addEventListener("pointerup", g => {
                g.target.classList.contains("btn_") && e.classList.remove("shown_")
            });
            e.appendChild(b);
            var f = document.createElement("div");
            f.className = "export-btn_ btn_";
            f.title = this.l.EXPORT_SETTIGNS_TTL;
            f.addEventListener("pointerup", g => {
                this.settingsManager.exportSettings()
            });
            b.appendChild(f);
            f = document.createElement("div");
            f.className = "import-btn_ btn_";
            f.title = this.l.IMPORT_SETTIGNS_TTL;
            f.addEventListener("pointerup", g => {
                this.settingsManager.importSettings()
            });
            b.appendChild(f);
            b = document.createElement("div");
            b.className = "title_";
            b.textContent = this.l.WIN_TITLE;
            a.appendChild(b);
            document.body.appendChild(this.container)
        }
        setEditionTitle(a, b = !1) {
            this.editionTitle.textContent = `${a} ed.`;
            this.edition.classList.toggle("demo_", !!b);
            this.edition.classList.remove("hidden")
        }
        setEditionState(a,
            b) {
            this.container.dataset.state = a;
            this.edition.title = "";
            switch (a) {
                case GPModulesManager_.STATE.TIME_LEFT:
                    this.edition.dataset.timeLeft = this.formatTimeLeft(b);
                    break;
                case GPModulesManager_.STATE.EXPIRED:
                    this.edition.title = this.l.BOOSTY_ICON_TTL;
                    break;
                case GPModulesManager_.STATE.KEY:
                    this.edition.title = this.l.KEY_BTN_TTL
            }
        }
        formatTimeLeft(a) {
            const b = this.l.SUB_DAYS_LEFT.split("|");
            a = Math.trunc(a / 864E5);
            switch (this.l.lang) {
                case GPLocalization_.LANGUAGE.RU:
                    const d = a % 100;
                    var c = d % 10;
                    let e;
                    if (10 <= d && 20 > d) e =
                        2;
                    else if (1 === c) e = 0;
                    else if (1 < c && 5 > c) e = 1;
                    else if (!c || 4 < c) e = 2;
                    c = [b[2], b[3], b[4]];
                    return `${e?b[1]:b[0]} ${1>d?b[5]:`${a} ${c[e]}`}`;
                case GPLocalization_.LANGUAGE.ES:
                    return 1 > a ? b[3] : `${b[0]} ${a} ${1===a?b[1]:b[2]}`;
                default:
                    return 1 > a ? b[3] : `${a} ${1===a?b[1]:b[2]} ${b[0]}`
            }
        }
        onMListClick(a) {
            2 === a.button ? a.preventDefault() : a.target.matches(":not(.no-settings_) > :is(.name_, .settings_)") && this.settingsManager.toggle(!0, a.target.dataset.module, a.ctrlKey || 1 === a.button)
        }
        compareToInitialState() {
            const a = [...this.modulesList.querySelectorAll(".gp-ui-cb_")].some(b =>
                b.checked !== this.initialState[b.name]);
            this.reloadBtn.classList.toggle("alert_", a);
            this.reloadBtn.classList.toggle("disabled_", !a)
        }
        reloadBtnClickHandler(a) {
            this.reloadPage(GPModulesManager_.FORCE_RELOAD)
        }
        reloadPage(a = !0) {
            a && (window.onbeforeunload = null);
            if (1 < this.root.gpproxy.getUsers().length) {
                a = location.pathname.indexOf("/", 1);
                a = location.pathname.slice(1, ~a ? a : void 0);
                a = 2 === a.length ? a : "en";
                const b = this.root.gpproxy.getUser().access;
                location.replace(`${location.origin}/${a}/?c=${b}`)
            } else location.reload()
        }
        setModules(a,
            b, c) {
            this.modules = a;
            this.rootThis = b;
            this.root = c;
            this.initDisabledList();
            this.initHiddenSettings();
            const d = this.initModule(this.modules.find(e => "GPProxy_" === e.name), b, c);
            d.addEventListener("presets", () => {
                this.initModules(this.modules, b, c).then(() => {
                    this.renderModulesList();
                    d.requestAuthId()
                }).catch(e => {
                    console.error(e);
                    e instanceof GPModuleError_ && this.renderError(e)
                })
            }, {
                once: !0
            })
        }
        async initModules(a, b, c) {
            a.forEach(d => {
                this.initModule(d, b, c)
            })
        }
        initModule(a, b, c) {
            if (!a.initialized) {
                b = window[a.name];
                this.initialState[a.name] = this.disabledList.has(a.name) && !a.required ? !1 : !0;
                var d = a.name in window;
                d && (a.title = b.MODULE.title);
                a.loaded = d;
                if (a.loaded) {
                    if (a.required) return this.initModuleInstance(a, c, this.loc.get(a.name));
                    a.locked = !0;
                    this.lm.push(a)
                } else if (!d) {
                    if (a.required) throw new GPModuleError_(`\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c "${a.name}" \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d`);
                    console.error(`\u041c\u043e\u0434\u0443\u043b\u044c "${a.name}" \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d`)
                }
            }
        }
        initModuleInstance(a,
            b, c) {
            const d = window[a.name];
            d.MODULE?.useCSS && window.content?.classList.add(`gpm-${d.MODULE.alias}_`);
            b = b[d.MODULE.alias] = new d(b, c);
            d.toggleSettingsVisibility = this.toggleSettingsVisibility(a);
            a.initialized = !0;
            return b
        }
        toggleSettingsVisibility(a) {
            return b => {
                a.hiddenSettings === b && (a.hiddenSettings = !b, a.hidden || a.hiddenSettings ? this.hiddenSettings.add(a.name) : this.hiddenSettings.delete(a.name), this.renderModulesList(), this.settingsManager.updateSettingsList())
            }
        }
        initDisabledList() {
            let a = !1;
            this.modules.forEach(b => {
                b.disabled ? (this.disabledList.add(b.name), a = !0) : this.disabledList.has(b.name) && (b.disabled = !0)
            });
            a && (this.s.disabledList = Array.from(this.disabledList))
        }
        initHiddenSettings() {
            this.hiddenSettings.clear();
            this.modules.forEach(a => {
                (a.hidden || a.hiddenSettings) && this.hiddenSettings.add(a.name)
            })
        }
        renderModulesList() {
            const a = document.createDocumentFragment(),
                b = new Intl.Collator("us", {
                    sensitivity: "base"
                });
            this.modules.sort((c, d) => {
                const [e, f] = [!c.locked, !d.locked];
                return e && f || !e && !f ? b.compare(c.title, d.title) :
                    e && !f ? -1 : 1
            });
            this.modules.forEach((c, d) => {
                if (!c.hidden) {
                    var e = this.settingsManager.hasSettings(c.name),
                        f = document.createElement("div");
                    f.className = "module_";
                    f.classList.toggle("locked_", !!c.locked);
                    f.classList.toggle("not-loaded_", !c.loaded);
                    f.classList.toggle("no-settings_", !!c.hiddenSettings || !e);
                    e = document.createElement("div");
                    e.className = "desc_";
                    e.textContent = "?";
                    e.addEventListener("pointerenter", k => {
                        let l = window.gpSettingsTooltip;
                        l || (l = document.createElement("div"), l.className = "gp-ui-tooltip_",
                            document.body.appendChild(l), window.gpSettingsTooltip = l);
                        l.textContent = this.loc.get(c.name).DESCRIPTION;
                        const {
                            x: m,
                            y: n,
                            width: r,
                            height: q
                        } = k.target.getBoundingClientRect();
                        ({
                            height: k
                        } = l.getBoundingClientRect());
                        l.style.cssText = `top: ${n-(k-q)/2}px; left: ${m+r+12}px`;
                        window.gpSettingsTooltip = l
                    });
                    e.addEventListener("pointerleave", k => {
                        window.gpSettingsTooltip && (window.gpSettingsTooltip.remove(), window.gpSettingsTooltip = null)
                    });
                    f.appendChild(e);
                    e = document.createElement("div");
                    e.className = "name_";
                    e.title =
                        c.loaded ? "" : "\u041c\u043e\u0434\u0443\u043b\u044c \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d";
                    e.dataset.module = c.name;
                    e.textContent = c.title;
                    f.appendChild(e);
                    e = document.createElement("div");
                    e.className = "settings_";
                    e.dataset.module = c.name;
                    e.textContent = "\ue92d";
                    f.appendChild(e);
                    var g = this.initialState[c.name];
                    e = document.createElement("div");
                    e.className = "checkbox_";
                    var h = document.createElement("input");
                    h.className = "gp-ui-cb_";
                    h.id = `module-${d}_`;
                    h.type = "checkbox";
                    h.checked = g;
                    h.toggleAttribute("checked",
                        !!g);
                    h.toggleAttribute("disabled", !!c.required);
                    h.addEventListener("change", k => {
                        c.required || (k.target.checked && this.disabledList.has(c.name) ? (c.disabled = !1, this.disabledList.delete(c.name)) : (c.disabled = !0, this.disabledList.add(c.name)), this.s.disabledList = Array.from(this.disabledList), this.compareToInitialState())
                    });
                    e.appendChild(h);
                    g = document.createElement("label");
                    g.className = "gp-ui-cb-label_";
                    g.setAttribute("for", `module-${d}_`);
                    e.appendChild(g);
                    f.appendChild(e);
                    a.appendChild(f)
                }
            });
            this.settingsBtn.classList.toggle("hidden",
                !this.settingsManager.hasModulesSettings());
            this.modulesList.innerHTML = "";
            this.modulesList.appendChild(a)
        }
        renderError(a) {
            const b = document.createElement("div");
            b.className = "error_";
            b.innerHTML = `<div class="error-msg_">${a.message}</div>`;
            this.modulesList.before(b);
            this.modulesList.remove()
        }
        handleSubExpiration(a) {
            a && (a[0] === GPModulesManager_.STATE.SUBSCRIPTION || a[0] === GPModulesManager_.STATE.TIME_LEFT || a[0] === GPModulesManager_.STATE.GIFT ? this.s.lastAuthSuccess = !0 : a[0] === GPModulesManager_.STATE.EXPIRED &&
                (!0 === this.s.lastAuthSuccess && this.root.abt?.showSubExpiredNotice(), this.s.lastAuthSuccess = !1))
        }
        requestTwitchToken() {
            this.twitchAuthWindow?.close();
            this.twitchAuthWindow = window.open(GPModulesManager_.TWITCH_AUTH_URL)
        }
        areHiddenSettings(a) {
            return this.hiddenSettings.has(a)
        }
        setLanguage(a) {
            this.lang = a;
            var b = this.lang !== this.loc.getLang();
            this.reloadBtn.classList.toggle("alert_", b);
            this.reloadBtn.classList.toggle("disabled_", !b);
            if (b = GPModulesManager_.RELOAD_BTN_L10N[a]) this.reloadBtn.textContent = b;
            localStorage.setItem("gp_localization",
                JSON.stringify({
                    lang: a
                }))
        }
        firstRunInit() {
            let a = JSON.parse(localStorage.getItem("gp_first-run"));
            !1 !== a && (a = !a, localStorage.setItem("gp_first-run", JSON.stringify(a)));
            this.firstRun = a
        }
        isFirstRun() {
            return this.firstRun
        }
    }
    class GPModuleError_ extends Error {
        constructor(a) {
            super(a)
        }
    }
    class GPAuthError_ extends Error {
        constructor(a) {
            super(a)
        }
    }
    class GPDecryptError_ extends Error {
        constructor(a) {
            super(a)
        }
    };
    class GPSettingsImporterExporter_ extends EventTarget {
        static CATEGORIES = {
            "internal settings": ["gp_latest-version", "gp_first-run", "gp_localization", "avatar", "gp_about"],
            key: ["gp_activation"],
            background: ["gp_background", "gp_background_db"],
            modules: {
                "anti-cheat": ["gp_anti-cheat"],
                "art broadcaster": ["gp_art-broadcaster"],
                avatars: ["gp_avatars"],
                "global banlist": ["gp_global-banlist"],
                moderation: ["ul_banlist", "gp_userlist", "gp_users_db"],
                painter: ["gp_painter", "gp_painter_bindings", "gp_custom-palettes", "gp_painter_custom-palette"],
                reference: ["gp_reference"],
                "timelapse player": ["gp_timelapse-player", "gp-timelapse-player-speed"],
                timer: ["gp_timer"],
                "modules manager": ["gp_mm"]
            }
        };
        static UNSPECIFIED_CATEGORY = "internal settings";
        static IGNORED_STORAGES = ["gp_auth-filename", "gp_update"];
        static STATIC_STORAGES = ["avatar", "ul_banlist"];
        static STATIC_DATABASES = ["gp_background_db", "gp_users_db"];
        constructor(a) {
            super();
            this.l = a;
            this.categoryMap = this.sortingMap = this.importer = null
        }
        init(a, b, c) {
            this.mm = a;
            this.appVersion = b;
            this.username = c
        }
        exportSettings() {
            const a =
                Object.keys(localStorage).filter(b => (b.startsWith("gp_") && !GPSettingsImporterExporter_.IGNORED_STORAGES.includes(b) || GPSettingsImporterExporter_.STATIC_STORAGES.includes(b)) && this.filterStorage(b)).map(b => this.cleanStorage(b));
            window.indexedDB.databases().then(b => {
                b = b.filter(c => GPSettingsImporterExporter_.STATIC_DATABASES.includes(c.name)).map(c => {
                    const d = window.indexedDB.open(c.name, c.version);
                    return new Promise(e => {
                        d.onsuccess = f => {
                            const g = f.target.result;
                            f = this.filterDBStores(g).map(h => new Promise(k => {
                                const l = g.transaction(h, "readonly").objectStore(h);
                                l.getAll().onsuccess = m => {
                                    k({
                                        name: l.name,
                                        keyPath: l.keyPath,
                                        autoIncrement: l.autoIncrement,
                                        indexes: [...l.indexNames].map(n => {
                                            const {
                                                name: r,
                                                keyPath: q,
                                                unique: p,
                                                multiEntry: t
                                            } = l.index(n);
                                            return {
                                                name: r,
                                                keyPath: q,
                                                unique: p,
                                                multiEntry: t
                                            }
                                        }),
                                        entries: m.target.result
                                    })
                                }
                            }));
                            Promise.all(f).then(h => e({
                                name: g.name,
                                version: g.version,
                                stores: h
                            }))
                        }
                    })
                });
                Promise.all(b).then(async c => {
                    var d = await this.serializeSettings(a, c);
                    c = `gpmod settings (${this.username}).gpset`;
                    d = URL.createObjectURL(d);
                    const e = document.createElement("a");
                    e.href = d;
                    e.download = c;
                    e.click();
                    URL.revokeObjectURL(d)
                })
            })
        }
        filterStorage(a) {
            switch (a) {
                case "gp_mm":
                    return a = JSON.parse(localStorage.getItem(a) || null), !!a && !(1 === Object.keys(a).length && a.disabledList && !a.disabledList.length);
                case "gp_auth-filename":
                    return !!JSON.parse(localStorage.getItem(a) || null);
                case "ul_banlist":
                    return !!JSON.parse(localStorage.getItem(a) || null)?.length;
                default:
                    return !0
            }
        }
        cleanStorage(a) {
            switch (a) {
                case "gp_localization":
                    const b = JSON.parse(localStorage.getItem("gp_localization")).lang;
                    return [a, JSON.stringify({
                        lang: b
                    })];
                default:
                    return [a, localStorage.getItem(a)]
            }
        }
        filterDBStores(a) {
            const b = Array.from(a.objectStoreNames);
            switch (a.name) {
                case "gp_background_db":
                    if (1 < b.length && b.indexOf("backgrounds_v3")) return a = b.indexOf("backgrounds"), ~a && b.splice(a, 1), b;
                default:
                    return b
            }
        }
        serializeSettings(a, b) {
            return new Promise(c => {
                const d = [];
                b = b.filter(e => e.stores.every(f => {
                    f.entries.forEach(g => {
                        g.blob && d.push(this.convertBlobToBase64(g.blob, g))
                    });
                    return f.entries.length
                }));
                Promise.all(d).then(async e => {
                    e.forEach(([f, g]) => {
                        g.blob = f
                    });
                    e = {
                        storages: a,
                        databases: b,
                        meta: {
                            username: this.username,
                            version: this.appVersion,
                            timestamp: Date.now()
                        }
                    };
                    e = await GPUtils_.compressData(e);
                    c(e)
                })
            })
        }
        convertBlobToBase64(a, b) {
            return new Promise(c => {
                const d = new FileReader;
                d.readAsDataURL(a);
                d.onloadend = () => {
                    c([d.result, b])
                }
            })
        }
        importSettings() {
            const a = document.createElement("input");
            a.type = "file";
            a.accept = ".gpset";
            a.addEventListener("change", async b => {
                if (b = b.target.files?.[0]) {
                    const {
                        storages: c,
                        databases: d,
                        meta: e
                    } = await this.deserializeSettings(b);
                    this.openImporter(c, d, e)
                }
            });
            this.closeImporter();
            a.click()
        }
        deserializeSettings(a) {
            return new Promise(async b => {
                const {
                    storages: c,
                    databases: d,
                    meta: e
                } = await GPUtils_.decompressFile(a), f = [];
                d.forEach(g => {
                    g.stores.forEach(h => {
                        h.entries.forEach(k => {
                            k.blob && f.push(this.convertBase64ToBlob(k.blob, k))
                        })
                    })
                });
                Promise.all(f).then(g => {
                    g.forEach(([h, k]) => {
                        k.blob = h
                    });
                    b({
                        storages: c,
                        databases: d,
                        meta: e
                    })
                })
            })
        }
        applySettings(a, b) {
            a && a.forEach(([c, d]) => {
                ("gp_update" !== c || this.shouldUpdateStorageBeImported()) && localStorage.setItem(c,
                    d)
            });
            b && (a = b.map(c => new Promise((d, e) => {
                const f = window.indexedDB.open(c.name, c.version),
                    g = c.stores;
                f.onupgradeneeded = h => {
                    const k = h.target.result;
                    g.map(l => {
                        const m = k.createObjectStore(l.name, {
                            keyPath: l.keyPath,
                            autoIncrement: l.autoIncrement
                        });
                        l.indexes.forEach(n => {
                            const {
                                name: r,
                                keyPath: q,
                                ...p
                            } = n;
                            m.createIndex(r, q, p)
                        })
                    })
                };
                f.onsuccess = h => {
                    const k = h.target.result;
                    h = g.map(l => new Promise(m => {
                        const n = k.transaction(l.name, "readwrite");
                        n.oncomplete = m;
                        const r = n.objectStore(l.name);
                        r.clear().onsuccess = () => {
                            l.entries.forEach((q,
                                p) => {
                                r.add(q, l.keyPath ? void 0 : p)
                            })
                        }
                    }));
                    Promise.all(h).then(d)
                };
                f.onerror = e
            })), Promise.allSettled(a).then(() => {
                this.mm.reloadPage()
            }))
        }
        convertBase64ToBlob(a, b) {
            return fetch(a).then(c => c.blob()).then(c => [c, b])
        }
        convertBlobToJSON(a) {
            return new Promise(b => {
                const c = new FileReader;
                c.readAsText(a);
                c.onloadend = () => {
                    b(JSON.parse(c.result))
                }
            })
        }
        shouldUpdateStorageBeImported() {
            return !localStorage.getItem("gp_update")
        }
        initImporter() {
            this.sortingMap = new Map;
            this.categoryMap = this.buildCategoryMap(GPSettingsImporterExporter_.CATEGORIES);
            this.renderImporter()
        }
        openImporter(a, b, c) {
            this.importer ? this.importer.classList.remove("hidden") : this.initImporter();
            const d = this.getImportedSettingsMap(a, b);
            this.renderImporterSettings(d, c);
            this.importBtn.onclick = () => {
                var e = new Set([...this.categories.elements].filter(f => f.checked).map(f => f.name));
                e = this.filterImporterSettings(a, b, d, e);
                this.applySettings(...e)
            }
        }
        filterImporterSettings(a, b, c, d) {
            const e = new Set([...c].filter(([f]) => d.has(f)).map(([, f]) => f).flat());
            return [a.filter(f => e.has(f[0])), b.filter(f =>
                e.has(f.name))]
        }
        getImportedSettingsMap(a, b) {
            a = a.map(d => d[0]);
            b = b.map(d => d.name);
            const c = new Map;
            [a, b].forEach(d => {
                d.forEach(e => {
                    const f = this.categoryMap.get(e) ?? GPSettingsImporterExporter_.UNSPECIFIED_CATEGORY,
                        g = c.get(f);
                    g ? g.push(e) : c.set(f, [e])
                })
            });
            return c
        }
        renderImporterSettings(a, b) {
            b = `${b.username} (${(new Date(b.timestamp)).toLocaleDateString()})`;
            this.importer.style.setProperty("--imported-settings-meta", `'${b}'`);
            this.categories.innerHTML = "";
            const c = document.createDocumentFragment();
            Array.from(a.keys()).sort((d,
                e) => this.sortingMap.get(d) - this.sortingMap.get(e)).forEach((d, e) => {
                const f = !(d in GPSettingsImporterExporter_.CATEGORIES),
                    g = "internal settings" === d;
                var h = f ? d : this.l[`IMPORTER_${d.toUpperCase().replace(/\s/g,"_")}`];
                const k = document.createElement("div");
                k.className = "category_";
                k.classList.toggle("disabled_", g);
                k.classList.toggle("module_", f);
                k.dataset.name = d;
                const l = document.createElement("div");
                l.className = "name_";
                l.textContent = h;
                l.addEventListener("click", n => {
                    g || (n.ctrlKey ? this.single\u0421ontrolClickHandler(n,
                        m) : m.click())
                });
                l.addEventListener("auxclick", n => {
                    g || 2 === n.button && this.single\u0421ontrolClickHandler(n, m)
                });
                k.appendChild(l);
                e = `gp-imp-cat-${e}_`;
                h = document.createElement("div");
                h.className = "checkbox_";
                k.appendChild(h);
                const m = document.createElement("input");
                m.type = "checkbox";
                m.id = e;
                m.className = "gp-ui-cb_";
                m.name = d;
                m.checked = !0;
                h.appendChild(m);
                g && (m.disabled = !0);
                d = document.createElement("label");
                d.className = "gp-ui-cb-label_";
                d.htmlFor = e;
                d.addEventListener("click", n => {
                    n.ctrlKey && this.single\u0421ontrolClickHandler(n,
                        n.target.control)
                });
                d.addEventListener("auxclick", n => {
                    2 === n.button && this.single\u0421ontrolClickHandler(n, n.target.control)
                });
                h.appendChild(d);
                f ? c.appendChild(k) : this.categories.appendChild(k)
            });
            c.childElementCount && (a = document.createElement("div"), a.className = "modules-label_", a.textContent = this.l.IMPORTER_MODULES, this.categories.appendChild(a), this.categories.appendChild(c))
        }
        "single\u0421ontrolClickHandler"(a, b) {
            a.preventDefault();
            const c = Array.from(this.categories.elements).every(d => d !== b ? d.disabled ||
                !d.checked : d.checked);
            Array.from(this.categories.elements).forEach(d => {
                d.disabled || (d.checked = d === b ? c ? !d.checked : !0 : !1)
            })
        }
        renderImporter() {
            const {
                x: a,
                width: b
            } = this.mm.getElement().getBoundingClientRect();
            var c = a + b + 24;
            this.importer = document.createElement("div");
            this.importer.className = "settings-importer_";
            this.importer.style.left = `${c}px`;
            c = document.createElement("div");
            c.className = "gp-ui-close-btn_";
            c.addEventListener("click", this.closeImporter.bind(this));
            this.importer.appendChild(c);
            var d = document.createElement("div");
            d.className = "title_";
            this.importer.appendChild(d);
            c = document.createElement("div");
            c.className = "label_";
            c.textContent = this.l.IMPORTER_TITLE;
            d.appendChild(c);
            c = document.createElement("div");
            c.className = "icon-wrapper_";
            d.appendChild(c);
            d = document.createElement("div");
            d.className = "ribbon_";
            c.appendChild(d);
            d = document.createElement("div");
            d.className = "icon_";
            c.appendChild(d);
            this.categories = document.createElement("form");
            this.categories.className = "categories_";
            this.categories.addEventListener("contextmenu",
                e => {
                    e.preventDefault()
                });
            this.importer.appendChild(this.categories);
            this.importBtn = document.createElement("div");
            this.importBtn.className = "import-btn_ gp-ui-btn_";
            this.importBtn.textContent = this.l.IMPORTER_IMPORT_BTN;
            this.importer.appendChild(this.importBtn);
            document.body.appendChild(this.importer)
        }
        closeImporter() {
            this.importer?.classList.add("hidden")
        }
        buildCategoryMap(a, b = new Map, c = 0) {
            Object.entries(a).forEach(([d, e]) => {
                Array.isArray(e) ? e.forEach(f => {
                    b.set(f, d);
                    this.sortingMap.set(d, c++)
                }) : b = new Map([...b,
                    ...this.buildCategoryMap(e, b, c)
                ])
            });
            return b
        }
    }
    window.GPSettingsImporterExporter_ = GPSettingsImporterExporter_;
    class GPSettingsManager_ extends EventTarget {
        static POINTER_SLIDER_PREVIEW_CHANGE_SENSITIVITY = Math.round(window.screen.height / 1080 * 15);
        constructor(a, b) {
            super();
            this.mm = a;
            this.l = b;
            this.views = new Set;
            this.viewsData = new Map;
            this.isRendered = !1;
            this.currentLabels = new Map;
            this.ie = new GPSettingsImporterExporter_(b);
            this.close = this.close.bind(this);
            this.addEventListener("update", ({
                detail: {
                    source: c,
                    storage: d,
                    settings: e,
                    changedSettings: f
                }
            }) => {
                c.dispatchEvent(new CustomEvent("settings_updated", {
                    detail: {
                        settings: f
                    }
                }));
                this.saveSettings(d, Object.assign({}, e, f))
            })
        }
        setSettings(a, b) {
            const {
                name: c,
                MODULE: {
                    title: d,
                    settings: {
                        storage: e,
                        defaultSettings: f,
                        ui: g = {}
                    }
                }
            } = a.constructor;
            b && a.addEventListener("settings_updated", b.bind(a));
            b = Object.assign({}, f, JSON.parse(localStorage.getItem(e)) || {});
            a.settings = b;
            const h = [...Object.values(g)].some(l => !l.hidden),
                k = this.copy(b);
            this.viewsData.set(c, {
                title: d,
                source: a,
                storage: e,
                settings: b,
                defaultSettings: f,
                initialSettings: k,
                ui: g,
                hasVisibleSettings: h
            });
            return this.buildSettingsAPI(c,
                b, g, e, a)
        }
        hasSettings(a) {
            return this.viewsData.has(a) && this.hasVisibleSettings(a)
        }
        hasModulesSettings() {
            return !!this.viewsData.size
        }
        buildSettingsAPI(a, b, c, d, e) {
            const f = this;
            return new Proxy(b, {
                set(g, h, k) {
                    k = {
                        [h]: k
                    };
                    Object.assign(g, k);
                    h = !(!c[h] || !0 === c[h].hidden);
                    f.dispatchEvent(new CustomEvent("update", {
                        detail: {
                            source: e,
                            storage: d,
                            settings: g,
                            changedSettings: k
                        }
                    }));
                    h && f.updateViews(a);
                    return !0
                },
                get(g, h) {
                    return g[h]
                }
            })
        }
        render(a, b = !1) {
            this.container = document.createElement("div");
            this.container.className =
                "gp-settings-manager_";
            this.container.classList.toggle("load-btn-shown_", b);
            b = document.createElement("div");
            b.className = "close-btn_ gp-ui-close-btn_";
            b.addEventListener("click", this.close);
            this.container.appendChild(b);
            this.modulesMenu = document.createElement("select");
            this.modulesMenu.className = "modules-menu_";
            this.modulesMenu.addEventListener("change", c => {
                this.selectModule(c.target.value)
            });
            this.renderSettingsList(a);
            this.container.appendChild(this.modulesMenu);
            a = document.createElement("div");
            a.className =
                "modules-menu-buttons_";
            this.container.appendChild(a);
            this.labelsBtn = document.createElement("div");
            this.labelsBtn.className = "labels-btn_ btn_";
            this.labelsBtn.title = this.l.CATEGORY_LIST_TTL;
            this.labelsBtn.addEventListener("pointerdown", c => {
                this.container.classList.toggle("labels_");
                this.container.classList.contains("labels_") && (this.labelList.value = "", document.addEventListener("pointerdown", d => {
                    d.target.parentElement !== this.labelList && d.target !== this.labelsBtn && this.container.classList.remove("labels_")
                }, {
                    once: !0,
                    capture: !0
                }))
            });
            a.appendChild(this.labelsBtn);
            this.labelList = document.createElement("select");
            this.labelList.className = "label-list_";
            this.labelList.addEventListener("change", c => {
                this.selectLabel(c.target.value);
                this.container.classList.remove("labels_");
                this.labelList.value = ""
            });
            this.container.appendChild(this.labelList);
            b = document.createElement("div");
            b.className = "search-btn_ btn_";
            b.title = this.l.SEARCH_TTL;
            b.addEventListener("pointerdown", c => {
                this.container.classList.toggle("search_");
                this.container.classList.contains("search_") ? setTimeout(() => {
                    this.searchField.focus()
                }, 1) : this.searchField.value && (this.searchField.value = "", this.filter(null))
            });
            a.appendChild(b);
            this.searchField = document.createElement("input");
            this.searchField.className = "search-field_ gp-ui-input_";
            this.searchField.type = "search";
            this.searchField.placeholder = this.l.SEARCH_INPUT_PH;
            this.searchField.setAttribute("spellcheck", "false");
            this.searchField.setAttribute("autocomplete", "off");
            this.searchField.toggleAttribute("incremental",
                !0);
            this.searchField.addEventListener("search", c => {
                this.filter(c.target.value)
            });
            this.searchField.addEventListener("keydown", c => {
                switch (c.key) {
                    case "Escape":
                        c.target.classList.add("hidden");
                    case "Enter":
                        c.target.blur()
                }
            });
            GPUtils_.setInputFocusBlurHandler(this.searchField);
            this.container.appendChild(this.searchField);
            document.body.appendChild(this.container);
            this.renderSettings(this.modulesMenu.value);
            this.isRendered = !0
        }
        renderSettingsList(a) {
            this.modulesMenu.innerHTML = "";
            const b = new Intl.Collator("us", {
                sensitivity: "base"
            });
            Array.from(this.viewsData).filter(([c]) => !this.isHiddenModule(c) && this.hasVisibleSettings(c)).sort(([, c], [, d]) => b.compare(c.title, d.title)).forEach(([c, d]) => {
                const e = document.createElement("option");
                e.value = c;
                e.textContent = d.title;
                this.modulesMenu.appendChild(e)
            });
            a && (this.modulesMenu.value = a)
        }
        shouldModuleBeRendered(a) {
            return this.viewsData.has(a) && !this.isHiddenModule(a)
        }
        selectModule(a) {
            this.updateView(this.view, a);
            this.updateHeader(a)
        }
        renderSettings(a) {
            this.view = this.insertView(a,
                this.container);
            this.updateHeader(a)
        }
        updateHeader(a) {
            this.labelsBtn.classList.toggle("empty_", !this.view.labels.size);
            this.updateLabelList(this.view.labels);
            this.searchField.value = "";
            this.container.classList.remove("search_");
            this.modulesMenu.value = a
        }
        updateViews(a, b = null) {
            this.views.forEach(c => {
                c.moduleName === a && c !== b && c.offsetParent && this.updateView(c)
            })
        }
        insertView(a, b) {
            if (this.shouldModuleBeRendered(a)) return this.renderView(a, b)
        }
        renderView(a, b) {
            const {
                view: c,
                controls: d
            } = this.buildView(a);
            b.appendChild(c);
            this.handleControlsScrollbar(d);
            this.handleControlsOverflow(d);
            return c
        }
        buildView(a, b = null) {
            const {
                source: c,
                storage: d,
                settings: e,
                ui: f
            } = this.viewsData.get(a);
            b ? b.innerHTML = "" : (b = document.createElement("div"), b.className = "gp-settings_", b.dataset.index = this.views.size, b.addEventListener("animationend", r => {
                "gp-set-highlight_" === r.animationName && r.target.classList.remove("highlight_")
            }), this.views.add(b));
            b.moduleName = a;
            b.labels = new Map;
            b.scrollPos = 0;
            const g = document.createElement("div");
            g.className = "controls_ gp-ui-scrollbar_";
            g.view = b;
            g.addEventListener("scroll", r => {
                b.scrollPos = r.target.scrollTop;
                this.handleControlsOverflow(r.target)
            });
            b.appendChild(g);
            var h = document.createElement("div");
            h.className = "buttons_";
            b.appendChild(h);
            const k = document.createElement("div");
            k.className = "load-btn_ btn_ gp-ui-btn_";
            k.textContent = "\ud83e\udc45";
            k.title = this.l.LOAD_JSON_TTL;
            k.addEventListener("click", () => {
                b.classList.toggle("json-data_");
                l.focus()
            });
            k.addEventListener("animationend", r => {
                r.target.classList.remove("failure_");
                r.target.classList.remove("success_")
            });
            h.appendChild(k);
            const l = document.createElement("input");
            l.className = "json-data-input_ gp-ui-input_";
            l.placeholder = this.l.JSON_INPUT_PH;
            l.spellcheck = !1;
            l.autocomplete = "off";
            l.addEventListener("keydown", r => {
                "Escape" === r.key && (b.classList.remove("json-data_"), r.target.blur())
            });
            l.addEventListener("input", r => {
                this.jsonDataInputHandler(a, r.target, k)
            });
            GPUtils_.setInputFocusBlurHandler(l);
            h.appendChild(l);
            var m = document.createElement("div");
            m.className = "restore-btn_ btn_ gp-ui-btn_";
            m.textContent = this.l.RESTORE_BTN_LBL;
            m.title = this.l.RESTORE_BTN_TTL;
            m.addEventListener("click", () => {
                this.restore(a)
            });
            h.appendChild(m);
            m = document.createElement("div");
            m.className = "default-btn_ btn_ gp-ui-btn_";
            m.textContent = this.l.RESET_BTN_LBL;
            m.title = this.l.RESET_BTN_TTL;
            m.addEventListener("click", () => {
                this.reset(a)
            });
            h.appendChild(m);
            h = document.createDocumentFragment();
            for (let r in f)
                if (m = f[r] ?? {}, this.isLabel(r)) {
                    var n = document.createElement("div");
                    n.className = "label_";
                    n.textContent = m.text;
                    h.appendChild(n);
                    b.labels.set(m.text, n)
                } else if (this.isSeparator(r)) n =
                document.createElement("div"), n.className = "separator_", n.classList.toggle(`${m.size}_`, !!m.size), h.appendChild(n);
            else if (m.type && !m.hidden) switch (m.type) {
                case "component":
                    n = document.createElement("div");
                    n.className = "component_";
                    n.dataset.name = r;
                    n.appendChild(m.getElement());
                    h.appendChild(n);
                    this.setControlStateAndDependents(f, r, e, n);
                    break;
                case "buttons":
                    const q = document.createElement("div");
                    q.className = "buttons_";
                    q.dataset.name = r;
                    m.getButtons().forEach(t => {
                        t.classList.add("btn_");
                        q.appendChild(t)
                    });
                    h.appendChild(q);
                    this.setControlStateAndDependents(f, r, e, q);
                    break;
                default:
                    n = document.createElement("div");
                    n.className = "setting_";
                    n.dataset.name = r;
                    const p = this.buildTooltip(m.description);
                    n.appendChild(p);
                    m = this.buildName(r, m.description);
                    n.appendChild(m);
                    m = this.buildControl(f, r, e[r], c, d, e, g);
                    n.appendChild(m);
                    h.appendChild(n);
                    this.setControlStateAndDependents(f, r, e, n)
            }
            g.appendChild(h);
            return {
                view: b,
                controls: g
            }
        }
        updateView(a, b = null) {
            b ??= a.moduleName;
            const c = +a.scrollPos;
            ({
                controls: a
            } = this.buildView(b,
                a));
            this.handleControlsScrollbar(a);
            this.handleControlsOverflow(a);
            a.scrollTop = c
        }
        handleControlsScrollbar(a) {
            a.scrollHeight > a.clientHeight && (a.parentElement.clientHeight - 41 > a.scrollHeight ? a.style.paddingBottom = `${a.scrollHeight-a.clientHeight}px` : a.classList.add("scrollbar_"))
        }
        handleControlsOverflow(a) {
            a.parentElement.classList.toggle("of-top_", 0 < a.scrollTop);
            a.parentElement.classList.toggle("of-bottom_", a.offsetHeight + a.scrollTop < a.scrollHeight)
        }
        isLabel(a) {
            return /^_\d+/.test(a)
        }
        isSeparator(a) {
            return /^_+$/.test(a)
        }
        buildTooltip(a) {
            const b =
                document.createElement("div");
            b.className = "tooltip_";
            b.textContent = "?";
            if (!a) return b.classList.add("disabled_"), b;
            b.addEventListener("pointerenter", c => {
                let d = window.gpSettingsTooltip;
                d || (d = document.createElement("div"), d.className = "gp-ui-tooltip_", document.body.appendChild(d), window.gpSettingsTooltip = d);
                d.textContent = a;
                const {
                    x: e,
                    y: f,
                    width: g,
                    height: h
                } = c.target.getBoundingClientRect();
                ({
                    height: c
                } = d.getBoundingClientRect());
                d.style.cssText = `top: ${f-(c-h)/2}px; left: ${e+g+12}px`;
                window.gpSettingsTooltip =
                    d
            });
            b.addEventListener("pointerleave", c => {
                window.gpSettingsTooltip && (window.gpSettingsTooltip.remove(), window.gpSettingsTooltip = null)
            });
            return b
        }
        buildName(a, b) {
            const c = document.createElement("div");
            c.className = "name_";
            c.title = b || "";
            c.textContent = a.split(/(?<![A-Z])(?=[A-Z])|(?=[A-Z]\B)/).join(" ");
            return c
        }
        buildControl(a, b, c, d, e, f, g) {
            const {
                type: h,
                args: k,
                formatter: l,
                inputTrigger: m,
                beforeActivation: n
            } = a[b], r = document.createElement("div");
            r.className = "control_";
            let q;
            switch (h) {
                case "switch":
                    q = document.createElement("div");
                    q.className = "gp-ui-switch_";
                    var p = `ctrl-${g.view.dataset.index}-${b}_`;
                    const t = document.createElement("input");
                    t.id = p;
                    t.type = "checkbox";
                    t.name = b;
                    t.checked = c;
                    if (n) {
                        let B = !1;
                        t.addEventListener("click", async G => {
                            G.preventDefault();
                            if (!B) {
                                if (t.checked && (B = !0, G = await n(), B = !1, !G)) return;
                                requestAnimationFrame(() => {
                                    t.checked = !t.checked;
                                    t.dispatchEvent(new Event("change", {
                                        bubbles: !0
                                    }))
                                })
                            }
                        })
                    }
                    q.appendChild(t);
                    const v = document.createElement("label");
                    v.setAttribute("for", p);
                    q.appendChild(v);
                    r.appendChild(q);
                    break;
                case "slider":
                    const {
                        min: w, max: u, step: y, reverse: z
                    } = k;
                    q = document.createElement("input");
                    q.className = "gp-ui-slider_";
                    q.type = "range";
                    q.min = w;
                    q.max = u;
                    q.step = y;
                    q.value = c;
                    q.name = b;
                    z && (q.style.direction = "rtl");
                    q.addEventListener("input", B => {
                        x.textContent = l ? l(Number.parseFloat(B.target.value)) : B.target.value
                    });
                    const x = document.createElement("div");
                    x.className = "gp-ui-slider-preview_";
                    x.textContent = l ? l(c) : c;
                    x.addEventListener("pointerdown", B => {
                        let G = B.clientY;
                        const E = D => {
                            var F = D.clientY - G;
                            const H = 0 > F;
                            Math.abs(F) >= GPSettingsManager_.POINTER_SLIDER_PREVIEW_CHANGE_SENSITIVITY && (F = q.valueAsNumber, F += (z ? !H : H) ? y : -y, F = Math.max(Math.min(F, u), w), F = Math.round(1E3 * F) / 1E3, q.value = F, x.textContent = l ? l(F) : F, q.dispatchEvent(new Event("change", {
                                bubbles: !0
                            })), G = D.clientY)
                        };
                        B.currentTarget.setPointerCapture(B.pointerId);
                        B.currentTarget.addEventListener("pointermove", E);
                        B.currentTarget.addEventListener("pointerup", D => {
                            D.currentTarget.removeEventListener("pointermove", E);
                            q.focus()
                        }, {
                            once: !0
                        })
                    });
                    r.appendChild(q);
                    r.appendChild(x);
                    break;
                case "input":
                    p = k?.secure;
                    q = document.createElement("input");
                    q.className = "gp-ui-input_";
                    q.classList.toggle("secure-input_", !!p);
                    q.spellcheck = !1;
                    q.autocomplete = "off";
                    q.value = c;
                    q.name = b;
                    q.addEventListener("keydown", B => {
                        switch (B.key) {
                            case "Escape":
                                B.target.value = B.target.dataset.initialValue;
                            case "Enter":
                                B.target.blur()
                        }
                    });
                    q.addEventListener("focus", B => {
                        B.target.dataset.initialValue = B.target.value
                    });
                    q.addEventListener("blur", B => {
                        delete B.target.dataset
                    });
                    GPUtils_.setInputFocusBlurHandler(q);
                    r.appendChild(q);
                    break;
                case "dropdown":
                    q = document.createElement("select");
                    q.className = "gp-ui-dropdown_";
                    q.autocomplete = "off";
                    q.name = b;
                    const {
                        items: A, itemsProxySetting: C
                    } = k;
                    (C && f[C] || (A?.length ? A : [c])).forEach((B, G) => {
                        const E = document.createElement("option");
                        E.value = B;
                        E.textContent = l ? l(B, G) : B;
                        q.appendChild(E)
                    });
                    q.value = c;
                    r.appendChild(q);
                    break;
                case "list-ms":
                case "list-md":
                    p = "list-ms" === h ? k.items : c;
                    q = document.createElement("form");
                    q.className = "gp-ui-list-m_";
                    q.name = b;
                    p.forEach((B, G) => {
                        const E = `ctrl-${g.view.dataset.index}-${b}-${G}_`;
                        var D = document.createElement("input");
                        D.id = E;
                        D.type = "checkbox";
                        D.value = B;
                        D.name = b;
                        D.checked = c.includes(B);
                        q.appendChild(D);
                        D = document.createElement("label");
                        D.textContent = l ? l(B, G) : B;
                        D.setAttribute("for", E);
                        q.appendChild(D)
                    });
                    r.appendChild(q);
                    break;
                case "list-i":
                    const {
                        icons: I
                    } = k;
                    q = document.createElement("form");
                    q.className = "gp-ui-list-i_";
                    q.name = b;
                    const M = [];
                    Object.keys(I).forEach((B, G) => {
                        G = `ctrl-${g.view.dataset.index}-${b}-${G}_`;
                        const E = document.createElement("input");
                        E.id = G;
                        E.type = "checkbox";
                        E.name = b;
                        E.value = B;
                        E.checked = c === B;
                        E.addEventListener("click", F => {
                            M.forEach(H => {
                                H.checked = H === E
                            })
                        });
                        q.appendChild(E);
                        M.push(E);
                        const D = document.createElement("label");
                        D.className = "gp-ui-list-i-icon_";
                        D.title = B.split("-").map(F => F[0].toUpperCase() + F.slice(1)).join(" ");
                        D.style.backgroundImage = `url("${I[B]}")`;
                        D.setAttribute("for", G);
                        q.appendChild(D)
                    });
                    r.appendChild(q);
                    break;
                case "color":
                    q = document.createElement("input"), q.className = "gp-ui-color_", q.type = "color", q.value = c, q.name = b, r.appendChild(q)
            }
            p = ["change", "input"];
            for (let t = 0; t < (m ? 2 : 1); t++) q.addEventListener(p[t], v => {
                v = {
                    [v.target.name]: this.parseValue(v.target, h)
                };
                this.dispatchEvent(new CustomEvent("update", {
                    detail: {
                        source: d,
                        storage: e,
                        settings: Object.assign(f, v),
                        changedSettings: v
                    }
                }));
                0 === t && this.updateViews(g.view.moduleName, g.view)
            });
            q.addEventListener("change", t => {
                a[b].dependents && a[b].dependents.forEach(v => {
                    this.updateControlState(v, a, f, g)
                })
            });
            return r
        }
        updateControlState(a, b, c, d) {
            b[a].requires && (b = this.calcControlState(b[a], c), d.querySelector(`:scope > [data-name="${a}"]`)?.classList.toggle("disabled_",
                !b))
        }
        calcControlState(a, b) {
            return Object.entries(a.requires).every(([c, d]) => b[c] === d)
        }
        parseValue(a, b) {
            switch (a.type) {
                case "range":
                    return Number.parseFloat(a.value);
                case "checkbox":
                    return a.form ? "list-i" === b ? a.value : [...a.form].filter(c => c.checked).map(c => c.value) : a.checked;
                default:
                    return a.value
            }
        }
        jsonDataInputHandler(a, b, c) {
            c.classList.remove("failure_");
            c.classList.remove("success_");
            try {
                let d = JSON.parse(b.value);
                const {
                    settings: e,
                    source: f,
                    storage: g
                } = this.viewsData.get(a);
                d = this.filterSettings(d,
                    e);
                if (Object.keys(d).length) {
                    const h = this.copy(d);
                    Object.assign(e, h);
                    this.updateViews(a);
                    this.dispatchEvent(new CustomEvent("update", {
                        detail: {
                            source: f,
                            storage: g,
                            settings: e,
                            changedSettings: h
                        }
                    }));
                    c.classList.add("success_")
                } else c.classList.add("failure_")
            } catch (d) {
                c.classList.add("failure_")
            }
            b.value = ""
        }
        filterSettings(a, b) {
            for (let c in a) c in b || delete a[c];
            return a
        }
        setControlStateAndDependents(a, b, c, d) {
            if (a[b].requires) {
                let e = !1;
                Object.entries(a[b].requires).forEach(([f, g]) => {
                    c[f] !== g && (e = !0);
                    f in
                        c && (a[f].dependents ? a[f].dependents.add(b) : a[f].dependents = new Set([b]))
                });
                d.classList.toggle("disabled_", e)
            }
        }
        selectLabel(a) {
            if (a = this.view.labels.get(a)) a.classList.add("highlight_"), a.scrollIntoView({
                behavior: "smooth"
            })
        }
        updateLabelList(a) {
            this.labelList.innerHTML = "";
            const b = document.createDocumentFragment();
            b.appendChild(document.createElement("option"));
            a.forEach((c, d) => {
                c = document.createElement("option");
                c.value = d;
                c.textContent = d;
                b.appendChild(c)
            });
            this.labelList.appendChild(b);
            this.labelList.size =
                a.size + 1;
            this.labelList.style.height = `${26*a.size}px`;
            this.container.classList.remove("labels_")
        }
        filter(a) {
            a = a?.replace(/\s/g, "").toLowerCase();
            Array.from(this.view.firstElementChild.children).forEach(b => {
                if (a) {
                    const c = b.dataset.name?.replace(/\s/g, "").toLowerCase();
                    c && ~c.indexOf(a) ? b.style.display = "" : b.style.display = "none"
                } else b.style.display = ""
            })
        }
        initImporterExporter(a, b) {
            this.ie.init(this.mm, a, b)
        }
        exportSettings() {
            this.ie.exportSettings()
        }
        importSettings() {
            this.ie.importSettings()
        }
        closeImporter() {
            this.ie.closeImporter()
        }
        reset(a) {
            const {
                settings: b,
                defaultSettings: c,
                source: d,
                storage: e
            } = this.viewsData.get(a), f = this.copy(c);
            Object.assign(b, f);
            for (let g in b) g in f || delete b[g];
            this.updateViews(a);
            this.dispatchEvent(new CustomEvent("update", {
                detail: {
                    source: d,
                    storage: e,
                    settings: b,
                    changedSettings: f
                }
            }))
        }
        restore(a) {
            const {
                settings: b,
                initialSettings: c,
                source: d,
                storage: e
            } = this.viewsData.get(a), f = this.copy(c);
            Object.assign(b, f);
            this.updateViews(a);
            this.dispatchEvent(new CustomEvent("update", {
                detail: {
                    source: d,
                    storage: e,
                    settings: b,
                    changedSettings: f
                }
            }))
        }
        copy(a) {
            return window.structuredClone(a)
        }
        toggle(a,
            b, c = !1) {
            this.isRendered ? (this.container.classList.toggle("hidden", void 0 === a ? a : !a), this.container.classList.toggle("load-btn-shown_", c), this.view.classList.remove("json-data_"), a && b && this.selectModule(b)) : !1 !== a && this.render(b, c)
        }
        close() {
            this.isOpened() && this.toggle(!1)
        }
        isOpened() {
            return !this.container?.classList.contains("hidden")
        }
        isHiddenModule(a) {
            return this.mm.areHiddenSettings(a)
        }
        hasVisibleSettings(a) {
            return this.viewsData.get(a).hasVisibleSettings
        }
        updateSettingsList() {
            this.isRendered && this.renderSettingsList()
        }
        saveSettings(a,
            b) {
            localStorage.setItem(a, JSON.stringify(b))
        }
    }
    window.GPSettingsManager_ = GPSettingsManager_;
    class GPAcoDecoder_ {
        static COLOR_MODE = {
            RGB: 0,
            HSB: 1,
            LAB: 7,
            GRAYSCALE: 8
        };
        static COLOR_MODES_SIGNS = {
            [this.COLOR_MODE.RGB]: [0, 0, 0, 0],
            [this.COLOR_MODE.HSB]: [0, 0, 0, 0],
            [this.COLOR_MODE.LAB]: [0, -1, -1, 0],
            [this.COLOR_MODE.GRAYSCALE]: [0, 0, 0, 0]
        };
        static decode(a) {
            try {
                return this.parseACO(a)
            } catch (b) {
                return null
            }
        }
        static parseACO(a) {
            a = new DataView(a);
            const b = a.getUint16(2),
                c = a.getUint16(4),
                d = [];
            for (let e = 0; e < b; e++) {
                const [f, g, h] = this.readData(a, 6 + 10 * e, c);
                let k;
                switch (c) {
                    case this.COLOR_MODE.RGB:
                        k = {
                            r: Math.trunc(f /
                                256),
                            g: Math.trunc(g / 256),
                            b: Math.trunc(h / 256),
                            a: 1
                        };
                        break;
                    case this.COLOR_MODE.HSB:
                        k = {
                            h: Math.trunc(f / 182.04),
                            s: Math.trunc(g / 655.35),
                            b: Math.trunc(h / 655.35)
                        };
                        break;
                    case this.COLOR_MODE.LAB:
                        k = {
                            l: Math.round(f / 100),
                            a: Math.round(g / 100),
                            b: Math.round(h / 100)
                        };
                        break;
                    case this.COLOR_MODE.GRAYSCALE:
                        k = {
                            r: Math.trunc(f / 39.0625),
                            g: Math.trunc(f / 39.0625),
                            b: Math.trunc(f / 39.0625),
                            a: 1
                        }
                }
                k && d.push(k)
            }
            return d.length ? this.convertToHex(d, c) : null
        }
        static readData(a, b, c) {
            const d = [];
            for (let f = 0; 4 > f; f++) {
                var e = b + 2 * f;
                e = ~this.COLOR_MODES_SIGNS[c][f] ?
                    a.getUint16(e) : a.getInt16(e);
                d.push(e)
            }
            return d
        }
        static convertToHex(a, b) {
            switch (b) {
                case this.COLOR_MODE.RGB:
                case this.COLOR_MODE.GRAYSCALE:
                    return a.map(c => this.rgbToHex(c));
                case this.COLOR_MODE.LAB:
                    return a.map(c => this.labToHex(c));
                case this.COLOR_MODE.HSB:
                    return a.map(c => this.hsvToHex(c))
            }
        }
        static componentToHex(a) {
            return Math.floor(a).toString(16).padStart(2, "0")
        }
        static rgbToHex({
            r: a,
            g: b,
            b: c
        }) {
            return `${this.componentToHex(a)}${this.componentToHex(b)}${this.componentToHex(c)}`
        }
        static hsvToHex({
            h: a,
            s: b,
            v: c
        }) {
            a = this.hsvToRgb(a / 360, b / 100, c / 100);
            return this.rgbToHex(a)
        }
        static hsvToRgb(a, b, c) {
            let d, e, f;
            const g = Math.floor(6 * a),
                h = 6 * a - g;
            a = c * (1 - b);
            const k = c * (1 - h * b);
            b = c * (1 - (1 - h) * b);
            switch (g % 6) {
                case 0:
                    d = c;
                    e = b;
                    f = a;
                    break;
                case 1:
                    d = k;
                    e = c;
                    f = a;
                    break;
                case 2:
                    d = a;
                    e = c;
                    f = b;
                    break;
                case 3:
                    d = a;
                    e = k;
                    f = c;
                    break;
                case 4:
                    d = b;
                    e = a;
                    f = c;
                    break;
                case 5:
                    d = c, e = a, f = k
            }
            return {
                r: Math.round(255 * d),
                g: Math.round(255 * e),
                b: Math.round(255 * f)
            }
        }
        static labToHex({
            l: a,
            a: b,
            b: c
        }) {
            a = this.labToRgb([a, b, c]);
            return this.rgbToHex(a)
        }
        static labToRgb(a) {
            var b =
                (a[0] + 16) / 116;
            let c = a[1] / 500 + b,
                d = b - a[2] / 200,
                e;
            c = .95047 * (.008856 < c * c * c ? c * c * c : (c - 16 / 116) / 7.787);
            b = .008856 < b * b * b ? b * b * b : (b - 16 / 116) / 7.787;
            d = 1.08883 * (.008856 < d * d * d ? d * d * d : (d - 16 / 116) / 7.787);
            a = 3.2406 * c + -1.5372 * b + -.4986 * d;
            e = -.9689 * c + 1.8758 * b + .0415 * d;
            b = .0557 * c + -.204 * b + 1.057 * d;
            a = .0031308 < a ? 1.055 * Math.pow(a, 1 / 2.4) - .055 : 12.92 * a;
            e = .0031308 < e ? 1.055 * Math.pow(e, 1 / 2.4) - .055 : 12.92 * e;
            b = .0031308 < b ? 1.055 * Math.pow(b, 1 / 2.4) - .055 : 12.92 * b;
            return {
                r: 255 * Math.max(0, Math.min(1, a)),
                g: 255 * Math.max(0, Math.min(1, e)),
                b: 255 * Math.max(0,
                    Math.min(1, b))
            }
        }
    };
    class GPColorPanel_ extends EventTarget {
        static MAX_WIDTH = 144;
        static SELECTORS = {
            SCREEN: ".screen",
            PANEL: ".colors",
            MARK_COLOR: ".marks .color",
            COLOR_LIST: ".colorslist",
            COLOR: ".colors :is(.colorslist, .marks) .color",
            INPUT_COLOR: 'input[type="color"]'
        };
        static SET = {
            DEFAULT: "default",
            CUSTOM_PALETTE: "custom_palette",
            COLOR_PICKER: "color_picker",
            COLOR_WHEEL: "color_wheel"
        };
        static CONTROL = {
            PALETTE: "palette",
            CUSTOM_PALETTE: "custom-palette",
            COLOR_PICKER: "color-picker",
            "FULL_SIZE_\u0421OLOR_PICKER": "full-size-color-picker",
            COLOR_WHEEL: "color-wheel"
        };
        static SET_CONTROLS = {
            [this.SET.DEFAULT]: [this.CONTROL.PALETTE, this.CONTROL.COLOR_PICKER],
            [this.SET.CUSTOM_PALETTE]: [this.CONTROL.CUSTOM_PALETTE, this.CONTROL.COLOR_PICKER],
            [this.SET.COLOR_PICKER]: [this.CONTROL.FULL_SIZE_\u0421OLOR_PICKER],
            [this.SET.COLOR_WHEEL]: [this.CONTROL.COLOR_PICKER, this.CONTROL.COLOR_WHEEL]
        };
        constructor(a, b, c) {
            super();
            this.gpproxy = b;
            this.l = c;
            this.style = document.documentElement.style;
            this.painter = a;
            this.s = a.getSettings();
            this.controls = new Set;
            this.colorInput;
            this.palette;
            this.colorWheel;
            this.colorPicker;
            this.fullSizeColorPicker;
            GPUtils_.bindMethods([this.colorsContainerClickHandler, this.colorPickerChangeHandler, this.colorInputInputHandler, this.colorInputChangeHandler, this.color2InputChangeHandler, this.wheelHandler], this);
            this.painter.addEventListener("color", ({
                detail: {
                    color: d
                }
            }) => {
                this.palette?.resetPaletteColor();
                this.colorWheel?.setColor(d);
                this.colorPicker?.setColor(d);
                this.fullSizeColorPicker?.setColor(d);
                this.colorInput.value = d
            });
            this.painter.addEventListener("color2",
                ({
                    detail: {
                        color: d
                    }
                }) => {
                    this.color2Input.value = d
                });
            this.init()
        }
        init() {
            const a = GPColorPanel_.SELECTORS;
            this.screen = document.querySelector(a.SCREEN);
            this.panel = this.screen.querySelector(a.PANEL);
            this.colorList = this.panel.querySelector(a.COLOR_LIST);
            this.colorsContainer = this.colorList.parentElement;
            this.panel.addEventListener("wheel", this.wheelHandler);
            const b = this.colorsContainer.querySelector(a.MARK_COLOR);
            this.screen.classList.toggle("color-marks_", b);
            this.colorsContainer.addEventListener("click",
                this.colorsContainerClickHandler, !0);
            this.colorsContainer.querySelectorAll(a.COLOR).forEach(c => {
                const [, d, e, f] = c.style.cssText.match(/\((\d+),\s(\d+),\s(\d+)\)/).map(g => +g);
                c.dataset.color = GPColorUtils_.rgbToHex(d, e, f)
            });
            this.nativeColorInput = this.panel.querySelector(a.INPUT_COLOR);
            this.updateNativePalette(this.s.stretchNativePalette);
            this.setControlsSet(this.s.colorPanelControlsSet);
            this.initColorInputs();
            this.enable();
            this.updateColorsPanelOffset()
        }
        terminate() {
            this.panel.removeEventListener("wheel",
                this.wheelHandler);
            this.colorsContainer.removeEventListener("click", this.colorsContainerClickHandler, !0);
            this.colorInput.removeEventListener("input", this.colorInputInputHandler);
            this.colorInput.removeEventListener("change", this.colorInputChangeHandler);
            this.color2Input.removeEventListener("change", this.color2InputChangeHandler);
            this.colorInput.remove();
            this.color2Input.remove();
            this.resetControls()
        }
        updateColorsPanelOffset() {
            const a = this.panel.getBoundingClientRect().height / this.painter.getActualScale();
            this.panel.style.setProperty("--gp-colors-panel-offset", `${Math.round(Math.min(Math.max(2*(112-(698-a)/2),0),698-a))}px`)
        }
        getColorsPanelOffset() {
            const a = this.painter.getActualScale(),
                b = this.panel.getBoundingClientRect().height;
            return Math.max(Math.round(158 - (698 - b / a) / 2), 0)
        }
        updateNativePalette(a) {
            this.screen.classList.toggle("gp-prevent-palette-stretching_", !a);
            this.updateColorsPanelOffset()
        }
        colorsContainerClickHandler(a) {
            if (a.target.classList.contains("color")) {
                var b = a.target.dataset.color;
                this.palette?.resetPaletteColor();
                this.colorPicker?.setColor(b);
                this.colorInput.value = b;
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: b
                    }
                }));
                a.stopPropagation()
            }
        }
        setControlsSet(a) {
            this.resetControls();
            this.currentControlsSet = a in GPColorPanel_.SET_CONTROLS ? a : GPColorPanel_.SET.DEFAULT;
            a = GPColorPanel_.SET_CONTROLS[this.currentControlsSet];
            this.panel.classList.add(...a.map(b => `ctrl-${b}_`));
            a.forEach(b => {
                switch (b) {
                    case GPColorPanel_.CONTROL.PALETTE:
                        0 === GPExtendedPalette_.PALETTES[this.s.extendedPaletteName]?.length && this.painter.setPaletteName(GPExtendedPalette_.PALETTE.DEFAULT);
                        this.s.extendedPalettePanel && this.initExtendedPalette();
                        break;
                    case GPColorPanel_.CONTROL.CUSTOM_PALETTE:
                        this.initExtendedPalette(GPExtendedPalette_.PALETTE.CUSTOM);
                        break;
                    case GPColorPanel_.CONTROL.COLOR_PICKER:
                        this.s.colorPickerPanel && this.initColorPicker();
                        break;
                    case GPColorPanel_.CONTROL.FULL_SIZE_\u0421OLOR_PICKER:
                        this.initFullSize\u0421olorPicker();
                        break;
                    case GPColorPanel_.CONTROL.COLOR_WHEEL:
                        this.initColorWheel()
                }
            });
            this.updateCustomToolsState();
            this.controls = new Set(a)
        }
        changeControlsSet(a) {
            const b =
                Object.values(GPColorPanel_.SET),
                c = b.findIndex(d => d === this.s.colorPanelControlsSet);
            if (~c) {
                const d = b.length;
                a = b[0 > a ? (c + d - 1) % d : (c + 1) % d]
            } else a = GPColorPanel_.SET.DEFAULT;
            this.setControlsSet(a);
            this.dispatchEvent(new CustomEvent("controls-set-changed", {
                detail: {
                    name: a
                }
            }))
        }
        wheelHandler(a) {
            this.changeControlsSet(a.deltaY);
            a.preventDefault()
        }
        initExtendedPalette(a) {
            this.palette && this.palette.terminate();
            this.palette = new GPExtendedPalette_(this.l, a ?? this.s.extendedPaletteName, () => this.gpproxy.getNickname(),
                () => this.painter.getColor().slice(1));
            this.palette.addEventListener("palette", ({
                detail: {
                    name: b
                }
            }) => {
                this.painter.setPaletteName(b)
            });
            this.palette.addEventListener("color", ({
                detail: {
                    color: b
                }
            }) => {
                this.colorWheel?.setColor(b);
                this.fullSizeColorPicker?.setColor(b);
                this.colorPicker?.setColor(b);
                this.colorInput.value = b;
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: b
                    }
                }))
            });
            this.painter.isDisabled && this.palette.disable();
            this.colorList.after(this.palette.getElement());
            this.screen.classList.add("gp-extended-palette-panel_")
        }
        initColorPicker() {
            this.colorPicker &&
                this.colorPicker.remove();
            this.colorPicker = new GPColorPicker_(GPColorPanel_.MAX_WIDTH, 125);
            this.colorPicker.setColor(this.painter.getColor());
            this.colorPicker.toggle(!this.painter.isDisabled);
            this.colorPicker.addEventListener("color", this.colorPickerChangeHandler);
            this.nativeColorInput.before(this.colorPicker.getElement());
            this.screen.classList.add("gp-color-picker-panel_")
        }
        "initFullSize\u0421olorPicker"() {
            this.fullSizeColorPicker && this.fullSizeColorPicker.remove();
            this.fullSizeColorPicker = new GPColorPicker_(GPColorPanel_.MAX_WIDTH,
                288);
            this.fullSizeColorPicker.setColor(this.painter.getColor());
            this.fullSizeColorPicker.toggle(!this.painter.isDisabled);
            this.fullSizeColorPicker.addEventListener("color", this.colorPickerChangeHandler);
            this.colorList.after(this.fullSizeColorPicker.getElement());
            this.screen.classList.add("gp-color-picker-panel_")
        }
        colorPickerChangeHandler({
            detail: {
                color: a
            }
        }) {
            this.palette?.resetPaletteColor();
            this.colorWheel?.setColor(a);
            this.colorInput.value = a;
            this.dispatchEvent(new CustomEvent("color", {
                detail: {
                    color: a
                }
            }))
        }
        initColorWheel() {
            this.colorWheel &&
                this.colorWheel.remove();
            this.colorWheel = new GPColorWheel_(this.painter.getColor(), this.s.colorWheelMode, GPColorPanel_.MAX_WIDTH, this.l);
            this.colorWheel.addEventListener("color", ({
                detail: {
                    color: a
                }
            }) => {
                this.fullSizeColorPicker?.setColor(a);
                this.colorPicker?.setColor(a);
                this.colorInput.value = a;
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: a
                    }
                }))
            });
            this.colorWheel.addEventListener("mode", ({
                detail: {
                    mode: a
                }
            }) => {
                this.dispatchEvent(new CustomEvent("color-wheel-mode-changed", {
                    detail: {
                        mode: a
                    }
                }))
            });
            this.colorList.after(this.colorWheel.getElement())
        }
        resetControls() {
            this.controls.forEach(a => {
                this.panel.classList.remove(`ctrl-${a}_`)
            });
            this.controls.clear();
            this.palette && (this.palette.terminate(), this.palette = null, this.screen.classList.remove("gp-extended-palette-panel_"));
            this.colorWheel && (this.colorWheel.remove(), this.colorWheel = null);
            this.fullSizeColorPicker && (this.fullSizeColorPicker.remove(), this.fullSizeColorPicker = null, this.screen.classList.remove("gp-color-picker-panel_"));
            this.colorPicker &&
                (this.colorPicker.remove(), this.colorPicker = null, this.screen.classList.remove("gp-color-picker-panel_"));
            this.screen.classList.remove("gp-custom-tools_")
        }
        initColorInputs() {
            this.colorInput = document.createElement("input");
            this.colorInput.type = "color";
            this.colorInput.className = "gp-painter-color_";
            this.colorInput.classList.add("gp-ui-color_");
            this.colorInput.value = this.painter.getColor();
            this.colorInput.addEventListener("input", this.colorInputInputHandler);
            this.colorInput.addEventListener("change", this.colorInputChangeHandler);
            this.nativeColorInput.after(this.colorInput);
            this.color2Input = document.createElement("input");
            this.color2Input.type = "color";
            this.color2Input.className = "gp-painter-color2_";
            this.color2Input.classList.add("gp-ui-color_");
            this.color2Input.value = this.painter.getColor2();
            this.color2Input.addEventListener("change", this.color2InputChangeHandler);
            this.colorInput.after(this.color2Input);
            this.nativeColorInput.classList.add("hidden")
        }
        colorInputInputHandler(a) {
            this.dispatchEvent(new CustomEvent("color", {
                detail: {
                    color: a.target.value
                }
            }))
        }
        colorInputChangeHandler(a) {
            this.palette?.resetPaletteColor();
            this.colorPicker?.setColor(a.target.value);
            this.dispatchEvent(new CustomEvent("color", {
                detail: {
                    color: a.target.value
                }
            }))
        }
        color2InputChangeHandler(a) {
            this.dispatchEvent(new CustomEvent("color2", {
                detail: {
                    color: a.target.value
                }
            }))
        }
        toggle(a) {
            a ? this.enable() : this.disable()
        }
        enable() {
            this.panel.classList.remove("disabled");
            this.colorInput.removeAttribute("disabled");
            this.color2Input.removeAttribute("disabled");
            this.colorInput.value = this.painter.getColor();
            this.color2Input.value = this.painter.getColor2();
            this.palette?.enable();
            this.colorWheel?.enable();
            this.colorPicker?.enable();
            this.fullSizeColorPicker?.enable()
        }
        disable() {
            this.panel.classList.add("disabled");
            this.colorInput.setAttribute("disabled", "");
            this.color2Input.setAttribute("disabled", "");
            this.colorInput.value = this.s.panelsBackgroundColor;
            this.color2Input.value = this.s.panelsBackgroundColor;
            this.palette?.disable();
            this.colorWheel?.disable();
            this.colorPicker?.disable();
            this.fullSizeColorPicker?.disable()
        }
        updateExtendedPalette(a) {
            this.controls.has(GPColorPanel_.CONTROL.PALETTE) &&
                (a ? this.initExtendedPalette() : this.palette && (this.palette.terminate(), this.palette = null, this.screen.classList.remove("gp-extended-palette-panel_")), this.updateCustomToolsState())
        }
        updateColorPickerPanel(a) {
            this.controls.has(GPColorPanel_.CONTROL.COLOR_PICKER) && (a ? this.initColorPicker() : this.colorPicker && (this.colorPicker.remove(), this.colorPicker = null, this.screen.classList.remove("gp-color-picker-panel_")), this.updateCustomToolsState())
        }
        updateCustomToolsState() {
            this.screen.classList.toggle("gp-custom-tools_",
                !!(this.palette || this.colorPicker || this.fullSizeColorPicker || this.colorWheel));
            this.updateColorsPanelOffset()
        }
        updatePanelsBackground(a) {
            this.painter.isDisabled && (this.colorInput.value = a, this.color2Input.value = a)
        }
    };
    class GPColorPicker_ extends EventTarget {
        static TOP = "top";
        static BOTTOM = "bottom";
        static LEFT = "left";
        static RIGHT = "right";
        static HORIZONTAL = "horizontal";
        static VERTICAL = "vertical";
        static DEFAULT_WIDTH = 250;
        static DEFAULT_HEIGHT = 250;
        static DEFAULT_HUE_POSITION = this.BOTTOM;
        static HUE_MIN_SIDE_SIZE = 30;
        static HUE_MARGIN = 15;
        constructor(a = GPColorPicker_.DEFAULT_WIDTH, b = GPColorPicker_.DEFAULT_HEIGHT, c = GPColorPicker_.DEFAULT_HUE_POSITION) {
            super();
            this.style = document.documentElement.style;
            this.style.setProperty("--cp-hue-margin",
                `${GPColorPicker_.HUE_MARGIN}px`);
            this.container;
            this.hsv = [0, 0, 0];
            this.width = a;
            this.height = b;
            this.palettePointerY = this.palettePointerX = 0;
            this.huePosition = c;
            this.huePosDir = c === GPColorPicker_.TOP || c === GPColorPicker_.BOTTOM ? GPColorPicker_.HORIZONTAL : GPColorPicker_.VERTICAL;
            this.hueBarSize = (this.huePosDir === GPColorPicker_.HORIZONTAL ? this.width : this.height) - 2 * GPColorPicker_.HUE_MARGIN;
            this.huePosDir === GPColorPicker_.HORIZONTAL ? (this.hueWidth = this.width, this.hueHeight = GPColorPicker_.HUE_MIN_SIDE_SIZE, this.paletteWidth =
                this.width, this.paletteHeight = this.height - this.hueHeight) : (this.hueWidth = GPColorPicker_.HUE_MIN_SIDE_SIZE, this.hueHeight = this.height, this.paletteWidth = this.width - this.hueWidth, this.paletteHeight = this.height);
            this.paletteDownHandler = this.paletteDownHandler.bind(this);
            this.paletteMoveHandler = this.paletteMoveHandler.bind(this);
            this.hueSliderDownHandler = this.hueSliderDownHandler.bind(this);
            this.hueSliderMoveHandler = this.hueSliderMoveHandler.bind(this);
            this.render()
        }
        getElement() {
            return this.container
        }
        hide() {
            this.container.classList.add("hidden");
            this.isHidden = !0
        }
        show(a, b) {
            let c = 0,
                d = 0;
            switch (this.huePosition) {
                case GPColorPicker_.LEFT:
                    c = this.hueWidth;
                    break;
                case GPColorPicker_.TOP:
                    d = this.hueHeight
            }
            a = a - this.palettePointerX - c;
            b = b - this.palettePointerY - d;
            a = a + this.width > document.documentElement.clientWidth ? Math.max(document.documentElement.clientWidth - this.width, 0) : Math.max(a, 0);
            b = b + this.height > document.documentElement.clientHeight ? Math.max(document.documentElement.clientHeight - this.height, 0) : Math.max(b, 0);
            this.container.style.left = `${a}px`;
            this.container.style.top =
                `${b}px`;
            this.container.classList.remove("hidden");
            this.isHidden = !1
        }
        remove() {
            this.container.remove()
        }
        toggle(a) {
            this.container.toggleAttribute("disabled", void 0 === a ? a : !a)
        }
        enable() {
            this.toggle(!0)
        }
        disable() {
            this.toggle(!1)
        }
        render() {
            this.container = document.createElement("div");
            this.container.className = `gp-color-picker_ ${this.huePosition}_`;
            this.container.innerHTML = '<div class="palette"><div class="hue"><div class="lightness"><div class="darkness"></div><div class="pointer-wrapper"><div class="pointer"></div></div></div></div></div><div class="hue"><div class="slider-wrapper"><div class="slider"><div class="handle-wrapper"><div class="handle"></div></div></div></div></div>';
            this.container.style.width = `${this.width}px`;
            this.container.style.height = `${this.height}px`;
            this.palette = this.container.querySelector(".palette");
            this.palette.addEventListener("pointerdown", this.paletteDownHandler);
            this.paletteHue = this.container.querySelector(".gp-color-picker_ > .palette .hue");
            this.pointerWrapper = this.container.querySelector(".gp-color-picker_ > .palette .pointer-wrapper");
            const a = this.container.querySelector(".gp-color-picker_ > .hue");
            a.style.width = `${this.hueWidth}px`;
            a.style.height =
                `${this.hueHeight}px`;
            this.hueSlider = this.container.querySelector(".gp-color-picker_ > .hue .slider");
            this.hueSlider.addEventListener("pointerdown", this.hueSliderDownHandler);
            this.hueHandleWrapper = this.container.querySelector(".gp-color-picker_ > .hue .handle-wrapper")
        }
        paletteDownHandler(a) {
            0 === a.button && (this.palette.setPointerCapture(a.pointerId), this.palette.addEventListener("pointermove", this.paletteMoveHandler), this.palette.addEventListener("pointerup", b => {
                this.palette.removeEventListener("pointermove",
                    this.paletteMoveHandler)
            }, {
                once: !0
            }), this.paletteMoveHandler(a))
        }
        paletteMoveHandler(a) {
            if (!this.isHidden) {
                var [b, c] = this.getCoords(a);
                b = Math.max(0, Math.min(this.paletteWidth, b));
                c = Math.max(0, Math.min(this.paletteHeight, c));
                this.palettePointerX = b;
                this.palettePointerY = c;
                this.updatePalettePointer(b, c);
                this.hsv = this.getPaletteColor(b, c);
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: GPColorUtils_.hsvToHex(...this.hsv)
                    }
                }))
            }
        }
        hueSliderDownHandler(a) {
            0 === a.button && (this.hueSlider.setPointerCapture(a.pointerId),
                this.hueSlider.addEventListener("pointermove", this.hueSliderMoveHandler), this.hueSlider.addEventListener("pointerup", b => {
                    this.hueSlider.removeEventListener("pointermove", this.hueSliderMoveHandler)
                }, {
                    once: !0
                }), this.hueSliderMoveHandler(a))
        }
        hueSliderMoveHandler(a) {
            if (!this.isHidden) {
                var [b, c] = this.getCoords(a), d = (a = this.huePosDir === GPColorPicker_.HORIZONTAL) ? b : c;
                this.updateHueSlider(d, a);
                this.hsv[0] = Math.round(Math.max(0, Math.min(100, d / (this.hueBarSize / 100)))) / 100;
                this.updatePaletteHue(this.hsv[0]);
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: GPColorUtils_.hsvToHex(...this.hsv)
                    }
                }))
            }
        }
        updatePalettePointer(a, b) {
            a = Math.max(0, Math.min(100, a / (this.paletteWidth / 100)));
            this.pointerWrapper.style.top = `${Math.max(0,Math.min(100,b/(this.paletteHeight/100)))}%`;
            this.pointerWrapper.style.left = `${a}%`
        }
        updatePaletteHue(a) {
            const [b, c, d] = GPColorUtils_.hsvToRgb(a, 1, 1);
            this.paletteHue.style.backgroundColor = `rgb(${b}, ${c}, ${d})`
        }
        updateHueSlider(a, b = this.huePosDir === GPColorPicker_.HORIZONTAL) {
            a = Math.max(0,
                Math.min(100, a / (this.hueBarSize / 100)));
            b ? this.hueHandleWrapper.style.left = `${a}%` : this.hueHandleWrapper.style.top = `${a}%`
        }
        getPaletteColor(a, b) {
            return Number.isNaN(a) || Number.isNaN(b) ? this.hsv : [this.hsv[0], Math.max(0, Math.min(100, Math.round(a / (this.paletteWidth / 100)))) / 100, Math.max(0, Math.min(100, Math.round((this.paletteHeight - b) / (this.paletteHeight / 100)))) / 100]
        }
        getCoords(a) {
            const b = a.target.getBoundingClientRect(),
                [c, d] = a.touches ? [a.touches[0].clientX, a.touches[0].clientY] : [a.clientX, a.clientY],
                [e,
                    f
                ] = [c - b.left, d - b.top];
            return [a.target.clientWidth / b.width * e, a.target.clientHeight / b.height * f]
        }
        getColor() {
            return GPColorUtils_.hsvToHex(...this.hsv)
        }
        setColor(a) {
            const [b, c, d] = GPColorUtils_.hexToHsv(a);
            this.hsv = [b, c, d];
            a = this.hueBarSize * b;
            const e = this.paletteWidth * c,
                f = this.paletteHeight - this.paletteHeight * d;
            this.palettePointerX = Math.max(0, Math.min(this.paletteWidth, e));
            this.palettePointerY = Math.max(0, Math.min(this.paletteHeight, f));
            this.updateHueSlider(a);
            this.updatePaletteHue(b);
            this.updatePalettePointer(e,
                f)
        }
    }
    window.GPColorPicker_ = GPColorPicker_;
    class GPColorUtils_ {
        static hsvToRgb(a, b, c) {
            let d, e, f;
            const g = Math.floor(6 * a),
                h = 6 * a - g;
            a = c * (1 - b);
            const k = c * (1 - h * b);
            b = c * (1 - (1 - h) * b);
            switch (g % 6) {
                case 0:
                    d = c;
                    e = b;
                    f = a;
                    break;
                case 1:
                    d = k;
                    e = c;
                    f = a;
                    break;
                case 2:
                    d = a;
                    e = c;
                    f = b;
                    break;
                case 3:
                    d = a;
                    e = k;
                    f = c;
                    break;
                case 4:
                    d = b;
                    e = a;
                    f = c;
                    break;
                case 5:
                    d = c, e = a, f = k
            }
            return [Math.round(255 * d), Math.round(255 * e), Math.round(255 * f)]
        }
        static rgbToHex(a, b, c) {
            return "#" + (16777216 + (a << 16) + (b << 8) + c).toString(16).slice(1)
        }
        static hsvToHex(a, b, c) {
            a = this.hsvToRgb(a, b, c);
            return this.rgbToHex(...a)
        }
        static hexToRgb(a) {
            a =
                a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i, (b, c, d, e) => c + c + d + d + e + e);
            return (a = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a)) ? [parseInt(a[1], 16), parseInt(a[2], 16), parseInt(a[3], 16)] : null
        }
        static rgbToHsv(a, b, c) {
            a /= 255;
            b /= 255;
            c /= 255;
            const d = Math.max(a, b, c),
                e = Math.min(a, b, c);
            let f;
            const g = d - e;
            if (d == e) f = 0;
            else {
                switch (d) {
                    case a:
                        f = (b - c) / g + (b < c ? 6 : 0);
                        break;
                    case b:
                        f = (c - a) / g + 2;
                        break;
                    case c:
                        f = (a - b) / g + 4
                }
                f /= 6
            }
            return [f, 0 == d ? 0 : g / d, d]
        }
        static hexToHsv(a) {
            a = this.hexToRgb(a);
            return this.rgbToHsv(...a).map(b => Math.floor(1E3 *
                b) / 1E3)
        }
        static rgbToHsl(a, b, c) {
            a /= 255;
            b /= 255;
            c /= 255;
            const d = Math.max(a, b, c);
            var e = Math.min(a, b, c);
            let f, g = (d + e) / 2;
            if (d == e) f = e = 0;
            else {
                const h = d - e;
                e = .5 < g ? h / (2 - d - e) : h / (d + e);
                switch (d) {
                    case a:
                        f = (b - c) / h + (b < c ? 6 : 0);
                        break;
                    case b:
                        f = (c - a) / h + 2;
                        break;
                    case c:
                        f = (a - b) / h + 4
                }
                f /= 6
            }
            return [f, e, g]
        }
        static hexToHsl(a) {
            a = this.hexToRgb(a);
            return this.rgbToHsl(...a)
        }
    }
    window.GPColorUtils_ = GPColorUtils_;
    class GPColorWheel_ extends EventTarget {
        static SIZE = 300;
        static DEFAULT_COLOR = "#000000";
        static DEFAULT_BRIGHTNESS = 1;
        static MOUSE_WHEEL_ENABLED = !1;
        static SECOND_BUTTON_ENABLED = !0;
        static MODE = {
            SINGLE: "single",
            COMPLEMENTARY: "complementary",
            SPLIT_COMPLEMENTARY: "split_complementary",
            ANALOGOUS: "analogous",
            TRIADIC: "triadic",
            TETRADIC: "tetradic"
        };
        static DEFAULT_MODE = this.MODE.COMPLEMENTARY;
        static MODE_MENU_TYPE = {
            TEXT: "text",
            ICON: "icon"
        };
        static DEFAULT_MODE_MENU_TYPE = this.MODE_MENU_TYPE.ICON;
        static MODE_ICON_PATTERN = '<svg class="icon_" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg"><defs><style>.cw-ic_{r:32px;fill:#000;cx:200px;cy:68px;transform-origin:200px 200px}</style></defs><circle cx="200" cy="200" r="200" fill="currentColor"/>{markers}</svg>';
        static MARKERS = {
            [this.MODE.SINGLE]: [0],
            [this.MODE.COMPLEMENTARY]: [0, 6],
            [this.MODE.SPLIT_COMPLEMENTARY]: [0, 5, 7],
            [this.MODE.ANALOGOUS]: [0, 1, 11],
            [this.MODE.TRIADIC]: [0, 4, 8],
            [this.MODE.TETRADIC]: [0, 3, 6, 9]
        };
        static HUE_STEP = .0833;
        constructor(a = GPColorWheel_.DEFAULT_MODE, b = GPColorWheel_.DEFAULT_COLOR, c = GPColorWheel_.SIZE, d) {
            super();
            this.l = d;
            this.size = c;
            this.brightness = GPColorWheel_.DEFAULT_BRIGHTNESS;
            this.mode = b;
            this.currentModeIndex = Object.values(GPColorWheel_.MODE).indexOf(this.mode);
            this.render();
            this.setColor(a)
        }
        getElement() {
            return this.container
        }
        render() {
            this.container =
                document.createElement("div");
            this.container.className = "gp-color-wheel_";
            this.container.dataset.menuType = GPColorWheel_.DEFAULT_MODE_MENU_TYPE;
            this.container.style.setProperty("--color-wheel-size", `${this.size}px`);
            this.modesMenu = document.createElement("div");
            this.modesMenu.className = "modes-menu_ folded_";
            const a = e => {
                this.hideModesMenu()
            };
            this.modesMenu.addEventListener("pointerdown", e => {
                if (0 === e.button) {
                    var f = this.modesMenu.classList.contains("folded_"),
                        g = e.target.parentElement === this.modesMenu;
                    g &&
                        document.removeEventListener("pointerup", a, {
                            once: !0
                        });
                    document.addEventListener("pointerup", h => {
                        h.target.parentElement !== this.modesMenu || h.target.classList.contains("selected_") && f ? f && !g && document.addEventListener("pointerup", a, {
                            once: !0
                        }) : (this.hideModesMenu(), this.selectMode(h.target.dataset.mode), document.removeEventListener("pointerup", a, {
                            once: !0
                        }))
                    }, {
                        once: !0
                    });
                    this.showModesMenu()
                }
            });
            this.container.appendChild(this.modesMenu);
            const b = this.l.COLOR_WHEEL_MODES.split("|");
            Object.values(GPColorWheel_.MODE).forEach((e,
                f) => {
                const g = document.createElement("div");
                g.className = "item_";
                g.classList.toggle("selected_", e === this.mode);
                g.dataset.mode = e;
                e = this.buildModeIcon(e);
                g.appendChild(e);
                e = document.createElement("div");
                e.className = "title_";
                e.textContent = b[f];
                g.appendChild(e);
                this.modesMenu.appendChild(g)
            });
            const c = document.createElement("div");
            c.className = "wheel_";
            c.addEventListener("pointerdown", e => {
                0 === e.button && e.target === e.currentTarget && (c.classList.add("pressed_"), document.addEventListener("pointerup", f => {
                    c.classList.remove("pressed_")
                }, {
                    once: !0
                }))
            });
            c.addEventListener("pointerdown", e => {
                0 === e.button && e.target === e.currentTarget && this.selectColorHandler(e, null, null, this.getScale())
            });
            GPColorWheel_.SECOND_BUTTON_ENABLED && c.addEventListener("contextmenu", e => {
                this.changeMode(1);
                e.preventDefault()
            });
            GPColorWheel_.MOUSE_WHEEL_ENABLED && c.addEventListener("wheel", e => {
                this.changeMode(e.deltaY);
                e.preventDefault()
            });
            this.container.appendChild(c);
            this.canvas = document.createElement("canvas");
            this.canvas.className = "canvas_";
            this.canvas.width = 300;
            this.canvas.height = 300;
            c.appendChild(this.canvas);
            const d = this.canvas.getContext("2d");
            this.drawWheel(d);
            this.markers = document.createElement("div");
            this.markers.className = "markers_";
            this.markers.addEventListener("pointerdown", e => {
                if (0 === e.button) {
                    var {
                        width: f,
                        height: g
                    } = e.target.getBoundingClientRect();
                    this.hsv = e.target.hsv;
                    var h = this.getScale();
                    this.selectColorHandler(e, e.offsetX * h - f / 2, e.offsetY * h - g / 2, h)
                }
            });
            c.appendChild(this.markers);
            this.brightnessInput = document.createElement("input");
            this.brightnessInput.className =
                "brightness_";
            this.brightnessInput.type = "range";
            this.brightnessInput.min = 0;
            this.brightnessInput.max = 1;
            this.brightnessInput.step = .01;
            this.brightnessInput.value = this.brightness;
            this.brightnessInput.addEventListener("input", e => {
                this.hsv[2] = Number.parseFloat(e.target.value);
                this.updateBrightness();
                this.renderMarkers();
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: GPColorUtils_.hsvToHex(...this.hsv)
                    }
                }))
            });
            this.container.appendChild(this.brightnessInput)
        }
        showModesMenu() {
            this.modesMenu.classList.remove("folded_")
        }
        hideModesMenu() {
            this.modesMenu.classList.add("folded_")
        }
        buildModeIcon(a) {
            a =
                GPColorWheel_.MARKERS[a].map(b => `<circle class="cw-ic_" transform="rotate(${30*b+180})"/>`);
            a = GPColorWheel_.MODE_ICON_PATTERN.replace("{markers}", a);
            return (new DOMParser).parseFromString(a, "image/svg+xml").documentElement
        }
        selectMode(a) {
            a !== this.mode && (this.mode = a, this.currentModeIndex = Object.values(GPColorWheel_.MODE).indexOf(a), this.updateModesMenu(), this.renderMarkers(), this.dispatchEvent(new CustomEvent("mode", {
                detail: {
                    mode: this.mode
                }
            })))
        }
        updateModesMenu() {
            this.hideModesMenu();
            Array.from(this.modesMenu.children).forEach(a => {
                a.classList.toggle("selected_", a.dataset.mode === this.mode)
            })
        }
        changeMode(a) {
            const b = Object.values(GPColorWheel_.MODE);
            this.currentModeIndex = 0 < a ? (this.currentModeIndex + 1) % b.length : (this.currentModeIndex - 1 + b.length) % b.length;
            this.mode = b[this.currentModeIndex];
            this.updateModesMenu();
            this.renderMarkers();
            this.dispatchEvent(new CustomEvent("mode", {
                detail: {
                    mode: this.mode
                }
            }))
        }
        updateBrightness() {
            this.brightness = this.hsv[2];
            this.brightnessInput.value = this.hsv[2];
            this.canvas.style.opacity = 1 * this.hsv[2]
        }
        drawWheel(a) {
            a.clearRect(0,
                0, a.canvas.width, a.canvas.height);
            const b = a.canvas.width / 2;
            a.translate(b, b);
            a.lineWidth = 3;
            let c = b,
                d = 0;
            this.plot(a, c, d, 0);
            const e = 45 / Math.floor(b / Math.sqrt(2));
            let f = 1.25 - b;
            for (; c > d;) {
                ++d;
                0 > f ? f += 2 * d + 3 : (f += 2 * (d - c) + 5, --c);
                const g = d * e;
                this.plot(a, c, d, g);
                this.plot(a, d, c, 90 - g)
            }
            a.translate(-b, -b)
        }
        plot(a, b, c, d) {
            const e = [b, -c, -b, c];
            b = [c, b, -c, -b];
            for (c = 0; 4 > c; ++c) {
                const f = a.createLinearGradient(0, 0, e[c], b[c]);
                f.addColorStop(0, "white");
                f.addColorStop(1, `rgb(${GPColorUtils_.hsvToRgb((-(d+90*c)%360+360)%360/360,
1,1).join(",")})`);
                a.strokeStyle = f;
                a.beginPath();
                a.moveTo(0, 0);
                a.lineTo(e[c], b[c]);
                a.stroke()
            }
        }
        selectColorHandler(a, b, c, d) {
            const e = f => {
                this.selectColor(f, a.target.index, b, c, d)
            };
            a.currentTarget.setPointerCapture(a.pointerId);
            a.currentTarget.addEventListener("pointermove", e);
            a.currentTarget.addEventListener("pointerup", f => {
                f.currentTarget.removeEventListener("pointermove", e)
            }, {
                once: !0
            });
            this.selectColor(a, a.target.index, b, c, d)
        }
        selectColor(a, b, c, d, e) {
            const [f, g] = this.getCoords(a, c, d, e);
            a = this.size / 2;
            this.hsv = [1 - (this.getAngle(a, a, f, g) + 180) % 360 / 360, Math.min(this.getDistance(a, a, f, g) / a, 1), Number.parseFloat(this.brightness)];
            this.updateMarkers(b);
            this.dispatchEvent(new CustomEvent("color", {
                detail: {
                    color: GPColorUtils_.hsvToHex(...this.hsv)
                }
            }))
        }
        renderMarkers() {
            this.markers.innerHTML = "";
            GPColorWheel_.MARKERS[this.mode].forEach((a, b) => {
                a = this.renderMarker([1 + (this.hsv[0] - GPColorWheel_.HUE_STEP * a) % 1, this.hsv[1], this.hsv[2]], b);
                this.markers.appendChild(a)
            })
        }
        renderMarker(a, b) {
            const [c, d] = this.getColorCoords(a),
                e = document.createElement("div");
            e.className = "marker_";
            e.classList.toggle("main_", 0 === b);
            e.style.top = `${d}px`;
            e.style.left = `${c}px`;
            e.style.backgroundColor = `rgb(${GPColorUtils_.hsvToRgb(...a).join(",")})`;
            e.index = b;
            e.hsv = a;
            return e
        }
        updateMarkers(a = 0) {
            Array.from(this.markers.children).forEach(b => {
                const c = [1 + (this.hsv[0] - GPColorWheel_.HUE_STEP * (GPColorWheel_.MARKERS[this.mode][b.index] - GPColorWheel_.MARKERS[this.mode][a])) % 1, this.hsv[1], this.hsv[2]],
                    [d, e] = this.getColorCoords(c);
                b.style.top = `${e}px`;
                b.style.left = `${d}px`;
                b.style.backgroundColor = `rgb(${GPColorUtils_.hsvToRgb(...c).join(",")})`
            })
        }
        getColorCoords(a) {
            var b = this.size / 2;
            const c = a[1] * b,
                d = Math.PI / 180 * (360 * a[0] + 90);
            a = b + c * Math.sin(d);
            b += c * Math.cos(d);
            1E-10 > Math.abs(a) && (a = 0);
            1E-10 > Math.abs(b) && (b = 0);
            return [a, b]
        }
        getCoords(a, b = 0, c = 0, d = 1) {
            const e = a.currentTarget.getBoundingClientRect();
            return [(a.clientX - e.left - b) / d, (a.clientY - e.top - c) / d]
        }
        getDistance(a, b, c, d) {
            a = c - a;
            b = d - b;
            return Math.sqrt(a * a + b * b)
        }
        getAngle(a, b, c, d) {
            return 180 / Math.PI * Math.atan2(d -
                b, c - a) + 180
        }
        setColor(a) {
            this.hsv = GPColorUtils_.hexToHsv(a);
            this.updateBrightness();
            this.renderMarkers()
        }
        getScale() {
            return this.container.getBoundingClientRect().width / this.container.offsetWidth
        }
        enable() {
            this.container.removeAttribute("disabled")
        }
        disable() {
            this.container.setAttribute("disabled", "")
        }
        remove() {
            this.container.remove()
        }
    }
    window.GPColorWheel_ = GPColorWheel_;
    class GPDrawInterface_ extends EventTarget {
        static MOBILE_MAX_WIDTH = 640;
        static TOOLS_IDS_CLASSES = {
            1: "pen",
            2: "ers",
            3: "lin",
            4: "reb",
            5: "ellb",
            6: "rec",
            7: "ell",
            8: "fil",
            10: "note"
        };
        static TOOLS = {
            pen: {
                id: 1,
                tumbler: !0
            },
            ers: {
                id: 2,
                tumbler: !0
            },
            reb: {
                id: 4,
                tumbler: !0
            },
            ellb: {
                id: 5,
                tumbler: !0
            },
            rec: {
                id: 6,
                tumbler: !0
            },
            ell: {
                id: 7,
                tumbler: !0
            },
            lin: {
                id: 3,
                tumbler: !0
            },
            fil: {
                id: 8,
                tumbler: !0
            },
            dropper: {
                id: "",
                tumbler: !0,
                disabled: !0
            },
            note: {
                id: 10,
                tumbler: !0
            },
            hide: {
                id: ""
            },
            undo: {
                id: ""
            },
            redo: {
                id: ""
            }
        };
        static FILTER_TOOL_CLASSES = ["jsx",
            "tool", "sel"
        ];
        static THICKNESSES = [2, 6, 10, 14, 18];
        static SELECTORS = {
            CORE: ".core",
            SCREEN: ".screen",
            TOOLS: ".tools",
            TOOL: ".tools .tool",
            SELECTED_TOOL: ".tool.sel",
            OPTIONS: ".options",
            OPACITY: ".bxopacity input",
            THICKNESS: ".thickness",
            SAVE_BTN: "button.download",
            READY_ICON: "i.ready,i.pencil"
        };
        static SYMMETRY_ICONS = {
            VERTICAL: '<svg width="26" height="26"><path d="M13.018 2.34v21.251h0" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.28163504"/></svg>',
            HORIZONTAL: '<svg width="26" height="26"><path d="M23.643 12.966H2.393h0" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.28163504"/></svg>',
            QUADRANT: '<svg width="26" height="26"><g stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.452"><path d="M23.643 12.966H2.393M13.018 2.34v21.251" stroke-width="2.28163504"/></g></svg>',
            RADIAL: '<svg width="26" height="26" fill="none"><circle cx="13" cy="13" r="10.387" stroke="currentColor" stroke-width="2.8"/></svg>',
            MANDALA: '<svg width="26" height="26" fill="none"><circle cx="13" cy="13" r="10.387" stroke="currentColor" stroke-width="2.8"/><g fill="currentColor" stroke-width="1.313"><path d="M13.04 13.623c-.658 0-1.203-.317-1.203-.698V3.257c0-.382.545-.698 1.203-.698s1.202.316 1.202.698v9.668c0 .381-.545.698-1.202.698z"/><path d="M22.628 18.581c-.334.566-.884.875-1.212.681l-8.326-4.915c-.329-.194-.324-.824.01-1.39s.884-.875 1.213-.68l8.325 4.914c.329.194.324.824-.01 1.39z"/><path d="M3.4 18.603c.334.566.884.874 1.212.68l8.326-4.914c.328-.194.324-.825-.01-1.39-.335-.567-.884-.875-1.213-.682L3.39 17.212c-.328.194-.323.825.01 1.39z"/></g></svg>'
        };
        static KEY_ALIASES = {
            Control: "Ctrl"
        };
        constructor(a,
            b, c) {
            super();
            this.gpproxy = b;
            this.l = c;
            this.style = document.documentElement.style;
            this.painter = a;
            this.initialSettings = a.getSettingsCopy();
            this.s = a.getSettings();
            this.bindingsScrollPos = this.settingsScrollPos = 0;
            this.toolsContainer;
            this.colorPanel;
            this.optionsContainer;
            this.thicknessesContainer;
            this.readyBtn;
            this.readyIcon;
            this.readyLabel;
            this.saveBtn;
            this.readyWarning;
            this.isInit = !1;
            this.tools = {};
            this.thicknesses = {};
            this.currentThickness = this.currentTool = null;
            this.currentKeys;
            this.pressedKeys;
            this.currentBindingElem =
                null;
            GPUtils_.bindMethods([this.toolsContainerClickHandler, this.opacityChangeHandler, this.thicknessesContainerClickHandler, this.readyBtnClickHandler, this.saveBtnClickHandler, this.symmetryModesClickHandler, this.settingsBtnHandler, this.renderSettingsHandler, this.resetBindings, this.renderBindingsHandler, this.setBindingHandler, this.keyUpHandler, this.keyDownHandler, this.keyHandler, this.resizeHandler, this.stopBinding], this);
            this.painter.addEventListener("mirror", ({
                detail: {
                    state: d
                }
            }) => {
                this.toolsStates.classList.toggle("mirror_",
                    d)
            });
            this.painter.addEventListener("vertical-mirror", ({
                detail: {
                    state: d
                }
            }) => {
                this.toolsStates.classList.toggle("vertical-mirror_", d)
            });
            this.painter.addEventListener("grayscale", ({
                detail: {
                    state: d
                }
            }) => {
                this.toolsStates.classList.toggle("grayscale_", d)
            });
            this.painter.addEventListener("zoom", ({
                detail: {
                    value: d
                }
            }) => {
                this.toolsStates.classList.remove("zoom-in_", "zoom-out_");
                1 !== d && (1 < d ? this.toolsStates.classList.add("zoom-in_") : this.toolsStates.classList.add("zoom-out_"))
            });
            this.updatePanelsBackground(this.initialSettings.panelsBackgroundColor,
                this.initialSettings.panelsBackgroundOpacity);
            this.updatePanelsElements(this.initialSettings.panelsElementsColor, this.initialSettings.panelsElementsOpacity);
            this.updateControlsBackgroundBlurLevel(this.initialSettings.controlsBackgroundBlurLevel)
        }
        init() {
            var a = GPDrawInterface_.SELECTORS;
            this.core = document.querySelector(a.CORE);
            this.core.classList.add("background_");
            this.screen = document.querySelector(a.SCREEN);
            this.screen.classList.add("gp-painter-rendered_");
            this.toolsContainer = document.querySelector(a.TOOLS);
            this.toolsContainer.addEventListener("click", this.toolsContainerClickHandler);
            this.toolsContainer.querySelectorAll(a.TOOL).forEach(c => {
                for (let d in GPDrawInterface_.TOOLS)
                    if (c.classList.contains(d)) {
                        c.dataset.toolid = GPDrawInterface_.TOOLS[d].id;
                        this.tools[d] = c;
                        break
                    }
            });
            this.currentTool = this.tools[GPDrawInterface_.TOOLS_IDS_CLASSES[this.painter.tool]];
            this.colorPanel = new GPColorPanel_(this.painter, this.gpproxy, this.l);
            this.colorPanel.addEventListener("color", ({
                detail: {
                    color: c
                }
            }) => {
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: c
                    }
                }))
            });
            this.colorPanel.addEventListener("color2", ({
                detail: {
                    color: c
                }
            }) => {
                this.dispatchEvent(new CustomEvent("color2", {
                    detail: {
                        color: c
                    }
                }))
            });
            this.colorPanel.addEventListener("controls-set-changed", ({
                detail: {
                    name: c
                }
            }) => {
                this.painter.setColorPanelControlsSet(c)
            });
            this.colorPanel.addEventListener("color-wheel-mode-changed", ({
                detail: {
                    mode: c
                }
            }) => {
                this.painter.setColorWheelMode(c)
            });
            this.optionsContainer = document.querySelector(a.OPTIONS);
            this.nativeOpacity = this.optionsContainer.querySelector(a.OPACITY);
            this.nativeOpacity.addEventListener("change", this.opacityChangeHandler);
            this.opacity = this.initOpacityPanel(this.s.minOpacity, this.painter.opacity, this.optionsContainer.querySelector(a.OPACITY));
            const b = this.optionsContainer.querySelectorAll(a.THICKNESS);
            b.forEach((c, d) => {
                d = GPDrawInterface_.THICKNESSES[d];
                c.dataset.value = d;
                this.thicknesses[d] = c;
                c.classList.remove("sel");
                this.painter.thickness === d && (c.classList.add("sel"), this.currentThickness = c)
            });
            this.thicknessesContainer = b[0].parentElement;
            this.thicknessesContainer.addEventListener("click",
                this.thicknessesContainerClickHandler);
            this.readyIcon = document.querySelector(a.READY_ICON);
            this.readyBtn = this.readyIcon.closest("button");
            this.readyBtn.addEventListener("click", this.readyBtnClickHandler, !0);
            this.readyLabel = this.readyBtn.querySelector("strong");
            this.readyBtn.hasAttribute("disabled") && this.readyBtn.removeAttribute("disabled");
            this.painter.addEventListener("stroke", c => {
                this.readyBtn.hasAttribute("disabled") && this.readyBtn.removeAttribute("disabled")
            }, {
                once: !0
            });
            this.painter.addEventListener("stroke_redo",
                c => {
                    this.readyBtn.hasAttribute("disabled") && this.readyBtn.removeAttribute("disabled")
                }, {
                    once: !0
                });
            this.updateReadyBtn();
            this.saveBtn = document.querySelector(a.SAVE_BTN);
            this.saveBtn.addEventListener("click", this.saveBtnClickHandler, !0);
            a = document.querySelector(".header");
            this.painter.reference && (this.referenceBtn = a.appendChild(this.painter.reference.getPainterButton()));
            this.painter.timer && this.painter.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION) && this.painter.gpproxy.isHost() && a.appendChild(this.painter.timer.getElement());
            this.symmetryModes = document.createElement("form");
            this.symmetryModes.className = "gp-painter-symmetry-modes_";
            this.symmetryModes.addEventListener("change", this.symmetryModesClickHandler);
            this.symmetryGuidesCount = document.createElement("div");
            this.symmetryGuidesCount.className = "guides-count_ btn_";
            this.symmetryGuidesCount.addEventListener("wheel", c => {
                c.currentTarget.dataset.count = this.painter.getSymmetryMode() === GPPainter_.SYMMETRY_MODES.RADIAL ? this.painter.changeSymmetryRadialGuidesCount(c.deltaY) :
                    this.painter.changeSymmetryMandalaGuidesCount(c.deltaY)
            });
            this.symmetryGuidesCount.addEventListener("pointerdown", c => {
                let d = c.clientY;
                const e = f => {
                    const g = f.clientY - d;
                    Math.abs(g) >= GPPainter_.SYMMETRY_GUIDES_COUNT_SENSITIVITY && (f.currentTarget.dataset.count = this.painter.getSymmetryMode() === GPPainter_.SYMMETRY_MODES.RADIAL ? this.painter.changeSymmetryRadialGuidesCount(g) : this.painter.changeSymmetryMandalaGuidesCount(g), d = f.clientY)
                };
                this.symmetryGuidesCount.setPointerCapture(c.pointerId);
                this.symmetryGuidesCount.addEventListener("pointermove",
                    e);
                this.symmetryGuidesCount.addEventListener("pointerup", f => {
                    this.symmetryGuidesCount.removeEventListener("pointermove", e)
                }, {
                    once: !0
                })
            });
            this.painter.getSymmetryModes().forEach(c => {
                var d = GPPainter_.SYMMETRY_MODES[c];
                const e = `sm-mode-${d}_`,
                    f = document.createElement("input");
                f.type = "radio";
                f.name = "sm-group_";
                f.id = e;
                f.checked = d === this.painter.getSymmetryMode();
                f.dataset.modeId = d;
                this.symmetryModes.appendChild(f);
                d = document.createElement("label");
                d.className = `${c.toLowerCase()}_ btn_`;
                d.setAttribute("for",
                    e);
                d.innerHTML = GPDrawInterface_.SYMMETRY_ICONS[c];
                this.symmetryModes.appendChild(d)
            });
            this.symmetryModes.appendChild(this.symmetryGuidesCount);
            this.toolsContainer.firstElementChild.before(this.symmetryModes);
            this.updateSymmetryPanel(this.painter.isSymmetryEnabled);
            this.updateSymmetryGuidesCount(this.painter.getSymmetryMode());
            this.actionQueueSize = document.createElement("div");
            this.actionQueueSize.className = "action-queue-size_";
            a.appendChild(this.actionQueueSize);
            this.toolsStates = document.createElement("div");
            this.toolsStates.className = "tools-states_";
            ["mirror", "vertical-mirror", "grayscale", "zoom-in", "zoom-out"].forEach(c => {
                const d = document.createElement("div");
                d.className = `${c}_ state_`;
                this.toolsStates.appendChild(d)
            });
            a.appendChild(this.toolsStates);
            this.settingsBtn = document.createElement("div");
            this.settingsBtn.className = "gp-painter-settings-btn_";
            this.settingsBtn.addEventListener("click", this.settingsBtnHandler);
            a.appendChild(this.settingsBtn);
            this.settingsPane = document.createElement("div");
            this.settingsPane.className =
                "settings_";
            this.settingsPane.classList.add("hidden");
            this.painter.container.appendChild(this.settingsPane);
            this.settingsButtons = document.createElement("div");
            this.settingsButtons.className = "buttons_";
            this.settingsPane.appendChild(this.settingsButtons);
            this.settingsTabBtn = document.createElement("div");
            this.settingsTabBtn.className = "main-settings_ btn_ gp-ui-btn_";
            this.settingsTabBtn.textContent = this.l.SETTINGS_BTN_LBL;
            this.settingsTabBtn.addEventListener("click", this.renderSettingsHandler);
            this.settingsButtons.appendChild(this.settingsTabBtn);
            this.bindingsBtn = document.createElement("div");
            this.bindingsBtn.className = "bindings-settings_ btn_ gp-ui-btn_";
            this.bindingsBtn.textContent = this.l.BINDINGS_BTN_LBL;
            this.bindingsBtn.addEventListener("click", this.renderBindingsHandler);
            this.settingsButtons.appendChild(this.bindingsBtn);
            this.settingsContent = document.createElement("div");
            this.settingsContent.className = "content_";
            this.settingsPane.appendChild(this.settingsContent);
            this.settingsPane.addEventListener("pointerdown", this.unlockElement);
            this.settingsPane.addEventListener("pointerup",
                this.unlockElement);
            this.settingsPane.addEventListener("pointermove", this.unlockElement);
            this.settingsPane.addEventListener("mousedown", this.unlockElement);
            this.settingsPane.addEventListener("mouseup", this.unlockElement);
            this.settingsPane.addEventListener("mousemove", this.unlockElement);
            this.settingsPane.addEventListener("wheel", this.unlockElement);
            this.toggleFixedScreenSize(this.s.fixedScreenSize);
            this.toggleHeaderBackground(this.s.hideHeaderBackground);
            this.updateHeaderColor(this.s.headerColor);
            this.updateHeaderPhraseColor(this.s.headerInstructionsColor);
            this.setAutoHideHeaderState(this.s.autoHideHeaderElements);
            this.setAutoHideHeaderDelay(this.s.autoHideHeaderDelay);
            this.enableInterface();
            window.addEventListener("resize", this.resizeHandler);
            this.lastViewportWidth = window.innerWidth;
            this.isInit = !0
        }
        terminate() {
            this.isInit && (this.tools = {}, this.thicknesses = {}, this.currentThickness = this.currentTool = null, this.opacity.remove(), this.opacity.removeEventListener("change", this.opacityChangeHandler), this.opacity = null, this.settingsBtn.remove(), this.settingsBtn = null, this.settingsPane.remove(), this.settingsPane = null, this.toolsContainer.removeEventListener("click",
                    this.toolsContainerClickHandler), this.toolsContainer = null, this.nativeOpacity.removeEventListener("change", this.opacityChangeHandler), this.nativeOpacity = null, this.thicknessesContainer.removeEventListener("click", this.thicknessesContainerClickHandler), this.thicknessesContainer = null, this.readyBtn.removeEventListener("click", this.readyBtnClickHandler, !0), this.readyBtn = null, this.symmetryModes.remove(), this.symmetryModes = null, this.actionQueueSize.remove(), this.actionQueueSize = null, this.toolsStates.remove(),
                this.toolsStates = null, this.saveBtn.removeEventListener("click", this.saveBtnClickHandler, !0), this.saveBtn = null, this.painter.reference && (this.referenceBtn.remove(), this.referenceBtn = null), this.core && this.core.classList.remove("background_"), this.readyWarning && (this.readyWarning.remove(), this.referenceBtn = null), this.colorPanel.terminate(), this.colorPanel = null, this.screen.classList.remove("gp-painter-rendered_"))
        }
        resizeHandler(a) {
            a = window.innerWidth;
            if (this.lastViewportWidth <= GPDrawInterface_.MOBILE_MAX_WIDTH &&
                a > GPDrawInterface_.MOBILE_MAX_WIDTH || this.lastViewportWidth > GPDrawInterface_.MOBILE_MAX_WIDTH && a <= GPDrawInterface_.MOBILE_MAX_WIDTH) this.terminate(), this.init();
            this.lastViewportWidth = a
        }
        initOpacityPanel(a, b, c) {
            const d = document.createElement("input");
            d.className = "gp-opacity-slider_";
            d.type = "range";
            d.min = a;
            d.max = 1;
            d.step = "0.01";
            d.value = b;
            d.addEventListener("change", this.opacityChangeHandler);
            c.after(d);
            return d
        }
        updateNativePalette(a) {
            this.colorPanel.updateNativePalette(a)
        }
        updateExtendedPalette(a) {
            this.colorPanel.updateExtendedPalette(a)
        }
        toggleInterface(a) {
            a ?
                this.enableInterface() : this.disableInterface()
        }
        enableInterface() {
            this.painter.enable();
            this.toolsContainer.classList.remove("disabled");
            this.optionsContainer.classList.remove("disabled");
            this.opacity.removeAttribute("disabled");
            this.updatePanelsBackground(this.s.panelsBackgroundColor, this.s.panelsBackgroundOpacity);
            this.colorPanel.enable()
        }
        disableInterface() {
            this.painter.disable();
            this.toolsContainer.classList.add("disabled");
            this.optionsContainer.classList.add("disabled");
            this.opacity.setAttribute("disabled",
                "");
            this.updatePanelsBackground(this.s.panelsBackgroundColor, Math.max(this.s.panelsBackgroundOpacity - 10, 0));
            this.colorPanel.disable()
        }
        toggleFixedScreenSize(a) {
            this.screen.classList.toggle("fixed-size_", !!a);
            this.painter.resizeWindowHandler()
        }
        toggleHeaderBackground(a) {
            this.screen.classList.toggle("header-hidden_", !!a)
        }
        roundPixelOffset() {
            this.style.setProperty("--gp-pixel-offset-top", "0px");
            this.style.setProperty("--gp-pixel-offset-left", "0px");
            const {
                top: a,
                left: b
            } = window.getComputedStyle(this.screen),
                c = parseFloat(a) % 1, d = parseFloat(b) % 1;
            this.style.setProperty("--gp-pixel-offset-top", `${c}px`);
            this.style.setProperty("--gp-pixel-offset-left", `${d}px`)
        }
        unlockElement(a) {
            a.stopPropagation()
        }
        toolsContainerClickHandler(a) {
            if (a.target.classList.contains("tool")) {
                a.stopImmediatePropagation();
                var b = a.target,
                    c = this.filterToolClasses([...a.target.classList]),
                    d = c[0];
                a = GPDrawInterface_.TOOLS[d];
                if (!a.disabled) {
                    if (a.id) this.painter.setTool(a.id);
                    else switch (d) {
                        case "hide":
                            c = "hideon" === c[1];
                            b.classList.toggle("hideon",
                                !c);
                            this.painter.toggleLastDraw(c);
                            break;
                        case "undo":
                            this.painter.undo();
                            break;
                        case "redo":
                            this.painter.redo()
                    }
                    a.tumbler && (this.currentTool.classList.remove("sel"), b.classList.add("sel"), this.currentTool = b)
                }
            }
        }
        filterToolClasses(a) {
            return a.filter(b => !GPDrawInterface_.FILTER_TOOL_CLASSES.some(c => b.startsWith(c)))
        }
        opacityChangeHandler(a) {
            a.stopImmediatePropagation();
            this.painter.setOpacity(a.target.value)
        }
        thicknessesContainerClickHandler(a) {
            a.stopPropagation();
            a.target.classList.contains("thickness") &&
                (a = +a.target.dataset.value, this.painter.setThickness(a), this.updateThickness(a))
        }
        readyBtnClickHandler(a) {
            a.stopPropagation();
            this.painter.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION) && this.painter.gpproxy.isHost() && this.s.readyConfirmation && !this.painter.isReadyWarningShown ? this.showReadyWarning() : (this.painter.timer && this.painter.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION) && this.painter.gpproxy.isHost() && this.painter.timer.reset(), a = !this.painter.gpproxy.isReady(), this.updateReadyBtn(a),
                this.toggleInterface(!a), this.painter.gpproxy.ready())
        }
        showReadyWarning() {
            this.readyWarning = document.createElement("div");
            this.readyWarning.className = "ready-warning_";
            var a = document.createElement("div");
            a.className = "window_";
            this.readyWarning.appendChild(a);
            var b = document.createElement("div");
            b.className = "label_";
            b.textContent = this.l.READY_CONFIRMATION_LBL;
            a.appendChild(b);
            b = document.createElement("div");
            b.className = "buttons_";
            a.appendChild(b);
            a = document.createElement("div");
            a.className = "ok-btn_ btn_";
            a.textContent = this.l.READY_CONFIRMATION_OK_BTN_LBL;
            a.addEventListener("click", c => {
                this.readyWarning.remove();
                this.painter.isReadyWarningShown = !0;
                this.readyBtn.click()
            });
            b.appendChild(a);
            a = document.createElement("div");
            a.className = "cancel-btn_ btn_";
            a.textContent = this.l.READY_CONFIRMATION_CANCEL_BTN_LBL;
            a.addEventListener("click", c => {
                this.readyWarning.remove()
            });
            b.appendChild(a);
            this.screen.appendChild(this.readyWarning)
        }
        saveBtnClickHandler(a) {
            a.stopPropagation();
            this.painter.saveImage()
        }
        settingsBtnHandler(a) {
            this.painter.resetZoom();
            a = this.settingsPane.classList.toggle("hidden");
            this.screen.classList.toggle("gp-settings-shown_");
            a || this.renderSettings()
        }
        symmetryModesClickHandler(a) {
            a = +a.target.dataset.modeId;
            this.painter.setSymmetryMode(a);
            this.updateSymmetryGuidesCount(a)
        }
        updateSymmetryGuidesCount(a) {
            switch (a) {
                case GPPainter_.SYMMETRY_MODES.RADIAL:
                    this.symmetryGuidesCount.dataset.count = this.s.symmetryRadialGuidesCount;
                    break;
                case GPPainter_.SYMMETRY_MODES.MANDALA:
                    this.symmetryGuidesCount.dataset.count = this.s.symmetryMandalaGuidesCount
            }
        }
        renderSettings() {
            this.settingsContent.innerHTML =
                "";
            this.settingsView ? (this.settingsContent.appendChild(this.settingsView), this.painter.updateSettingsView(this.settingsView)) : this.settingsView = this.painter.insertSettingsView(this.settingsContent)
        }
        renderSettingsHandler(a) {
            this.renderSettings()
        }
        renderBindings(a, b) {
            this.settingsContent.innerHTML = "";
            const c = document.createElement("div");
            c.className = "bindings_ gp-ui-scrollbar_";
            c.addEventListener("scroll", g => {
                this.bindingsScrollPos = g.target.scrollTop;
                this.handleContentOverflow(g.target)
            });
            this.settingsContent.appendChild(c);
            var d = document.createElement("div");
            d.className = "buttons_";
            this.settingsContent.appendChild(d);
            var e = document.createElement("div");
            e.className = "reset-btn_ btn_ gp-ui-btn_";
            e.textContent = this.l.RESET_SETTINGS_BTN_LBL;
            e.title = this.l.RESET_SETTINGS_BTN_TTL;
            e.addEventListener("click", this.resetBindings);
            d.appendChild(e);
            d = document.createDocumentFragment();
            for (let g in a) {
                if (!this.painter.tools[g]) continue;
                g in b && (e = document.createElement("div"), e.className = "label_", e.textContent = b[g], d.appendChild(e));
                e = document.createElement("div");
                e.className = "name_";
                e.title = this.painter.tools[g].description;
                e.textContent = g.split(/(?=[A-Z])/).join(" ");
                d.appendChild(e);
                e = document.createElement("div");
                e.className = "keys-bindings_";
                const h = document.createElement("div");
                h.className = "keys-bindings-container_";
                e.appendChild(h);
                if (a[g].length) a[g].forEach((k, l) => {
                    k = this.renderBindingKeys(g, l, k, h, c);
                    h.appendChild(k)
                });
                else {
                    var f = this.renderBindingKeys(g, -1, [], h, c);
                    f.classList.add("empty_");
                    h.appendChild(f)
                }
                f = document.createElement("div");
                f.className = "add-btn_ btn_ gp-ui-btn_";
                f.addEventListener("click", k => {
                    k = this.renderBindingKeys(g, -1, [], h, c);
                    h.appendChild(k);
                    this.toggleScrollbar(c);
                    this.handleContentOverflow(c)
                });
                e.appendChild(f);
                d.appendChild(e)
            }
            c.appendChild(d);
            c.scrollTop = this.bindingsScrollPos;
            this.toggleScrollbar(c);
            this.handleContentOverflow(c)
        }
        renderBindingsHandler(a) {
            this.renderBindings(...this.painter.getBindings())
        }
        handleContentOverflow(a) {
            this.settingsContent.classList.toggle("of-top_", 0 < a.scrollTop);
            this.settingsContent.classList.toggle("of-bottom_",
                a.offsetHeight + a.scrollTop < a.scrollHeight)
        }
        renderBindingKeys(a, b, c, d, e) {
            c = this.formatKeys(c);
            const f = document.createElement("div");
            f.className = "keys-binding_";
            d = document.createElement("div");
            d.className = "keys_";
            d.textContent = c;
            d.dataset.name = a;
            d.dataset.index = b;
            d.dataset.initialValue = c;
            d.addEventListener("click", this.setBindingHandler);
            f.appendChild(d);
            c = document.createElement("div");
            c.className = "buttons_";
            f.appendChild(c);
            d = document.createElement("div");
            d.className = "delete-btn_ btn_ gp-ui-btn_";
            d.addEventListener("click", g => {
                this.deleteBinding(a, b, f);
                this.toggleScrollbar(e);
                this.handleContentOverflow(e)
            });
            c.appendChild(d);
            d = document.createElement("div");
            d.className = "accept-btn_ btn_ gp-ui-btn_";
            d.addEventListener("click", g => {
                this.isAcceptedBinding(this.currentKeys, this.pressedKeys) ? this.acceptBinding(this.currentBindingElem, this.pressedKeys) : this.cancelBinding(this.currentBindingElem)
            });
            c.appendChild(d);
            return f
        }
        deleteBinding(a, b, c) {
            if (~b) {
                const [d, e] = this.painter.getBindings();
                d[a].splice(b,
                    1);
                this.renderBindings(d, e);
                this.dispatchEvent(new CustomEvent("bindings_updated", {
                    detail: {
                        bindings: d
                    }
                }))
            } else c.remove()
        }
        setBindingHandler(a) {
            this.currentBindingElem && this.cancelBinding(this.currentBindingElem);
            this.painter.setKeysLockState(!0);
            a.currentTarget.focus();
            a = a.target;
            this.currentKeys = this.painter.getBindingKeys(a.dataset.name, +a.dataset.index);
            this.pressedKeys = new Set;
            this.currentBindingElem = a;
            a.parentElement.classList.add("process_");
            a.textContent = this.getPlaceholderKeys();
            document.addEventListener("keydown",
                this.keyDownHandler, !0);
            document.addEventListener("keyup", this.keyUpHandler, !0);
            document.addEventListener("pointerdown", this.stopBinding, !0)
        }
        stopBinding(a) {
            this.currentBindingElem ? this.currentBindingElem.parentElement.contains(a.target) || this.cancelBinding(this.currentBindingElem) : document.removeEventListener("pointerdown", this.stopBinding, !0)
        }
        keyDownHandler(a) {
            a.preventDefault();
            a.stopPropagation();
            if (!a.repeat) {
                var b = this.currentBindingElem;
                switch (a.code) {
                    case "Escape":
                        this.cancelBinding(b);
                        break;
                    case "Enter":
                    case "NumpadEnter":
                        this.isAcceptedBinding(this.currentKeys, this.pressedKeys) ? this.acceptBinding(b, this.pressedKeys) : this.cancelBinding(b);
                        break;
                    default:
                        this.pressedKeys.add(a.code), this.keyHandler(a)
                }
            }
        }
        keyUpHandler(a) {
            this.pressedKeys.delete(a.code);
            this.keyHandler(a)
        }
        keyHandler(a) {
            a = this.currentBindingElem;
            a.classList.remove("existed_");
            this.pressedKeys.size ? (a.textContent = this.formatKeys(this.pressedKeys), a.classList.toggle("existed_", this.isSameBindingKeys(this.currentKeys, this.pressedKeys) ||
                this.isBindingExists(this.pressedKeys))) : a.textContent = this.getPlaceholderKeys()
        }
        isAcceptedBinding(a, b) {
            return !(0 === b.size || this.isSameBindingKeys(a, b) || this.isBindingExists(b))
        }
        isBindingExists(a) {
            return this.painter.isBindingExisted(a)
        }
        isSameBindingKeys(a, b) {
            return this.painter.compareBindingsKeys(a, b)
        }
        acceptBinding(a, b) {
            b = Array.from(b).map(this.formatKey).join(" + ");
            a.textContent = b;
            a.dataset.initialValue = b;
            this.updateBindingsSettings(a.dataset.name, a.dataset.index);
            this.endBinding(a)
        }
        cancelBinding(a) {
            a.textContent =
                a.dataset.initialValue;
            this.endBinding(a)
        }
        endBinding(a) {
            this.painter.setKeysLockState(!1);
            a.parentElement.classList.remove("process_");
            a.classList.remove("existed_");
            document.removeEventListener("keydown", this.keyDownHandler, !0);
            document.removeEventListener("keyup", this.keyUpHandler, !0);
            document.removeEventListener("pointerdown", this.stopBinding, !0);
            this.currentBindingElem = null
        }
        resetBindings(a) {
            const [b, c] = this.painter.getDefaultBindings();
            this.renderBindings(b, c);
            this.dispatchEvent(new CustomEvent("bindings_updated", {
                detail: {
                    bindings: b
                }
            }))
        }
        updateBindingsSettings(a, b) {
            const [c, d] = this.painter.getBindings();
            b = ~b ? b : c[a].length;
            c[a][b] = [...this.pressedKeys];
            this.renderBindings(c, d);
            this.dispatchEvent(new CustomEvent("bindings_updated", {
                detail: {
                    bindings: c
                }
            }))
        }
        getPlaceholderKeys() {
            return "\u00a0"
        }
        formatKeys(a) {
            return a ? Array.from(a).map(this.formatKey).join(" + ") : this.getPlaceholderKeys()
        }
        formatKey(a) {
            return a.replace(/^(Key|Digit)?(.+?)((?:Left)|(?:Right))?$/, (b, c, d, e) => (GPDrawInterface_.KEY_ALIASES[d] ?? d) + ("Right" ===
                e ? ` (${e})` : ""))
        }
        toggleScrollbar(a) {
            a.classList.toggle("scrollbar_", a.scrollHeight > a.clientHeight)
        }
        toggleReference() {
            this.referenceBtn?.click()
        }
        updateToolbar(a) {
            this.currentTool.classList.remove("sel");
            this.currentTool = this.tools[GPDrawInterface_.TOOLS_IDS_CLASSES[a]];
            this.currentTool.classList.add("sel")
        }
        updateOpacity(a) {
            this.opacity.value = a
        }
        updateThickness(a) {
            a = this.thicknesses[a];
            this.currentThickness && (this.currentThickness.classList.remove("sel"), this.currentThickness = null);
            a && (a.classList.add("sel"),
                this.currentThickness = a)
        }
        updateReadyBtn(a) {
            a ?? this.painter.gpproxy.isReady() ? (this.readyIcon.classList.replace("ready", "pencil"), this.readyLabel.textContent = this.painter.localization.edit) : (this.readyIcon.classList.replace("pencil", "ready"), this.readyLabel.textContent = this.painter.localization.ready)
        }
        updateColorPickerPanel(a) {
            this.colorPanel.updateColorPickerPanel(a)
        }
        updatePanelsBackground(a, b) {
            const c = parseInt(a.substr(1, 2), 16),
                d = parseInt(a.substr(3, 2), 16),
                e = parseInt(a.substr(5, 2), 16);
            this.style.setProperty("--gp-panels-bg-color",
                `rgb(${c} ${d} ${e} / ${b}%)`);
            const [f, g, h] = GPColorUtils_.rgbToHsv(c, d, e), [k, l, m] = GPColorUtils_.hsvToRgb(Math.max(f - .04246122552758713, 0), Math.max(g - .012523565849717255, 0), Math.max(h - .05882352941176472, 0));
            this.style.setProperty("--gp-panels-elems2-color", `rgb(${k}, ${l}, ${m})`);
            this.colorPanel?.updatePanelsBackground(a)
        }
        updatePanelsElements(a, b) {
            const c = parseInt(a.substr(1, 2), 16),
                d = parseInt(a.substr(3, 2), 16);
            a = parseInt(a.substr(5, 2), 16);
            this.style.setProperty("--gp-panels-elems-rgb", `${c} ${d} ${a}`);
            this.style.setProperty("--gp-panels-elems-rgb-opacity", `${b}%`)
        }
        updateControlsBackgroundBlurLevel(a) {
            this.style.setProperty("--gp-panels-controls-backdrop-filter", a ? `blur(${a}px)` : "unset")
        }
        updateHeaderColor(a) {
            this.screen.classList.toggle("gp-colored-header_", a !== GPPainter_.DEFAULT_HEADER_COLOR);
            let [b, c, d] = GPColorUtils_.hexToHsl(a);
            b = Math.round(36E3 * b) / 100;
            c = Math.round(1E4 * c) / 100;
            d = Math.round(1E4 * d) / 100;
            var e = (b - -5.36 + 92.59) % 360,
                f = this.calcHeaderFilterValue(66.86, 78.64, c),
                g = this.calcHeaderFilterValue(34.31,
                    20.2, d),
                h = (b - 5.72 + 103.67) % 360,
                k = this.calcHeaderFilterValue(66.86, 72.41, c),
                l = this.calcHeaderFilterValue(34.31, 60.2, d);
            e = `hue-rotate(${e}deg) saturate(${f}) brightness(${g})`;
            h = `hue-rotate(${h}deg) saturate(${k}) brightness(${l})`;
            k = `hsl(${b}deg ${Math.max(c-5.96,0)}% ${Math.max(d-8.23,0)}%)`;
            l = `hsl(${b}deg ${Math.max(c-3.86,0)}% ${Math.min(d+21.18,100)}%)`;
            f = `hsl(${b-5.38}deg ${Math.max(c-6.86,0)}% ${Math.max(d-22.55,0)}%)`;
            g = `hsl(${b}deg ${Math.min(c+8.52,100)}% ${Math.max(d-21.56,0)}%)`;
            const m =
                this.screen.querySelector(":scope > .draw").style;
            m.setProperty("--gp-header-color", a);
            m.setProperty("--gp-book-color", k);
            m.setProperty("--gp-book-top-border-color", l);
            m.setProperty("--gp-book-rings-filter", h);
            m.setProperty("--gp-book-sheets-bottom-color", f);
            m.setProperty("--gp-header-shadow-color", l);
            m.setProperty("--gp-header-bottom-border-color", g);
            m.setProperty("--gp-header-logo-bg-filter", e);
            m.setProperty("--gp-ready-btn-shadow-color", k)
        }
        calcHeaderFilterValue(a, b, c) {
            return Math.round(Math.min(Math.max(c -
                (a - b), 0), 100) / b * 100) / 100
        }
        updateHeaderPhraseColor(a) {
            this.style.setProperty("--gp-header-phrase-color", a)
        }
        updateActionQueueSize(a, b) {
            this.actionQueueSize.textContent = a ? this.formatActionQueueTimeleft(b) : ""
        }
        formatActionQueueTimeleft(a) {
            return `${Math.floor(a/6E4)||""}:${String(Math.floor(a/1E3)%60).padStart(2,"0")}`
        }
        setAutoHideHeaderState(a) {
            this.screen.classList.toggle("gp-auto-hide-header_", a)
        }
        setAutoHideHeaderDelay(a) {
            this.style.setProperty("--gp-header-auto-hide-delay", `${a}s`)
        }
        updateSymmetryPanel(a) {
            this.screen.classList.toggle("gp-symmetry-panel_",
                a)
        }
    }
    window.GPDrawInterface_ = GPDrawInterface_;
    class GPExtendedPalette_ extends EventTarget {
        static CUSTOM_COLOR_SET_STORAGE = "gp_custom-palettes";
        static DEFAULT_COLOR_SET = "3A0505 590D0D 993333 ED1C24 E54C4C FF9999 FF0000 000000 251005 59270D 995633 FF5800 E5814C FFBC99 FFFF00 FFFFFF 2D1F06 593E0D 997533 FFA500 E5AF4C FFDB99 00FF00 FFFFFF 2D2D06 59590D 999933 FFF200 E4E54C FFFF99 00FFFF 0C0C0C 192D06 32590D 659933 7EFF00 97E54C CBFF99 0000FF 191919 062D0C 0D5919 339943 21E43F 4CE564 99FFA9 FF00FF 262626 062D25 0D5948 339982 00FFC7 4CE5C3 99FFE9 2A2C30 333333 061F2D 0D3E59 337599 00A5FF 4CAFE5 99DBFF 464B55 4C4C4C 06132D 0D2759 335699 0058FF 4C81E5 99BCFF 798BA8 666666 06062D 0D0D59 333399 0000FF 6060F0 9999FF A7B0C8 7F7F7F 13062D 260D59 543399 5200FF 7E4CE5 BA99FF C8CFE4 999999 1F062D 3E0D59 753399 A500FF AF4CE5 DB99FF 36322D B3B3B3 2D0626 590D4B 993387 EC008C E54CCA FF99ED 56493D CCCCCC 2D0614 590D29 993358 FF005D E54C84 FF99BE 6B5745 D9D9D9 F3BD9E FFCCAF FFDCC8 E5C9C3 F7E1DB FBE7E2 B58F7B E6E6E6 B27C5E CC9475 DCA98C ECC8B6 FFDFCF FEE6DB C0A292 F3F3F3".split(" ");
        static CUSTOM_PALETTES = JSON.parse(localStorage.getItem(this.CUSTOM_COLOR_SET_STORAGE)) ?? {};
        static PALETTE = {
            DEFAULT: "default",
            CUSTOM: "custom"
        };
        static PALETTES = Object.assign({
            [this.PALETTE.DEFAULT]: this.DEFAULT_COLOR_SET,
            [this.PALETTE.CUSTOM]: []
        }, this.CUSTOM_PALETTES);
        static MAX_PALETTE_SIZE = 128;
        static TYPE_PALETTE = "application/vnd.gpmod.palette";
        static TYPE_PALETTE_COLOR_ID = "application/vnd.gpmod.color-id";
        static PALETTE_FILE_EXT = "gppal";
        static PS_COLOR_SWATCH_EXT = "aco";
        static PALETTE_KEY_STATES = {
            Shift: "add",
            Control: "delete",
            Alt: "move"
        };
        static buildDragPaletteImage() {
            const a = new Image;
            a.src = 'data:image/svg+xml,%3Csvg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M12.78.28C6.567 1.492 1.561 6.486.336 12.68c-2.313 11.688 8.231 20.4 16.175 19.169 2.575-.4 3.838-3.413 2.656-5.732-1.444-2.837.62-6.15 3.807-6.15h4.981c2.238 0 4.05-1.85 4.056-4.081C31.98 6.036 23.017-1.714 12.78.28zM6.011 19.968c-1.106 0-2-.894-2-2 0-1.107.894-2 2-2 1.106 0 2 .893 2 2 0 1.106-.894 2-2 2zm2-8c-1.106 0-2-.894-2-2 0-1.107.894-2 2-2 1.106 0 2 .893 2 2 0 1.106-.894 2-2 2zm8-4c-1.106 0-2-.894-2-2 0-1.107.894-2 2-2s2 .893 2 2c0 1.106-.893 2-2 2zm8 4c-1.106 0-2-.894-2-2 0-1.107.894-2 2-2 1.107 0 2 .893 2 2 0 1.106-.893 2-2 2z" fill="%2343de99" stroke-width=".063"/%3E%3C/svg%3E';
            return a
        }
        static DRAG_PALETTE_IMAGE = this.buildDragPaletteImage();
        static PALETTE_BACKGROUND_ICON = '<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512"><path d="M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"/></svg>';
        static PALETTE_WHEEL_SWITCH = !1;
        constructor(a,
            b, c, d) {
            super();
            this.l = a;
            this.paletteName = b;
            this.getNickname = c;
            this.getCurrentColor = d;
            this.state = !1;
            GPUtils_.bindMethods([this.paletteKeyHandler, this.resetKeys, this.onPaletteDragStart, this.onPaletteDragOver, this.onPaletteDragEnter, this.onPaletteDragLeave, this.onPaletteDrop], this);
            this.init()
        }
        getElement() {
            return this.palette
        }
        getState() {
            return this.state
        }
        init() {
            document.addEventListener("keydown", this.paletteKeyHandler, !0);
            document.addEventListener("keyup", this.paletteKeyHandler, !0);
            window.addEventListener("blur",
                this.resetKeys);
            window.addEventListener("focus", this.resetKeys);
            this.paletteKeys = new Set;
            this.paletteFileInput = document.createElement("input");
            this.paletteFileInput.type = "file";
            this.paletteFileInput.accept = `.${GPExtendedPalette_.PALETTE_FILE_EXT}`;
            this.paletteFileInput.addEventListener("change", a => {
                this.handlePaletteFile(a.target.files)
            });
            this.palette = document.createElement("div");
            this.palette.className = "gp-palette-set_";
            this.palette.classList.toggle("custom_", this.isCustomPalette);
            this.palette.dataset.id = -1;
            this.paletteBackground = document.createElement("div");
            this.paletteBackground.className = "background_";
            this.paletteBackground.title = this.l.PALETTE_FILE_DROP_AREA_TTL;
            this.paletteBackground.innerHTML = GPExtendedPalette_.PALETTE_BACKGROUND_ICON;
            this.palette.appendChild(this.paletteBackground);
            this.paletteColors = document.createElement("div");
            this.paletteColors.className = "colors_";
            this.palette.appendChild(this.paletteColors);
            this.isCustomPalette && (this.palette.draggable = !0, this.palette.addEventListener("dragstart",
                this.onPaletteDragStart), this.palette.addEventListener("dragover", this.onPaletteDragOver), this.palette.addEventListener("dragenter", this.onPaletteDragEnter), this.palette.addEventListener("dragleave", this.onPaletteDragLeave), this.palette.addEventListener("drop", this.onPaletteDrop));
            this.palette.addEventListener("auxclick", a => {
                this.isCustomPalette && 1 === a.button && (a.ctrlKey ? 0 < this.colorSet.length && this.downloadPalette() : this.paletteFileInput.click(), a.preventDefault())
            });
            this.palette.addEventListener("pointerdown",
                a => {
                    if (0 === a.button)
                        if (this.isCustomPalette) {
                            const b = a.target.classList.contains("color_"),
                                c = this.colorSet,
                                d = b ? this.getColorIndex(a.target) : -1;
                            a.shiftKey ? (b ? (c.splice(d, 0, this.getCurrentColor()), c.length = Math.min(c.length, GPExtendedPalette_.MAX_PALETTE_SIZE)) : c.length < GPExtendedPalette_.MAX_PALETTE_SIZE && c.push(this.getCurrentColor()), this.renderPaletteColorSet(), this.saveCustomPalette()) : a.ctrlKey ? (b ? c.splice(d, 1) : c.length && c.pop(), this.renderPaletteColorSet(), this.saveCustomPalette()) : a.altKey ?
                                b && this.renderPaletteColorSet() : b && this.selectPaletteColor(a.target)
                        } else this.selectPaletteColor(a.target)
                });
            this.palette.addEventListener("click", a => {
                this.isCustomPalette && 0 === this.colorSet.length && void 0 === this.palette.dataset.state && this.paletteFileInput.click()
            });
            GPExtendedPalette_.PALETTE_WHEEL_SWITCH && this.palette.addEventListener("wheel", a => {
                this.changePalette(a.deltaY);
                a.preventDefault()
            });
            this.setPalette(this.paletteName)
        }
        terminate() {
            this.palette.remove();
            this.paletteKeys.clear();
            document.removeEventListener("keydown",
                this.paletteKeyHandler, !0);
            document.removeEventListener("keyup", this.paletteKeyHandler, !0);
            window.removeEventListener("blur", this.resetKeys);
            window.removeEventListener("focus", this.resetKeys)
        }
        changePalette(a) {
            const b = Object.keys(GPExtendedPalette_.PALETTES),
                c = b.findIndex(d => d === this.paletteName);
            if (~c) {
                const d = b.length;
                a = b[0 > a ? (c + d - 1) % d : (c + 1) % d]
            } else a = GPExtendedPalette_.PALETTE.DEFAULT;
            this.setPalette(a);
            this.dispatchEvent(new CustomEvent("palette", {
                detail: {
                    name: a
                }
            }))
        }
        setPalette(a) {
            this.palette ?
                (this.paletteKeys.clear(), this.paletteName = a, this.colorSet = GPExtendedPalette_.PALETTES[this.paletteName], this.isCustomPalette = this.paletteName !== GPExtendedPalette_.PALETTE.DEFAULT, this.paletteDropTarget = null, this.palette.classList.toggle("custom_", this.isCustomPalette), this.renderPaletteColorSet(), this.isCustomPalette ? (this.palette.draggable = !0, this.palette.addEventListener("dragstart", this.onPaletteDragStart), this.palette.addEventListener("dragover", this.onPaletteDragOver), this.palette.addEventListener("dragenter",
                    this.onPaletteDragEnter), this.palette.addEventListener("dragleave", this.onPaletteDragLeave), this.palette.addEventListener("drop", this.onPaletteDrop)) : (this.palette.draggable = !1, this.palette.removeEventListener("dragstart", this.onPaletteDragStart), this.palette.removeEventListener("dragover", this.onPaletteDragOver), this.palette.removeEventListener("dragenter", this.onPaletteDragEnter), this.palette.removeEventListener("dragleave", this.onPaletteDragLeave), this.palette.removeEventListener("drop", this.onPaletteDrop))) :
                this.init()
        }
        renderPaletteColorSet() {
            const a = this.colorSet;
            a.length = Math.min(a.length, GPExtendedPalette_.MAX_PALETTE_SIZE);
            const [b, c, d] = this.calculateColorSize(a.length);
            this.palette.classList.toggle("max-size_", c);
            this.palette.classList.toggle("empty_", !a.length);
            this.palette.style.setProperty("--gp-color-size", `${b}px`);
            this.palette.style.setProperty("--gp-palette-columns-count", `${d}`);
            this.paletteColors.innerHTML = "";
            a.forEach((e, f) => {
                const g = document.createElement("div");
                g.className = "color_";
                g.dataset.color = `#${e}`;
                g.style.backgroundColor = `#${e}`;
                this.isCustomPalette && (g.draggable = !0, g.dataset.id = f);
                this.paletteColors.appendChild(g)
            })
        }
        saveCustomPalette() {
            const {
                default: a,
                ...b
            } = GPExtendedPalette_.PALETTES;
            localStorage.setItem(GPExtendedPalette_.CUSTOM_COLOR_SET_STORAGE, JSON.stringify(b))
        }
        calculateColorSize(a) {
            const b = [3, 4, 5, 6, 8];
            var c = b.map((f, g) => Math.floor(292 / (148 / b[g])) * f).findIndex(f => a <= f),
                d = ~c ? c : b.length - 1;
            c = Math.floor((148 - 3 * (b[d] - 1)) / b[d]);
            const e = b[d] === b.at(-1);
            d = ~d ? b[d] : b.at(-1);
            return [c, e, d]
        }
        getColorIndex(a) {
            return [].indexOf.call(this.palette.children, a)
        }
        selectPaletteColor(a) {
            const b = a.dataset.color;
            this.resetPaletteColor();
            a.classList.add("selected_");
            this.dispatchEvent(new CustomEvent("color", {
                detail: {
                    color: b
                }
            }))
        }
        resetPaletteColor() {
            if (this.palette) {
                var a = this.palette.querySelector(".color_.selected_");
                a && a.classList.remove("selected_")
            }
        }
        paletteKeyHandler(a) {
            if (this.palette && !a.repeat) {
                var b = GPExtendedPalette_.PALETTE_KEY_STATES;
                a.key in b && (a.getModifierState(a.key) ?
                    this.paletteKeys.add(a.key) : this.paletteKeys.delete(a.key), (a = Object.keys(b).find(c => this.paletteKeys.has(c))) ? this.palette.dataset.state = b[a] : delete this.palette.dataset.state)
            }
        }
        resetKeys(a) {
            this.palette && (this.paletteKeys.clear(), delete this.palette.dataset.state)
        }
        serializePalette(a) {
            return a.join("\n")
        }
        downloadPalette() {
            const {
                url: a,
                filename: b
            } = this.buildSerializedPalette(), c = document.createElement("a");
            c.href = a;
            c.download = b;
            c.click();
            URL.revokeObjectURL(this.paletteURL)
        }
        buildSerializedPalette() {
            const a =
                `gp-palette by ${this.getNickname()} (${this.getPaletteHash()}).${GPExtendedPalette_.PALETTE_FILE_EXT}`,
                b = new Blob([this.serializePalette(this.colorSet)]);
            URL.revokeObjectURL(this.paletteURL);
            this.paletteURL = URL.createObjectURL(b);
            return {
                url: this.paletteURL,
                filename: a
            }
        }
        getPaletteHash() {
            let a = 0;
            this.colorSet.forEach(b => {
                for (let c = 0; c < b.length; c++) {
                    const d = b.charCodeAt(c);
                    a = (a << 5) - a + d;
                    a |= 0
                }
            });
            return (a + 2147483648).toString(36)
        }
        onPaletteDragStart(a) {
            if (a.shiftKey || a.ctrlKey || a.altKey || !this.colorSet.length) a.altKey &&
                a.target !== a.currentTarget ? (a.dataTransfer.setData(GPExtendedPalette_.TYPE_PALETTE_COLOR_ID, a.target.dataset.id), a.dataTransfer.effectAllowed = "move") : a.preventDefault();
            else {
                const {
                    url: b,
                    filename: c
                } = this.buildSerializedPalette();
                a.dataTransfer.setData("DownloadURL", `${GPExtendedPalette_.TYPE_PALETTE}:${c}:${b}`);
                a.dataTransfer.setDragImage(GPExtendedPalette_.DRAG_PALETTE_IMAGE, 0, 0)
            }
        }
        onPaletteDragOver(a) {
            a.preventDefault();
            a.dataTransfer.dropEffect = "move"
        }
        onPaletteDragEnter(a) {
            switch (a.dataTransfer.types[0]) {
                case GPExtendedPalette_.TYPE_PALETTE_COLOR_ID:
                    ~a.target.dataset.id &&
                        a.target.classList.add("drag-over_");
                    break;
                case "Files":
                    this.paletteDropTarget = a.target, a.currentTarget.classList.add("drag-over_")
            }
        }
        onPaletteDragLeave(a) {
            a.target.matches(".color_") ? a.target.classList.remove("drag-over_") : a.target === this.paletteDropTarget && (a.preventDefault(), a.currentTarget.classList.remove("drag-over_"))
        }
        onPaletteDrop(a) {
            switch (a.dataTransfer.types[0]) {
                case GPExtendedPalette_.TYPE_PALETTE_COLOR_ID:
                    const b = a.dataTransfer.getData(GPExtendedPalette_.TYPE_PALETTE_COLOR_ID);
                    if (b ===
                        a.target.dataset.id) break;
                    this.moveColor(b, a.target.dataset.id);
                    this.saveCustomPalette();
                    break;
                case "Files":
                    this.handlePaletteFile(a.dataTransfer.files)
            }
            a.target.classList.remove("drag-over_");
            a.currentTarget.classList.remove("drag-over_");
            a.preventDefault()
        }
        handlePaletteFile(a) {
            if (a = Array.from(a).find(this.isPaletteFile)) {
                const b = new FileReader;
                this.isPSColorSwatchFile(a) ? (b.addEventListener("loadend", c => {
                        try {
                            const d = GPAcoDecoder_.decode(b.result);
                            this.loadPaletteColors(d)
                        } catch (d) {
                            console.error(d)
                        }
                    }),
                    b.readAsArrayBuffer(a)) : (b.addEventListener("loadend", c => {
                    try {
                        const d = this.parsePaletteFile(b.result);
                        this.loadPaletteColors(d)
                    } catch (d) {
                        console.error(d)
                    }
                }), b.readAsText(a))
            }
        }
        loadPaletteColors(a) {
            a && (this.colorSet.length = 0, this.colorSet.push(...a), this.renderPaletteColorSet(), this.saveCustomPalette())
        }
        parsePaletteFile(a) {
            const b = [];
            a = a.split(/\s+/);
            for (let c = 0; c < a.length; c++) {
                const d = (a[c].match(/^#?([0-9A-Fa-f]{6})$/) || [])[1];
                if (d && (b.push(d), b.length === GPExtendedPalette_.MAX_PALETTE_SIZE)) break
            }
            return b
        }
        isPaletteFile(a) {
            const b =
                a.name.toLowerCase();
            return [GPExtendedPalette_.PALETTE_FILE_EXT, GPExtendedPalette_.PS_COLOR_SWATCH_EXT].some(c => b.endsWith(`.${c}`))
        }
        isPSColorSwatchFile(a) {
            return a.name.toLowerCase().endsWith(`.${GPExtendedPalette_.PS_COLOR_SWATCH_EXT}`)
        }
        moveColor(a, b) {
            this.colorSet.splice(~b ? b : this.colorSet.length, 0, this.colorSet.splice(a, 1)[0]);
            this.renderPaletteColorSet()
        }
        enable() {
            this.palette.removeAttribute("disabled")
        }
        disable() {
            this.palette.setAttribute("disabled", "")
        }
        remove() {
            this.palette.remove()
        }
        get size() {
            return GPExtendedPalette_.PALETTES[this.paletteName].length
        }
    };
    class GPPainter_ extends EventTarget {
        static SEARCH_DRAW_CONTAINER_INTERVAL = 200;
        static TOOL = {
            BRUSH: 1,
            ERASER: 2,
            LINE: 3,
            RECTANGLE: 4,
            CIRCLE: 5,
            RECTANGLE_FILLED: 6,
            CIRCLE_FILLED: 7,
            FILL: 8,
            NOTE: 10,
            DELIMITER: 11
        };
        static TOOLS_IN_TIME = [this.TOOL.BRUSH, this.TOOL.ERASER, this.TOOL.NOTE];
        static ORIGINAL_WIDTH = 758;
        static ORIGINAL_HEIGHT = 424;
        static DEFAULT_DENSITY = 2;
        static BACKGROUND_COLOR = "#ffffff";
        static DEFAULT_TOOL = this.TOOL.BRUSH;
        static FIRST_STROKE_ID = 1;
        static POINTER_COLOR = "#000000";
        static POINTER_OPACITY = 1;
        static POINTER_OUTLINE_COLOR = "#FFFFFF";
        static POINTER_OUTLINE_OPACITY = 1;
        static POINTER_CROSSHAIR_MIN_THICKNESS = 5;
        static POINTER_CROSSHAIR_LINE_LENGTH = 6;
        static POINTER_DOT_THICKNESS = 2;
        static TOOLS_THICKNESSES = {
            [this.TOOL.RECTANGLE_FILLED]: 2,
            [this.TOOL.CIRCLE_FILLED]: 2,
            [this.TOOL.FILL]: 2
        };
        static DISABLED_MODE_OPTIONS = {
            visible: [2]
        };
        static COLOR_PICKER_WIDTH = 250;
        static COLOR_PICKER_HEIGHT = 250;
        static COLOR_PICKER_HUE_POSITION = GPColorPicker_.RIGHT;
        static DEFAULT_HEADER_COLOR = "#481d92";
        static SYMMETRY_MODES = {
            VERTICAL: 0,
            HORIZONTAL: 1,
            QUADRANT: 2,
            RADIAL: 3,
            MANDALA: 4
        };
        static UNSUBSCRIBED_SYMMETRY_MODES = ["VERTICAL", "HORIZONTAL"];
        static DEFAULT_SYMMETRY_MODE = this.SYMMETRY_MODES.VERTICAL;
        static SYMMETRY_GUIDES_COUNT_SENSITIVITY = Math.round(window.screen.height /
            1080 * 5);
        static MIN_SYMMETRY_RADIAL_GUIDES = 2;
        static MAX_SYMMETRY_RADIAL_GUIDES = 32;
        static MIN_SYMMETRY_MANDALA_GUIDES = 2;
        static MAX_SYMMETRY_MANDALA_GUIDES = 16;
        static SYMMETRY_GUIDES_RADIUS = Math.ceil(Math.sqrt(this.ORIGINAL_WIDTH * this.ORIGINAL_WIDTH + this.ORIGINAL_HEIGHT * this.ORIGINAL_HEIGHT)) * this.DEFAULT_DENSITY;
        static M_STROKE_OFFSET = 67;
        static M_STROKE_RANGE = 100;
        static DEFAULT_BINDINGS = {
            dropper: [
                ["AltLeft"]
            ],
            thickness: [
                ["ControlLeft"]
            ],
            opacity: [
                ["ShiftLeft"]
            ],
            brightness: [
                ["KeyV"]
            ],
            zoom: [
                ["KeyZ"]
            ],
            zoomToPoint: [
                ["KeyS"]
            ],
            zoomReset: [
                ["KeyA"]
            ],
            mirror: [
                ["CapsLock"]
            ],
            verticalMirror: [
                ["ControlLeft", "CapsLock"]
            ],
            palette: [
                ["Tab"]
            ],
            swap: [
                ["KeyX"]
            ],
            eraser: [
                ["KeyC"]
            ],
            grayscale: [
                ["KeyW"]
            ],
            hand: [
                ["Space"]
            ],
            clear: [
                ["KeyF"]
            ],
            symmetry: [
                ["KeyT"]
            ],
            reference: [
                ["KeyP"]
            ],
            toolCentering: [
                ["KeyR"]
            ],
            save: [
                ["ControlLeft", "KeyS"]
            ],
            undo: [
                ["ControlLeft", "KeyZ"]
            ],
            redo: [
                ["ControlLeft", "KeyY"],
                ["ControlLeft", "ShiftLeft", "KeyZ"]
            ],
            save: [
                ["ControlLeft", "KeyS"]
            ],
            brushTool: [
                ["KeyB"]
            ],
            eraserTool: [
                ["KeyE"]
            ],
            rectangleTool: [],
            rectangleFilledTool: [],
            circleTool: [],
            circleFilledTool: [],
            fillTool: [],
            noteTool: []
        };
        static NATIVE_BINDINGS_KEYS = new Set(["KeyE", "KeyB", "KeyZ"]);
        static AXIS = {
            HORIZONTAL: "horizontal",
            VERTICAL: "vertical"
        };
        static DIRECTION = {
            DOWN_RIGHT: "down / right",
            UP_LEFT: "up / left"
        };
        static DEFAULT_SETTINGS = {
            defaultColor: "#000000",
            defaultThickness: 6,
            defaultOpacity: 1,
            minThickness: 2,
            maxThickness: 300,
            thicknessAxis: this.AXIS.HORIZONTAL,
            upThicknessDirection: this.DIRECTION.DOWN_RIGHT,
            doubleEraserThickness: !0,
            minOpacity: .02,
            opacitySensitivity: 1,
            opacityAxis: this.AXIS.HORIZONTAL,
            upOpacityDirection: this.DIRECTION.DOWN_RIGHT,
            brightnessSensitivity: 1,
            brightnessAxis: this.AXIS.VERTICAL,
            upBrightnessDirection: this.DIRECTION.UP_LEFT,
            minZoom: 1,
            maxZoom: 30,
            zoomSensitivity: 10,
            zoomAxis: this.AXIS.VERTICAL,
            zoomInDirection: this.DIRECTION.UP_LEFT,
            maxZoomToPoint: 3,
            pointerOpacity: 1,
            pointerOutlineOpacity: 1,
            colorPickerHuePosition: GPColorPicker_.RIGHT,
            colorPickerWidth: 250,
            colorPickerHeight: 250,
            colorWheelMode: GPColorWheel_.MODE.COMPLEMENTARY,
            fixedScreenSize: !1,
            readyConfirmation: !1,
            stretchNativePalette: !0,
            extendedPalettePanel: !0,
            extendedPaletteName: "default",
            colorPanelControlsSet: "default",
            colorPickerPanel: !0,
            panelsBackgroundColor: "#5e1933",
            panelsBackgroundOpacity: 50,
            panelsElementsColor: "#ff8eaf",
            panelsElementsOpacity: 60,
            controlsBackgroundBlurLevel: 0,
            hideHeaderBackground: !1,
            autoHideHeaderElements: !1,
            autoHideHeaderDelay: .3,
            headerColor: "#481d92",
            headerInstructionsColor: "#43de99",
            lineSmoothingLevel: 0,
            eraserLineSmoothing: !1,
            symmetryGuidesColor: "#4affff",
            symmetryGuidesOpacity: 1,
            symmetryGuidesWidth: 1,
            symmetryRadialGuidesCount: 8,
            symmetryMandalaGuidesCount: 4,
            symmetryMode: this.SYMMETRY_MODES.VERTICAL,
            centeringCircleTool: !1
        };
        static SETTINGS_UI = {
            _1: {
                text: "Default Settings"
            },
            defaultColor: {
                type: "color",
                description: "\u0426\u0432\u0435\u0442 \u043a\u0438\u0441\u0442\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0430\u0443\u043d\u0434\u0430)"
            },
            defaultThickness: {
                type: "slider",
                args: {
                    min: 1,
                    max: 600,
                    step: 1
                },
                description: "\u0422\u043e\u043b\u0449\u0438\u043d\u0430 \u043a\u0438\u0441\u0442\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0430\u0443\u043d\u0434\u0430)"
            },
            defaultOpacity: {
                type: "slider",
                args: {
                    min: .01,
                    max: 1,
                    step: .01
                },
                description: "\u041d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043a\u0438\u0441\u0442\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0430\u0443\u043d\u0434\u0430)"
            },
            _2: {
                text: "Thickness"
            },
            minThickness: {
                type: "slider",
                args: {
                    min: 1,
                    max: 600,
                    step: 1
                },
                description: "\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u043e\u043b\u0449\u0438\u043d\u0430 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u0430\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            maxThickness: {
                type: "slider",
                args: {
                    min: 1,
                    max: 600,
                    step: 1
                },
                description: "\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u043e\u043b\u0449\u0438\u043d\u0430 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u0430\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            thicknessAxis: {
                type: "dropdown",
                args: {
                    items: [this.AXIS.HORIZONTAL, this.AXIS.VERTICAL]
                },
                description: "\u041f\u043b\u043e\u0441\u043a\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0442\u043e\u043b\u0449\u0438\u043d\u044b \u043a\u0438\u0441\u0442\u0438"
            },
            upThicknessDirection: {
                type: "dropdown",
                args: {
                    items: [this.DIRECTION.DOWN_RIGHT, this.DIRECTION.UP_LEFT]
                },
                description: "\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u0442\u043e\u043b\u0449\u0438\u043d\u044b \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            doubleEraserThickness: {
                type: "switch",
                description: "\u0423\u0434\u0432\u0430\u0438\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u0449\u0438\u043d\u0443 \u043a\u0438\u0441\u0442\u0438 \u043f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430 \u041b\u0430\u0441\u0442\u0438\u043a"
            },
            _3: {
                text: "Opacity"
            },
            minOpacity: {
                type: "slider",
                args: {
                    min: .01,
                    max: 1,
                    step: .01
                },
                description: "\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u0430\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            opacitySensitivity: {
                type: "slider",
                args: {
                    min: .1,
                    max: 3,
                    step: .1
                },
                description: "\u0427\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            opacityAxis: {
                type: "dropdown",
                args: {
                    items: [this.AXIS.HORIZONTAL,
                        this.AXIS.VERTICAL
                    ]
                },
                description: "\u041f\u043b\u043e\u0441\u043a\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u0438\u0441\u0442\u0438"
            },
            upOpacityDirection: {
                type: "dropdown",
                args: {
                    items: [this.DIRECTION.DOWN_RIGHT, this.DIRECTION.UP_LEFT]
                },
                description: "\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            _4: {
                text: "Brightness"
            },
            brightnessSensitivity: {
                type: "slider",
                args: {
                    min: .1,
                    max: 3,
                    step: .1
                },
                description: "\u0427\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u044f\u0440\u043a\u043e\u0441\u0442\u0438 \u0446\u0432\u0435\u0442\u0430 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            brightnessAxis: {
                type: "dropdown",
                args: {
                    items: [this.AXIS.HORIZONTAL, this.AXIS.VERTICAL]
                },
                description: "\u041f\u043b\u043e\u0441\u043a\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u044f\u0440\u043a\u043e\u0441\u0442\u0438 \u0446\u0432\u0435\u0442\u0430 \u043a\u0438\u0441\u0442\u0438"
            },
            upBrightnessDirection: {
                type: "dropdown",
                args: {
                    items: [this.DIRECTION.DOWN_RIGHT, this.DIRECTION.UP_LEFT]
                },
                description: "\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u044f\u0440\u043a\u043e\u0441\u0442\u0438 \u0446\u0432\u0435\u0442\u0430 \u043a\u0438\u0441\u0442\u0438, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            _5: {
                text: "Zoom"
            },
            minZoom: {
                type: "slider",
                args: {
                    min: .1,
                    max: 1,
                    step: .1
                },
                description: "\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            maxZoom: {
                type: "slider",
                args: {
                    min: 2,
                    max: 60,
                    step: 1
                },
                description: "\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            zoomSensitivity: {
                type: "slider",
                args: {
                    min: 1,
                    max: 20,
                    step: 1
                },
                description: "\u0427\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            zoomAxis: {
                type: "dropdown",
                args: {
                    items: [this.AXIS.HORIZONTAL, this.AXIS.VERTICAL]
                },
                description: "\u041f\u043b\u043e\u0441\u043a\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430"
            },
            zoomInDirection: {
                type: "dropdown",
                args: {
                    items: [this.DIRECTION.DOWN_RIGHT, this.DIRECTION.UP_LEFT]
                },
                description: "\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430, \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
            },
            maxZoomToPoint: {
                type: "slider",
                args: {
                    min: 2,
                    max: 60,
                    step: 1
                },
                description: "\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435 \u0445\u043e\u043b\u0441\u0442\u0430 \u0432 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0442\u043e\u0447\u043a\u0443"
            },
            _6: {
                text: "Pointer"
            },
            pointerOpacity: {
                type: "slider",
                args: {
                    min: 0,
                    max: 1,
                    step: .1
                },
                description: "\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u044c \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f"
            },
            pointerOutlineOpacity: {
                type: "slider",
                args: {
                    min: 0,
                    max: 1,
                    step: .1
                },
                description: "\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u044c \u043a\u043e\u043d\u0442\u0443\u0440\u0430 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f"
            },
            _7: {
                text: "Color Picker"
            },
            colorPickerHuePosition: {
                type: "dropdown",
                args: {
                    items: [GPColorPicker_.TOP, GPColorPicker_.BOTTOM, GPColorPicker_.RIGHT, GPColorPicker_.LEFT]
                },
                description: "\u0420\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u0437\u0443\u043d\u043a\u0430 \u043e\u0442\u0442\u0435\u043d\u043a\u0430 \u0434\u043b\u044f \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u0446\u0432\u0435\u0442\u043e\u0432 (\u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c)"
            },
            colorPickerWidth: {
                type: "slider",
                args: {
                    min: 100,
                    max: 350,
                    step: 1
                },
                description: "\u0428\u0438\u0440\u0438\u043d\u0430 \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u0446\u0432\u0435\u0442\u043e\u0432 (\u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c)"
            },
            colorPickerHeight: {
                type: "slider",
                args: {
                    min: 100,
                    max: 350,
                    step: 1
                },
                description: "\u0412\u044b\u0441\u043e\u0442\u0430 \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u0446\u0432\u0435\u0442\u043e\u0432 (\u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c)"
            },
            _8: {
                text: "Interface"
            },
            fixedScreenSize: {
                type: "switch",
                description: "\u0424\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430 (\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442 \u0440\u0430\u0437\u043c\u0435\u0440 \u043e\u043a\u043d\u0430 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430)"
            },
            readyConfirmation: {
                type: "switch",
                description: '\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0445\u043e\u0434\u0430, \u0435\u0441\u043b\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 "\u0412\u0420\u0415\u041c\u042f" \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d, \u043a\u0430\u043a "\u0420\u0415\u0428\u0415\u041d\u0418\u0415 \u0412\u0415\u0414\u0423\u0429\u0415\u0413\u041e" (\u043f\u0440\u0438 \u0443\u0441\u043b\u043e\u0432\u0438\u0438, \u0447\u0442\u043e \u0412\u044b \u044f\u0432\u043b\u044f\u0435\u0442\u0435\u0441\u044c \u0432\u043b\u0430\u0434\u0435\u043b\u044c\u0446\u0435\u043c \u043a\u043e\u043c\u043d\u0430\u0442\u044b)'
            },
            stretchNativePalette: {
                type: "switch",
                description: "\u0420\u0430\u0441\u0442\u044f\u0433\u0438\u0432\u0430\u0442\u044c \u0440\u043e\u0434\u043d\u0443\u044e \u043f\u0430\u043d\u0435\u043b\u044c \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u043f\u043e \u0448\u0438\u0440\u0438\u043d\u0435"
            },
            extendedPalettePanel: {
                type: "switch",
                description: "\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u0430\u044f \u043f\u0430\u043d\u0435\u043b\u044c \u043f\u0430\u043b\u0438\u0442\u0440\u044b (\u0437\u0430\u043c\u0435\u043d\u044f\u0435\u0442 \u043e\u0441\u043d\u043e\u0432\u043d\u0443\u044e)"
            },
            colorPickerPanel: {
                type: "switch",
                description: "\u041f\u0430\u043d\u0435\u043b\u044c \u0432\u044b\u0431\u043e\u0440\u0430 \u0446\u0432\u0435\u0442\u0430"
            },
            panelsBackgroundColor: {
                type: "color",
                inputTrigger: !0,
                description: "\u0426\u0432\u0435\u0442 \u0444\u043e\u043d\u0430 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"
            },
            panelsBackgroundOpacity: {
                type: "slider",
                args: {
                    min: 0,
                    max: 100,
                    step: 1
                },
                inputTrigger: !0,
                description: "\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u0442\u044c \u0444\u043e\u043d\u0430 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"
            },
            panelsElementsColor: {
                type: "color",
                inputTrigger: !0,
                description: "\u0426\u0432\u0435\u0442 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"
            },
            panelsElementsOpacity: {
                type: "slider",
                args: {
                    min: 0,
                    max: 100,
                    step: 1
                },
                inputTrigger: !0,
                description: "\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"
            },
            controlsBackgroundBlurLevel: {
                type: "slider",
                args: {
                    min: 0,
                    max: 20,
                    step: .1
                },
                inputTrigger: !0,
                description: "\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0440\u0430\u0437\u043c\u044b\u0442\u0438\u044f \u0444\u043e\u043d\u0430 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f"
            },
            _9: {
                text: "Header"
            },
            hideHeaderBackground: {
                type: "switch",
                description: "\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0444\u043e\u043d \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 \u0438 \u0440\u0430\u043c\u043a\u0438 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430"
            },
            autoHideHeaderElements: {
                type: "switch",
                description: "\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430 (\u043a\u0440\u043e\u043c\u0435 \u043b\u043e\u0433\u043e \u0438 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0430\u0439\u043c\u0435\u0440\u0430) \u0438 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043f\u0440\u0438 \u043d\u0430\u0432\u0435\u0434\u0435\u043d\u0438\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f"
            },
            autoHideHeaderDelay: {
                type: "slider",
                args: {
                    min: 0,
                    max: 1,
                    step: .1
                },
                description: "\u0417\u0430\u0434\u0435\u0440\u0436\u043a\u0430 \u043f\u0435\u0440\u0435\u0434 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u0441\u043a\u0440\u044b\u0442\u0438\u0435\u043c/\u043f\u043e\u043a\u0430\u0437\u043e\u043c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430"
            },
            headerColor: {
                type: "color",
                inputTrigger: !0,
                description: "\u0426\u0432\u0435\u0442 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430 \u0438 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432"
            },
            headerInstructionsColor: {
                type: "color",
                inputTrigger: !0,
                description: "\u0426\u0432\u0435\u0442 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0439 \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0430"
            },
            _10: {
                text: "Line Smoothing"
            },
            lineSmoothingLevel: {
                type: "slider",
                args: {
                    min: 0,
                    max: 8,
                    step: 1
                },
                description: "\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0441\u0433\u043b\u0430\u0436\u0438\u0432\u0430\u043d\u0438\u044f \u043b\u0438\u043d\u0438\u0439 \u0434\u043b\u044f \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u041a\u0438\u0441\u0442\u044c, \u041b\u0430\u0441\u0442\u0438\u043a \u0438 \u0417\u0430\u043c\u0435\u0442\u043a\u0430"
            },
            eraserLineSmoothing: {
                type: "switch",
                description: "\u041f\u0440\u0438\u043c\u0435\u043d\u044f\u0442\u044c \u0441\u0433\u043b\u0430\u0436\u0438\u0432\u0430\u043d\u0438\u0435 \u043b\u0438\u043d\u0438\u0439 \u0434\u043b\u044f \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430 \u041b\u0430\u0441\u0442\u0438\u043a"
            },
            _11: {
                text: "Symmetry Guides"
            },
            symmetryGuidesColor: {
                type: "color",
                inputTrigger: !0,
                description: "\u0426\u0432\u0435\u0442 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0445 \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0438"
            },
            symmetryGuidesOpacity: {
                type: "slider",
                args: {
                    min: 0,
                    max: 1,
                    step: .01
                },
                inputTrigger: !0,
                description: "\u041d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0445 \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0438"
            },
            symmetryGuidesWidth: {
                type: "slider",
                args: {
                    min: 1,
                    max: 8,
                    step: .5
                },
                inputTrigger: !0,
                description: "\u0428\u0438\u0440\u0438\u043d\u0430 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0445 \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0438"
            },
            _12: {
                text: "Tools"
            },
            centeringCircleTool: {
                type: "switch",
                description: "\u0426\u0435\u043d\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u044b \u041a\u0440\u0443\u0433 \u0438 \u0417\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0439 \u043a\u0440\u0443\u0433 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e"
            }
        };
        static MODULE = {
            title: "Painter",
            alias: "pa",
            dependencies: ["GPDrawInterface_", "GPColorUtils_", "GPColorPicker_"],
            settings: {
                storage: "gp_painter",
                defaultSettings: this.DEFAULT_SETTINGS,
                ui: this.SETTINGS_UI
            },
            useCSS: !0
        };
        constructor(a, b) {
            super();
            this.gpproxy = a.gpproxy;
            this.sm = a.sm;
            this.timer = a.tmr;
            this.reference = a.ref;
            this.ac = a.ac;
            this.abt = a.abt;
            this.l = b;
            this.s = a.sm.setSettings(this, this.updateSettings);
            this.bindings = Object.assign({}, window.structuredClone(GPPainter_.DEFAULT_BINDINGS), JSON.parse(localStorage.getItem("gp_painter_bindings")));
            this.bindingsLabels = {
                brushTool: this.l.BINDINGS_LABEL_TOOLS
            };
            this.tools = {
                dropper: {
                    handler: this.dropperKeyDown,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041f\u0438\u043f\u0435\u0442\u043a\u0430 (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0446\u0432\u0435\u0442 \u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u043c\u044b\u0448\u0438)"
                },
                thickness: {
                    handler: this.thicknessKeyDown,
                    description: "\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0442\u043e\u043b\u0449\u0438\u043d\u044b \u043a\u0438\u0441\u0442\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
                },
                opacity: {
                    handler: this.opacityKeyDown,
                    description: "\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u0438\u0441\u0442\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
                },
                brightness: {
                    handler: this.brightnessKeyDown,
                    description: "\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u044f\u0440\u043a\u043e\u0441\u0442\u0438 \u0446\u0432\u0435\u0442\u0430 \u043a\u0438\u0441\u0442\u0438 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
                },
                zoom: {
                    handler: this.zoomKeyDown,
                    description: "\u041f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435/\u043e\u0442\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0445\u043e\u043b\u0441\u0442\u0430 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
                },
                zoomToPoint: {
                    handler: this.zoomToPoint,
                    description: "\u041f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u0435/\u043e\u0442\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0445\u043e\u043b\u0441\u0442\u0430 \u0432 \u0442\u043e\u0447\u043a\u0443 \u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
                },
                zoomReset: {
                    handler: this.resetZoom,
                    description: "\u0421\u0431\u0440\u043e\u0441 \u0443\u0440\u043e\u0432\u043d\u044f \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f/\u043e\u0442\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0445\u043e\u043b\u0441\u0442\u0430"
                },
                mirror: {
                    handler: this.mirror,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0417\u0435\u0440\u043a\u0430\u043b\u043e (\u043e\u0442\u0440\u0430\u0436\u0430\u0435\u0442 \u0445\u043e\u043b\u0441\u0442 \u043f\u043e \u0433\u043e\u0440\u0438\u0437\u043e\u043d\u0442\u0430\u043b\u0438)"
                },
                verticalMirror: {
                    handler: this.verticalMirror,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0412\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u0435\u0440\u043a\u0430\u043b\u043e (\u043e\u0442\u0440\u0430\u0436\u0430\u0435\u0442 \u0445\u043e\u043b\u0441\u0442 \u043f\u043e \u0432\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u0438)"
                },
                palette: {
                    handler: this.palette,
                    description: "\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u043f\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c"
                },
                swap: {
                    handler: this.swap,
                    description: "\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u043c \u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0446\u0432\u0435\u0442\u0430\u043c\u0438"
                },
                eraser: {
                    handler: this.eraser,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041b\u0430\u0441\u0442\u0438\u043a (\u043f\u0440\u0438 \u0437\u0430\u0436\u0430\u0442\u0438\u0438 \u043a\u043b\u0430\u0432\u0438\u0448\u0438 - \u0430\u043a\u0442\u0438\u0432\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u043f\u0440\u0438 \u043e\u0442\u043f\u0443\u0441\u043a\u0430\u043d\u0438\u0438 - \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442)"
                },
                grayscale: {
                    handler: this.grayscale,
                    description: "\u0412\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0447\u0451\u0440\u043d\u043e-\u0431\u0435\u043b\u043e\u0433\u043e \u0444\u0438\u043b\u044c\u0442\u0440\u0430"
                },
                hand: {
                    handler: this.handKeyDown,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0420\u0443\u043a\u0430 (\u043f\u0440\u0438 \u0437\u0430\u0436\u0430\u0442\u0438\u0438 \u043a\u043b\u0430\u0432\u0438\u0448\u0438 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0430\u0442\u044c \u0445\u043e\u043b\u0441\u0442 \u041b\u0435\u0432\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u043e\u0439 \u043c\u044b\u0448\u0438 \u0438\u043b\u0438 \u0441\u0442\u0438\u043b\u0443\u0441\u043e\u043c)"
                },
                clear: {
                    handler: this.clear,
                    description: "\u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u0445\u043e\u043b\u0441\u0442\u0430 (\u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0432 \u0440\u0435\u0436\u0438\u043c\u0430\u0445 \u0410\u043d\u0438\u043c\u0430\u0446\u0438\u044f, \u0424\u043e\u043d \u0438 \u0421\u043e\u043b\u043e)"
                },
                symmetry: {
                    handler: this.symmetry,
                    description: "\u0412\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0438\u043c\u043c\u0435\u0442\u0440\u0438\u0447\u043d\u043e\u0433\u043e \u0440\u0438\u0441\u043e\u0432\u0430\u043d\u0438\u044f"
                },
                reference: {
                    handler: this.toggleReference,
                    description: "\u041f\u043e\u043a\u0430\u0437 \u043e\u043a\u043d\u0430 \u043c\u043e\u0434\u0443\u043b\u044f Reference"
                },
                toolCentering: {
                    handler: this.toolCentering,
                    description: "\u041f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u0435 \u0444\u0438\u0433\u0443\u0440 \u043e\u0442 \u0446\u0435\u043d\u0442\u0440\u0430 (\u043f\u0440\u0438 \u0437\u0430\u0436\u0430\u0442\u0438\u0438 \u043a\u043b\u0430\u0432\u0438\u0448\u0438)"
                },
                undo: {
                    handler: this.undo,
                    repeat: !0,
                    description: "\u041e\u0442\u043c\u0435\u043d\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0448\u0442\u0440\u0438\u0445\u0430"
                },
                redo: {
                    handler: this.redo,
                    repeat: !0,
                    description: "\u0412\u043e\u0437\u0432\u0440\u0430\u0442 \u043e\u0442\u043c\u0435\u043d\u0435\u043d\u043d\u043e\u0433\u043e \u0448\u0442\u0440\u0438\u0445\u0430"
                },
                save: {
                    handler: this.save,
                    description: "\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0440\u0438\u0441\u0443\u043d\u043a\u0430 \u043d\u0430 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440"
                },
                brushTool: {
                    handler: this.brushTool,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041a\u0438\u0441\u0442\u044c"
                },
                eraserTool: {
                    handler: this.eraserTool,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041b\u0430\u0441\u0442\u0438\u043a"
                },
                rectangleTool: {
                    handler: this.rectangleTool,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041f\u0440\u044f\u043c\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a"
                },
                rectangleFilledTool: {
                    handler: this.rectangleFilledTool,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041f\u0440\u044f\u043c\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a (\u0437\u0430\u043a\u0440\u0430\u0448\u0435\u043d\u043d\u044b\u0439)"
                },
                circleTool: {
                    handler: this.circleTool,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041a\u0440\u0443\u0433"
                },
                circleFilledTool: {
                    handler: this.circleFilledTool,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u041a\u0440\u0443\u0433 (\u0437\u0430\u043a\u0440\u0430\u0448\u0435\u043d\u043d\u044b\u0439)"
                },
                fillTool: {
                    handler: this.fillTool,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0417\u0430\u043b\u0438\u0432\u043a\u0430"
                },
                noteTool: {
                    handler: this.noteTool,
                    description: "\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0417\u0430\u043c\u0435\u0442\u043a\u0430"
                }
            };
            this.areKeysLocked = !1;
            this.iface = new GPDrawInterface_(this, this.gpproxy, this.l);
            this.iface.addEventListener("color", ({
                detail: {
                    color: d
                }
            }) => {
                this.color = d;
                this.colorPicker.setColor(d)
            });
            this.iface.addEventListener("color2", ({
                detail: {
                    color: d
                }
            }) => {
                this.color2 = d
            });
            this.density = GPPainter_.DEFAULT_DENSITY;
            this.width = GPPainter_.ORIGINAL_WIDTH * this.density;
            this.height = GPPainter_.ORIGINAL_HEIGHT * this.density;
            this.style = document.documentElement.style;
            this.style.setProperty("--gp-painter-heigth-width", `${GPPainter_.ORIGINAL_WIDTH}px`);
            this.style.setProperty("--gp-painter-heigth", `${GPPainter_.ORIGINAL_HEIGHT}px`);
            this.style.setProperty("--gp-painter-background-color", `${GPPainter_.BACKGROUND_COLOR}`);
            this.color = this.s.defaultColor;
            this.color2 = GPPainter_.BACKGROUND_COLOR;
            this.thickness = Math.max(this.s.minThickness, Math.min(this.s.maxThickness, this.s.defaultThickness));
            a = Math.max(this.s.minOpacity, this.s.defaultOpacity);
            this.opacity = 1 === a ? a : String(a);
            this.tool = GPPainter_.DEFAULT_TOOL;
            this.isNote = !1;
            this.searchTimer = null;
            this.strokeId = GPPainter_.FIRST_STROKE_ID;
            this.strokeOptions = [];
            this.strokeCoords = [];
            this.history = [];
            this.undos = [];
            this.lastDrawData = this.backgroundData = null;
            this.lastDelimiterIndex = -1;
            this.isSigned = !1;
            this.mStrokeId = null;
            this.mStrokeOrigin = this.getRandomInt(GPPainter_.M_STROKE_RANGE);
            this.isSubscribed = !1;
            this.pointerY = this.pointerX = 0;
            this.isDrawing =
                this.isToolCentering = this.isZoomedToPoint = this.isHand = this.isEraser = this.isGrayscale = this.isVerticalMirror = this.isMirrored = this.isZooming = this.isBrightnessSetting = this.isThicknessSetting = this.isOpacitySetting = this.isDropperDown = this.isDropper = !1;
            this.centering\u0421oords = [];
            this.isSymmetryGuidesMoved = this.isSymmetryGuidesEditable = this.isSymmetryEnabled = !1;
            this.symmetryStrokesOptions = [];
            this.symmetryCoords = [];
            this.symmetryStrokesGroups = {};
            this.symmetryGuideX = Math.round(GPPainter_.ORIGINAL_WIDTH / 2);
            this.symmetryGuideY = Math.round(GPPainter_.ORIGINAL_HEIGHT / 2);
            this.radiansPerSymmetryRadialGuide = 2 * Math.PI / this.s.symmetryRadialGuidesCount;
            this.radiansPerSymmetryMandalaGuide = 2 * Math.PI / this.s.symmetryMandalaGuidesCount;
            this.isTerminated = this.isDisabled = !1;
            this.pointerMoveHandler = null;
            this.localization = this.gpproxy.getLocalization("draw");
            this.isReadyWarningShown = !1;
            this.lineSmoothingCounter = 1;
            this.background;
            this.backgroundCtx;
            this.lastDraw;
            this.lastDrawCtx;
            this.canvas;
            this.canvasCtx;
            this.stroke;
            this.strokeCtx;
            this.pointer;
            this.pointerCtx;
            this.colorPicker;
            this.colorPickerWidth = GPPainter_.COLOR_PICKER_WIDTH;
            this.colorPickerHeight = GPPainter_.COLOR_PICKER_HEIGHT;
            this.colorPickerHuePos = GPPainter_.COLOR_PICKER_HUE_POSITION;
            GPUtils_.bindMethods([this.globalCoordsHandler, this.keyDownHandler, this.keyUpHandler, this.inject, this.searchDrawContainer, this.getFillData, this.saveImage, this.clearPointer, this.middleButtonDown, this.rightButtonDown, this.strokeDown, this.strokeUp, this.strokeMove, this.strokeProcess,
                this.drawPointer, this.dropperKeyDown, this.dropperKeyUp, this.dropperMove, this.dropperDown, this.dropperUp, this.resetKeys, this.thicknessKeyDown, this.thicknessKeyUp, this.thicknessDown, this.opacityKeyDown, this.opacityKeyUp, this.opacityDown, this.brightnessKeyDown, this.brightnessKeyUp, this.brightnessDown, this.zoomKeyDown, this.zoomKeyUp, this.zoomDown, this.mouseZoom, this.handKeyDown, this.handKeyUp, this.handDown, this.symmetryGuidesDownHandler, this.changeSymmetryRadialGuidesCount, this.changeSymmetryMandalaGuidesCount,
                this.blockContextMenu, this.resizeWindowHandler, this.windowsInkCheck
            ], this);
            this.keysMap = this.buildKeysMap(this.bindings);
            this.pressedKeys = new Set;
            this.currentBinding = null;
            this.addEventListener("color", ({
                detail: {
                    color: d
                }
            }) => {
                this.color = d
            });
            this.addEventListener("color2", ({
                detail: {
                    color: d
                }
            }) => {
                this.color2 = d
            });
            this.addEventListener("stroke", ({
                detail: {
                    data: d,
                    symmetryStrokesData: e = []
                }
            }) => {
                this.drawFunction(this.canvasCtx, [d, ...e]);
                this.strokeOptions = [];
                this.strokeCoords = [];
                this.symmetryCoords = [];
                e.length &&
                    (this.symmetryStrokesGroups[d[1]] = d[1], e.map(f => {
                        this.symmetryStrokesGroups[f[1]] = d[1]
                    }));
                this.clearStroke();
                this.history.push(d, ...e);
                this.undos.length && (this.undos = []);
                this.shouldBeSigned() && this.sign()
            });
            this.addEventListener("stroke_started", ({
                detail: {
                    data: d,
                    symmetryStrokesData: e = []
                }
            }) => {
                const f = !!e.length,
                    g = d[0];
                this.gpproxy.getSendQueueSize() && this.isToolInTime(g) || (this.gpproxy.tool(1, d, f), e.forEach(h => {
                    this.gpproxy.tool(1, h, f)
                }))
            });
            this.addEventListener("stroke_process", ({
                detail: {
                    data: d,
                    symmetryStrokesData: e = []
                }
            }) => {
                const f = !!e.length;
                this.gpproxy.tool(3, d, f);
                e.forEach(g => {
                    this.gpproxy.tool(3, g, f)
                })
            });
            this.addEventListener("stroke_ended", ({
                detail: {
                    data: d,
                    symmetryStrokesData: e = []
                }
            }) => {
                const f = !!e.length,
                    g = f || this.gpproxy.getSendQueueSize() && this.isToolInTime(d[0]) ? 1 : 3;
                this.gpproxy.tool(g, d, f);
                e.forEach(h => {
                    this.gpproxy.tool(g, h, f)
                })
            });
            this.addEventListener("stroke_undo", ({
                detail: {
                    data: d,
                    symmetryStrokesData: e = []
                }
            }) => {
                this.gpproxy.undo(d[1], !1);
                e.forEach(f => {
                    this.gpproxy.undo(f[1], !1)
                })
            });
            this.addEventListener("stroke_redo",
                ({
                    detail: {
                        data: d,
                        symmetryStrokesData: e = []
                    }
                }) => {
                    const f = !!e.length;
                    this.gpproxy.redo(d, f);
                    e.forEach(g => {
                        this.gpproxy.redo(g, f)
                    })
                });
            this.gpproxy.addEventListener("localization", ({
                detail: {
                    data: d,
                    type: e
                }
            }) => {
                "draw" === e && (this.localization = d)
            });
            this.gpproxy.addEventListener("turn_started", () => {
                this.terminate();
                this.resetTurnSettings();
                this.setTimer()
            });
            this.gpproxy.addEventListener("turns_ended", d => {
                this.terminate();
                this.stopTimer()
            });
            this.gpproxy.addEventListener("send_queue_updated", ({
                detail: {
                    size: d,
                    timeLeft: e
                }
            }) => {
                this.iface.updateActionQueueSize(d, e)
            });
            this.iface.addEventListener("bindings_updated", ({
                detail: {
                    bindings: d
                }
            }) => {
                this.updateBindings(d);
                this.saveBindings()
            });
            document.addEventListener("_url_changed", ({
                detail: {
                    path: d
                }
            }) => {
                "/draw" === d && (this.enabled = this.isPermittedMode(), this.terminate(), this.inject())
            });
            this.gpproxy.addEventListener("rejoin", ({
                detail: {
                    screen: d
                }
            }) => {
                d === GPProxy_.SCREEN.PAINTER && (this.enabled = this.isPermittedMode(), this.terminate(), this.inject())
            });
            document.addEventListener("_subs_status",
                ({
                    detail: {
                        status: d
                    }
                }) => {
                    this.isSubscribed = d
                });
            Document.prototype.addEventListener = new Proxy(Element.prototype.addEventListener, {
                apply(d, e, f) {
                    if ("keydown" !== f[0] || !1 !== f[2]) return d.apply(e, f)
                }
            });
            const c = this;
            Element.prototype.addEventListener = new Proxy(Element.prototype.addEventListener, {
                apply(d, e, f) {
                    if (!(e.classList?.contains("drawingContainer") && ["mousedown", "pointerdown", "contextmenu", "touchstart"].includes(f[0]) && c.isPermittedMode())) return d.apply(e, f)
                }
            });
            this.timer?.addEventListener("finish",
                d => {
                    this.timer.settings.readyAfterTimeExpires && this.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION) && this.gpproxy.isHost() && this.iface.readyBtn.click()
                });
            this.reference?.addEventListener("state_changed", ({
                detail: {
                    isEnabled: d
                }
            }) => {
                d && this.resizeWindowHandler()
            })
        }
        buildKeysMap(a) {
            const b = {};
            for (let c in a) this.tools[c] && a[c].forEach(d => {
                const e = d.length;
                b[e] = b[e] || [];
                b[e].push({
                    name: c,
                    keys: d,
                    ...this.tools[c]
                })
            });
            return b
        }
        bindingHandler(a, b) {
            const c = this.getBinding();
            c ? (a.preventDefault(), a.stopPropagation(),
                a.repeat && a.repeat !== !!c.repeat || !a.repeat && c.name === this.currentBinding?.name || (c.handler.apply(this, [a]), this.currentBinding = c)) : !b && this.isNativeBinding(a.code) && a.stopPropagation()
        }
        isNativeBinding(a) {
            return GPPainter_.NATIVE_BINDINGS_KEYS.has(a)
        }
        getBinding() {
            var a = this.pressedKeys.size;
            if (this.currentBinding) {
                if (!a) return this.currentBinding = null;
                if (!this.keysMap[a]) return this.currentBinding.keys.length > a && (this.currentBinding = null), null
            }
            if (a = (this.keysMap[a] || []).find(({
                    keys: b
                }) => {
                    const c = this.pressedKeys.values();
                    return b.every(d => d === c.next().value)
                })) return a;
            this.checkForMatchBinding() || (this.currentBinding = null);
            return null
        }
        checkForMatchBinding() {
            if (this.currentBinding) {
                var a = this.pressedKeys.values();
                return this.currentBinding.keys.every(b => b === a.next().value)
            }
        }
        keyDownHandler(a) {
            this.areKeysDisabled() || (this.pressedKeys.add(a.code), this.bindingHandler(a))
        }
        keyUpHandler(a) {
            this.areKeysDisabled() || (this.pressedKeys.delete(a.code), this.bindingHandler(a, !0))
        }
        areKeysDisabled() {
            return this.isDisabled || this.areKeysLocked ||
                "INPUT" === document.activeElement.tagName && ("text" === document.activeElement.type || "search" === document.activeElement.type) || "TEXTAREA" === document.activeElement.tagName
        }
        render() {
            this.container = document.createElement("div");
            this.container.className = "gp-painter_";
            this.container.addEventListener("pointerdown", this.suppressEvents);
            this.container.addEventListener("pointermove", this.suppressEvents);
            this.container.addEventListener("mousedown", this.suppressEvents);
            this.container.addEventListener("mousemove",
                this.suppressEvents);
            this.container.addEventListener("mouseup", this.suppressEvents);
            this.container.addEventListener("mousecancel", this.suppressEvents);
            this.container.addEventListener("touchstart", this.suppressEvents, !0);
            this.container.addEventListener("touchend", this.suppressEvents, !0);
            this.container.addEventListener("touchcancel", this.suppressEvents, !0);
            this.container.addEventListener("wheel", this.stopWheelPropagation);
            this.drawingArea = document.createElement("div");
            this.drawingArea.className = "drawing-area";
            this.container.appendChild(this.drawingArea);
            this.background =
                document.createElement("canvas");
            this.background.className = "background_";
            this.background.classList.add("hidden");
            this.background.width = this.width;
            this.background.height = this.height;
            this.backgroundCtx = this.background.getContext("2d");
            this.backgroundCtx.fillStyle = GPPainter_.BACKGROUND_COLOR;
            this.backgroundCtx.fillRect(0, 0, this.width, this.height);
            this.drawingArea.appendChild(this.background);
            this.lastDraw = document.createElement("canvas");
            this.lastDraw.className = "last-draw_";
            this.lastDraw.classList.add("hidden");
            this.lastDraw.width = this.width;
            this.lastDraw.height = this.height;
            this.lastDrawCtx = this.lastDraw.getContext("2d");
            this.drawingArea.appendChild(this.lastDraw);
            this.canvas = document.createElement("canvas");
            this.canvas.className = "canvas_";
            this.canvas.width = this.width;
            this.canvas.height = this.height;
            this.canvasCtx = this.canvas.getContext("2d");
            this.drawingArea.appendChild(this.canvas);
            this.stroke = document.createElement("canvas");
            this.stroke.className = "stroke_";
            this.stroke.width = this.width;
            this.stroke.height =
                this.height;
            this.stroke.addEventListener("contextmenu", this.blockContextMenu);
            this.stroke.addEventListener("pointermove", this.drawPointer);
            null === this.abt?.getWindowsInkWarningState() && this.stroke.addEventListener("pointerdown", this.windowsInkCheck, {
                once: !0
            });
            this.stroke.addEventListener("pointerdown", this.middleButtonDown);
            this.stroke.addEventListener("pointerdown", this.rightButtonDown);
            this.stroke.addEventListener("pointerdown", this.strokeDown);
            this.stroke.addEventListener("pointerdown", this.dropperDown);
            this.stroke.addEventListener("pointerdown", this.thicknessDown);
            this.stroke.addEventListener("pointerdown", this.opacityDown);
            this.stroke.addEventListener("pointerdown", this.brightnessDown);
            this.stroke.addEventListener("pointerdown", this.zoomDown);
            this.stroke.addEventListener("pointerdown", this.handDown);
            this.stroke.addEventListener("pointerout", this.clearPointer);
            this.stroke.addEventListener("wheel", this.mouseZoom);
            this.drawingArea.appendChild(this.stroke);
            this.strokeCtx = this.stroke.getContext("2d");
            this.strokeCtx.lineJoin = "round";
            this.strokeCtx.lineCap = "round";
            this.strokeCtx.strokeStyle = this.s.defaultColor;
            this.strokeCtx.lineWidth = this.s.defaultThickness;
            this.strokeCtx.globalAlpha = this.s.defaultOpacity;
            this.pointer = document.createElement("canvas");
            this.pointer.className = "pointer_";
            this.pointer.width = this.width;
            this.pointer.height = this.height;
            this.drawingArea.appendChild(this.pointer);
            this.pointerCtx = this.pointer.getContext("2d");
            this.pointerCtx.lineWidth = this.density;
            this.symmetryGuides = document.createElement("canvas");
            this.symmetryGuides.className = "symmetry-guides_";
            this.symmetryGuides.width = this.width;
            this.symmetryGuides.height = this.height;
            this.symmetryGuidesCtx = this.symmetryGuides.getContext("2d");
            this.symmetryGuidesCtx.strokeStyle = this.s.symmetryGuidesColor;
            this.symmetryGuidesCtx.globalAlpha = this.s.symmetryGuidesOpacity;
            this.symmetryGuidesCtx.lineWidth = this.s.symmetryGuidesWidth * this.density;
            this.symmetryGuides.addEventListener("contextmenu", this.blockContextMenu);
            this.symmetryGuides.addEventListener("pointerdown",
                this.symmetryGuidesDownHandler);
            this.drawSymmetryGuides();
            this.drawingArea.appendChild(this.symmetryGuides);
            this.zoomer = window.renderer({
                minScale: this.s.minZoom,
                maxScale: this.s.maxZoom,
                element: this.drawingArea,
                defaultScaleSensitivity: this.s.zoomSensitivity
            });
            this.initColorPicker({
                width: this.s.colorPickerWidth,
                height: this.s.colorPickerHeight,
                huePos: this.s.colorPickerHuePosition
            })
        }
        terminate() {
            !this.isTerminated && this.container && (clearTimeout(this.strokeTimer), clearTimeout(this.searchTimer), window.removeEventListener("blur",
                    this.resetKeys), window.removeEventListener("focus", this.resetKeys), window.removeEventListener("resize", this.resizeWindowHandler), document.removeEventListener("pointermove", this.globalCoordsHandler, !0), document.removeEventListener("keydown", this.keyDownHandler, !0), document.removeEventListener("keyup", this.keyUpHandler, !0), document.removeEventListener("contextmenu", this.blockContextMenu), this.stroke.removeEventListener("pointermove", this.strokeMove), this.stroke.removeEventListener("pointerup", this.strokeUp, {
                    once: !0
                }), this.stroke.removeEventListener("pointermove", this.thicknessMoveHandler), this.stroke.removeEventListener("pointermove", this.opacityMoveHandler), this.stroke.removeEventListener("pointermove", this.brightnessMoveHandler), this.stroke.removeEventListener("pointermove", this.zoomMoveHandler), this.stroke.removeEventListener("pointermove", this.handMoveHandler), this.clearPointer(), this.clearStroke(), this.clearCanvas(), this.clearBackground(), this.resetZoom(), this.resetMirror(), this.container.classList.remove("grayscale_"),
                this.background.classList.add("hidden"), this.lastDraw.classList.add("hidden"), this.symmetryGuides.classList.remove("editable_"), this.colorPicker.hide(), this.iface.terminate(), this.reference?.terminate(), this.container.remove(), this.isTerminated = !0)
        }
        resetTurnSettings() {
            if (this.container) {
                this.color = this.s.defaultColor;
                this.color2 = GPPainter_.BACKGROUND_COLOR;
                this.thickness = Math.max(this.s.minThickness, Math.min(this.s.maxThickness, this.s.defaultThickness));
                var a = Math.max(this.s.minOpacity, this.s.defaultOpacity);
                this.opacity = 1 === a ? a : String(a);
                this.tool = GPPainter_.DEFAULT_TOOL;
                this.isSymmetryEnabled = !1;
                this.symmetryStrokesGroups = {};
                this.symmetryGuides.classList.remove("shown_");
                this.isSigned = !1;
                this.mStrokeOrigin = this.getRandomInt(GPPainter_.M_STROKE_RANGE)
            }
        }
        init() {
            const a = this.gpproxy.getState(),
                b = this.gpproxy.getCurrentTurnId();
            this.searchTimer = null;
            this.strokeOptions = [];
            this.strokeCoords = [];
            this.history = a.draw || [];
            this.backgroundData = this.ac?.isSuspicious(`tbg_${b}`) ? [] : a.background;
            this.lastDrawData = this.ac?.isSuspicious(`t_${b}`) ? [] : a.lastDraw;
            this.lastDelimiterIndex = this.history.findLastIndex(c => 11 === c[0]);
            this.strokeId = this.calculateStrokeID();
            this.undos = [];
            this.pointerY = this.pointerX = 0;
            this.isDrawing = this.isToolCentering = this.isZoomedToPoint = this.isHand = this.isEraser = this.isGrayscale = this.isVerticalMirror = this.isMirrored = this.isZooming = this.isBrightnessSetting = this.isThicknessSetting = this.isOpacitySetting = this.isDropperDown = this.isDropper = this.areKeysLocked = !1;
            this.currentBinding = null;
            this.pressedKeys.clear();
            this.isSymmetryGuidesMoved =
                this.isSymmetryGuidesEditable = this.isReadyWarningShown = this.isNote = this.isDisabled = !1;
            this.symmetryStrokesOptions = [];
            this.symmetryCoords = [];
            !this.isSubscribed && !this.gpproxy.isSoloGame() && 1 < this.s.symmetryMode && (this.s.symmetryMode = GPPainter_.DEFAULT_SYMMETRY_MODE, this.drawSymmetryGuides());
            document.addEventListener("pointermove", this.globalCoordsHandler, !0);
            document.addEventListener("keydown", this.keyDownHandler, !0);
            document.addEventListener("keyup", this.keyUpHandler, !0);
            window.addEventListener("blur",
                this.resetKeys);
            window.addEventListener("focus", this.resetKeys);
            window.addEventListener("resize", this.resizeWindowHandler);
            this.redrawBackground();
            this.redrawLastDraw();
            this.redrawCanvas();
            this.background.classList.toggle("hidden", !this.backgroundData);
            this.lastDraw.classList.toggle("hidden", !this.lastDrawData);
            this.zoomer.setContainerScale(this.getContainerScale());
            this.iface.init();
            this.reference?.init();
            this.gpproxy.isReady() && this.iface.disableInterface();
            this.isTerminated = !1
        }
        inject() {
            this.enabled &&
                (this.container || this.render(), this.searchDrawContainer().then(a => {
                    a.appendChild(this.container);
                    this.init()
                }))
        }
        searchDrawContainer() {
            return new Promise(a => {
                this.searchTimer = setTimeout(() => {
                    const b = document.querySelector(".drawingContainer");
                    b ? (clearTimeout(this.searchTimer), a(b)) : this.searchDrawContainer()
                }, GPPainter_.SEARCH_DRAW_CONTAINER_INTERVAL)
            })
        }
        isPermittedMode() {
            const {
                configs: a
            } = this.gpproxy.getState();
            for (let b in GPPainter_.DISABLED_MODE_OPTIONS)
                if (GPPainter_.DISABLED_MODE_OPTIONS[b].some(c =>
                        c === a[b])) return !1;
            return !0
        }
        initColorPicker({
            width: a,
            height: b,
            huePos: c
        } = {}) {
            this.colorPickerWidth = a ?? this.colorPickerWidth;
            this.colorPickerHeight = b ?? this.colorPickerHeight;
            this.colorPickerHuePos = c ?? this.colorPickerHuePos;
            this.colorPicker?.getElement() && this.colorPicker.getElement().remove();
            this.colorPicker = new GPColorPicker_(this.colorPickerWidth, this.colorPickerHeight, this.colorPickerHuePos);
            this.colorPicker.setColor(this.color);
            this.colorPicker.hide();
            this.colorPicker.addEventListener("color",
                ({
                    detail: {
                        color: d
                    }
                }) => {
                    this.dispatchEvent(new CustomEvent("color", {
                        detail: {
                            color: d
                        }
                    }))
                });
            document.body.appendChild(this.colorPicker.getElement())
        }
        calculateStrokeID() {
            const a = [...this.history, ...this.undos].reduceRight((b, c) => c[1] > b ? c[1] : b, GPPainter_.FIRST_STROKE_ID - 1);
            return Math.max(a + 1, GPPainter_.FIRST_STROKE_ID)
        }
        middleButtonDown(a) {
            1 !== a.button || this.isThicknessSetting || this.isOpacitySetting || this.isBrightnessSetting || this.isZooming || this.isHand || (this.handDown(a, !0), a.stopPropagation(), a.stopImmediatePropagation())
        }
        rightButtonDown(a) {
            if (2 ===
                a.button) {
                if (this.isThicknessSetting) this.stroke.removeEventListener("pointermove", this.thicknessMoveHandler), this.thickness = this.s.defaultThickness, this.iface.updateThickness(this.thickness), this.renderPointer(...this.getCoords(a), void 0, void 0, !0);
                else if (this.isOpacitySetting) this.stroke.removeEventListener("pointermove", this.opacityMoveHandler), this.setOpacity(this.s.defaultOpacity), this.renderPointer(...this.getCoords(a), this.opacity, void 0, !0);
                else if (this.isBrightnessSetting) {
                    this.stroke.removeEventListener("pointermove",
                        this.zoomMoveHandler);
                    this.brightness = 1;
                    const [b, c] = GPColorUtils_.hexToHsv(this.color), d = GPColorUtils_.hsvToHex(b, c, this.brightness);
                    this.colorPicker.setColor(d);
                    this.dispatchEvent(new CustomEvent("color", {
                        detail: {
                            color: d
                        }
                    }));
                    this.renderPointer(...this.getCoords(a), this.opacity, void 0, !0)
                } else this.isZooming ? (this.stroke.removeEventListener("pointermove", this.zoomMoveHandler), this.resetZoom()) : this.isHand ? this.resetZoom() : this.strokeDown(a, this.color2);
                document.addEventListener("contextmenu", this.blockContextMenu, {
                    once: !0
                });
                a.stopPropagation();
                a.stopImmediatePropagation()
            }
        }
        strokeDown(a, b) {
            this.gpproxy.isConnected() || this.abt?.showDisconnectionNotice();
            this.isDrawing && this.strokeUp(a);
            if (!(this.isDropper || this.isDropperDown || this.isOpacitySetting || this.isThicknessSetting || this.isBrightnessSetting || this.isZooming || this.isHand)) {
                var c = this.getOCoords(a);
                this.strokeOptions = this.getStrokeOptions(this.tool, b);
                this.strokeCoords = [c];
                this.isCenteringActivated = this.shouldCenteringBeActivated(this.tool);
                this.centering\u0421oords = [c.slice()];
                this.isSymmetryEnabled && this.convertToSymmetryCoords(c).forEach((d, e) => {
                    const f = this.strokeOptions.slice();
                    f[1] = this.strokeId++;
                    this.symmetryStrokesOptions[e] = f;
                    this.symmetryCoords[e] = [d];
                    this.centering\u0421oords[e + 1] = d.slice()
                });
                this.lineSmoothingCounter = 1;
                this.tool === GPPainter_.TOOL.FILL ? (this.updateStrokeCoords(this.strokeCoords, this.getCoords(a)), a = this.buildStrokeData(this.strokeOptions, this.strokeCoords), this.dispatchEvent(new CustomEvent("stroke_started", {
                    detail: {
                        data: a
                    }
                })), this.dispatchEvent(new CustomEvent("stroke", {
                    detail: {
                        data: a
                    }
                }))) : (this.stroke.setPointerCapture(a.pointerId), this.stroke.addEventListener("pointermove", this.strokeMove), this.stroke.addEventListener("pointerup", this.strokeUp, {
                    once: !0
                }), a = [...this.strokeOptions, ...this.strokeCoords], b = this.buildSymmetryStrokesData(!0), this.drawFunction(this.strokeCtx, [a, ...b], this.density, !1), clearTimeout(this.strokeTimer), !this.isSymmetryEnabled && this.isToolInTime(this.tool) && (this.strokeTimer = setTimeout(this.strokeProcess, 1E3), this.dispatchEvent(new CustomEvent("stroke_started", {
                    detail: {
                        data: a,
                        symmetryStrokesData: b
                    }
                }))), this.isDrawing = !0)
            }
        }
        buildSymmetryStrokesData(a = !1) {
            const b = [];
            this.isSymmetryEnabled && this.symmetryCoords.forEach((c, d) => {
                b.push(this.buildStrokeData(this.symmetryStrokesOptions[d], c, a))
            });
            return b
        }
        rotatePoint(a, b, c, d, e) {
            var f = Math.PI / 180 * e;
            e = Math.cos(f);
            f = Math.sin(f);
            return [e * (c - a) + f * (d - b) + a, e * (d - b) - f * (c - a) + b]
        }
        convertToSymmetryCoords([a, b], c = this.s.symmetryMode) {
            const d = this.isMirrored ? GPPainter_.ORIGINAL_WIDTH - this.symmetryGuideX : this.symmetryGuideX,
                e =
                this.isVerticalMirror ? GPPainter_.ORIGINAL_HEIGHT - this.symmetryGuideY : this.symmetryGuideY,
                f = [];
            switch (c) {
                case GPPainter_.SYMMETRY_MODES.VERTICAL:
                    f.push([d + (d - a), b]);
                    break;
                case GPPainter_.SYMMETRY_MODES.HORIZONTAL:
                    f.push([a, e + (e - b)]);
                    break;
                case GPPainter_.SYMMETRY_MODES.QUADRANT:
                    f.push([d + (d - a), b]);
                    f.push([a, e + (e - b)]);
                    f.push([d + (d - a), e + (e - b)]);
                    break;
                case GPPainter_.SYMMETRY_MODES.RADIAL:
                    c = this.s.symmetryRadialGuidesCount;
                    var g = 360 / c;
                    for (var h = 1; h < c; h++) {
                        const [l, m] = this.rotatePoint(d, e, a, b, h * g);
                        f.push([Math.round(l),
                            Math.round(m)
                        ])
                    }
                    break;
                case GPPainter_.SYMMETRY_MODES.MANDALA:
                    c = e + (e - b);
                    g = 2 * this.s.symmetryMandalaGuidesCount;
                    h = 360 / g;
                    const k = this.s.symmetryMandalaGuidesCount % 2 ? 2 * h : 3 * h;
                    for (let l = 1; l < g; l++) {
                        let m, n;
                        l % 2 ? (m = l * h + k, n = c) : (m = l * h, n = b);
                        const [r, q] = this.rotatePoint(d, e, a, n, m);
                        f.push([Math.round(r), Math.round(q)])
                    }
            }
            return f
        }
        strokeMove(a) {
            var b = this.getOCoords(a);
            this.updateStrokeCoords(this.strokeCoords, b);
            this.isSymmetryEnabled && (b = this.convertToSymmetryCoords(b), this.updateSymmetryStrokeCoords(b));
            b = this.buildSymmetryStrokesData(!0);
            this.clearStroke();
            this.drawFunction(this.strokeCtx, [
                [...this.strokeOptions, ...this.strokeCoords], ...b
            ], this.density, !1);
            this.lineSmoothingCounter++;
            this.isCenteringActivated && this.renderPointer(...this.getCoords(a), null, void 0, !1, this.centering\u0421oords[0].map(c => c * this.density))
        }
        strokeUp(a) {
            clearTimeout(this.strokeTimer);
            this.s.lineSmoothingLevel && this.lineSmoothingCounter % (this.s.lineSmoothingLevel + 1) && this.strokeCoords.push(this.getOCoords(a));
            a = this.buildStrokeData(this.strokeOptions, this.strokeCoords);
            const b = this.buildSymmetryStrokesData(),
                c = this.isToolInTime(this.tool) ? "stroke_ended" : "stroke_started";
            this.dispatchEvent(new CustomEvent(c, {
                detail: {
                    data: a,
                    symmetryStrokesData: b
                }
            }));
            this.dispatchEvent(new CustomEvent("stroke", {
                detail: {
                    data: a,
                    symmetryStrokesData: b
                }
            }));
            this.isDrawing = !1;
            this.stroke.removeEventListener("pointermove", this.strokeMove)
        }
        strokeProcess() {
            let a;
            this.isSymmetryEnabled && (a = [], this.symmetryCoords.forEach((b, c) => {
                a.push(this.buildStrokeData(this.symmetryStrokesOptions[c], b))
            }));
            this.dispatchEvent(new CustomEvent("stroke_process", {
                detail: {
                    data: [...this.strokeOptions, ...this.strokeCoords],
                    symmetryStrokesData: a
                }
            }));
            !this.isSymmetryEnabled && this.isToolInTime(this.tool) && (clearTimeout(this.strokeTimer), this.strokeTimer = setTimeout(this.strokeProcess, 1E3))
        }
        updateSymmetryStrokeCoords(a) {
            a.forEach((b, c) => {
                this.updateStrokeCoords(this.symmetryCoords[c], b, c + 1)
            })
        }
        updateStrokeCoords(a, b, c = 0) {
            switch (this.tool) {
                case GPPainter_.TOOL.BRUSH:
                case GPPainter_.TOOL.ERASER:
                case GPPainter_.TOOL.NOTE:
                    this.s.lineSmoothingLevel &&
                        (this.tool !== GPPainter_.TOOL.ERASER || this.s.eraserLineSmoothing) && this.lineSmoothingCounter % (this.s.lineSmoothingLevel + 1) || a.push(b);
                    break;
                case GPPainter_.TOOL.LINE:
                case GPPainter_.TOOL.RECTANGLE:
                case GPPainter_.TOOL.CIRCLE:
                case GPPainter_.TOOL.RECTANGLE_FILLED:
                case GPPainter_.TOOL.CIRCLE_FILLED:
                    let d = [a[0], b];
                    a.splice(0, a.length);
                    a.push(...d);
                    if (this.isCenteringActivated) {
                        const [e, f] = this.centering\u0421oords[c];
                        a[0][0] = e - (b[0] - e);
                        a[0][1] = f - (b[1] - f)
                    }
                    break;
                case GPPainter_.TOOL.FILL:
                    a.splice(0, a.length),
                        a.push(...this.getFillData(b[0], b[1]))
            }
        }
        getStrokeOptions(a = this.tool, b = this.color, c = this.thickness) {
            switch (a) {
                case GPPainter_.TOOL.BRUSH:
                case GPPainter_.TOOL.LINE:
                case GPPainter_.TOOL.RECTANGLE:
                case GPPainter_.TOOL.CIRCLE:
                case GPPainter_.TOOL.RECTANGLE_FILLED:
                case GPPainter_.TOOL.CIRCLE_FILLED:
                    return [a, this.strokeId++, [b, c, this.opacity]];
                case GPPainter_.TOOL.ERASER:
                    return [a, this.strokeId++, this.s.doubleEraserThickness ? 2 * c : c];
                case GPPainter_.TOOL.FILL:
                    return [a, this.strokeId++, [b, this.opacity]];
                case GPPainter_.TOOL.NOTE:
                    return [a,
                        this.strokeId++, null
                    ]
            }
        }
        buildStrokeData(a, b, c = !1) {
            return [...a, ...(c || !this.isMirrored && !this.isVerticalMirror || a[0] === GPPainter_.TOOL.FILL ? b : this.mirrorStrokeCoords(b, this.isMirrored, this.isVerticalMirror))]
        }
        drawPointer(a, b, c) {
            const [d, e] = this.getCoords(a);
            this.pointerX = d;
            this.pointerY = e;
            this.renderPointer(d, e, b, c)
        }
        renderPointer(a, b, c, d = this.thickness, e, f) {
            this.clearPointer();
            c = this.isOpacitySetting ? this.opacity : c;
            d = this.isZooming ? 1 : !e && GPPainter_.TOOLS_THICKNESSES[this.tool] || d;
            this.tool === GPPainter_.TOOL.ERASER &&
                this.s.doubleEraserThickness && (d *= 2);
            e = this.pointerCtx;
            e.beginPath();
            e.arc(a, b, d / 2 * this.density, 0, 2 * Math.PI);
            c && (e.fillStyle = `rgba(${GPColorUtils_.hexToRgb(this.color).join(",")},${c}`, e.fill());
            e.strokeStyle = GPPainter_.POINTER_COLOR;
            e.stroke();
            e.beginPath();
            e.arc(a, b, (d / 2 + 1) * this.density, 0, 2 * Math.PI);
            e.strokeStyle = GPPainter_.POINTER_OUTLINE_COLOR;
            e.globalAlpha = this.s.pointerOutlineOpacity;
            e.stroke();
            e.globalAlpha = this.s.pointerOpacity;
            if (d < GPPainter_.POINTER_CROSSHAIR_MIN_THICKNESS) {
                d = 3 * d * this.density;
                const g = GPPainter_.POINTER_CROSSHAIR_LINE_LENGTH * this.density;
                e.strokeStyle = GPPainter_.POINTER_OUTLINE_COLOR;
                e.globalAlpha = this.s.pointerOutlineOpacity;
                e.beginPath();
                e.moveTo(a, b - d);
                e.lineTo(a, b - d - g);
                e.moveTo(a + d, b);
                e.lineTo(a + d + g, b);
                e.moveTo(a, b + d);
                e.lineTo(a, b + d + g);
                e.moveTo(a - d, b);
                e.lineTo(a - d - g, b);
                e.stroke();
                e.globalAlpha = this.s.pointerOpacity
            }
            if (f) {
                const [g, h] = f;
                e.beginPath();
                e.arc(g, h, GPPainter_.POINTER_DOT_THICKNESS / 2 * this.density, 0, 2 * Math.PI);
                c && (e.fillStyle = `rgba(${GPColorUtils_.hexToRgb(this.color).join(",")},${c}`,
                    e.fill());
                e.strokeStyle = GPPainter_.POINTER_COLOR;
                e.stroke();
                e.beginPath();
                e.arc(g, h, (GPPainter_.POINTER_DOT_THICKNESS / 2 + 1) * this.density, 0, 2 * Math.PI);
                e.strokeStyle = GPPainter_.POINTER_OUTLINE_COLOR;
                e.globalAlpha = this.s.pointerOutlineOpacity;
                e.stroke();
                e.globalAlpha = this.s.pointerOpacity
            }
        }
        updatePointer() {
            this.renderPointer(this.pointerX, this.pointerY)
        }
        setTool(a) {
            this.tool = a;
            a = a === GPPainter_.TOOL.NOTE;
            const b = a !== this.isNote;
            this.isNote = a;
            b && (this.redrawBackground(), this.redrawLastDraw(), this.redrawCanvas())
        }
        getColor() {
            return this.color
        }
        getColor2() {
            return this.color2
        }
        setOpacity(a) {
            this.opacity =
                String(a);
            this.iface.updateOpacity(a)
        }
        setThickness(a) {
            this.thickness = a
        }
        toggleLastDraw(a) {
            this.lastDraw.classList.toggle("hidden", !a)
        }
        clearBackground() {
            this.backgroundCtx.fillStyle = GPPainter_.BACKGROUND_COLOR;
            this.backgroundCtx.fillRect(0, 0, this.background.width, this.background.height)
        }
        clearLastDraw() {
            this.lastDrawCtx.clearRect(0, 0, this.lastDraw.width, this.lastDraw.height)
        }
        clearCanvas() {
            this.canvasCtx.clearRect(0, 0, this.canvas.width, this.canvas.height)
        }
        clearStroke() {
            this.strokeCtx.clearRect(0, 0, this.stroke.width,
                this.stroke.height)
        }
        clearPointer() {
            this.pointerCtx.clearRect(0, 0, this.pointer.width, this.pointer.height)
        }
        redrawBackground() {
            this.clearBackground();
            this.backgroundData?.length && this.drawFunction(this.backgroundCtx, this.backgroundData, this.density, !1, this.isNote)
        }
        redrawLastDraw() {
            this.clearLastDraw();
            this.lastDrawData?.length && this.drawFunction(this.lastDrawCtx, this.lastDrawData, this.density, !0, this.isNote)
        }
        redrawCanvas() {
            this.clearCanvas();
            this.history.length && this.drawFunction(this.canvasCtx, this.history,
                this.density, !0, this.isNote)
        }
        getCoords(a) {
            const b = a.target.getBoundingClientRect(),
                [c, d] = a.touches ? [a.touches[0].clientX, a.touches[0].clientY] : [a.clientX, a.clientY],
                [e, f] = [c - b.left, d - b.top];
            return [Math.round(a.target.width / b.width * e), Math.round(a.target.height / b.height * f)]
        }
        getOCoords(a) {
            const [b, c] = this.getCoords(a);
            return [Math.round(b / this.density), Math.round(c / this.density)]
        }
        globalCoordsHandler(a) {
            this.cX = a.clientX;
            this.cY = a.clientY
        }
        resetKeys(a) {
            this.container && (this.drawingArea.classList.remove("dropper_",
                "dropper-s_", "hand_", "hand-s_"), this.isToolCentering = this.isHand = this.isEraser = this.isZooming = this.isBrightnessSetting = this.isThicknessSetting = this.isOpacitySetting = this.isDropperDown = this.isDropper = !1, this.stroke.removeEventListener("pointermove", this.thicknessMoveHandler), this.stroke.removeEventListener("pointermove", this.opacityMoveHandler), this.stroke.removeEventListener("pointermove", this.brightnessMoveHandler), this.stroke.removeEventListener("pointermove", this.zoomMoveHandler), this.stroke.removeEventListener("pointermove",
                this.handMoveHandler), this.currentBinding = null, a && (this.pressedKeys.clear(), this.bindingHandler(a)))
        }
        dropperKeyDown(a) {
            a.preventDefault();
            this.isDropper = !0;
            this.drawingArea.classList.add("dropper_");
            document.addEventListener("keyup", this.dropperKeyUp, {
                once: !0
            })
        }
        dropperKeyUp(a) {
            this.isDropper && (a.preventDefault(), this.isDropper = !1, this.drawingArea.classList.remove("dropper_"), this.isDropperDown || this.stroke.removeEventListener("pointermove", this.dropperMove))
        }
        dropperDown(a) {
            this.isDropper && (this.isDropperDown = !0, this.dropperMove(a), this.drawingArea.classList.add("dropper-s_"), this.stroke.setPointerCapture(a.pointerId), this.stroke.addEventListener("pointermove", this.dropperMove), this.stroke.addEventListener("pointerup", this.dropperUp, {
                once: !0
            }))
        }
        dropperMove(a) {
            if (this.isDropper || this.isDropperDown) {
                var [b, c] = this.getCoords(a);
                b = this.isMirrored ? this.width - b : b;
                c = this.isVerticalMirror ? this.height - c : c;
                a = this.getPixelColor(b, c);
                this.colorPicker.setColor(a);
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: a
                    }
                }))
            }
        }
        dropperUp(a) {
            let [b,
                c
            ] = this.getCoords(a);
            b = this.isMirrored ? this.width - b : b;
            c = this.isVerticalMirror ? this.height - c : c;
            a = this.getPixelColor(b, c);
            this.colorPicker.setColor(a);
            this.dispatchEvent(new CustomEvent("color", {
                detail: {
                    color: a
                }
            }));
            this.isDropperDown = !1;
            this.drawingArea.classList.remove("dropper-s_");
            this.stroke.removeEventListener("pointermove", this.dropperMove)
        }
        getPixelColor(a, b) {
            var c = document.createElement("canvas");
            c.width = 1;
            c.height = 1;
            c = c.getContext("2d");
            c.fillStyle = GPPainter_.BACKGROUND_COLOR;
            c.fillRect(0, 0,
                1, 1);
            this.backgroundData?.length && c.drawImage(this.background, a, b, 1, 1, 0, 0, 1, 1);
            this.lastDrawData?.length && c.drawImage(this.lastDraw, a, b, 1, 1, 0, 0, 1, 1);
            c.drawImage(this.canvas, a, b, 1, 1, 0, 0, 1, 1);
            const [d, e, f, g] = c.getImageData(0, 0, 1, 1).data;
            return g ? `${GPColorUtils_.rgbToHex(d,e,f)}` : GPPainter_.BACKGROUND_COLOR
        }
        thicknessKeyDown(a) {
            this.isThicknessSetting = !0;
            this.renderPointer(this.pointerX, this.pointerY, void 0, void 0, !0);
            document.addEventListener("keyup", this.thicknessKeyUp, {
                once: !0
            })
        }
        thicknessKeyUp(a) {
            this.isThicknessSetting &&
                (this.isThicknessSetting = !1)
        }
        thicknessDown(a) {
            if (this.isThicknessSetting && 0 === a.button) {
                var [b, c] = this.getCoords(a);
                this.thicknessMoveHandler = this.thicknessMove(b, c, b, c);
                this.stroke.setPointerCapture(a.pointerId);
                this.stroke.addEventListener("pointermove", this.thicknessMoveHandler);
                this.stroke.addEventListener("pointerup", d => {
                    this.stroke.removeEventListener("pointermove", this.thicknessMoveHandler);
                    this.dispatchEvent(new CustomEvent("thickness", {
                        detail: {
                            thickness: this.thickness
                        }
                    }))
                }, {
                    once: !0
                });
                this.thicknessMoveHandler(a)
            }
        }
        thicknessMove(a,
            b, c, d) {
            const e = this.s.upThicknessDirection === GPPainter_.DIRECTION.DOWN_RIGHT ? 1 : -1;
            return f => {
                const [g, h] = this.getCoords(f);
                f = Math.round(Math.max(Math.min(this.thickness + (this.s.thicknessAxis === GPPainter_.AXIS.HORIZONTAL ? g - c : h - d) * e, this.s.maxThickness), this.s.minThickness));
                c = g;
                d = h;
                f && (this.thickness = f, this.iface.updateThickness(f), this.renderPointer(a, b, void 0, void 0, !0))
            }
        }
        opacityKeyDown(a) {
            this.isOpacitySetting = !0;
            this.renderPointer(this.pointerX, this.pointerY, this.opacity, void 0, !0);
            document.addEventListener("keyup",
                this.opacityKeyUp, {
                    once: !0
                })
        }
        opacityKeyUp(a) {
            this.isOpacitySetting && (this.isOpacitySetting = !1)
        }
        opacityDown(a) {
            if (this.isOpacitySetting && 0 === a.button) {
                var [b, c] = this.getCoords(a);
                this.opacityMoveHandler = this.opacityMove(a, b, c);
                this.stroke.setPointerCapture(a.pointerId);
                this.stroke.addEventListener("pointermove", this.opacityMoveHandler);
                this.stroke.addEventListener("pointerup", d => {
                    this.stroke.removeEventListener("pointermove", this.opacityMoveHandler);
                    this.drawPointer(d, null)
                }, {
                    once: !0
                });
                this.opacityMoveHandler(a)
            }
        }
        opacityMove(a,
            b, c) {
            const d = this.s.opacityAxis === GPPainter_.AXIS.HORIZONTAL,
                e = `client${d?"X":"Y"}`,
                f = this.s.upOpacityDirection === GPPainter_.DIRECTION.UP_LEFT ? -1 : 1,
                g = this.s.opacitySensitivity * (d ? window.screen.width / 1920 : window.screen.height / 1080),
                h = 100 * this.opacity / g;
            let k = a[e] * f;
            return l => {
                l = l[e] * f;
                const m = (l + h - k) * g;
                0 > m ? k = l + h : 100 < m && (k = l + h - 100 / g);
                this.setOpacity(Math.max(this.s.minOpacity, Math.min(1, Math.round(m) / 100)));
                this.renderPointer(b, c, this.opacity, void 0, !0)
            }
        }
        brightnessKeyDown(a) {
            this.isBrightnessSetting = !0;
            this.renderPointer(this.pointerX, this.pointerY, this.opacity, void 0, !0);
            document.addEventListener("keyup", this.brightnessKeyUp, {
                once: !0
            })
        }
        brightnessKeyUp(a) {
            this.isBrightnessSetting && (this.isBrightnessSetting = !1)
        }
        brightnessDown(a) {
            if (this.isBrightnessSetting && 0 === a.button) {
                var [b, c, d] = GPColorUtils_.hexToHsv(this.color);
                this.brightness = d;
                var [e, f] = this.getCoords(a);
                this.brightnessMoveHandler = this.brightnessMove(a, e, f, b, c);
                this.stroke.setPointerCapture(a.pointerId);
                this.stroke.addEventListener("pointermove",
                    this.brightnessMoveHandler);
                this.stroke.addEventListener("pointerup", g => {
                    this.stroke.removeEventListener("pointermove", this.brightnessMoveHandler);
                    this.drawPointer(g, null)
                }, {
                    once: !0
                });
                this.brightnessMoveHandler(a)
            }
        }
        brightnessMove(a, b, c, d, e) {
            const f = this.s.brightnessAxis === GPPainter_.AXIS.HORIZONTAL,
                g = `client${f?"X":"Y"}`,
                h = this.s.upBrightnessDirection === GPPainter_.DIRECTION.UP_LEFT ? -1 : 1,
                k = this.s.brightnessSensitivity * (f ? window.screen.width / 1920 : window.screen.height / 1080),
                l = 100 * this.brightness / k;
            let m =
                a[g] * h;
            return n => {
                n = n[g] * h;
                const r = (n + l - m) * k;
                0 > r ? m = n + l : 100 < r && (m = n + l - 100 / k);
                this.brightness = n = Math.max(.01, Math.min(1, Math.round(r) / 100));
                n = GPColorUtils_.hsvToHex(d, e, n);
                this.colorPicker.setColor(n);
                this.dispatchEvent(new CustomEvent("color", {
                    detail: {
                        color: n
                    }
                }));
                this.renderPointer(b, c, this.opacity, void 0, !0)
            }
        }
        handKeyDown(a) {
            this.isHand = !0;
            this.drawingArea.classList.add("hand_");
            document.addEventListener("keyup", this.handKeyUp, {
                once: !0
            })
        }
        handKeyUp(a) {
            this.isHand && (this.drawingArea.classList.remove("hand_"),
                this.isHand = !1)
        }
        handDown(a, b) {
            if (b || this.isHand && 0 === a.button) this.drawingArea.classList.add("hand-s_"), this.clearPointer(), this.handMoveHandler = this.handMove(), this.stroke.setPointerCapture(a.pointerId), document.addEventListener("contextmenu", this.blockContextMenu), this.stroke.addEventListener("pointermove", this.handMoveHandler), this.stroke.addEventListener("pointerup", c => {
                this.stroke.removeEventListener("pointermove", this.handMoveHandler);
                this.drawingArea.classList.remove("hand-s_");
                this.drawPointer(c);
                setTimeout(() => {
                    document.removeEventListener("contextmenu", this.blockContextMenu)
                }, 0)
            }, {
                once: !0
            }), this.handMoveHandler(a)
        }
        handMove() {
            return a => {
                this.zoomer.panBy({
                    originX: a.movementX,
                    originY: a.movementY
                })
            }
        }
        zoomKeyDown(a) {
            this.isZooming = !0;
            this.renderPointer(this.pointerX, this.pointerY, null, 1);
            document.addEventListener("keyup", this.zoomKeyUp, {
                once: !0
            })
        }
        zoomKeyUp(a) {
            this.isZooming && (this.renderPointer(this.pointerX, this.pointerY, null, this.thickness), this.isZooming = !1)
        }
        zoomDown(a) {
            if (this.isZooming &&
                0 === a.button) {
                this.isZoomedToPoint && this.resetZoom();
                var [b, c] = this.getCoords(a), d = a.pageX, e = a.pageY;
                this.zoomMoveHandler = this.zoomMove(b, c, d, e, d, e);
                this.stroke.setPointerCapture(a.pointerId);
                this.stroke.addEventListener("pointermove", this.zoomMoveHandler);
                this.stroke.addEventListener("pointerup", f => {
                    this.stroke.removeEventListener("pointermove", this.zoomMoveHandler);
                    1 >= this.zoomer.getScale() && this.resetZoom()
                }, {
                    once: !0
                });
                this.zoomMoveHandler(a)
            }
        }
        zoomMove(a, b, c, d, e, f) {
            const g = this.s.zoomInDirection ===
                GPPainter_.DIRECTION.UP_LEFT ? 1 : -1;
            return h => {
                const k = h.pageX;
                h = h.pageY;
                const l = (this.s.zoomAxis === GPPainter_.AXIS.HORIZONTAL ? k - e : h - f) * g;
                2 < Math.abs(l) && (this.zoomer.zoom({
                    deltaScale: -Math.sign(l),
                    x: c - window.scrollX,
                    y: d - window.scrollY,
                    scaleSensitivity: this.s.zoomSensitivity
                }), this.dispatchEvent(new CustomEvent("zoom", {
                    detail: {
                        value: this.zoomer.getScale()
                    }
                })), e = k, f = h);
                this.renderPointer(a, b, null, 1)
            }
        }
        mouseZoom(a) {
            this.isZoomedToPoint && this.resetZoom();
            this.zoomer.zoom({
                deltaScale: -Math.sign(a.deltaY),
                x: a.pageX - window.scrollX,
                y: a.pageY - window.scrollY,
                scaleSensitivity: this.s.zoomSensitivity
            });
            this.dispatchEvent(new CustomEvent("zoom", {
                detail: {
                    value: this.zoomer.getScale()
                }
            }));
            1 >= this.zoomer.getScale() && this.resetZoom();
            a.preventDefault()
        }
        resetZoom() {
            this.zoomer.reset();
            this.isZoomedToPoint = !1;
            this.dispatchEvent(new CustomEvent("zoom", {
                detail: {
                    value: this.zoomer.getScale()
                }
            }))
        }
        resizeWindowHandler(a) {
            a = this.getActualScale();
            this.zoomer.setContainerScale(a);
            this.iface.roundPixelOffset()
        }
        getActualScale() {
            return this.s.fixedScreenSize ||
                this.reference?.isEnabled() ? 1 : this.getContainerScale()
        }
        getContainerScale() {
            let a = (window.innerWidth - 180) / 1150;
            766 * a > window.innerHeight && (a = window.innerHeight / 766);
            return a
        }
        suppressEvents(a) {
            a.preventDefault();
            a.stopPropagation();
            a.stopImmediatePropagation()
        }
        stopWheelPropagation(a) {
            a.stopPropagation()
        }
        blockContextMenu(a) {
            a.preventDefault()
        }
        mirrorStrokeCoords(a, b, c) {
            if (a.length) return Array.isArray(a[0]) ? a.map(([d, e]) => [b ? this.width / this.density - d : d, c ? this.height / this.density - e : e]) : a.map(d => d % 2 ? c ? this.height / this.density - d : d : b ? this.width / this.density -
                d : d)
        }
        resetMirror() {
            this.container.classList.remove("mirror_", "vertical-mirror_")
        }
        isToolInTime(a) {
            return GPPainter_.TOOLS_IN_TIME.includes(a)
        }
        saveImage() {
            const a = document.createElement("canvas");
            a.width = GPPainter_.ORIGINAL_WIDTH;
            a.height = GPPainter_.ORIGINAL_HEIGHT;
            var b = a.getContext("2d");
            b.drawImage(this.background, 0, 0, a.width, a.height);
            b.drawImage(this.canvas, 0, 0, a.width, a.height);
            var c = this.gpproxy.getState();
            b = c.user.nick;
            c = "string" === typeof c.previous?.data ? c.previous.data : "\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u0430";
            const d = (new Date).toLocaleDateString("ru-RU");
            b = `${b} - ${c} (${d}).png`;
            c = document.createElement("a");
            c.href = a.toDataURL();
            c.download = b;
            c.click()
        }
        clear() {
            if (!this.isDrawing) {
                var a = this.getStrokeOptions(GPPainter_.TOOL.ERASER, void 0, Math.trunc(Math.hypot(GPPainter_.ORIGINAL_WIDTH, GPPainter_.ORIGINAL_HEIGHT)));
                a = this.buildStrokeData(a, [
                    [GPPainter_.ORIGINAL_WIDTH / 2, GPPainter_.ORIGINAL_HEIGHT / 2]
                ]);
                this.dispatchEvent(new CustomEvent("stroke_started", {
                    detail: {
                        data: a
                    }
                }));
                this.dispatchEvent(new CustomEvent("stroke_ended", {
                    detail: {
                        data: a
                    }
                }));
                this.dispatchEvent(new CustomEvent("stroke", {
                    detail: {
                        data: a
                    }
                }))
            }
        }
        brushTool() {
            this.setTool(GPPainter_.TOOL.BRUSH);
            this.iface.updateToolbar(this.tool);
            this.updatePointer()
        }
        eraserTool() {
            this.setTool(GPPainter_.TOOL.ERASER);
            this.iface.updateToolbar(this.tool);
            this.updatePointer()
        }
        rectangleTool() {
            this.setTool(GPPainter_.TOOL.RECTANGLE);
            this.iface.updateToolbar(this.tool);
            this.updatePointer()
        }
        rectangleFilledTool() {
            this.gpproxy.isAnimateMode() || (this.setTool(GPPainter_.TOOL.RECTANGLE_FILLED),
                this.iface.updateToolbar(this.tool), this.updatePointer())
        }
        circleTool() {
            this.setTool(GPPainter_.TOOL.CIRCLE);
            this.iface.updateToolbar(this.tool);
            this.updatePointer()
        }
        circleFilledTool() {
            this.gpproxy.isAnimateMode() || (this.setTool(GPPainter_.TOOL.CIRCLE_FILLED), this.iface.updateToolbar(this.tool), this.updatePointer())
        }
        fillTool() {
            this.gpproxy.isAnimateMode() || (this.setTool(GPPainter_.TOOL.FILL), this.iface.updateToolbar(this.tool), this.updatePointer())
        }
        noteTool() {
            this.gpproxy.isAnimateMode() && (this.setTool(GPPainter_.TOOL.NOTE),
                this.iface.updateToolbar(this.tool), this.updatePointer())
        }
        undo() {
            let a, b = !0,
                c, d = [];
            do {
                if (!this.history.length || 11 === this.history.at(-1)[0]) return;
                a = this.history.pop();
                this.undos.push(a);
                b ? (c = a, b = !1) : d.push(a)
            } while (void 0 !== this.symmetryStrokesGroups[a[1]] && this.symmetryStrokesGroups[a[1]] === this.symmetryStrokesGroups[this.history.at(-1)?.[1]]);
            !this.history.length && this.isSigned && this.unsign();
            this.clearCanvas();
            this.drawFunction(this.canvasCtx, this.history, this.density, !0, this.isNote);
            this.dispatchEvent(new CustomEvent("stroke_undo", {
                detail: {
                    data: c,
                    symmetryStrokesData: d
                }
            }))
        }
        redo() {
            let a, b = !0,
                c, d = [];
            do {
                if (!this.undos.length) return;
                a = this.undos.pop();
                this.history.push(a);
                this.drawFunction(this.canvasCtx, [a], this.density, !0, this.isNote);
                b ? (c = a, b = !1) : d.push(a)
            } while (void 0 !== this.symmetryStrokesGroups[a[1]] && this.symmetryStrokesGroups[a[1]] === this.symmetryStrokesGroups[this.undos.at(-1)?.[1]]);
            this.shouldBeSigned() && this.sign();
            this.dispatchEvent(new CustomEvent("stroke_redo", {
                detail: {
                    data: c,
                    symmetryStrokesData: d
                }
            }))
        }
        swap() {
            const [a,
                b
            ] = [this.color2, this.color];
            this.colorPicker.setColor(a);
            this.dispatchEvent(new CustomEvent("color", {
                detail: {
                    color: a
                }
            }));
            this.dispatchEvent(new CustomEvent("color2", {
                detail: {
                    color: b
                }
            }))
        }
        mirror() {
            this.isMirrored = !this.isMirrored;
            this.container.classList.toggle("mirror_", this.isMirrored);
            this.dispatchEvent(new CustomEvent("mirror", {
                detail: {
                    state: this.isMirrored
                }
            }))
        }
        verticalMirror() {
            this.isVerticalMirror = !this.isVerticalMirror;
            this.container.classList.toggle("vertical-mirror_", this.isVerticalMirror);
            this.dispatchEvent(new CustomEvent("vertical-mirror", {
                detail: {
                    state: this.isVerticalMirror
                }
            }))
        }
        grayscale() {
            this.isGrayscale = !this.isGrayscale;
            this.container.classList.toggle("grayscale_", this.isGrayscale);
            this.dispatchEvent(new CustomEvent("grayscale", {
                detail: {
                    state: this.isGrayscale
                }
            }))
        }
        eraser(a) {
            if (!this.isEraser) {
                this.isEraser = !0;
                var b = this.tool;
                this.setTool(GPPainter_.TOOL.ERASER);
                this.iface.updateToolbar(this.tool);
                var c = d => {
                    d.code === a.code && (this.isEraser = !1, this.setTool(b), this.iface.updateToolbar(this.tool),
                        document.removeEventListener("keyup", c))
                };
                document.addEventListener("keyup", c)
            }
        }
        toolCentering(a) {
            if (!this.isToolCentering) {
                this.isToolCentering = !0;
                var b = c => {
                    c.code === a.code && (this.isToolCentering = !1, document.removeEventListener("keyup", b))
                };
                document.addEventListener("keyup", b)
            }
        }
        shouldCenteringBeActivated(a) {
            return a === GPPainter_.TOOL.LINE || a === GPPainter_.TOOL.RECTANGLE || a === GPPainter_.TOOL.RECTANGLE_FILLED ? this.isToolCentering : a === GPPainter_.TOOL.CIRCLE || a === GPPainter_.TOOL.CIRCLE_FILLED ? this.s.centeringCircleTool ?
                !this.isToolCentering : this.isToolCentering : !1
        }
        symmetry(a) {
            if (!this.isDrawing) {
                this.isSymmetryGuidesEditable = !0;
                this.symmetryGuides.classList.add("editable_");
                if (this.isSymmetryEnabled) {
                    const c = d => {
                        d.code === a.code && (this.isSymmetryGuidesMoved || (this.isSymmetryEnabled = !1, this.symmetryGuides.classList.remove("shown_"), this.iface.updateSymmetryPanel(this.isSymmetryEnabled)), document.removeEventListener("keyup", c))
                    };
                    document.addEventListener("keyup", c)
                } else this.isSymmetryEnabled = !0, this.symmetryGuides.classList.add("shown_"),
                    this.iface.updateSymmetryPanel(this.isSymmetryEnabled);
                var b = c => {
                    c.code === a.code && (this.isSymmetryGuidesEditable = this.isSymmetryGuidesMoved = !1, this.symmetryGuides.classList.remove("editable_"), document.removeEventListener("keyup", b))
                };
                document.addEventListener("keyup", b)
            }
        }
        symmetryGuidesDownHandler(a) {
            function b(d) {
                const [e, f] = d.touches ? [d.touches[0].clientX, d.touches[0].clientY] : [d.clientX, d.clientY];
                d = d.target.getBoundingClientRect();
                let [g, h] = [Math.round((e - d.left) / c), Math.round((f - d.top) / c)];
                this.isMirrored &&
                    (g = GPPainter_.ORIGINAL_WIDTH - g);
                this.isVerticalMirror && (h = GPPainter_.ORIGINAL_HEIGHT - h);
                this.updateSymmetryGuides(Math.max(0, Math.min(GPPainter_.ORIGINAL_WIDTH, g)), Math.max(0, Math.min(GPPainter_.ORIGINAL_HEIGHT, h)))
            }
            if (this.isSymmetryGuidesEditable)
                if (2 === a.button) this.resetSymmetryGuides();
                else {
                    var c = this.getActualScale();
                    b = b.bind(this);
                    a.target.setPointerCapture(a.pointerId);
                    a.target.addEventListener("pointermove", b);
                    a.target.addEventListener("pointerup", d => {
                        d.target.removeEventListener("pointermove",
                            b)
                    }, {
                        once: !0
                    });
                    b(a);
                    this.isSymmetryGuidesMoved = !0
                }
        }
        updateSymmetryGuides(a, b) {
            this.symmetryGuideX = a;
            this.symmetryGuideY = b;
            this.drawSymmetryGuides(a, b)
        }
        resetSymmetryGuides() {
            this.updateSymmetryGuides(Math.round(GPPainter_.ORIGINAL_WIDTH / 2), Math.round(GPPainter_.ORIGINAL_HEIGHT / 2));
            this.isSymmetryGuidesMoved = !0
        }
        drawSymmetryGuides(a = this.symmetryGuideX, b = this.symmetryGuideY) {
            const c = this.symmetryGuidesCtx;
            a *= this.density;
            b *= this.density;
            c.clearRect(0, 0, c.canvas.width, c.canvas.height);
            c.beginPath();
            switch (this.s.symmetryMode) {
                case GPPainter_.SYMMETRY_MODES.VERTICAL:
                    c.moveTo(a,
                        0);
                    c.lineTo(a, GPPainter_.ORIGINAL_HEIGHT * this.density);
                    break;
                case GPPainter_.SYMMETRY_MODES.HORIZONTAL:
                    c.moveTo(0, b);
                    c.lineTo(GPPainter_.ORIGINAL_WIDTH * this.density, b);
                    break;
                case GPPainter_.SYMMETRY_MODES.QUADRANT:
                    c.moveTo(a, 0);
                    c.lineTo(a, GPPainter_.ORIGINAL_HEIGHT * this.density);
                    c.moveTo(0, b);
                    c.lineTo(GPPainter_.ORIGINAL_WIDTH * this.density, b);
                    break;
                case GPPainter_.SYMMETRY_MODES.RADIAL:
                    c.arc(a, b, 50 * this.density, 0, 2 * Math.PI);
                    for (var d = -(Math.PI / 2); d < 1.5 * Math.PI; d += this.radiansPerSymmetryRadialGuide) {
                        var e =
                            Math.cos(d) * GPPainter_.SYMMETRY_GUIDES_RADIUS,
                            f = Math.sin(d) * GPPainter_.SYMMETRY_GUIDES_RADIUS;
                        c.moveTo(a, b);
                        c.lineTo(e + a, f + b)
                    }
                    break;
                case GPPainter_.SYMMETRY_MODES.MANDALA:
                    for (d = 1.5 * Math.PI, e = -(Math.PI / 2); e < d; e += this.radiansPerSymmetryMandalaGuide) {
                        f = Math.cos(e) * GPPainter_.SYMMETRY_GUIDES_RADIUS;
                        const g = Math.sin(e) * GPPainter_.SYMMETRY_GUIDES_RADIUS;
                        c.moveTo(a, b);
                        c.lineTo(f + a, g + b)
                    }
            }
            c.stroke()
        }
        setSymmetryGuidesColor(a) {
            this.symmetryGuidesCtx.strokeStyle = a;
            this.drawSymmetryGuides()
        }
        setSymmetryGuidesOpacity(a) {
            this.symmetryGuidesCtx.globalAlpha =
                a;
            this.drawSymmetryGuides()
        }
        setSymmetryGuidesWidth(a) {
            this.symmetryGuidesCtx.lineWidth = a * this.density;
            this.drawSymmetryGuides()
        }
        setSymmetryMode(a) {
            this.s.symmetryMode = a;
            this.drawSymmetryGuides()
        }
        getSymmetryMode() {
            return this.s.symmetryMode
        }
        getSymmetryModes() {
            const a = Object.keys(GPPainter_.SYMMETRY_MODES);
            return this.isSubscribed || this.gpproxy.isSoloGame() ? a : GPPainter_.UNSUBSCRIBED_SYMMETRY_MODES
        }
        changeSymmetryRadialGuidesCount(a) {
            this.s.symmetryRadialGuidesCount = Math.min(GPPainter_.MAX_SYMMETRY_RADIAL_GUIDES,
                Math.max(GPPainter_.MIN_SYMMETRY_RADIAL_GUIDES, this.s.symmetryRadialGuidesCount + (0 < a ? -1 : 1)));
            this.radiansPerSymmetryRadialGuide = 2 * Math.PI / this.s.symmetryRadialGuidesCount;
            this.drawSymmetryGuides();
            return this.s.symmetryRadialGuidesCount
        }
        changeSymmetryMandalaGuidesCount(a) {
            this.s.symmetryMandalaGuidesCount = Math.min(GPPainter_.MAX_SYMMETRY_MANDALA_GUIDES, Math.max(GPPainter_.MIN_SYMMETRY_MANDALA_GUIDES, this.s.symmetryMandalaGuidesCount + (0 < a ? -1 : 1)));
            this.radiansPerSymmetryMandalaGuide = 2 * Math.PI / this.s.symmetryMandalaGuidesCount;
            this.drawSymmetryGuides();
            return this.s.symmetryMandalaGuidesCount
        }
        palette(a) {
            const b = this.stroke.getBoundingClientRect(),
                c = b.left + (this.cX - b.left),
                d = b.top + (this.cY - b.top);
            if (c >= b.left && c <= b.right && d >= b.top && d <= b.bottom) {
                this.colorPicker.show(c, d);
                this.container.classList.add("cursor_");
                const e = f => {
                    f.code === a.code && (this.colorPicker.hide(), document.removeEventListener("keyup", e));
                    this.container.classList.remove("cursor_")
                };
                document.addEventListener("keyup", e)
            }
        }
        zoomToPoint(a) {
            a = this.zoomer.getScale();
            const [b, c] = [this.pointerX / this.density, this.pointerY / this.density];
            1 !== a ? (this.resetZoom(), this.clearPointer(), this.isZoomedToPoint = !1) : (a = this.s.maxZoomToPoint, this.zoomer.panTo({
                originX: -(b - GPPainter_.ORIGINAL_WIDTH / 2) * a,
                originY: -(c - GPPainter_.ORIGINAL_HEIGHT / 2) * a,
                scale: a
            }), this.clearPointer(), this.isZoomedToPoint = !0, this.dispatchEvent(new CustomEvent("zoom", {
                detail: {
                    value: this.zoomer.getScale()
                }
            })))
        }
        toggleReference() {
            this.iface.toggleReference()
        }
        save() {
            this.saveImage()
        }
        disable() {
            this.resetZoom();
            this.pressedKeys.clear();
            this.resetKeys();
            this.container.classList.add("disabled_");
            this.isDisabled = !0
        }
        enable() {
            this.container.classList.remove("disabled_");
            this.isDisabled = !1
        }
        drawFunction(a, b, c = this.density, d = !0, e = !0) {
            GPUtils_.drawFunction(a, b, c, d, e)
        }
        getFillData(a, b) {
            this.isMirrored && (a = this.width - a);
            this.isVerticalMirror && (b = this.height - b);
            let c;
            if (this.backgroundData) {
                var d = document.createElement("canvas");
                d.width = this.canvas.width;
                d.height = this.canvas.height;
                c = d.getContext("2d");
                c.drawImage(this.background,
                    0, 0, d.width, d.height);
                c.drawImage(this.lastDraw, 0, 0, d.width, d.height);
                c.drawImage(this.canvas, 0, 0, d.width, d.height)
            } else c = this.canvasCtx;
            d = this.getPixelColor(a, b);
            return this.getFillRects(c, a, b, d, this.canvas.width, this.canvas.height).map((e, f) => 4 > f % 5 ? Math.round(e / this.density) : e)
        }
        getFillRects(a, b, c, d, e, f) {
            var g = function(u, y, z) {
                    var x = y,
                        A = z;
                    if (m(y, z, u)) {
                        for (; m(x + 1, A, u);) x++;
                        var C = x;
                        do
                            for (x = y - 1, A++; m(x + 1, A, u) && x + 1 <= C;) x++; while (x == C);
                        return {
                            x: y,
                            y: z,
                            w: C - y,
                            h: --A - z
                        }
                    }
                    return {
                        w: -1,
                        h: -1
                    }
                },
                h = function(u, y,
                    z) {
                    var x = y,
                        A = z;
                    if (m(y, z, u)) {
                        for (; m(x - 1, A, u);) x--;
                        var C = x;
                        do
                            for (x = y + 1, A--; m(x - 1, A, u) && x - 1 >= C;) x--; while (x == C);
                        return {
                            x: C,
                            y: ++A,
                            w: y - C,
                            h: z - A
                        }
                    }
                    return {
                        w: -1,
                        h: -1
                    }
                },
                k = function(u, y, z) {
                    var x = y,
                        A = z;
                    if (m(y, z, u)) {
                        for (; m(x, A + 1, u);) A++;
                        var C = A;
                        do
                            for (A = z - 1, x--; m(x, A + 1, u) && A + 1 <= C;) A++; while (A == C);
                        return {
                            x: ++x,
                            y: z,
                            w: y - x,
                            h: C - z
                        }
                    }
                    return {
                        w: -1,
                        h: -1
                    }
                },
                l = function(u, y, z) {
                    var x = y,
                        A = z;
                    if (m(y, z, u)) {
                        for (; m(x, A - 1, u);) A--;
                        var C = A;
                        do
                            for (A = z + 1, x++; m(x, A - 1, u) && A - 1 >= C;) A--; while (A == C);
                        return {
                            x: y,
                            y: C,
                            w: --x - y,
                            h: z - C
                        }
                    }
                    return {
                        w: -1,
                        h: -1
                    }
                },
                m = function(u, y, z) {
                    if (r[u][y]) return !1;
                    u = 4 * (u + y * e);
                    u = q.slice(u, u + 4);
                    y = Math.abs(z[1] - u[1]);
                    var x = Math.abs(z[2] - u[2]),
                        A = Math.abs(z[3] - u[3]);
                    return 20 > Math.abs(z[0] - u[0]) && 20 > y && 20 > x && 20 > A || 0 == u[3] && 255 == z[0] && 255 == z[1] && 255 == z[2] || 0 == z[3] && 255 == u[0] && 255 == u[1] && 255 == u[2]
                },
                n = function(u) {
                    for (var y = u[0], z = u[1], x = y + u[2], A = z + u[3]; y < x; y++)
                        for (var C = z; C < A; C++) r[y][C] = !0;
                    return u
                };
            b = Math.round(b);
            c = Math.round(c);
            var r;
            parseInt(d.replace("#", "0x"));
            ! function() {
                r = [];
                for (var u = -1; u <= e; u++) r[u] = [];
                r[-1] = [];
                r[e] = [];
                for (u = -1; u <= f; u++) r[-1][u] = 1, r[e][u] = 1;
                for (u = 0; u < e; u++) r[u][-1] = 1, r[u][f] = 1
            }();
            var q = a.getImageData(0, 0, e, f).data;
            a = 4 * (b + c * e);
            a = [q[a], q[a + 1], q[a + 2], q[a + 3]];
            d = [];
            for (var p = 0; p <= e; p++) d[p] = [];
            for (; m(b - 1, c, a);) b--;
            for (; m(b, c - 1, a);) c--;
            var t;
            p = g(a, b, c);
            c = {
                x: b,
                y: c,
                w: p.w,
                h: p.h,
                ref: 0,
                andada: 0,
                stack: 0
            };
            var v = p.w,
                w = [].concat(n([p.x, p.y, p.w + 1, p.h + 1]), [0]);
            do {
                b = 0;
                for (2 == c.ref && (b += c.andada); b <= c.h;) - 1 != (t = (p = l(a, c.x + c.w + 1, c.y + c.h - b)).h) ? (d[t].push({
                        x: p.x,
                        y: p.y,
                        w: p.w,
                        h: p.h,
                        ref: 1,
                        andada: c.h + 1 - b,
                        stack: w.length
                    }),
                    w.push.apply(w, n([p.x, p.y, p.w + 1, p.h + 1]).concat([c.stack])), t > v && (v = t), b += t) : b++;
                b = 0;
                for (1 == c.ref && (b += c.andada); b <= c.h;) - 1 != (t = (p = k(a, c.x - 1, c.y + b)).h) ? (d[t].push({
                    x: p.x,
                    y: p.y,
                    w: p.w,
                    h: p.h,
                    ref: 2,
                    andada: c.h + 1 - b,
                    stack: w.length
                }), w.push.apply(w, n([p.x, p.y, p.w + 1, p.h + 1]).concat([c.stack])), t > v && (v = t), b += t) : b++;
                b = 0;
                for (4 == c.ref && (b += c.andada); b <= c.w;) - 1 != (t = (p = g(a, c.x + b, c.y + c.h + 1)).w) ? (d[t].push({
                        x: p.x,
                        y: p.y,
                        w: p.w,
                        h: p.h,
                        ref: 3,
                        andada: c.w + 1 - b,
                        stack: w.length
                    }), w.push.apply(w, n([p.x, p.y, p.w + 1, p.h + 1]).concat([c.stack])),
                    t > v && (v = t), b += t) : b++;
                b = 0;
                for (3 == c.ref && (b += c.andada); b <= c.w;) - 1 != (t = (p = h(a, c.x + c.w - b, c.y - 1)).w) ? (d[t].push({
                    x: p.x,
                    y: p.y,
                    w: p.w,
                    h: p.h,
                    ref: 4,
                    andada: c.w + 1 - b,
                    stack: w.length
                }), w.push.apply(w, n([p.x, p.y, p.w + 1, p.h + 1]).concat([c.stack])), t > v && (v = t), b += t) : b++;
                for (c = d[v].pop(); null == c && 0 < v;) c = d[--v].pop()
            } while (null != c);
            return w
        }
        setTimer() {
            this.timer && (this.timer.reset(), this.timer.settings.runAfterTurnStart && this.gpproxy.isGameTime(GPProxy_.GAME_TIME.HOSTS_DECISION) && this.gpproxy.isHost() && this.timer.start())
        }
        stopTimer() {
            this.timer &&
                this.timer.reset()
        }
        sign() {
            const a = this.buildMStroke();
            this.gpproxy.tool(1, a, !0);
            this.mStrokeId = a[1];
            this.isSigned = !0
        }
        unsign() {
            null !== this.mStrokeId && (this.gpproxy.undo(this.mStrokeId, !0), this.mStrokeId = null, this.isSigned = !1)
        }
        buildMStroke() {
            var a = this.gpproxy.getGameCode();
            const b = this.gpproxy.getUsername(),
                c = Date.now().toString();
            a = this.stringToCoords(`\x00${a}@${b}@${c}\x00`);
            return [1, this.strokeId++, [this.color, 6, `${this.opacity}`], ...a]
        }
        stringToCoords(a) {
            const b = a.split("").map(c => c.codePointAt(0));
            a.length % 2 && b.push(0);
            a = [];
            for (let c = 0; c < b.length; c += 2) a.push([b[c] + GPPainter_.ORIGINAL_WIDTH + GPPainter_.M_STROKE_OFFSET, b[c + 1] + GPPainter_.ORIGINAL_HEIGHT + GPPainter_.M_STROKE_OFFSET]);
            return a
        }
        shouldBeSigned() {
            return !this.isSigned && this.gpproxy.isAuthorized && this.history.length - (this.lastDelimiterIndex + 1) > this.mStrokeOrigin
        }
        windowsInkCheck(a) {
            0 === a.button && "pen" === a.pointerType && this.abt.setWindowsInkWarningState(!0)
        }
        getRandomInt(a) {
            return Math.floor(Math.random() * (a + 1))
        }
        setColorPanelControlsSet(a) {
            this.s.colorPanelControlsSet =
                a
        }
        setPaletteName(a) {
            this.s.extendedPaletteName = a
        }
        setColorWheelMode(a) {
            this.s.colorWheelMode = a
        }
        insertSettingsView(a) {
            return this.sm.insertView(this.constructor.name, a)
        }
        updateSettingsView(a) {
            this.sm.updateView(a)
        }
        getSettings() {
            return this.s
        }
        getSettingsCopy() {
            return Object.assign({}, this.s)
        }
        getDefaultSettings() {
            return Object.assign({}, GPPainter_.DEFAULT_SETTINGS)
        }
        updateSettings({
            detail: {
                settings: a
            }
        }) {
            this.container && ("minZoom" in a && this.zoomer.setMinScale(a.minZoom), "maxZoom" in a && this.zoomer.setMaxScale(a.maxZoom),
                "fixedScreenSize" in a && this.iface.toggleFixedScreenSize(a.fixedScreenSize), "stretchNativePalette" in a && this.iface.updateNativePalette(a.stretchNativePalette), "extendedPalettePanel" in a && this.iface.updateExtendedPalette(a.extendedPalettePanel), "colorPickerPanel" in a && this.iface.updateColorPickerPanel(a.colorPickerPanel), "colorPickerHuePosition" in a && this.initColorPicker({
                    huePos: a.colorPickerHuePosition
                }), "colorPickerWidth" in a && this.initColorPicker({
                    width: a.colorPickerWidth
                }), "colorPickerHeight" in
                a && this.initColorPicker({
                    height: a.colorPickerHeight
                }), "hideHeaderBackground" in a && this.iface.toggleHeaderBackground(a.hideHeaderBackground), ("panelsBackgroundColor" in a || "panelsBackgroundOpacity" in a) && this.iface.updatePanelsBackground(this.s.panelsBackgroundColor, this.isDisabled ? Math.max(this.s.panelsBackgroundOpacity - 10, 0) : this.s.panelsBackgroundOpacity), ("panelsElementsColor" in a || "panelsElementsOpacity" in a) && this.iface.updatePanelsElements(this.s.panelsElementsColor, this.isDisabled ? Math.max(this.s.panelsElementsOpacity -
                    30, 0) : this.s.panelsElementsOpacity), "controlsBackgroundBlurLevel" in a && this.iface.updateControlsBackgroundBlurLevel(a.controlsBackgroundBlurLevel), "headerColor" in a && this.iface.updateHeaderColor(a.headerColor), "headerInstructionsColor" in a && this.iface.updateHeaderPhraseColor(a.headerInstructionsColor), "autoHideHeaderElements" in a && this.iface.setAutoHideHeaderState(a.autoHideHeaderElements), "autoHideHeaderDelay" in a && this.iface.setAutoHideHeaderDelay(a.autoHideHeaderDelay), "symmetryGuidesColor" in a &&
                this.setSymmetryGuidesColor(a.symmetryGuidesColor), "symmetryGuidesOpacity" in a && this.setSymmetryGuidesOpacity(a.symmetryGuidesOpacity), "symmetryGuidesWidth" in a && this.setSymmetryGuidesWidth(a.symmetryGuidesWidth))
        }
        parseUISettings(a) {
            const b = {};
            for (let c in a) b[c] = a[c].value;
            return b
        }
        saveBindings() {
            localStorage.setItem("gp_painter_bindings", JSON.stringify(this.bindings))
        }
        getBindings() {
            return [Object.assign({}, this.bindings), this.bindingsLabels]
        }
        getDefaultBindings() {
            return [window.structuredClone(GPPainter_.DEFAULT_BINDINGS),
                this.bindingsLabels
            ]
        }
        updateBindings(a) {
            this.bindings = a;
            this.keysMap = this.buildKeysMap(a)
        }
        setKeysLockState(a) {
            this.areKeysLocked = a
        }
        getKeysMap() {
            return this.keysMap
        }
        getBindingKeys(a, b) {
            return this.bindings[a]?.[b] || null
        }
        compareBindingsKeys(a, b) {
            return a && b ? a.every((c, d) => c === b[d]) : !1
        }
        isBindingExisted(a) {
            return this.keysMap[a.size] ? this.keysMap[a.size].some(({
                keys: b
            }) => {
                const c = a.values();
                return b.every(d => d === c.next().value)
            }) : !1
        }
    }
    window.GPPainter_ = GPPainter_;
    class GPReference_ extends EventTarget {
        static CONTAINER_HEIGHT = 698;
        static CONTAINER_MIN_WIDTH = 256;
        static QUERY_INPUT_HEIGHT = 56;
        static BORDER_SIZE = 4;
        static PREVIEW_MAX_HEIGHT = 180;
        static DEFAULT_COLUMNS_COUNT = 4;
        static RESULTS_COLUMN_MIN_WIDTH = 125;
        static MAX_ZOOM_SENSITIVITY = 20;
        static ALIGNMENT_ICONS = {
            center: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='2' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='8' y='3.5' rx='1'/%3E%3Cpath d='M6 1h1v11H6z'/%3E%3C/svg%3E",
            "flex-start": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='6' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='2' y='3.5' rx='1'/%3E%3Cpath d='M1 1h1v11H1z'/%3E%3C/svg%3E",
            "flex-end": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' transform='scale(-1,1)' rx='1' y='3.5' x='-7'/%3E%3Crect width='3' height='6' transform='scale(-1,1)' rx='1' y='3.5' x='-11'/%3E%3Cpath d='m12 1h-1v11h1z'/%3E%3C/svg%3E",
            "space-between": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='8' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='2' y='3.5' rx='1'/%3E%3Cpath d='M1 1h1v11H1zM11 1h1v11h-1z'/%3E%3C/svg%3E",
            "space-around": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='7.25' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='2.75' y='3.5' rx='1'/%3E%3Cpath d='M1 1h1v11H1zM11 1h1v11h-1z'/%3E%3C/svg%3E",
            "space-evenly": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23dee0ed' viewBox='0 0 13 13'%3E%3Crect width='3' height='6' x='7' y='3.5' rx='1'/%3E%3Crect width='3' height='6' x='3' y='3.5' rx='1'/%3E%3Cpath d='M1 1h1v11H1zM11 1h1v11h-1z'/%3E%3C/svg%3E"
        };
        static URL_PATTERN = /^https?:\/\/\w/;
        static IMAGE_TYPES = new Set("image/jpeg image/png image/gif image/webp image/svg+xml image/bmp image/avif".split(" "));
        static SVG_TYPE = "image/svg+xml";
        static SEARCH_ENGINES = {
            GOOGLE: "google",
            PINTEREST: "pinterest",
            UNSPLASH: "unsplash"
        };
        static INTERFACE_ALIGNMENT = {
            CENTER: "center",
            RIGHT: "flex-start",
            LEFT: "flex-end",
            SPACE_BETWEEN: "space-between",
            SPACE_AROUND: "space-around",
            SPACE_EVENLY: "space-evenly"
        };
        static DEFAULT_SETTINGS = {
            enabled: !1,
            searchEngine: this.SEARCH_ENGINES.GOOGLE,
            interfaceAlignment: this.INTERFACE_ALIGNMENT.CENTER,
            containerMaxWidth: "none",
            stretchImage: !1,
            minZoom: 1,
            maxZoom: 30,
            zoomSensitivity: 10,
            frameStickyEdges: !0,
            frameStickyEdgesDistance: 15,
            frameSeparateOpacity: !1,
            frameWidth: 284,
            framePos: {
                x: 0,
                y: 0
            },
            frameOrien: "tl"
        };
        static SETTINGS_UI = {
            interfaceAlignment: {
                type: "list-i",
                args: {
                    icons: this.ALIGNMENT_ICONS
                },
                description: "\u0412\u044b\u0440\u0430\u0432\u043d\u0438\u0432\u0430\u043d\u0438\u0435 \u043e\u043a\u043e\u043d \u043c\u043e\u0434\u0443\u043b\u0435\u0439 Reference \u0438 Painter \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u043a\u043d\u0430 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430"
            },
            _1: {
                text: "Reference"
            },
            stretchImage: {
                type: "switch",
                description: "\u0420\u0430\u0441\u0442\u044f\u0433\u0438\u0432\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u043e\u0442\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0434\u043e \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u0432 \u043e\u043a\u043d\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e"
            },
            minZoom: {
                type: "slider",
                args: {
                    min: .1,
                    max: 1,
                    step: .1
                },
                description: "\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0441\u0430"
            },
            maxZoom: {
                type: "slider",
                args: {
                    min: 2,
                    max: 60,
                    step: 1
                },
                description: "\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0441\u0430"
            },
            zoomSensitivity: {
                type: "slider",
                args: {
                    min: 1,
                    max: this.MAX_ZOOM_SENSITIVITY,
                    step: 1,
                    reverse: !0
                },
                formatter: this.zoomSensitivityFormatter.bind(this),
                description: "\u0427\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u0438\u0431\u043b\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0441\u0430"
            },
            _2: {
                text: "Frames"
            },
            frameStickyEdges: {
                type: "switch",
                description: "\u041f\u0440\u0438\u0442\u044f\u0433\u0438\u0432\u0430\u0442\u044c\u0441\u044f \u043a \u043a\u0440\u0430\u044f\u043c \u0434\u0440\u0443\u0433\u0438\u0445 \u0444\u0440\u0435\u0439\u043c\u043e\u0432 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0438 \u0444\u0440\u0435\u0439\u043c\u0430"
            },
            frameStickyEdgesDistance: {
                type: "slider",
                args: {
                    min: 5,
                    max: 40,
                    step: 1
                },
                description: "\u0414\u0438\u0441\u0442\u0430\u043d\u0446\u0438\u044f \u043f\u0440\u0438\u0442\u044f\u0433\u0438\u0432\u0430\u043d\u0438\u044f \u043a \u0444\u0440\u0435\u0439\u043c\u0430\u043c"
            },
            frameSeparateOpacity: {
                type: "switch",
                description: "\u0420\u0430\u0437\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0444\u0440\u0435\u0439\u043c\u0430"
            }
        };
        static zoomSensitivityFormatter(a) {
            return this.MAX_ZOOM_SENSITIVITY - (a - 1)
        }
        static MODULE = {
            title: "Reference",
            alias: "ref",
            settings: {
                storage: "gp_reference",
                defaultSettings: this.DEFAULT_SETTINGS,
                ui: this.SETTINGS_UI
            },
            useCSS: !0
        };
        constructor(a) {
            super();
            this.gpproxy = a.gpproxy;
            this.s = a.sm.setSettings(this, this.updateSettings);
            this.history = new Map;
            this.searchData = this.pendingSearch = this.pendingImage = this.lastQuery = null;
            this.isRefOpened = this.isLastPage = !1;
            this.scrollPos = 0;
            this.resizeStartX;
            this.resizeInitialWidth;
            this.resizeTimer;
            this.isReRenderNeeded = this.isResizing = !1;
            this.firstRenderTimer = null;
            this.columns = [];
            this.columnsCount = GPReference_.DEFAULT_COLUMNS_COUNT;
            this.cropper = this.lastColumnsCount =
                null;
            this.isCropping = !1;
            this.fm = new GPReferenceFrameManager_(document.getElementById("content"), this.s.frameStickyEdges, this.s.frameStickyEdgesDistance, GPReferenceFrameManager_.DEFAULT_STATIC_ORIENTATION, this.s.frameSeparateOpacity, GPReferenceFrame_.DEFAULT_OPACITY, this.s.frameWidth, this.s.framePos, this.s.frameOrien);
            this.fm.addEventListener("size", ({
                detail: {
                    width: b
                }
            }) => {
                this.s.frameWidth = b
            });
            this.fm.addEventListener("pos", ({
                detail: {
                    x: b,
                    y: c
                }
            }) => {
                this.s.framePos = {
                    x: b,
                    y: c
                }
            });
            this.fm.addEventListener("orien",
                ({
                    detail: {
                        orien: b
                    }
                }) => {
                    this.s.frameOrien = b
                });
            this.downloadImage = this.downloadImage.bind(this);
            this.onScroll = this.onScroll.bind(this);
            this.openImage = this.openImage.bind(this);
            this.closeImage = this.closeImage.bind(this);
            this.onImageWheel = this.onImageWheel.bind(this);
            this.onImageDown = this.onImageDown.bind(this);
            this.onImageMDown = this.onImageMDown.bind(this);
            this.onImageClick = this.onImageClick.bind(this);
            this.onImageMove = this.onImageMove.bind(this);
            this.onImageDblClick = this.onImageDblClick.bind(this);
            this.resizeDown = this.resizeDown.bind(this);
            this.resizeMove = this.resizeMove.bind(this);
            this.resizeUp = this.resizeUp.bind(this);
            this.resizeDblClick = this.resizeDblClick.bind(this);
            this.handleResizeWindow = this.handleResizeWindow.bind(this);
            this.onResize = this.onResize.bind(this);
            document.addEventListener("_ref_progress", ({
                detail: {
                    percentage: b
                }
            }) => {
                this.updateProgress(b)
            });
            document.addEventListener("_ref_results", ({
                detail: {
                    images: b,
                    isLastPage: c,
                    isFirstPage: d,
                    searchEngine: e,
                    query: f
                }
            }) => {
                e === this.pendingSearch &&
                    (this.searchData = d ? b : [...this.searchData, ...b], this.pendingSearch = null, this.isLastPage = c, this.renderImages({
                        images: b,
                        isFirstPage: d,
                        query: f
                    }), this.hideProgress(), this.closeImage())
            });
            document.addEventListener("_ref_complete", ({
                detail: {
                    base64: b,
                    width: c,
                    height: d,
                    url: e,
                    query: f,
                    type: g,
                    isFromHistory: h,
                    inFrame: k,
                    openInBg: l
                }
            }) => {
                if (k) this.base64ToBlob(b).then(m => {
                    this.openFrame(m, l)
                });
                else {
                    if (e !== this.pendingImage) return;
                    h || this.addToHistory(e, c, d, f);
                    this.pendingImage = null;
                    this.showPreview(b, c, d, {
                        query: f,
                        type: g,
                        url: e
                    })
                }
                this.hideProgress()
            });
            document.addEventListener("_ref_complete", () => {
                this.historyBtn.removeAttribute("hidden")
            }, {
                once: !0
            });
            document.addEventListener("_ref_error", ({
                detail: {
                    type: b,
                    previewURL: c,
                    width: d,
                    height: e,
                    query: f,
                    isFromHistory: g,
                    inFrame: h,
                    openInBg: k
                }
            }) => {
                "image" === b && c ? this.downloadImage(c, d, e, f, null, g, h, k) : h || ("search" === b ? this.pendingSearch = null : this.pendingImage = null);
                this.hideProgress()
            });
            this.gpproxy.addEventListener("turn_started", b => {
                this.container && (this.container.classList.remove("no-animation-delay_"),
                    this.isLastPage = this.isRefOpened = !1, this.lastQuery = this.lastColumnsCount = null, this.queryInput.value = "", this.scrollPos = 0, this.searchData = null, this.results.innerHTML = "", delete this.results.dataset.query, this.fm.clear())
            });
            this.gpproxy.addEventListener("turns_ended", b => {
                this.fm.clear()
            });
            this.createPainterBtn()
        }
        toggle(a) {
            this.s.enabled = a ?? !document.getElementById("__next")?.classList.contains("gp-reference-rendered_");
            this.s.enabled ? this.enable() : this.disable()
        }
        enable() {
            document.getElementById("__next").classList.add("gp-reference-rendered_");
            clearTimeout(this.firstRenderTimer);
            this.firstRenderTimer = setTimeout(() => {
                const a = this.columnsCount;
                this.calculateColumnsCount();
                this.columnsCount !== a && this.renderImages({
                    images: this.searchData,
                    isFirstPage: !0,
                    query: this.results.dataset.query
                })
            }, 400);
            this.dispatchEvent(new CustomEvent("state_changed", {
                detail: {
                    isEnabled: !0
                }
            }))
        }
        disable() {
            document.getElementById("__next").classList.remove("gp-reference-rendered_");
            clearTimeout(this.firstRenderTimer);
            this.dispatchEvent(new CustomEvent("state_changed", {
                detail: {
                    isEnabled: !1
                }
            }))
        }
        init() {
            this.container || this.render();
            window.addEventListener("resize", this.handleResizeWindow);
            this.screen = document.querySelector("#content > .screen");
            this.screen.before(this.container);
            this.s.enabled ? this.enable() : this.disable()
        }
        terminate() {
            this.container && (this.pendingSearch = this.pendingImage = null, this.isReRenderNeeded = this.isResizing = !1, this.container.remove(), this.container.classList.remove("image-opened_"), this.zoomer.reset(), window.removeEventListener("resize", this.handleResizeWindow),
                this.disable())
        }
        render() {
            this.container = document.createElement("div");
            this.container.className = "gp-reference_";
            this.style = this.container.style;
            this.style.setProperty("--gp-ref-max-width", `${this.s.containerMaxWidth}`);
            this.style.setProperty("--gp-ref-column-flex", `${Math.floor(100/this.columnsCount)}%`);
            document.documentElement.style.setProperty("--gp-ref-alignment", `${this.s.interfaceAlignment}`);
            var a = this.container;
            a.addEventListener("drop", async c => {
                c.preventDefault();
                let d;
                c.dataTransfer.items &&
                    "file" === c.dataTransfer.items[0].kind ? d = c.dataTransfer.items[0].getAsFile() : c.dataTransfer.files.length && (d = c.dataTransfer.files[0]);
                if (d && GPReference_.IMAGE_TYPES.has(d.type)) {
                    const e = new FileReader;
                    e.addEventListener("loadend", f => {
                        this.showPreview(e.result, 0, 0, {
                            query: "file",
                            type: d.type
                        })
                    });
                    e.readAsDataURL(d)
                }
            }, !0);
            a.addEventListener("dragover", c => {
                c.preventDefault();
                c.dataTransfer.dropEffect = "move"
            }, !0);
            a = document.createElement("div");
            a.className = "wrapper_";
            this.container.appendChild(a);
            var b = document.createElement("div");
            b.className = "header_";
            b.addEventListener("animationend", c => {
                "gp-ref-fade-out_" === c.animationName && this.style.setProperty("--gp-ref-progress", "0%")
            });
            b.addEventListener("pointerleave", c => {
                this.historyList.classList.remove("shown_")
            });
            a.appendChild(b);
            this.queryInput = document.createElement("input");
            this.queryInput.className = "query_";
            this.queryInput.setAttribute("spellcheck", "false");
            this.queryInput.setAttribute("autocomplete", "off");
            this.queryInput.addEventListener("keydown", c => {
                if ("Enter" === c.key) {
                    const d =
                        c.target.value.trim();
                    GPReference_.URL_PATTERN.test(d) ? this.openImageURL(d) : d && (this.lastQuery = d, this.searchImages(d, !1));
                    c.target.blur()
                } else "Escape" === c.key && c.target.blur()
            });
            GPUtils_.setInputFocusBlurHandler(this.queryInput);
            b.appendChild(this.queryInput);
            this.historyBtn = document.createElement("div");
            this.historyBtn.className = "history-btn_";
            this.historyBtn.setAttribute("hidden", "");
            this.historyBtn.addEventListener("pointerdown", c => {
                0 === c.button && this.history.size && (this.historyList.classList.toggle("shown_"),
                    this.historyList.scrollTop = 0)
            });
            b.appendChild(this.historyBtn);
            this.historyList = document.createElement("div");
            this.historyList.className = "history-list_";
            this.historyList.addEventListener("pointerup", c => {
                if (c = c.target.closest(".history-item_")) {
                    var {
                        url: d,
                        width: e,
                        height: f,
                        query: g
                    } = c.dataset;
                    this.downloadImage(d, e, f, g, null, !0);
                    this.historyList.classList.remove("shown_")
                }
            });
            b.appendChild(this.historyList);
            this.searchEnginesMenu = document.createElement("div");
            this.searchEnginesMenu.className = "search-engines-menu_";
            b.appendChild(this.searchEnginesMenu);
            this.searchEngines = document.createElement("div");
            this.searchEngines.className = "search-engines_";
            this.searchEngines.addEventListener("pointerdown", c => {
                0 === c.button && (this.searchEngines.classList.contains("shown_") ? c.target === this.searchEngines && this.searchEngines.classList.remove("shown_") : this.searchEngines.classList.add("shown_"))
            });
            this.searchEngines.addEventListener("click", c => {
                c.target.matches(".search-engine_.selected_") && this.searchEngines.classList.remove("shown_")
            });
            this.searchEngines.addEventListener("pointerup", c => {
                if (c.target.classList.contains("search-engine_")) {
                    var d = c.target.dataset.searchEngine;
                    if (d !== this.s.searchEngine) {
                        this.s.searchEngine = d;
                        const e = this.queryInput.value.trim();
                        this.searchByEngine(e, d);
                        Array.from(this.searchEngines.children).forEach(f => {
                            f.style.order = +(f !== c.target)
                        });
                        this.searchEngines.classList.remove("shown_");
                        this.searchEngines.title = c.target.title
                    }
                }
            });
            Object.values(GPReference_.SEARCH_ENGINES).forEach(c => {
                const d = document.createElement("div");
                d.className = `search-engine_ ${c}_`;
                d.title = c[0].toUpperCase() + c.slice(1);
                d.dataset.searchEngine = c;
                this.searchEngines.appendChild(d)
            });
            b = this.searchEngines.querySelector(`[data-search-engine="${this.s.searchEngine}"]`);
            b.classList.add("selected_");
            this.searchEngines.title = b.title;
            this.searchEnginesMenu.appendChild(this.searchEngines);
            Array.from(this.searchEngines.children).forEach(c => {
                c.style.order = +(c.dataset.searchEngine !== this.s.searchEngine)
            });
            this.results = document.createElement("div");
            this.results.className =
                "results_";
            this.results.addEventListener("click", this.openImage);
            this.results.addEventListener("scroll", this.onScroll);
            this.results.addEventListener("contextmenu", this.blockContextMenu);
            a.appendChild(this.results);
            this.imageObserver = new IntersectionObserver(c => {
                c.forEach(d => {
                    d.isIntersecting && (d = d.target, d.src = d.dataset.src, this.imageObserver.unobserve(d))
                })
            }, {
                root: this.results
            });
            this.imageWrapper = document.createElement("div");
            this.imageWrapper.className = "image-wrapper_";
            this.imageWrapper.addEventListener("wheel",
                this.onImageWheel);
            this.imageWrapper.addEventListener("pointerdown", this.onImageDown);
            this.imageWrapper.addEventListener("mousedown", this.onImageMDown);
            this.imageWrapper.addEventListener("click", this.onImageClick);
            this.imageWrapper.addEventListener("dblclick", this.onImageDblClick);
            this.imageWrapper.addEventListener("contextmenu", this.blockContextMenu);
            a.appendChild(this.imageWrapper);
            this.image = document.createElement("img");
            this.image.className = "image_";
            this.image.addEventListener("load", c => {
                this.calculateOrientation()
            });
            this.imageWrapper.appendChild(this.image);
            b = document.createElement("div");
            b.className = "close-btn_";
            b.innerHTML = '<svg viewBox="0 0 98 98" stroke-linejoin="round"><path stroke-width="2" stroke="currentColor" fill="currentColor" filter="drop-shadow(2px 2px 0px rgb(32 33 36 / 60%))" d="M78.2 23.3 75 20.1 48.7 46.4 22.5 20.1l-3.3 3.2 26.3 26.3-27.2 27.2 3.2 3.3 27.2-27.3L76 80.1l3.2-3.3L52 49.6l26.2-26.3z"/></svg>';
            b.addEventListener("click", c => {
                this.closeImage()
            });
            this.imageWrapper.appendChild(b);
            this.zoomer =
                window.renderer({
                    minScale: this.s.minZoom,
                    maxScale: this.s.maxZoom,
                    element: this.image,
                    defaultScaleSensitivity: this.s.zoomSensitivity
                });
            b = document.createElement("div");
            b.className = "resizer_ left_";
            b.dataset.dir = "left";
            b.addEventListener("pointerdown", this.resizeDown);
            b.addEventListener("pointerup", this.resizeUp);
            b.addEventListener("dblclick", this.resizeDblClick);
            a.appendChild(b);
            b = document.createElement("div");
            b.className = "resizer_ right_";
            b.dataset.dir = "right";
            b.addEventListener("pointerdown", this.resizeDown);
            b.addEventListener("pointerup", this.resizeUp);
            b.addEventListener("dblclick", this.resizeDblClick);
            a.appendChild(b)
        }
        createPainterBtn() {
            this.painterBtn = document.createElement("div");
            this.painterBtn.className = "gp-reference-btn_";
            this.painterBtn.addEventListener("click", () => {
                this.container.classList.toggle("no-animation-delay_", !this.s.enabled);
                this.toggle()
            })
        }
        searchByEngine(a, b) {
            a && (this.lastQuery = a, this.searchImages(a, !1));
            (a = this.searchEngines.querySelector(".selected_")) && a.classList.remove("selected_");
            this.searchEngines.querySelector(`[data-search-engine=${b}]`).classList.add("selected_")
        }
        searchImages(a, b) {
            a && (this.pendingImage = null, this.pendingSearch = this.s.searchEngine, document.dispatchEvent(new CustomEvent("_ref_search", {
                detail: {
                    searchEngine: this.s.searchEngine,
                    next: !!b,
                    query: a
                }
            })), this.container.classList.remove("complete_"))
        }
        renderImages({
            images: a,
            isFirstPage: b,
            query: c,
            scrollPos: d
        }) {
            if (a?.length) {
                var e = Array(this.columnsCount).fill(0),
                    f = Array(this.columnsCount).fill().map(() => document.createDocumentFragment());
                if (b)
                    for (this.results.innerHTML = "", this.results.scrollTop = 0, this.results.dataset.query = c, this.columns = [], b = 0; b < this.columnsCount; b++) {
                        const g = document.createElement("div");
                        g.className = "column_";
                        g.dataset.index = `${b}`;
                        this.columns[b] = g;
                        this.results.appendChild(g)
                    } else e.map((g, h) => +this.columns[h].dataset.height);
                a.forEach(g => {
                    var h = g.image.width / g.image.height;
                    const k = document.createElement("div");
                    k.className = "preview_";
                    k.style.backgroundColor = g.dominantColor;
                    k.dataset.url = g.image.url;
                    k.dataset.previewURL =
                        g.preview.url;
                    k.dataset.width = g.image.width;
                    k.dataset.height = g.image.height;
                    k.dataset.aspectRatio = h;
                    const l = new Image;
                    l.width = h * GPReference_.PREVIEW_MAX_HEIGHT;
                    l.height = GPReference_.PREVIEW_MAX_HEIGHT;
                    l.dataset.src = g.preview.url;
                    k.appendChild(l);
                    this.imageObserver.observe(l);
                    h = this.getMinHeightColumnIndex(e);
                    f[h].appendChild(k);
                    e[h] += g.image.height / g.image.width
                });
                this.columns.forEach((g, h) => {
                    g.dataset.height = e[h];
                    g.appendChild(f[h])
                });
                a = !!this.results.getBoundingClientRect().height;
                void 0 !== d && setTimeout(() => {
                    this.results.scrollTop = d
                }, a ? 0 : 500);
                a && setTimeout(() => {
                    this.isNextPageNeeded() && this.searchImages(c, !0)
                }, a ? 0 : 500)
            }
        }
        getMinHeightColumnIndex(a) {
            return a.reduce((b, c, d, e) => c < e[b] ? d : b, 0)
        }
        isNextPageNeeded() {
            return !this.isLastPage && !this.pendingSearch && this.columns.some(a => {
                const b = this.results.scrollTop,
                    c = this.results.getBoundingClientRect().height;
                a = a.getBoundingClientRect().height;
                return b + c >= a
            })
        }
        calculateColumnsCount(a) {
            a = a || this.results.getBoundingClientRect().width || this.imageWrapper.getBoundingClientRect().width;
            this.columnsCount = Math.floor(a / GPReference_.RESULTS_COLUMN_MIN_WIDTH);
            this.style.setProperty("--gp-ref-column-flex", `${Math.floor(100/this.columnsCount)}%`)
        }
        onScroll() {
            !this.isResizing && this.isNextPageNeeded() && this.searchImages(this.lastQuery, !0);
            this.scrollPos = this.results.scrollTop
        }
        updateProgress(a) {
            this.container.classList.toggle("progress_", !~a);
            this.style.setProperty("--gp-ref-progress", `${a}%`)
        }
        hideProgress() {
            this.container.classList.remove("progress_");
            this.container.classList.add("complete_")
        }
        downloadImage(a,
            b, c, d, e, f, g, h) {
            this.pendingImage = a;
            document.dispatchEvent(new CustomEvent("_ref_image", {
                detail: {
                    searchEngine: this.s.searchEngine,
                    url: a,
                    width: b,
                    height: c,
                    query: d,
                    previewURL: e,
                    isFromHistory: f,
                    inFrame: g,
                    openInBg: h
                }
            }));
            this.container.classList.add("progress_");
            this.container.classList.remove("complete_")
        }
        async showPreview(a, b, c, {
            query: d,
            type: e,
            url: f
        }) {
            b && c || ([b, c] = await this.getImageDimensions(a));
            this.image.metadata = {
                base64: a,
                query: d,
                type: e,
                url: f
            };
            this.image.style.setProperty("--gp-ref-img-width", "100%");
            this.image.style.setProperty("--gp-ref-img-height", "100%");
            this.image.src = a;
            this.container.classList.add("image-opened_");
            this.imageWidth = b;
            this.imageHeight = c;
            (a = this.history.get(f)?.pos) ? this.zoomer.setState(a): this.zoomer.reset();
            this.isRefOpened = !0
        }
        async getImageDimensions(a) {
            return new Promise((b, c) => {
                const d = new Image;
                d.onload = () => {
                    b([d.naturalWidth, d.naturalHeight])
                };
                d.onerror = c;
                d.src = a
            })
        }
        onImageDown(a) {
            switch (a.button) {
                case 0:
                    a.ctrlKey && !a.shiftKey ? this.saveImage() : a.shiftKey ? this.cropImage(a) :
                        this.moveImage(a);
                    break;
                case 1:
                    this.zoomer.reset(), this.updateHistoryState()
            }
        }
        onImageMDown(a) {
            2 === a.button && (this.isCropping ? (this.isCropping = !1, this.cropper.remove()) : document.addEventListener("mouseup", b => {
                b.target === this.imageWrapper && this.closeImage()
            }, {
                once: !0
            }))
        }
        onImageClick(a) {
            0 === a.button && 2 === a.buttons && (this.base64ToBlob(this.image.metadata.base64).then(b => {
                this.openFrame(b, a.ctrlKey)
            }), document.addEventListener("contextmenu", b => {
                b.preventDefault()
            }, {
                once: !0
            }))
        }
        moveImage(a) {
            a.target.setPointerCapture(a.pointerId);
            a.target.addEventListener("pointermove", this.onImageMove);
            a.target.addEventListener("pointerup", b => {
                b.target.removeEventListener("pointermove", this.onImageMove);
                this.updateHistoryState()
            }, {
                once: !0
            })
        }
        cropImage(a) {
            if (a.target === this.imageWrapper && this.image.metadata.type !== GPReference_.SVG_TYPE) {
                this.cropper = document.createElement("div");
                this.cropper.className = "gp-ref-cropper_";
                document.body.appendChild(this.cropper);
                var b = a.pageX,
                    c = a.pageY,
                    [, d] = this.getContainedImageSize(this.image),
                    e = this.image.getBoundingClientRect(),
                    f = d === e.height ? e.height / this.image.naturalHeight : e.width / this.image.naturalWidth,
                    g = Math.round(a.clientX - e.x) / f,
                    h = Math.round(a.clientY - e.y) / f;
                this.isCropping = !0;
                var k = (l => {
                    this.isCropping || this.image.removeEventListener("pointermove", k);
                    const m = Math.min(b, l.pageX),
                        n = Math.min(c, l.pageY),
                        r = Math.max(b, l.pageX);
                    l = Math.max(c, l.pageY);
                    this.cropper.style.left = `${m}px`;
                    this.cropper.style.top = `${n}px`;
                    this.cropper.style.width = `${r-m}px`;
                    this.cropper.style.height = `${l-n}px`
                }).bind(this);
                this.image.setPointerCapture(a.pointerId);
                this.image.addEventListener("pointermove", k);
                this.image.addEventListener("pointerup", l => {
                    this.image.removeEventListener("pointermove", k);
                    this.cropper.remove();
                    this.cropper = null;
                    this.isCropping && this.getCroppedImage(g, h, Math.round(l.clientX - e.x) / f, Math.round(l.clientY - e.y) / f).then(m => {
                        this.openFrame(m, l.ctrlKey)
                    });
                    this.isCropping = !1
                }, {
                    once: !0
                })
            }
        }
        calculateOrientation() {
            const [, a] = this.getContainedImageSize(this.image), b = this.s.stretchImage ? "100%" : "unset";
            a === this.image.height ? (this.image.style.setProperty("--gp-ref-img-width",
                "unset"), this.image.style.setProperty("--gp-ref-img-height", b)) : (this.image.style.setProperty("--gp-ref-img-width", b), this.image.style.setProperty("--gp-ref-img-height", "unset"))
        }
        getContainedImageSize(a) {
            const b = a.naturalWidth / a.naturalHeight;
            let c = a.height * b,
                d = a.height;
            c > a.width && (c = a.width, d = a.width / b);
            return [Math.ceil(c), Math.ceil(d)]
        }
        getCroppedImage(a, b, c, d) {
            return new Promise(e => {
                var f = Math.min(a, c),
                    g = Math.min(b, d);
                const h = Math.max(a, c);
                var k = Math.max(b, d);
                const l = Math.min(f, 0),
                    m = Math.min(g,
                        0),
                    n = f - l,
                    r = g - m;
                f = Math.abs(h - f) - (Math.max(h - this.image.naturalWidth, 0) - l);
                g = Math.abs(k - g) - (Math.max(k - this.image.naturalHeight, 0) - m);
                k = document.createElement("canvas");
                k.width = f;
                k.height = g;
                k.getContext("2d").drawImage(this.image, n, r, f, g, 0, 0, f, g);
                k.toBlob(e)
            })
        }
        onImageMove(a) {
            this.zoomer.panBy({
                originX: a.movementX,
                originY: a.movementY
            })
        }
        onImageDblClick(a) {
            this.zoomer.reset();
            this.updateHistoryState()
        }
        onImageWheel(a) {
            a.preventDefault();
            this.zoomer.zoom({
                deltaScale: -Math.sign(a.deltaY),
                x: a.pageX - window.scrollX,
                y: a.pageY - window.scrollY,
                scaleSensitivity: this.s.zoomSensitivity
            });
            1 === this.zoomer.getMinScale() && 1 >= this.zoomer.getScale() && this.zoomer.reset();
            this.updateHistoryState()
        }
        openImageURL(a) {
            this.downloadImage(a, 0, 0, "url", null, null)
        }
        openImage(a) {
            if (a.target.classList.contains("preview_")) {
                var {
                    url: b,
                    width: c,
                    height: d,
                    previewURL: e
                } = a.target.dataset, f = 0 === a.button && (a.ctrlKey || 2 === a.buttons);
                a = f && a.ctrlKey;
                this.downloadImage(b, c, d, this.results.dataset.query, e, null, f, a);
                f && !a && document.addEventListener("contextmenu",
                    g => {
                        g.preventDefault()
                    }, {
                        once: !0
                    })
            }
        }
        closeImage(a) {
            this.results.dataset.query && (this.isRefOpened = !1, this.zoomer.reset(), this.container.classList.remove("image-opened_"), this.isReRenderNeeded && (this.calculateColumnsCount(), this.renderImages({
                images: this.searchData,
                isFirstPage: !0,
                query: this.results.dataset.query
            })))
        }
        saveImage() {
            const {
                base64: a,
                query: b,
                type: c
            } = this.image.metadata, d = c.split("/")[1].split("+")[0], e = document.createElement("a");
            e.href = a;
            e.download = `${b}.${d}`;
            e.click()
        }
        addToHistory(a, b, c,
            d) {
            this.history.delete(a);
            this.history.set(a, {
                width: b,
                height: c,
                query: d
            });
            this.renderHistory()
        }
        updateHistoryState() {
            const a = this.history.get(this.image.metadata.url);
            a && (a.pos = this.zoomer.getState())
        }
        renderHistory() {
            this.historyList.innerHTML = "";
            const a = document.createDocumentFragment();
            Array.from(this.history).reverse().forEach(([b, {
                width: c,
                height: d,
                query: e
            }], f) => {
                const g = document.createElement("div");
                g.className = "history-item_";
                g.dataset.url = b;
                g.dataset.width = c;
                g.dataset.height = d;
                g.dataset.query =
                    e;
                b = document.createElement("div");
                b.className = "index_";
                b.textContent = `${this.history.size-f}.`;
                g.appendChild(b);
                f = document.createElement("div");
                f.className = "label_";
                f.textContent = e;
                g.appendChild(f);
                a.appendChild(g)
            });
            this.historyList.appendChild(a)
        }
        blockContextMenu(a) {
            a.preventDefault()
        }
        resizeDown(a) {
            a.target.setPointerCapture(a.pointerId);
            this.resizeStartX = a.pageX;
            this.resizeInitialWidth = this.getContainerWidth();
            this.lastColumnsCount = this.columnsCount;
            a.target.addEventListener("pointermove", this.resizeMove);
            this.isResizing = !0
        }
        resizeMove(a) {
            const b = a.pageX - this.resizeStartX;
            this.style.setProperty("--gp-ref-max-width", `${Math.max(this.resizeInitialWidth+2*("left"===a.target.dataset.dir?-b:b),GPReference_.CONTAINER_MIN_WIDTH)}px`);
            this.isRefOpened ? this.isReRenderNeeded = !0 : this.calculateColumnsCount()
        }
        resizeUp(a) {
            var b = this.getContainerWidth();
            if (b !== this.resizeInitialWidth) {
                this.style.setProperty("--gp-ref-max-width", "none");
                const c = this.getContainerWidth();
                b = b < c ? `${b}px` : "none";
                this.s.containerMaxWidth =
                    b;
                this.style.setProperty("--gp-ref-max-width", b)
            }
            a.target.removeEventListener("pointermove", this.resizeMove);
            this.isResizing = !1;
            !this.isRefOpened && this.searchData && this.columnsCount !== this.lastColumnsCount && this.renderImages({
                images: this.searchData,
                isFirstPage: !0,
                query: this.results.dataset.query
            })
        }
        resizeDblClick(a) {
            a = "none" === window.getComputedStyle(this.container).maxWidth ? `${GPReference_.CONTAINER_MIN_WIDTH}px` : "none";
            this.s.containerMaxWidth = a;
            this.style.setProperty("--gp-ref-max-width", a);
            this.isRefOpened ?
                this.isReRenderNeeded = !0 : (this.calculateColumnsCount(), this.renderImages({
                    images: this.searchData,
                    isFirstPage: !0,
                    query: this.results.dataset.query
                }))
        }
        getContainerWidth() {
            return this.container.getBoundingClientRect().width - 2 * GPReference_.BORDER_SIZE
        }
        handleResizeWindow(a) {
            clearTimeout(this.resizeTimer);
            this.resizeTimer = setTimeout(this.onResize, 250)
        }
        onResize() {
            this.s.enabled && (this.isRefOpened ? this.isReRenderNeeded = !0 : (this.calculateColumnsCount(), this.renderImages({
                images: this.searchData,
                isFirstPage: !0,
                query: this.results.dataset.query
            })))
        }
        openFrame(a, b) {
            this.fm.create(a, b);
            b || this.toggle(!1)
        }
        base64ToBlob(a) {
            return fetch(a).then(b => b.blob())
        }
        isEnabled() {
            return this.s.enabled
        }
        getPainterButton() {
            return this.painterBtn
        }
        updateSettings({
            detail: {
                settings: a
            }
        }) {
            "interfaceAlignment" in a && document.documentElement.style.setProperty("--gp-ref-alignment", `${a.interfaceAlignment}`);
            this.container && ("minZoom" in a && this.zoomer.setMinScale(a.minZoom), "maxZoom" in a && this.zoomer.setMaxScale(a.maxZoom), "stretchImage" in
                a && this.isRefOpened && (this.calculateOrientation(), this.zoomer.reset(), this.updateHistoryState()), "frameStickyEdges" in a && this.fm.setStickyEdges(a.frameStickyEdges), "frameStickyEdgesDistance" in a && this.fm.setStickyEdgesDistance(a.frameStickyEdgesDistance), "frameSeparateOpacity" in a && this.fm.setSeparateOpacity(a.frameSeparateOpacity))
        }
    }
    window.GPReference_ = GPReference_;
    class GPReferenceFrameManager_ extends EventTarget {
        static DEFAULT_STICKY_EDGES = !0;
        static DEFAULT_STICKY_EDGES_DISTANCE = 15;
        static DEFAULT_STATIC_ORIENTATION = !0;
        static DEFAULT_SEPARATE_OPACITY = !1;
        static BASE_Z_INDEX = 100;
        static Z_INDEX_POOL = 100;
        static MIN_FRAME_DISPLAY_AREA_SIZE = 40;
        constructor(a, b, c, d, e, f, g, h, k) {
            super();
            this.container = a;
            this.stickyEdges = b;
            this.stickyEdgesDistance = c;
            this.staticOrientation = d;
            this.separateOpacity = e;
            this.opacity = f;
            this.width = g;
            this.x = h.x;
            this.y = h.y;
            this.orien = k;
            this.frames = [];
            this.topFrame = null;
            this.lastZIndex = GPReferenceFrameManager_.BASE_Z_INDEX
        }
        create(a, b) {
            a = new GPReferenceFrame_(a, b, this);
            this.add(a)
        }
        add(a) {
            this.frames.push(a);
            this.topFrame = a
        }
        delete(a) {
            a = this.frames.indexOf(a);
            this.frames.splice(a, 1);
            this.frames.length || this.reset()
        }
        clear() {
            this.frames.forEach(a => {
                a.remove()
            });
            this.reset()
        }
        reset() {
            this.frames = [];
            this.topFrame = null;
            this.lastZIndex = GPReferenceFrameManager_.BASE_Z_INDEX
        }
        toFront(a) {
            this.topFrame !== a && (a.setZIndex(this.getNextZIndex()), this.topFrame =
                a);
            (this.frames.length > GPReferenceFrameManager_.Z_INDEX_POOL || this.lastZIndex > GPReferenceFrameManager_.BASE_Z_INDEX + GPReferenceFrameManager_.Z_INDEX_POOL) && this.optimizeZIndexes()
        }
        getNextZIndex() {
            return this.lastZIndex++
        }
        optimizeZIndexes() {
            this.lastZIndex = GPReferenceFrameManager_.BASE_Z_INDEX;
            Array.from(this.frames).sort((a, b) => a.zIndex - b.zIndex).forEach(a => {
                a.setZIndex(this.getNextZIndex());
                this.topFrame = a
            })
        }
        setTopFrame(a) {
            this.topFrame = a
        }
        getAlignedCoords(a) {
            const b = GPReferenceFrame_.BORDER_WIDTH;
            var c = GPReferenceFrame_.DEFAULT_WIDTH;
            if (1 === this.frames.length) return [b, b];
            const d = 2 * b;
            var e = Math.trunc(document.documentElement.clientWidth / (c + 2 * b));
            const f = new Map([
                [b, []]
            ]);
            for (var g = 0; g < e; g++) f.set((c + 2 * b) * g + b, [
                [-b, -b]
            ]);
            let h = b;
            this.frames.forEach(k => {
                if (k !== a && !k.isSeparated && !k.isChanged) {
                    const l = [k.offsetY, k.offsetY + k.height],
                        m = f.get(k.offsetX);
                    m ? m.push(l) : f.set(k.offsetX, [
                        [b, b], l
                    ]);
                    k.offsetX > h && (h = k.offsetX)
                }
            });
            for (let [k, l] of f)
                for (l.sort((m, n) => m[0] - n[0]), c = 0; c < l.length; c++)
                    if ([, e] = l[c],
                        [g] = c !== l.length - 1 ? l[c + 1] : [document.documentElement.clientHeight, document.documentElement.clientHeight], g - (e + d) >= a.height) return [k, e + d];
            return [h + GPReferenceFrame_.DEFAULT_WIDTH + d, b]
        }
        setOpacity(a) {
            this.frames.forEach(b => {
                b.setOpacity(a)
            })
        }
        getFrames() {
            return this.frames
        }
        hasFrames() {
            return 0 < this.frames.length
        }
        isSingleFrame() {
            return 1 === this.frames.length
        }
        getContainer() {
            return this.container
        }
        setStickyEdges(a) {
            this.stickyEdges = a
        }
        setStickyEdgesDistance(a) {
            this.stickyEdgesDistance = a
        }
        setSeparateOpacity(a) {
            this.separateOpacity =
                a
        }
        setStaticOrientation(a) {
            this.staticOrientation = a
        }
    }
    class GPReferenceFrame_ {
        static DEFAULT_WIDTH = 284;
        static MAX_WIDTH = window.screen.width / 3;
        static MIN_WIDTH = 180;
        static WIDTH_STEP = 10;
        static BORDER_WIDTH = 2;
        static DEFAULT_ORIENTATION = "tl";
        static DEFAULT_OPACITY = 1;
        static MIN_OPACITY = .1;
        static OPACITY_STEP = .1;
        static ORIENTATION_PROPS = {
            t: "top",
            b: "bottom",
            l: "left",
            r: "right"
        };
        static ORIENTATION = {
            TOP: "t",
            BOTTOM: "b",
            LEFT: "l",
            RIGHT: "r"
        };
        constructor(a, b = !1, c) {
            this.fm = c;
            this.opacity = this.fm.opacity ?? GPReferenceFrame_.DEFAULT_OPACITY;
            this.isChanged = !1;
            this.openedInBg =
                b;
            this.isSeparated = !this.fm.hasFrames() && !this.openedInBg;
            this.suppressEvent = this.suppressEvent.bind(this);
            this.opacityPreviewHandler = this.opacityPreviewHandler.bind(this);
            this.render();
            this.load(a);
            this.fm.setTopFrame(this)
        }
        render() {
            this.frame = document.createElement("div");
            this.frame.className = "frame_ gp-ref-frame_";
            this.frame.classList.toggle("static-orien_", this.fm.staticOrientation);
            this.frame.style.zIndex = this.fm.getNextZIndex();
            this.frame.style.setProperty("--gp-ref-frame-opacity", `${this.opacity}`);
            this.frame.addEventListener("wheel", this.wheelHandler.bind(this));
            this.frame.addEventListener("pointerdown", this.toFront.bind(this));
            this.frame.addEventListener("pointerdown", this.moveHandler.bind(this));
            this.frame.addEventListener("pointerdown", this.resizeHandler.bind(this));
            this.frame.addEventListener("pointerdown", this.closeHandler.bind(this));
            this.frame.addEventListener("mousedown", b => {
                b.stopPropagation()
            });
            const a = document.createElement("div");
            a.className = "wrapper_";
            this.frame.appendChild(a);
            this.image = document.createElement("img");
            this.image.className = "image_";
            a.appendChild(this.image);
            this.fm.getContainer().appendChild(this.frame)
        }
        wheelHandler(a) {
            a.ctrlKey ? this.changeOpacity(a) : this.changeSize(a);
            a.preventDefault()
        }
        changeOpacity(a) {
            a = Math.max(Math.min(this.opacity + (0 < a.deltaY ? -GPReferenceFrame_.OPACITY_STEP : GPReferenceFrame_.OPACITY_STEP), 1), GPReferenceFrame_.MIN_OPACITY);
            this.setOpacity(a);
            this.fm.separateOpacity ? this.setOpacity(a) : this.fm.setOpacity(a);
            this.frame.classList.add("opacity-preview_");
            this.frame.addEventListener("pointerleave", this.opacityPreviewHandler, {
                once: !0
            })
        }
        opacityPreviewHandler(a) {
            this.frame.classList.remove("opacity-preview_")
        }
        setOpacity(a) {
            this.opacity = a;
            this.frame.style.setProperty("--gp-ref-frame-opacity", `${a}`)
        }
        changeSize(a) {
            a = 0 < a.deltaY ? Math.max(this.width - GPReferenceFrame_.WIDTH_STEP, this.minWidth) : Math.min(this.width + GPReferenceFrame_.WIDTH_STEP, GPReferenceFrame_.MAX_WIDTH);
            this.setSize(a);
            this.toFront();
            this.isChanged || this.handleChange();
            this.fm.isSingleFrame() &&
                (this.fm.width = a, this.dispatchSize(a))
        }
        toFront() {
            this.fm.toFront(this)
        }
        moveHandler(a) {
            if (0 === a.button) {
                var b = this.frame.dataset.orien,
                    c = this.offsetX,
                    d = this.offsetY,
                    [e, f, g, h] = this.getCoords(a),
                    k = (l => {
                        const [m, n, r] = this.getStickyCoords(l, l.pageX - e, l.pageY - f, g, h);
                        this.setPosition(m, n, g, h, r)
                    }).bind(this);
                this.frame.setPointerCapture(a.pointerId);
                this.frame.addEventListener("pointermove", k);
                this.frame.addEventListener("pointerup", () => {
                    this.frame.removeEventListener("pointermove", k);
                    this.isChanged || this.offsetX ===
                        c && this.offsetY === d || this.handleChange();
                    this.fm.isSingleFrame() && (this.fm.x = this.offsetX, this.fm.y = this.offsetY, this.dispatchPos(this.offsetX, this.offsetY), this.staticOrientation || this.frame.dataset.orien === b || (this.fm.orien = this.frame.dataset.orien, this.dispatchOrien(this.frame.dataset.orien)))
                }, {
                    once: !0
                });
                (this.fm.stickyEdges && a.ctrlKey || !this.fm.stickyEdges && !a.ctrlKey) && k(a)
            }
        }
        getStickyCoords(a, b, c, d, e) {
            if (this.fm.stickyEdges && a.ctrlKey || !this.fm.stickyEdges && !a.ctrlKey || !this.fm.hasFrames()) return [b,
                c, null
            ];
            const f = this.fm.stickyEdgesDistance;
            let g, h, k, l, m = null,
                n, r;
            this.fm.getFrames().forEach(q => {
                if (q !== this) {
                    var p = q.frame.getBoundingClientRect();
                    var t = Math.abs(p.y - (c + e));
                    t < f && (void 0 === k || t < k) && p.x + p.width >= b && p.x <= b + d && (!r || r[0] === q.frame.dataset.orien[0]) && (k = t, c = p.y - e, m = r = q.frame.dataset.orien);
                    t = Math.abs(p.y + p.height - c);
                    t < f && (void 0 === l || t < l) && p.x + p.width >= b && p.x <= b + d && (!r || r[0] === q.frame.dataset.orien[0]) && (l = t, c = p.y + p.height, m = r = q.frame.dataset.orien);
                    t = Math.abs(p.x - (b + d));
                    t < f && (void 0 ===
                        g || t < g) && p.y + p.height >= c && p.y <= c + e && (!n || n[1] === q.frame.dataset.orien[1]) && (g = t, b = p.x - d, m = n = q.frame.dataset.orien);
                    t = Math.abs(p.x + p.width - b);
                    t < f && (void 0 === h || t < h) && p.y + p.height >= c && p.y <= c + e && (!n || n[1] === q.frame.dataset.orien[1]) && (h = t, b = p.x + p.width, m = n = q.frame.dataset.orien)
                }
            });
            return [b, c, m]
        }
        resizeHandler(a) {
            if (2 === a.button) {
                var b = this.width,
                    c = a.pageX,
                    d = this.image.getBoundingClientRect().width,
                    e = this.frame.dataset.orien,
                    f = (g => {
                        g = g.pageX - c;
                        this.setSize(Math.min(Math.max(d + (e[1] === GPReferenceFrame_.ORIENTATION.LEFT ?
                            g : -g), this.minWidth), GPReferenceFrame_.MAX_WIDTH))
                    }).bind(this);
                this.frame.setPointerCapture(a.pointerId);
                this.frame.addEventListener("pointermove", f);
                this.frame.addEventListener("pointerup", g => {
                    document.addEventListener("contextmenu", this.suppressEvent, {
                        once: !0
                    });
                    this.frame.removeEventListener("pointermove", f);
                    this.frame.classList.remove("resizing_");
                    this.isChanged || this.handleChange();
                    this.fm.isSingleFrame() && this.width !== b && (this.fm.width = this.width, this.dispatchSize(this.width))
                }, {
                    once: !0
                });
                this.frame.classList.add("resizing_")
            }
        }
        closeHandler(a) {
            1 ===
                a.button && (this.close(), a.preventDefault())
        }
        suppressEvent(a) {
            a.preventDefault()
        }
        setSize(a) {
            this.width = a;
            this.height = Math.round(a / this.aspectRatio);
            this.frame.style.setProperty("--gp-ref-frame-width", `${a}px`)
        }
        updatePosition() {
            const a = Math.max(Math.min(this.offsetX, document.documentElement.clientWidth - (this.width + GPReferenceFrame_.BORDER_WIDTH)), GPReferenceFrame_.BORDER_WIDTH),
                b = Math.max(Math.min(this.offsetY, document.documentElement.clientHeight - (this.height + GPReferenceFrame_.BORDER_WIDTH)), GPReferenceFrame_.BORDER_WIDTH);
            this.frame.style.inset = "unset";
            Array.from(this.frame.dataset.orien).forEach(c => {
                const d = GPReferenceFrame_.ORIENTATION_PROPS[c];
                switch (c) {
                    case GPReferenceFrame_.ORIENTATION.TOP:
                    case GPReferenceFrame_.ORIENTATION.BOTTOM:
                        this.frame.style[d] = `${b}px`;
                        break;
                    case GPReferenceFrame_.ORIENTATION.LEFT:
                    case GPReferenceFrame_.ORIENTATION.RIGHT:
                        this.frame.style[d] = `${a}px`
                }
            })
        }
        setPosition(a, b, c, d, e) {
            if (!c || !d) {
                const [l, m] = this.frame.getBoundingClientRect();
                c = l;
                d = m
            }
            const f = document.documentElement.clientWidth,
                g =
                document.documentElement.clientHeight;
            var h;
            if (this.fm.staticOrientation) var k = h = GPReferenceFrameManager_.MIN_FRAME_DISPLAY_AREA_SIZE;
            else h = c, k = d;
            h = Math.max(Math.min(a, f - (h + GPReferenceFrame_.BORDER_WIDTH)), GPReferenceFrame_.BORDER_WIDTH);
            k = Math.max(Math.min(b, g - (k + GPReferenceFrame_.BORDER_WIDTH)), GPReferenceFrame_.BORDER_WIDTH);
            a = e ?? (this.fm.staticOrientation ? GPReferenceFrame_.DEFAULT_ORIENTATION : (b + d / 2 > g / 2 ? GPReferenceFrame_.ORIENTATION.BOTTOM : GPReferenceFrame_.ORIENTATION.TOP) + (a + c / 2 > f / 2 ? GPReferenceFrame_.ORIENTATION.RIGHT :
                GPReferenceFrame_.ORIENTATION.LEFT));
            this.frame.dataset.orien = a;
            this.frame.style.inset = "unset";
            a[0] === GPReferenceFrame_.ORIENTATION.TOP ? (this.offsetY = Math.round(k), this.frame.style.top = `${this.offsetY}px`) : (this.offsetY = Math.round(g - (k + d)), this.frame.style.bottom = `${this.offsetY}px`);
            a[1] === GPReferenceFrame_.ORIENTATION.LEFT ? (this.offsetX = Math.round(h), this.frame.style.left = `${this.offsetX}px`) : (this.offsetX = Math.round(f - (h + c)), this.frame.style.right = `${this.offsetX}px`)
        }
        getCoords(a) {
            const [b, c] =
            a.touches ? [a.touches[0].clientX, a.touches[0].clientY] : [a.clientX, a.clientY];
            a = a.currentTarget.getBoundingClientRect();
            return [Math.round(b - a.left), Math.round(c - a.top), a.width, a.height]
        }
        handleChange() {
            this.isChanged = !0
        }
        dispatchSize(a) {
            this.fm.dispatchEvent(new CustomEvent("size", {
                detail: {
                    width: a
                }
            }))
        }
        dispatchPos(a, b) {
            this.fm.dispatchEvent(new CustomEvent("pos", {
                detail: {
                    x: a,
                    y: b
                }
            }))
        }
        dispatchOrien(a) {
            this.fm.dispatchEvent(new CustomEvent("orien", {
                detail: {
                    orien: a
                }
            }))
        }
        load(a) {
            const b = URL.createObjectURL(a);
            this.image.src = b;
            this.image.onload = c => {
                const {
                    naturalWidth: d,
                    naturalHeight: e
                } = this.image;
                this.aspectRatio = d / e;
                this.image.style.setProperty("--aspect-ratio", this.aspectRatio);
                this.minWidth = Math.min(GPReferenceFrame_.MIN_WIDTH, d);
                this.setSize(Math.min(this.isSeparated ? this.fm.width : GPReferenceFrame_.DEFAULT_WIDTH, d));
                if (this.isSeparated) this.offsetX = this.fm.x, this.offsetY = this.fm.y, this.frame.dataset.orien = this.fm.orien;
                else {
                    const [f, g] = this.fm.getAlignedCoords(this);
                    this.offsetX = f;
                    this.offsetY = g;
                    this.frame.dataset.orien =
                        GPReferenceFrame_.DEFAULT_ORIENTATION
                }
                this.updatePosition();
                URL.revokeObjectURL(b)
            }
        }
        close() {
            this.remove();
            this.fm.delete(this)
        }
        remove() {
            this.frame.remove()
        }
        setZIndex(a) {
            this.zIndex = this.frame.style.zIndex = a
        }
    };
    class GPPlayersManager_ extends EventTarget {
        static DISPLAY_MODE = {
            NORMAL: "normal",
            EXPANDED: "expanded",
            FULLSCREEN: "fullscreen"
        };
        static PREVIEW_PANEL_PATHS = ["write", "memory"];
        static DEFAULT_SETTINGS = {
            autoplay: !0,
            openPlayerWithDoubleClick: !1,
            defaultDisplayMode: this.DISPLAY_MODE.NORMAL
        };
        static SETTINGS_UI = {
            autoplay: {
                type: "switch",
                description: "\u0410\u0432\u0442\u043e\u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0440\u0438\u0441\u043e\u0432\u0430\u043d\u0438\u044f \u0441\u0440\u0430\u0437\u0443 \u043f\u043e\u0441\u043b\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u044f \u043f\u043b\u0435\u0435\u0440\u0430 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435"
            },
            openPlayerWithDoubleClick: {
                type: "switch",
                description: "\u041e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043f\u043b\u0435\u0435\u0440 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0434\u0432\u043e\u0439\u043d\u043e\u0433\u043e \u043a\u043b\u0438\u043a\u0430 \u043f\u043e \u0440\u0438\u0441\u0443\u043d\u043a\u0443 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435"
            },
            defaultDisplayMode: {
                type: "dropdown",
                args: {
                    items: Object.values(this.DISPLAY_MODE)
                },
                description: "\u0420\u0435\u0436\u0438\u043c \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043e\u043a\u043d\u0430 \u043f\u043b\u0435\u0435\u0440\u0430 \u043f\u0440\u0438 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0438 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435"
            }
        };
        static MODULE = {
            title: "Timelapse Player",
            alias: "pl",
            dependencies: ["GPTimelapsePlayer_"],
            settings: {
                storage: "gp_timelapse-player",
                defaultSettings: this.DEFAULT_SETTINGS,
                ui: this.SETTINGS_UI
            },
            useCSS: !0
        };
        constructor(a) {
            super();
            this.gpproxy = a.gpproxy;
            this.s = a.sm.setSettings(this);
            this.currentPath = null;
            this.onAlbumMiddleClick = this.onAlbumMiddleClick.bind(this);
            this.onAlbumDoubleClick = this.onAlbumDoubleClick.bind(this);
            this.onPreviewMiddleClick = this.onPreviewMiddleClick.bind(this);
            this.onPreviewDoubleClick = this.onPreviewDoubleClick.bind(this);
            document.addEventListener("_url_changed",
                ({
                    detail: {
                        path: b
                    }
                }) => {
                    this.currentPath = b.slice(1)
                });
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: b
                }
            }) => {
                b === GPProxy_.EVENT.TURN_STARTED ? this.closePlayers() : b === GPProxy_.EVENT.GAME_STARTED ? (document.addEventListener("pointerdown", this.onPreviewMiddleClick), document.addEventListener("dblclick", this.onPreviewDoubleClick)) : [GPProxy_.EVENT.ALBUM_INFO, GPProxy_.EVENT.NEW_GAME, GPProxy_.EVENT.ALBUM_SCORE, GPProxy_.EVENT.GAME_QUIT].includes(b) ? (this.closePlayers(), b !== GPProxy_.EVENT.ALBUM_INFO && (document.removeEventListener("pointerdown",
                    this.onAlbumMiddleClick), document.removeEventListener("dblclick", this.onAlbumDoubleClick))) : b === GPProxy_.EVENT.GALLERY_SETTINGS && (document.addEventListener("pointerdown", this.onAlbumMiddleClick), document.addEventListener("dblclick", this.onAlbumDoubleClick), document.removeEventListener("pointerdown", this.onPreviewMiddleClick), document.removeEventListener("dblclick", this.onPreviewDoubleClick))
            });
            this.gpproxy.addEventListener("rejoin", ({
                detail: {
                    stage: b
                }
            }) => {
                switch (b) {
                    case GPProxy_.STAGE.GAME:
                        document.addEventListener("pointerdown",
                            this.onPreviewMiddleClick);
                        document.addEventListener("dblclick", this.onPreviewDoubleClick);
                        break;
                    case GPProxy_.STAGE.ALBUM:
                        document.addEventListener("pointerdown", this.onAlbumMiddleClick), document.addEventListener("dblclick", this.onAlbumDoubleClick)
                }
            })
        }
        onPreviewMiddleClick(a) {
            1 === a.button && this.handleImageClick(a)
        }
        onPreviewDoubleClick(a) {
            0 === a.button && this.s.openPlayerWithDoubleClick && this.handleImageClick(a)
        }
        handleImageClick(a) {
            if (this.isPreviewPanelShown() && "CANVAS" === a.target.tagName && a.target.parentElement.parentElement.classList.contains("core")) {
                const b = {
                    data: this.gpproxy.getPrevImageData(),
                    meta: {
                        author: "",
                        title: "",
                        date: Date.now()
                    }
                };
                a = a.target.parentElement.parentElement;
                const c = document.querySelector(".screen");
                a.isPlayerRendered || this.renderPlayer(b, a, c, GPTimelapsePlayer_.DISPLAY_MODE.NORMAL, !1, !0)
            }
        }
        isPreviewPanelShown() {
            return GPPlayersManager_.PREVIEW_PANEL_PATHS.includes(this.currentPath)
        }
        onAlbumMiddleClick(a) {
            1 === a.button && this.handleAlbumClick(a)
        }
        onAlbumDoubleClick(a) {
            0 === a.button && this.s.openPlayerWithDoubleClick && this.handleAlbumClick(a)
        }
        handleAlbumClick(a) {
            if ("CANVAS" ===
                a.target.tagName && !a.target.parentElement.classList.contains("animation")) {
                var b = a.target.closest(".item");
                if (b) {
                    a = [...b.parentElement.children].filter(d => d.classList.contains("item")).indexOf(b);
                    a = this.gpproxy.getAlbumItem(a);
                    b = b.querySelector(".balloon");
                    var c = document.querySelector(".screen");
                    b.isPlayerRendered || this.renderPlayer(a, b, c)
                }
            }
        }
        renderPlayer(a, b, c, d, e, f) {
            const g = new GPTimelapsePlayer_({
                image: a,
                container: b,
                mainContainer: c
            }, d || this.s.defaultDisplayMode, f);
            (e ?? this.s.autoplay) && g.addEventListener("data-loaded",
                () => {
                    g.play()
                })
        }
        closePlayers() {
            GPTimelapsePlayer_.closeAll()
        }
    }
    window.GPPlayersManager_ = GPPlayersManager_;
    class GPTimelapsePlayer_ extends EventTarget {
        static players = new Set;
        static CACHE_ENABLED = !0;
        static CACHE_INTERVAL = 1E3;
        static ORIGINAL_WIDTH = 758;
        static ORIGINAL_HEIGHT = 424;
        static DENSITY = 1;
        static WIDTH = this.ORIGINAL_WIDTH * this.DENSITY;
        static HEIGHT = this.ORIGINAL_HEIGHT * this.DENSITY;
        static BACKGROUND_COLOR = "#FFFFFF";
        static STROKE_OFFSET = 3;
        static SPEEDS = [
            [1, 1],
            [5, 1],
            [15, 1],
            [30, 1],
            [50, 1],
            [0, 1],
            [0, 2],
            [0, 4],
            [0, 8],
            [0, 16],
            [0, 32]
        ];
        static SPEED = 0;
        static SPEED_SLIDER_WIDTH = 130;
        static SPEED_SLIDER_HEIGHT = 16;
        static SPEED_SLIDER_THUMB_WIDTH = 14;
        static M_STROKE_OFFSET = 67;
        static DISPLAY_MODE = {
            NORMAL: "normal",
            EXPANDED: "expanded",
            FULLSCREEN: "fullscreen"
        };
        static DEFAULT_DISPLAY_MODE = GPTimelapsePlayer_.DISPLAY_MODE.NORMAL;
        static FV2_DATE = 1681366233E3;
        static GARTICPHONE_HOSTNAME_PATTERN = /(^|\.)garticphone\.com$/;
        constructor({
            image: {
                data: a,
                background: b,
                auth: c,
                meta: {
                    author: d,
                    title: e,
                    date: f
                }
            },
            container: g,
            mainContainer: h
        }, k = GPTimelapsePlayer_.DEFAULT_DISPLAY_MODE, l = !1) {
            super();
            GPTimelapsePlayer_.players.add(this);
            this.density = GPTimelapsePlayer_.DENSITY;
            this.width = GPTimelapsePlayer_.WIDTH;
            this.height = GPTimelapsePlayer_.HEIGHT;
            this.originalData = a.slice();
            const [m, n, r] = this.handleDelimiters(a, b);
            this.data = m;
            this.background = n;
            this.auth = c;
            this.author = d;
            this.title = e;
            this.date = new Date(f);
            this.eraserAlpha = !r;
            this.fi = f && this.date.getTime() > GPTimelapsePlayer_.FV2_DATE ? 5 : 4;
            this.container = g;
            this.container.isPlayerRendered = !0;
            this.mainContainer = h;
            this.defaultDisplayMode = k;
            this.defaultDisplayModeDensity = this.getModeDensity(k);
            this.cache;
            this.canvas;
            this.ctx;
            this.isPlaying = !1;
            this.currentSpeed = JSON.parse(localStorage.getItem("gp-timelapse-player-speed")) ||
                GPTimelapsePlayer_.SPEED;
            this.speed = GPTimelapsePlayer_.SPEEDS[this.currentSpeed];
            this.sPos = this.pos = 0;
            this.lastContainerDimension = {
                width: 0,
                height: 0
            };
            this.isContextLayoutShown = this.expandStateBeforeFullscreen = this.isFullscreen = this.isExpanded = !1;
            this.isContextMenuDisabled = l;
            this.isStandalone = !GPTimelapsePlayer_.GARTICPHONE_HOSTNAME_PATTERN.test(location.hostname);
            this.progressBarPointerMoveHandler = this.progressBarPointerMoveHandler.bind(this);
            this.resizeHandler = this.resizeHandler.bind(this);
            this.toggleFullscreen =
                this.toggleFullscreen.bind(this);
            this.playPause = this.playPause.bind(this);
            this.drawing = this.drawing.bind(this);
            this.expand = this.expand.bind(this);
            this.terminate = this.terminate.bind(this);
            this.toggleContextLayout = this.toggleContextLayout.bind(this);
            this.saveImage = this.saveImage.bind(this);
            this.speedViewPointerMoveHandler = this.speedViewPointerMoveHandler.bind(this);
            window.addEventListener("resize", this.resizeHandler);
            this.addEventListener("cache-updated", this.updateCacheHandler);
            this.initData();
            this.initCacheWorker()
        }
        static closeAll() {
            GPTimelapsePlayer_.players.forEach(a => {
                a.terminate()
            })
        }
        updateCacheHandler({
            detail: {
                density: a
            }
        }) {
            if (a === this.defaultDisplayModeDensity) {
                this.render();
                switch (this.defaultDisplayMode) {
                    case GPTimelapsePlayer_.DISPLAY_MODE.EXPANDED:
                        this.expand(!0);
                        break;
                    case GPTimelapsePlayer_.DISPLAY_MODE.FULLSCREEN:
                        this.player.requestFullscreen()
                }
                this.seek(this.data.length);
                this.dispatchEvent(new Event("image-rendered"));
                this.dispatchEvent(new CustomEvent("data-loaded", {
                    detail: {
                        author: this.author,
                        title: this.title,
                        date: this.date.toISOString()
                    }
                }));
                this.removeEventListener("cache-updated",
                    this.updateCacheHandler)
            }
        }
        getModeDensity(a) {
            switch (a) {
                case GPTimelapsePlayer_.DISPLAY_MODE.NORMAL:
                    const {
                        width: b, height: c
                    } = getComputedStyle(this.container);
                    return this.getDensityByDimensions(parseInt(b), parseInt(c)).density;
                case GPTimelapsePlayer_.DISPLAY_MODE.EXPANDED:
                    const {
                        width: d, height: e
                    } = getComputedStyle(this.mainContainer);
                    return this.getDensityByDimensions(parseInt(d), parseInt(e)).density;
                case GPTimelapsePlayer_.DISPLAY_MODE.FULLSCREEN:
                    return this.getDensityByDimensions(window.screen.width,
                        window.screen.height).density
            }
        }
        terminate() {
            document.fullscreenElement === this.player && this.mainContainer.classList.remove("gp-tp-fullscreen_");
            this.pause();
            this.worker.terminate();
            this.cache = this.originalData = this.data = null;
            this.player.remove();
            this.container.isPlayerRendered = !1;
            this.container = null;
            this.speedInput && this.speedInput.remove();
            window.removeEventListener("resize", this.resizeHandler);
            GPTimelapsePlayer_.players.delete(this);
            this.dispatchEvent(new Event("terminated"))
        }
        initData() {
            const a = [];
            for (let b = 0; b < this.data.length; b++) this.data[b].index = b, this.isMStroke(this.data[b]) && a.push(b);
            a.reverse().forEach(b => {
                this.data.splice(b, 1)
            })
        }
        isMStroke(a) {
            return !(1 === a[0] && a[3][0] > GPTimelapsePlayer_.ORIGINAL_WIDTH && a[3][1] > GPTimelapsePlayer_.ORIGINAL_HEIGHT) || a[3][0] - GPTimelapsePlayer_.ORIGINAL_WIDTH - GPTimelapsePlayer_.M_STROKE_OFFSET || a.at(-1)[1] - GPTimelapsePlayer_.ORIGINAL_HEIGHT - GPTimelapsePlayer_.M_STROKE_OFFSET ? !1 : !0
        }
        render() {
            this.player = document.createElement("div");
            this.player.className =
                "timelapse-player_";
            this.player.addEventListener("click", e => {
                e.stopPropagation()
            });
            this.player.addEventListener("pointerdown", e => {
                e.stopPropagation()
            });
            this.player.addEventListener("pointerup", e => {
                e.stopPropagation()
            });
            this.player.addEventListener("mouseup", e => {
                e.stopPropagation()
            });
            this.player.addEventListener("mousedown", e => {
                e.preventDefault();
                e.stopPropagation();
                1 === e.button && (this.isFullscreen ? this.toggleFullscreen() : this.expand())
            }, !0);
            this.player.addEventListener("contextmenu", e => {
                e.stopPropagation();
                e.preventDefault();
                this.toggleContextLayout()
            });
            this.player.addEventListener("fullscreenchange", e => {
                this.isFullscreen = !!document.fullscreenElement;
                this.player.classList.toggle("fullscreen_", this.isFullscreen);
                this.mainContainer.classList.toggle("gp-tp-fullscreen_", this.isFullscreen);
                this.isStandalone && !this.isFullscreen ? this.expand(this.expandStateBeforeFullscreen) : this.resizeHandler()
            });
            this.bgCanvas = document.createElement("canvas");
            this.bgCanvas.className = "background-canvas_";
            this.bgCanvas.width =
                this.width;
            this.bgCanvas.height = this.height;
            this.player.appendChild(this.bgCanvas);
            this.bgCtx = this.bgCanvas.getContext("2d");
            this.bgCtx.fillStyle = GPTimelapsePlayer_.BACKGROUND_COLOR;
            this.bgCtx.fillRect(0, 0, this.bgCanvas.width, this.bgCanvas.height);
            this.background && this.drawFunction(this.bgCtx, this.background, this.density, !1);
            this.canvas = document.createElement("canvas");
            this.canvas.className = "canvas_";
            this.canvas.width = this.width;
            this.canvas.height = this.height;
            this.player.appendChild(this.canvas);
            this.ctx = this.canvas.getContext("2d", {
                willReadFrequently: !0
            });
            this.strokeCanvas = document.createElement("canvas");
            this.strokeCanvas.className = "stroke-canvas_";
            this.strokeCanvas.width = this.width;
            this.strokeCanvas.height = this.height;
            this.player.appendChild(this.strokeCanvas);
            this.strokeCtx = this.strokeCanvas.getContext("2d");
            var a = document.createElement("div");
            a.className = "event-catcher_";
            a.addEventListener("click", this.playPause);
            a.addEventListener("dblclick", this.toggleFullscreen);
            this.player.appendChild(a);
            a = document.createElement("div");
            a.className = "controls_";
            a.style.cssText = "";
            this.player.appendChild(a);
            const b = document.createElement("div");
            b.className = "progress-bar_";
            b.addEventListener("pointermove", e => {
                const [f, , g] = this.getCoords(e);
                d.style.width = `${100*Math.max(0,Math.min(1,f/g))}%`
            }, !0);
            b.addEventListener("pointerdown", e => {
                if (0 === e.button) {
                    var f = this.isPlaying;
                    this.progress.classList.remove("smooth_");
                    this.player.classList.toggle("finished_", this.pos === this.data.length - 1);
                    this.progressBarPointerMoveHandler(e);
                    b.setPointerCapture(e.pointerId);
                    b.addEventListener("pointermove", this.progressBarPointerMoveHandler);
                    b.addEventListener("pointerup", g => {
                        b.removeEventListener("pointermove", this.progressBarPointerMoveHandler);
                        this.progress.classList.add("smooth_");
                        this.player.classList.toggle("finished_", this.pos === this.data.length);
                        f && this.pos < this.data.length && this.play()
                    }, {
                        once: !0
                    })
                }
            });
            a.appendChild(b);
            var c = document.createElement("div");
            c.className = "progress-bar-bg_";
            b.appendChild(c);
            const d = document.createElement("div");
            d.className = "progress-hover_";
            b.appendChild(d);
            this.progress = document.createElement("div");
            this.progress.className = "progress_ smooth_";
            this.updateProgress();
            b.appendChild(this.progress);
            c = document.createElement("div");
            c.className = "play-btn_ btn_";
            c.title = "\u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c/\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u043d\u0438\u0435";
            a.appendChild(c);
            c.addEventListener("click", e => {
                this.playPause()
            });
            c = document.createElement("div");
            c.className = "first-frame-btn_ btn_";
            c.title = "\u041a \u043f\u0435\u0440\u0432\u043e\u043c\u0443 \u0448\u0442\u0440\u0438\u0445\u0443";
            c.addEventListener("click", e => {
                this.seek(0);
                this.updateProgress();
                this.player.classList.remove("finished_")
            });
            a.appendChild(c);
            c = document.createElement("div");
            c.className = "speed-down-btn_ btn_";
            c.title = "\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";
            c.addEventListener("click", e => {
                this.changeSpeed(-1)
            });
            a.appendChild(c);
            c = document.createElement("div");
            c.className = "speed-up-btn_ btn_";
            c.title = "\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";
            c.addEventListener("click", e => {
                this.changeSpeed(1)
            });
            a.appendChild(c);
            c = document.createElement("div");
            c.className = "last-frame-btn_ btn_";
            c.title = "\u041a \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c\u0443 \u0448\u0442\u0440\u0438\u0445\u0443";
            c.addEventListener("click", e => {
                this.seek(this.data.length);
                this.updateProgress();
                this.player.classList.add("finished_")
            });
            a.appendChild(c);
            this.speedView = document.createElement("div");
            this.speedView.className = "speed_";
            this.speedView.title = "\u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";
            this.speedView.textContent = " ";
            this.updateSpeedView();
            a.appendChild(this.speedView);
            this.speedView.addEventListener("pointerdown", e => {
                const {
                    x: f,
                    y: g
                } = this.player.getBoundingClientRect(), h = (e.clientY -
                    g - (e.clientY - e.target.getBoundingClientRect().y)) / this.scaleY;
                this.renderSpeedInput((e.clientX - f) / this.scaleX, h);
                this.speedView.setPointerCapture(e.pointerId);
                this.speedView.addEventListener("pointermove", this.speedViewPointerMoveHandler);
                this.speedView.addEventListener("pointerup", k => {
                    this.speedView.removeEventListener("pointermove", this.speedViewPointerMoveHandler);
                    this.speedInput?.remove()
                }, {
                    once: !0
                })
            });
            this.strokeNumView = document.createElement("div");
            this.strokeNumView.className = "stroke_";
            this.strokeNumView.title =
                "\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0448\u0442\u0440\u0438\u0445";
            this.strokeNumView.textContent = " ";
            this.updateStrokeView();
            a.appendChild(this.strokeNumView);
            a.appendChild(document.createElement("span"));
            c = document.createElement("div");
            c.className = "expand-btn_ btn_";
            c.title = "\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c/\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c";
            c.addEventListener("click", e => {
                this.expand()
            });
            a.appendChild(c);
            c = document.createElement("div");
            c.className =
                "fullscreen-btn_ btn_";
            c.title = "\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043d\u0430 \u0432\u0435\u0441\u044c \u044d\u043a\u0440\u0430\u043d";
            c.addEventListener("click", this.toggleFullscreen);
            a.appendChild(c);
            a = document.createElement("div");
            a.className = "close-btn_";
            a.title = "\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u043f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u0442\u0435\u043b\u044c";
            a.addEventListener("click", this.terminate);
            this.player.appendChild(a);
            this.contextLayout =
                document.createElement("div");
            this.contextLayout.className = "context-layout_";
            this.contextLayout.addEventListener("click", this.toggleContextLayout);
            a = document.createElement("div");
            a.className = "save-img-data-btn_ btn_";
            a.title = "\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a";
            a.addEventListener("click", e => {
                e.stopPropagation();
                this.saveImageData()
            });
            this.contextLayout.appendChild(a);
            a = document.createElement("div");
            a.className = "save-img-btn_ btn_";
            a.title = "\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435";
            a.addEventListener("click", e => {
                e.stopPropagation();
                this.saveImage()
            });
            this.contextLayout.appendChild(a);
            this.player.appendChild(this.contextLayout);
            this.container.firstElementChild.before(this.player);
            this.resizeHandler()
        }
        toggleContextLayout() {
            this.isContextMenuDisabled || (this.pause(), this.isContextLayoutShown = !this.isContextLayoutShown, this.player.classList.toggle("context-menu_",
                this.isContextLayoutShown))
        }
        updateSpeedView() {
            let a = Number(!this.speed[0]);
            this.speedView.firstChild.nodeValue = `x${a?100*this.speed[a]:this.speed[a]}`
        }
        updateStrokeView() {
            this.strokeNumView.firstChild.nodeValue = `${this.pos} / ${this.data.length}`
        }
        resizeHandler() {
            const a = this.isPlaying;
            this.pause();
            if (document.fullscreenElement === this.player) this.setSize(document.documentElement.clientWidth, document.documentElement.clientHeight);
            else {
                const d = this.isExpanded ? this.mainContainer : this.container;
                let {
                    width: e,
                    height: f
                } = getComputedStyle(d);
                e = parseInt(e);
                f = parseInt(f);
                const {
                    width: g,
                    height: h
                } = this.lastContainerDimension;
                if (d !== this.mainContainer || e !== g || f !== h) this.setSize(e, f), this.lastContainerDimension = {
                    width: e,
                    height: f
                }
            }
            a && this.play();
            const {
                width: b,
                height: c
            } = this.mainContainer.getBoundingClientRect();
            this.scaleX = b / this.mainContainer.offsetWidth;
            this.scaleY = c / this.mainContainer.offsetHeight
        }
        getDensityByDimensions(a, b) {
            a = Math.min(Math.ceil(a / GPTimelapsePlayer_.ORIGINAL_WIDTH), Math.ceil(b / GPTimelapsePlayer_.ORIGINAL_HEIGHT));
            return {
                density: a,
                canvasWidth: GPTimelapsePlayer_.ORIGINAL_WIDTH * a,
                canvasHeight: GPTimelapsePlayer_.ORIGINAL_HEIGHT * a
            }
        }
        setSize(a, b) {
            const {
                density: c,
                canvasWidth: d,
                canvasHeight: e
            } = this.getDensityByDimensions(a, b), {
                width: f,
                height: g
            } = this.calculateAspectRatioFit(GPTimelapsePlayer_.ORIGINAL_WIDTH, GPTimelapsePlayer_.ORIGINAL_HEIGHT, a, b);
            a = document.documentElement.style;
            a.setProperty("--timelapse-player-width", `${Math.round(f)}px`);
            a.setProperty("--timelapse-player-height", `${Math.round(g)}px`);
            this.density =
                c;
            this.width = d;
            this.height = e;
            this.bgCanvas.width = d;
            this.bgCanvas.height = e;
            this.canvas.width = d;
            this.canvas.height = e;
            this.strokeCanvas.width = d;
            this.strokeCanvas.height = e;
            this.redraw()
        }
        redraw() {
            this.pause();
            if (this.background) {
                this.clearBackground();
                var a = this.getCache();
                this.cache[this.density] ? (a = a.at(-1), this.bgCtx.putImageData(a, 0, 0)) : this.drawFunction(this.bgCtx, this.background, this.density, !1)
            } else this.bgCtx.fillStyle = GPTimelapsePlayer_.BACKGROUND_COLOR, this.bgCtx.fillRect(0, 0, this.bgCanvas.width,
                this.bgCanvas.height);
            this.clearCanvas();
            a = this.data.slice(0, this.pos);
            this.draw(this.ctx, a);
            this.clearStroke();
            this.stroke && (a = this.stroke.slice(0, GPTimelapsePlayer_.STROKE_OFFSET + this.sPos + 1), this.draw(this.strokeCtx, [a], this.density, !1))
        }
        calculateAspectRatioFit(a, b, c, d) {
            c = Math.min(c / a, d / b);
            return {
                width: a * c,
                height: b * c
            }
        }
        expand(a) {
            this.isExpanded = a ?? !this.isExpanded;
            this.player.classList.toggle("expanded_", this.isExpanded);
            this.isExpanded ? this.mainContainer.appendChild(this.player) : this.container.firstElementChild.before(this.player);
            this.resizeHandler();
            this.isStandalone && document.dispatchEvent(new CustomEvent("gp:player.display_mode_changed", {
                detail: {
                    displayMode: this.isExpanded ? GPTimelapsePlayer_.DISPLAY_MODE.EXPANDED : GPTimelapsePlayer_.DISPLAY_MODE.NORMAL
                }
            }))
        }
        playPause() {
            this.isPlaying ? this.pause() : this.play()
        }
        play(a = this.pos) {
            a || this.clearCanvas();
            this.isPlaying = !0;
            this.updateProgress();
            this.player.classList.add("playing_");
            setTimeout(() => {
                this.player.classList.remove("finished_")
            }, 24);
            this.timer = requestAnimationFrame(this.drawing)
        }
        pause() {
            this.isPlaying = !1;
            cancelAnimationFrame(this.timer);
            this.player.classList.remove("playing_")
        }
        stop() {
            this.pause();
            this.pos = 0;
            this.updateProgress()
        }
        seek(a) {
            this.pause();
            a = Math.max(0, Math.min(this.data.length, a));
            if (a !== this.pos || !a) {
                this.clearStroke();
                if (a < this.pos || !this.pos) {
                    this.clearCanvas();
                    var b = this.data.slice(0, a)
                } else b = this.data.slice(this.pos, a);
                this.draw(this.ctx, b);
                this.pos = a;
                this.sPos = 0;
                this.stroke = null;
                this.updateStrokeView()
            }
        }
        drawing() {
            if (this.stroke) this.drawingStroke(this.stroke);
            else if (this.pos <
                this.data.length) {
                const a = this.data.slice(this.pos, this.pos + this.speed[1]),
                    b = a.at(-1);
                this.speed[0] && [1, 2].includes(b[0]) ? (this.sPos = 0, this.stroke = b, this.drawingStroke(b)) : (this.draw(this.ctx, a), this.pos = Math.min(this.data.length, this.pos + this.speed[1]), this.pos < this.data.length ? this.timer = requestAnimationFrame(this.drawing) : (this.player.classList.add("finished_"), this.pause()), this.updateProgress(), this.updateStrokeView())
            } else this.pos = 0, this.updateProgress(), this.play()
        }
        drawingStroke(a) {
            if (this.speed[0] &&
                this.sPos < a.length - GPTimelapsePlayer_.STROKE_OFFSET) {
                const b = a.slice(0, GPTimelapsePlayer_.STROKE_OFFSET + this.sPos + 1);
                this.sPos += this.speed[0];
                this.clearStroke();
                this.draw(this.strokeCtx, [b], this.density, !1);
                this.timer = requestAnimationFrame(() => {
                    this.drawingStroke(a)
                })
            } else this.sPos = 0, this.pos = Math.min(this.data.length, this.pos + this.speed[1]), this.clearStroke(), this.draw(this.ctx, [a]), this.updateProgress(), this.updateStrokeView(), this.stroke = null, this.pos < this.data.length ? this.timer = requestAnimationFrame(this.drawing) :
                (this.player.classList.add("finished_"), this.pause())
        }
        changeSpeed(a, b) {
            this.currentSpeed = Math.max(0, Math.min(GPTimelapsePlayer_.SPEEDS.length - 1, b ?? this.currentSpeed + a));
            this.speed = GPTimelapsePlayer_.SPEEDS[this.currentSpeed];
            localStorage.setItem("gp-timelapse-player-speed", JSON.stringify(this.currentSpeed));
            this.updateSpeedView()
        }
        speedViewPointerMoveHandler(a) {
            a = (a.clientX - this.player.getBoundingClientRect().x) / this.scaleX;
            a = Math.round(Math.max(0, Math.min(GPTimelapsePlayer_.SPEED_SLIDER_WIDTH - GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH,
                a - this.speedInput.currentX)) / ((GPTimelapsePlayer_.SPEED_SLIDER_WIDTH - GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH) / (GPTimelapsePlayer_.SPEEDS.length - 1)));
            this.speedInput.value = a;
            this.changeSpeed(null, a)
        }
        renderSpeedInput(a, b) {
            if (!this.speedInput) {
                this.speedInput = document.createElement("input");
                this.speedInput.className = "speed-slider_";
                this.speedInput.type = "range";
                this.speedInput.min = 0;
                this.speedInput.max = GPTimelapsePlayer_.SPEEDS.length - 1;
                this.speedInput.style.width = `${GPTimelapsePlayer_.SPEED_SLIDER_WIDTH}px`;
                this.speedInput.style.height = `${GPTimelapsePlayer_.SPEED_SLIDER_HEIGHT}px`;
                var c = GPTimelapsePlayer_.SPEEDS.findIndex(([d]) => !d);
                this.speedInput.style.setProperty("--bg-separator", `${Math.round(c/GPTimelapsePlayer_.SPEEDS.length*100)+Math.round(GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH/GPTimelapsePlayer_.SPEED_SLIDER_WIDTH*100)/2}%`)
            }
            this.speedInput.value = this.currentSpeed;
            c = (GPTimelapsePlayer_.SPEED_SLIDER_WIDTH - GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH) / (GPTimelapsePlayer_.SPEEDS.length - 1) * Number(this.speedInput.value);
            this.speedInput.style.top = `${b-GPTimelapsePlayer_.SPEED_SLIDER_HEIGHT-10}px`;
            this.speedInput.style.left = `${a-c-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH/2}px`;
            this.player.appendChild(this.speedInput);
            this.speedInput.currentX = a - c
        }
        clearBackground() {
            this.bgCtx.fillStyle = GPTimelapsePlayer_.BACKGROUND_COLOR;
            this.bgCtx.fillRect(0, 0, this.width, this.height)
        }
        clearCanvas() {
            this.ctx.clearRect(0, 0, this.width, this.height)
        }
        clearStroke() {
            this.strokeCtx.clearRect(0, 0, this.width, this.height)
        }
        updateProgress(a = this.pos) {
            this.progress.style.width =
                `${Math.round(a/this.data.length*100)}%`
        }
        splitStroke(a) {
            const [b, c, d, ...e] = a;
            if (1 === b || 2 === b) {
                a = [];
                for (let f = 1; f <= e.length; f++) a.push([b, c, d, ...e.slice(0, f)]);
                return a
            }
            return [a]
        }
        getCoords(a, b) {
            b = (b || a.target).getBoundingClientRect();
            const [c, d] = a.touches ? [a.touches[0].clientX, a.touches[0].clientY] : [a.clientX, a.clientY], [e, f] = [c - b.left, d - b.top];
            return [Math.round(e), Math.round(f), b.width, b.height]
        }
        progressBarPointerMoveHandler(a) {
            const [b, , c] = this.getCoords(a);
            a = Math.max(0, Math.min(1, b / c));
            const d =
                Math.round(this.data.length * a);
            this.progress.style.width = `${100*a}%`;
            this.seek(d)
        }
        toggleFullscreen() {
            document.fullscreenElement ? document.exitFullscreen() : (this.expandStateBeforeFullscreen = this.isExpanded, this.expand(!1), this.player.requestFullscreen())
        }
        saveImage() {
            var a = document.createElement("canvas");
            a.width = this.width;
            a.height = this.height;
            var b = a.getContext("2d");
            this.draw(b, this.data, this.density, this.eraserAlpha);
            b = document.createElement("canvas");
            b.width = this.width;
            b.height = this.height;
            var c =
                b.getContext("2d");
            c.fillStyle = GPTimelapsePlayer_.BACKGROUND_COLOR;
            c.fillRect(0, 0, this.width, this.height);
            if (this.background) {
                var d = this.getCache();
                this.cache[this.density] ? (d = d.at(-1), c.putImageData(d, 0, 0)) : this.drawFunction(c, this.background, this.density, !1)
            }
            c = document.createElement("canvas");
            c.width = this.width;
            c.height = this.height;
            d = c.getContext("2d");
            d.drawImage(b, 0, 0, this.width, this.height);
            d.drawImage(a, 0, 0, this.width, this.height);
            a = this.date.toLocaleDateString("ru-RU");
            a = `${this.author} - ${this.title} (${a}).png`;
            b = document.createElement("a");
            b.href = c.toDataURL();
            b.download = a;
            b.click()
        }
        async saveImageData() {
            var a = this.date.toLocaleDateString("ru-RU");
            a = `${this.author} - ${this.title} (${a}).gpimg`;
            var b = {
                m: {
                    a: this.author,
                    t: this.title,
                    d: this.date.toISOString()
                },
                d: this.originalData
            };
            this.background && (b.b = this.background);
            this.auth && (b.a = this.auth);
            b = await GPUtils_.wCompressData(b);
            GPUtils_.saveBlob(b, a)
        }
        getCache() {
            this.cache?.[this.density] || this.updateCache();
            return this.cache[this.density]
        }
        updateCache() {
            const a =
                this.cache || {};
            a[this.density] || this.worker.postMessage({
                type: "get-cache",
                density: this.density
            });
            this.cache = a
        }
        draw(a, b, c, d, e = !0) {
            if (b) {
                var f = GPTimelapsePlayer_.CACHE_INTERVAL;
                if (GPTimelapsePlayer_.CACHE_ENABLED && e && b.length > f)
                    if (e = this.getCache(), !this.cache[this.density] && b.at(-1).index + 1 < f) this.drawFunction(a, b, c, d);
                    else {
                        const g = Math.floor((b.at(-1).index + 1) / f) - 1;
                        a.putImageData(e[g], 0, 0);
                        b = b.slice(-(b.at(-1).index + 1 - (g + 1) * f));
                        this.drawFunction(a, b, c, d)
                    }
                else this.drawFunction(a, b, c, d)
            }
        }
        drawFunction(a,
            b, c = this.density, d = this.eraserAlpha, e = !1) {
            GPUtils_.drawFunction(a, b, c, d, e)
        }
        handleDelimiters(a, b) {
            const c = a.findLastIndex(d => 11 === d[0]);
            if (~c) {
                const d = a.slice(c + 1);
                a = (b ?? []).concat(a.slice(0, c).filter(e => 11 !== e[0]));
                return [d, a, !0]
            }
            return [a, b, !1]
        }
        initCacheWorker() {
            let {
                width: a,
                height: b
            } = getComputedStyle(this.container);
            a = parseInt(a);
            b = parseInt(b);
            var {
                density: c
            } = this.getDensityByDimensions(a, b);
            let {
                width: d,
                height: e
            } = getComputedStyle(this.mainContainer);
            d = parseInt(d);
            e = parseInt(e);
            const {
                density: f
            } =
            this.getDensityByDimensions(d, e), {
                density: g
            } = this.getDensityByDimensions(window.screen.width, window.screen.height), h = [...(new Set([c, f, g]))];
            this.worker || (c = URL.createObjectURL(new Blob([this.getFuncBody(this.cacheWorkerBody)])), this.worker = new Worker(c), URL.revokeObjectURL(c), this.worker.addEventListener("message", ({
                data: k
            }) => {
                "worker-ready" === k.type ? h.forEach(l => {
                    this.worker.postMessage({
                        type: "get-cache",
                        density: l
                    })
                }) : "cache-updated" === k.type && (this.cache = k.cache, this.dispatchEvent(new CustomEvent("cache-updated", {
                    detail: {
                        density: k.density
                    }
                })))
            }));
            this.worker.postMessage({
                type: "init",
                data: this.data,
                background: this.background,
                eraserAlpha: this.eraserAlpha,
                drawFunctionString: GPUtils_.drawFunctionString,
                fi: this.fi,
                CACHE_INTERVAL: GPTimelapsePlayer_.CACHE_INTERVAL,
                ORIGINAL_WIDTH: GPTimelapsePlayer_.ORIGINAL_WIDTH,
                ORIGINAL_HEIGHT: GPTimelapsePlayer_.ORIGINAL_HEIGHT,
                BACKGROUND_COLOR: GPTimelapsePlayer_.BACKGROUND_COLOR
            })
        }
        cacheWorkerBody() {
            function a(f) {
                var g = b * f,
                    h = c * f;
                if (!this.cache[f]) {
                    this.cache[f] = [];
                    const l = e,
                        m =
                        Math.floor(self.data.length / l);
                    g = new OffscreenCanvas(g, h);
                    h = g.getContext("2d", {
                        willReadFrequently: !0
                    });
                    let n;
                    self.background && (h.fillStyle = d, h.fillRect(0, 0, g.width, g.height), self.draw(h, this.background, f, !1), n = h.getImageData(0, 0, g.width, g.height), h.clearRect(0, 0, g.width, g.height));
                    for (let r = 0; r < m; r++) {
                        var k = r * l;
                        k = self.data.slice(k, k + l);
                        self.draw(h, k, f, self.eraserAlpha);
                        k = h.getImageData(0, 0, g.width, g.height);
                        this.cache[f].push(k)
                    }
                    self.background && this.cache[f].push(n)
                }
            }
            let b, c, d, e;
            self.data;
            self.draw;
            self.cache = [];
            self.addEventListener("message", ({
                data: f
            }) => {
                "init" === f.type ? (self.data = f.data, self.background = f.background, self.eraserAlpha = f.eraserAlpha, self.fi = f.fi, self.draw = (new Function(`return ${f.drawFunctionString}`))(), e = f.CACHE_INTERVAL, b = f.ORIGINAL_WIDTH, c = f.ORIGINAL_HEIGHT, d = f.BACKGROUND_COLOR, self.postMessage({
                    type: "worker-ready"
                })) : "get-cache" === f.type && (self.cache[f.density] || a(f.density), self.postMessage({
                    type: "cache-updated",
                    cache: self.cache,
                    density: f.density
                }))
            })
        }
        getFuncBody(a) {
            a =
                a.toString();
            return a.substring(a.indexOf("{") + 1, a.lastIndexOf("}"))
        }
    }
    window.GPTimelapsePlayer_ = GPTimelapsePlayer_;
    class GPTimer_ extends EventTarget {
        static STARTED = "started";
        static PAUSED = "paused";
        static STOPPED = "stopped";
        static SETTING = "setting";
        static SOUND_ALERT_URL = "https://garticphone.com/sounds/timeout.mp3";
        static SETTING_MINUTE_STEP = 5;
        static POINTER_TIMER_CHANGE_SENSITIVITY = Math.round(window.screen.height / 1080 * 15);
        static DEFAULT_SETTINGS = {
            reverted: !0,
            delimiterFlicker: !0,
            soundAlert: !0,
            soundAlertVolume: 1,
            runAfterTurnStart: !1,
            readyAfterTimeExpires: !1,
            defaultTimer: "1800000",
            timers: []
        };
        static SETTINGS_UI = {
            reverted: {
                type: "switch",
                description: "\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043e\u0442\u0441\u0447\u0451\u0442\u0430 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0432 \u043e\u0431\u0440\u0430\u0442\u043d\u043e\u043c \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0438"
            },
            delimiterFlicker: {
                type: "switch",
                description: "\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043c\u0435\u0440\u0446\u0430\u043d\u0438\u0435 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044f \u0447\u0430\u0441\u043e\u0432 \u0438 \u043c\u0438\u043d\u0443\u0442"
            },
            _2: {
                text: "Sound Alert"
            },
            soundAlert: {
                type: "switch",
                description: "\u0417\u0432\u0443\u043a\u043e\u0432\u043e\u0435 \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u0435, \u0441\u0438\u0433\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u044e\u0449\u0435\u0435 \u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438"
            },
            soundAlertVolume: {
                type: "slider",
                args: {
                    min: 0,
                    max: 1,
                    step: .01
                },
                formatter: this.volumeFormatter,
                description: "\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0433\u0440\u043e\u043c\u043a\u043e\u0441\u0442\u0438 \u0437\u0432\u0443\u043a\u043e\u0432\u043e\u0433\u043e \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u044f"
            },
            _3: {
                text: "Triggers"
            },
            runAfterTurnStart: {
                type: "switch",
                description: "\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u0442\u0430\u0439\u043c\u0435\u0440 \u043f\u043e\u0441\u043b\u0435 \u043d\u0430\u0447\u0430\u043b\u0430 \u0440\u0430\u0443\u043d\u0434\u0430"
            },
            readyAfterTimeExpires: {
                type: "switch",
                description: "\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043d\u0430\u0436\u0438\u043c\u0430\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443 \u0433\u043e\u0442\u043e\u0432\u043d\u043e\u0441\u0442\u0438 \u043f\u043e \u0438\u0441\u0442\u0435\u0447\u0435\u043d\u0438\u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438"
            },
            _4: {
                text: "Timers"
            },
            defaultTimer: {
                type: "dropdown",
                args: {
                    items: this.DEFAULT_SETTINGS.timers,
                    itemsProxySetting: "timers"
                },
                formatter: this.timeFormatter,
                description: "\u0422\u0430\u0439\u043c\u0435\u0440 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u0432\u0445\u043e\u0434\u0435 \u043d\u0430 \u0441\u0430\u0439\u0442)"
            },
            timers: {
                type: "list-md",
                formatter: this.timeFormatter,
                description: "\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0432\u0430\u043c\u0438 \u0442\u0430\u0439\u043c\u0435\u0440\u043e\u0432"
            }
        };
        static timeFormatter(a) {
            return `${Math.floor(a/
36E5)}:${String(Math.floor(a/6E4)%60).padStart(2,"0")}`
        }
        static volumeFormatter(a) {
            return `${Math.round(100*a)}`
        }
        static MODULE = {
            title: "Timer",
            alias: "tmr",
            settings: {
                storage: "gp_timer",
                defaultSettings: this.DEFAULT_SETTINGS,
                ui: this.SETTINGS_UI
            },
            useCSS: !0
        };
        constructor(a) {
            if (GPTimer_.instance) return GPTimer_.instance;
            super();
            GPTimer_.instance = this;
            this.s = a.sm.setSettings(this, this.updateSettings);
            this.timer;
            this.value = +this.s.defaultTimer;
            this.timeStarted;
            this.timePaused;
            this.elapsed = 0;
            this.state = GPTimer_.STOPPED;
            this.onPointerDown = this.onPointerDown.bind(this);
            this.onWheel = this.onWheel.bind(this);
            this.onTimerChange = this.onTimerChange.bind(this);
            this.onAddBtnClick = this.onAddBtnClick.bind(this);
            this.render()
        }
        static getInstance() {
            return this.instance
        }
        getElement() {
            return this.container
        }
        render() {
            this.container = document.createElement("div");
            this.container.className = "gp-timer_";
            this.container.dataset.state = this.state;
            this.container.addEventListener("pointerdown", this.onPointerDown);
            this.container.addEventListener("wheel",
                this.onWheel);
            this.container.addEventListener("contextmenu", b => {
                b.preventDefault()
            });
            this.hours = document.createElement("div");
            this.hours.className = "hours_";
            this.hours.addEventListener("pointerdown", this.onTimerChange);
            this.minutes = document.createElement("div");
            this.minutes.className = "minutes_";
            this.minutes.addEventListener("pointerdown", this.onTimerChange);
            this.seconds = document.createElement("div");
            this.seconds.className = "seconds_";
            this.delimiter = document.createElement("div");
            this.delimiter.className =
                "delimiter_";
            this.delimiter.classList.toggle("flicker_", this.s.delimiterFlicker);
            this.delimiter.textContent = ":";
            this.addBtn = document.createElement("div");
            this.addBtn.className = "add-btn_";
            this.addBtn.textContent = "+";
            this.addBtn.addEventListener("click", this.onAddBtnClick);
            this.container.appendChild(this.hours);
            this.container.appendChild(this.delimiter);
            this.container.appendChild(this.minutes);
            this.container.appendChild(this.seconds);
            this.container.appendChild(this.addBtn);
            const a = this.formatTime(this.value);
            this.renderTime(a);
            this.alert = new Audio(GPTimer_.SOUND_ALERT_URL);
            this.alert.src = GPTimer_.SOUND_ALERT_URL
        }
        onPointerDown(a) {
            if (0 === a.button && !a.ctrlKey) this.playPause();
            else if (2 === a.button) this.revertTime();
            else if (1 === a.button || 0 === a.button && a.ctrlKey) this.state === GPTimer_.STARTED ? this.reset() : this.toggleSetting()
        }
        onWheel(a) {
            var b = 0 > a.deltaY;
            switch (this.state) {
                case GPTimer_.SETTING:
                    var c = Number.parseInt(this.hours.textContent);
                    let d = Number.parseInt(this.minutes.textContent);
                    switch (a.target) {
                        case this.hours:
                            c +=
                                b ? 1 : -1;
                            c = (0 > c ? c + 24 : c) % 24;
                            break;
                        case this.minutes:
                            d += (b ? 1 : -1) * GPTimer_.SETTING_MINUTE_STEP, d = (0 > d ? d + 60 : d) % 60
                    }
                    this.value = 36E5 * Math.max(Math.min(c, 24), 0) + 6E4 * Math.max(Math.min(d, 55), 0);
                    b = this.formatTime(this.value);
                    this.renderTime(b);
                    break;
                case GPTimer_.STARTED:
                    a = this.s.timers.length, c = this.s.timers.findIndex(e => +e === this.value), ~c ? (b = c + (b ? -1 : 1), this.value = +this.s.timers[(0 > b ? b + a : b) % a]) : a && (this.value = +this.s.timers[0]), this.reset()
            }
        }
        onTimerChange(a) {
            if (this.state === GPTimer_.SETTING) {
                var b = a.clientY,
                    c = d => {
                        var e = d.clientY - b,
                            f = 0 > e;
                        if (Math.abs(e) >= GPTimer_.POINTER_TIMER_CHANGE_SENSITIVITY) {
                            e = Number.parseInt(this.hours.textContent);
                            let g = Number.parseInt(this.minutes.textContent);
                            switch (d.currentTarget) {
                                case this.hours:
                                    e += f ? 1 : -1;
                                    e = (0 > e ? e + 24 : e) % 24;
                                    break;
                                case this.minutes:
                                    g += (f ? 1 : -1) * GPTimer_.SETTING_MINUTE_STEP, g = (0 > g ? g + 60 : g) % 60
                            }
                            this.value = 36E5 * Math.max(Math.min(e, 24), 0) + 6E4 * Math.max(Math.min(g, 55), 0);
                            f = this.formatTime(this.value);
                            this.renderTime(f);
                            b = d.clientY
                        }
                    };
                a.currentTarget.setPointerCapture(a.pointerId);
                a.currentTarget.addEventListener("pointermove", c);
                a.currentTarget.addEventListener("pointerup", d => {
                    d.currentTarget.removeEventListener("pointermove", c)
                }, {
                    once: !0
                })
            }
        }
        onAddBtnClick(a) {
            this.value && !this.s.timers.includes(String(this.value)) && (this.s.timers = [...this.s.timers, String(this.value)].sort((b, c) => c - b))
        }
        toggleSetting() {
            this.state !== GPTimer_.SETTING ? (this.reset(), this.updateState(GPTimer_.SETTING)) : this.updateState(GPTimer_.STOPPED)
        }
        revertTime(a) {
            this.state === GPTimer_.STARTED && (void 0 === a && (this.s.reverted =
                a = !this.s.reverted), this.container.classList.remove("last-minute_"), a = this.formatTime(a ? Math.max(this.value - this.elapsed, 0) : Math.min(this.elapsed, this.value)), this.renderTime(a))
        }
        renderTime({
            h: a,
            m: b,
            s: c
        }) {
            this.hours.textContent = a;
            this.minutes.textContent = String(b).padStart(2, "0");
            this.state !== GPTimer_.STARTED || !this.s.reverted || a || b || (this.container.classList.add("last-minute_"), this.seconds.textContent = String(c).padStart(2, "0"))
        }
        tick() {
            this.elapsed = Date.now() - this.timeStarted;
            const a = this.formatTime(this.s.reverted ?
                Math.max(this.value - this.elapsed, 0) : Math.min(this.elapsed, this.value));
            this.renderTime(a);
            this.elapsed >= this.value && (this.stop(), this.s.soundAlert && !this.s.readyAfterTimeExpires && this.runAlert(), this.dispatchEvent(new Event("finish")), this.container.classList.add("finished_"))
        }
        playPause() {
            switch (this.state) {
                case GPTimer_.STOPPED:
                case GPTimer_.PAUSED:
                    this.start();
                    break;
                case GPTimer_.STARTED:
                    this.pause()
            }
        }
        start() {
            clearInterval(this.timer);
            this.container.classList.remove("finished_");
            this.state === GPTimer_.STOPPED ?
                this.timeStarted = Date.now() : this.state === GPTimer_.PAUSED && (this.timeStarted = Date.now() - (this.timePaused - this.timeStarted));
            this.timer = setInterval(this.tick.bind(this), 1E3);
            this.updateState(GPTimer_.STARTED);
            this.tick()
        }
        pause() {
            this.timePaused = Date.now();
            clearInterval(this.timer);
            this.updateState(GPTimer_.PAUSED)
        }
        stop() {
            this.container.classList.remove("last-minute_");
            clearInterval(this.timer);
            this.updateState(GPTimer_.STOPPED)
        }
        reset() {
            this.stop();
            this.elapsed = 0;
            const a = this.formatTime(this.value, !0);
            this.renderTime(a);
            this.container.classList.remove("finished_")
        }
        formatTime(a) {
            return {
                h: Math.floor(a / 36E5),
                m: Math.floor(a / 6E4) % 60,
                s: Math.round(a / 1E3) % 61
            }
        }
        runAlert(a = 0) {
            this.alert.currentTime = a;
            this.alert.play()
        }
        updateState(a) {
            this.state = a;
            this.container.dataset.state = a
        }
        updateSettings({
            detail: {
                settings: a
            }
        }) {
            "reverted" in a && this.revertTime(a.reverted);
            "delimiterFlicker" in a && this.delimiter.classList.toggle("flicker_", a.delimiterFlicker);
            "soundAlertVolume" in a && (this.alert.volume = Number.parseFloat(a.soundAlertVolume),
                1 === Object.keys(a).length && this.runAlert(.3));
            "defaultTimer" in a && this.state === GPTimer_.STOPPED && (this.value = +a.defaultTimer)
        }
    }
    window.GPTimer_ = GPTimer_;
    class GPKnownUsersDB_ extends EventTarget {
        static READ = "readonly";
        static WRITE = "readwrite";
        static DB_NAME = "gp_users_db";
        static STORE_NAME = "users";
        static USERS_LIMIT = 1E4;
        constructor() {
            super();
            this.db = null;
            this.init()
        }
        init() {
            return new Promise((a, b) => {
                const c = window.indexedDB.open(GPKnownUsersDB_.DB_NAME, 1);
                c.addEventListener("error", d => {
                    console.error("Users Database Request Error:", d.target.errorCode);
                    b(d.target.errorCode)
                });
                c.addEventListener("success", d => {
                    d = d.target.result;
                    d.addEventListener("error",
                        e => {
                            console.error("Users Database Error:", e.target.errorCode)
                        });
                    this.db = d;
                    this.dispatchEvent(new CustomEvent("init", {
                        detail: d
                    }));
                    a(d)
                });
                c.addEventListener("upgradeneeded", d => {
                    d = d.target.result.createObjectStore(GPKnownUsersDB_.STORE_NAME, {
                        keyPath: "username"
                    });
                    d.createIndex("username", "username", {
                        unique: !0
                    });
                    d.createIndex("last_seen", "last_seen")
                })
            })
        }
        async hasUsers(a) {
            const b = new Set;
            if (!this.db) return b;
            const c = await this.getStore(GPKnownUsersDB_.READ);
            (await Promise.all(a.map(d => this.getUser(d, c)))).forEach(d => {
                null !== d && b.add(d)
            });
            return b
        }
        async hasUser(a, b) {
            return null !== await this.getUser(a, b) ? !0 : !1
        }
        getUser(a, b) {
            return this.db ? new Promise(async c => {
                b ||= await this.getStore(GPKnownUsersDB_.READ);
                const d = b.getKey(a);
                d.addEventListener("success", e => {
                    c(e.target.result ?? null)
                });
                d.addEventListener("error", () => {
                    c(null)
                })
            }) : Promise.resolve(null)
        }
        async addUsers(a) {
            if (a?.length)
                for (let b of a) await this.addUser(b)
        }
        addUser(a, b) {
            return this.db ? new Promise(async c => {
                var d = {
                    username: a,
                    last_seen: Date.now()
                };
                b ||= await this.getStore(GPKnownUsersDB_.WRITE);
                d = b.put(d);
                d.addEventListener("success", async e => {
                    await this.size() > GPKnownUsersDB_.USERS_LIMIT && await this.clean();
                    c(!0)
                });
                d.addEventListener("error", e => {
                    c(!1)
                })
            }) : Promise.resolve(!1)
        }
        async deleteUser(a) {
            this.db && (await this.getStore(GPKnownUsersDB_.WRITE)).delete(a)
        }
        async clean() {
            if (this.db) {
                var a = await this.size() - GPKnownUsersDB_.USERS_LIMIT;
                if (!(0 >= a)) {
                    var b = await this.getStore(GPKnownUsersDB_.WRITE);
                    b.index("last_seen").openKeyCursor(null, "next").addEventListener("success", c => {
                        (c = c.target.result) &&
                        a && (b.delete(c.primaryKey), a--, c.continue())
                    })
                }
            }
        }
        size() {
            return new Promise(async a => {
                (await this.getStore(GPKnownUsersDB_.READ)).count().addEventListener("success", b => {
                    a(b.target.result)
                })
            })
        }
        async getStore(a) {
            try {
                return this.db.transaction([GPKnownUsersDB_.STORE_NAME], a).objectStore(GPKnownUsersDB_.STORE_NAME)
            } catch (b) {
                return await this.init(), this.getStore(a)
            }
        }
    }
    window.GPKnownUsersDB_ = GPKnownUsersDB_;
    class GPModeration_ extends EventTarget {
        static TWITCH_APP_CLIENT_ID = "qrohytuwdc7d3uns3gnvtb4esylpqy";
        static TWITCH_APP_SCOPES = "moderator:manage:banned_users";
        static TWITCH_APP_REDIRECT_URI = "https://gpmod.github.io/twitch-token?WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW&tokenType={token-type}";
        static TWITCH_AUTH_URL = `https://id.twitch.tv/oauth2/authorize?client_id=${this.TWITCH_APP_CLIENT_ID}&redirect_uri=${encodeURIComponent(this.TWITCH_APP_REDIRECT_URI)}&response_type=token&scope=${this.TWITCH_APP_SCOPES}`;
        static TWITCH_BANS_API = "https://api.twitch.tv/helix/moderation/bans";
        static NEW_ACCOUNT_PERIODS = ["3600000",
            "86400000", "604800000", "2678400000"
        ];
        static NEW_ACCOUNT_PERIODS_ALIASES = ["Hour", "Day", "Week", "Month"];
        static ALBUM_ITEM_TYPE = {
            IMAGE: "image",
            TEXT: "text",
            ANIMATION: "animation"
        };
        static CENSORING_REASON = {
            BANNED_PLAYER: "banned_player",
            BACKGROUND: "background",
            UNKNOWN_PLAYER: "unknown_player",
            NEW_ACCOUNT: "new_account",
            FORGERY: "forgery",
            BY_USER: "by_user",
            ANIMATION_FRAME: "animation_frame",
            SAFE_MODE: "safe_mode"
        };
        static PREVIEW_PATHS = ["write", "memory"];
        static PREVIEW_MONITOR_INTERVAL = 200;
        static PREVIEW_MONITOR_TIMEOUT = 2E3;
        static SAFE_MODE_OPT_L10N = {
            ru: {
                TITLE: "\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c",
                DESC: "\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0440\u0438\u0441\u0443\u043d\u043a\u0438 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e",
                ON: "\u0412\u041a\u041b",
                OFF: "\u0412\u042b\u041a\u041b"
            },
            en: {
                TITLE: "Safe Mode",
                DESC: "Hide all drawings by default",
                ON: "ON",
                OFF: "OFF"
            },
            es: {
                TITLE: "Modo Seguro",
                DESC: "Ocultar todos los dibujos por defecto",
                ON: "ON",
                OFF: "OFF"
            }
        };
        static DEFAULT_SETTINGS = {
            showUI: !1,
            autoKick: !0,
            autoKickNewAccounts: !1,
            copyUsernamesWithClick: !1,
            compactMode: !0,
            playersColorIndication: !0,
            twitchFollowerBadges: !1,
            twitchSubscriberBadges: !1,
            disableLocalizedTwitchUsernames: !1,
            censorDrawings: !0,
            censorSentences: !0,
            censorNicknames: !1,
            censorUnknownPlayers: !1,
            censorNewAccounts: !1,
            newAccountPeriod: "86400000",
            safeMode: !1,
            previewEnabled: !1,
            previewPanelPos: {
                x: 0,
                y: 0,
                o: "br"
            },
            previewPanelWidth: 280,
            userBansSyncWithTwitch: !1,
            twitchToken: "",
            sendBanReports: !0
        };
        static SETTINGS_UI = {
            autoKick: {
                type: "switch",
                description: "\u0412\u044b\u0433\u043e\u043d\u044f\u0442\u044c \u0438\u0437 \u043b\u043e\u0431\u0431\u0438 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0437\u0430\u0431\u0430\u043d\u0435\u043d\u043d\u044b\u0445"
            },
            autoKickNewAccounts: {
                type: "switch",
                description: "\u0412\u044b\u0433\u043e\u043d\u044f\u0442\u044c \u0438\u0437 \u043b\u043e\u0431\u0431\u0438 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0441 \u043d\u043e\u0432\u044b\u043c\u0438 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430\u043c\u0438 (Twitch)"
            },
            copyUsernamesWithClick: {
                type: "switch",
                description: "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u043f\u0440\u0438 \u043d\u0430\u0436\u0430\u0442\u0438\u0438 \u043d\u0430 \u0435\u0433\u043e \u043d\u0438\u043a \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435 \u0438\u043b\u0438 \u0441\u043f\u0438\u0441\u043a\u0435 \u0438\u0433\u0440\u043e\u043a\u043e\u0432"
            },
            _1: {
                text: "Interface"
            },
            compactMode: {
                type: "switch",
                description: "\u041a\u043e\u043c\u043f\u0430\u043a\u0442\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u0430\u043d\u0435\u043b\u0438 \u0441\u043f\u0438\u0441\u043a\u0430 \u0438\u0433\u0440\u043e\u043a\u043e\u0432"
            },
            playersColorIndication: {
                type: "switch",
                description: "\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0442\u044c \u0446\u0432\u0435\u0442\u043e\u0432\u044b\u0435 \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u0431\u0430\u043d\u0435\u043d\u043d\u044b\u0445, \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445 \u0438 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0441 \u043d\u043e\u0432\u044b\u043c\u0438 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430\u043c\u0438 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0440\u043e\u0434\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430"
            },
            twitchFollowerBadges: {
                type: "switch",
                description: "\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u043e\u043a \u0444\u043e\u043b\u043b\u043e\u0432\u0435\u0440\u0430 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 Twitch"
            },
            twitchSubscriberBadges: {
                type: "switch",
                description: "\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u043e\u043a \u043f\u043e\u0434\u043f\u0438\u0441\u0447\u0438\u043a\u0430 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 Twitch"
            },
            disableLocalizedTwitchUsernames: {
                type: "switch",
                description: "\u0417\u0430\u043c\u0435\u043d\u044f\u0442\u044c \u043a\u0438\u0442\u0430\u0439\u0441\u043a\u0438\u0435, \u044f\u043f\u043e\u043d\u0441\u043a\u0438\u0435 \u0438 \u043a\u043e\u0440\u0435\u0439\u0441\u043a\u0438\u0435 \u0438\u043c\u0435\u043d\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0438 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0430\u0445 \u043d\u0430 \u0438\u043c\u0435\u043d\u0430 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u043e\u0432"
            },
            _2: {
                text: "Censor Content"
            },
            censorDrawings: {
                type: "switch",
                description: "\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0440\u0438\u0441\u0443\u043d\u043a\u0438 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u0432\u043d\u0435\u0441\u0451\u043d\u043d\u044b\u0445 \u0432 \u0447\u0451\u0440\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a"
            },
            censorSentences: {
                type: "switch",
                description: "\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0440\u0438\u0441\u0443\u043d\u043a\u043e\u0432 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u0432\u043d\u0435\u0441\u0451\u043d\u043d\u044b\u0445 \u0432 \u0447\u0451\u0440\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a"
            },
            censorNicknames: {
                type: "switch",
                description: "\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0438\u043c\u0435\u043d\u0430 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u0432\u043d\u0435\u0441\u0451\u043d\u043d\u044b\u0445 \u0432 \u0447\u0451\u0440\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a"
            },
            _3: {
                text: "Censor Rules"
            },
            censorUnknownPlayers: {
                type: "switch",
                description: "\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0412\u044b \u0432\u0438\u0434\u0438\u0442\u0435 \u0432 \u0438\u0433\u0440\u0430\u0445 \u0432\u043f\u0435\u0440\u0432\u044b\u0435"
            },
            censorNewAccounts: {
                type: "switch",
                description: "\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0438\u0433\u0440\u043e\u043a\u043e\u0432, \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u044b \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u0447\u0438\u0442\u0430\u044e\u0442\u0441\u044f \u043d\u043e\u0432\u044b\u043c\u0438 (Twitch)"
            },
            newAccountPeriod: {
                type: "dropdown",
                args: {
                    items: GPModeration_.NEW_ACCOUNT_PERIODS
                },
                formatter: this.newAccountPeriodFormatter,
                description: "\u041f\u0435\u0440\u0438\u043e\u0434, \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u043d\u043e\u0432\u044b\u043c"
            },
            safeMode: {
                type: "switch",
                description: "\u0421\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0440\u0438\u0441\u0443\u043d\u043a\u0438 \u0432\u0441\u0435\u0445 \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e (\u0438\u0445 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043f\u0430\u043d\u0435\u043b\u044c \u043f\u0440\u0435\u0434\u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u043f\u0435\u0440\u0435\u0434 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0435\u043c \u043d\u0430 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u0438)"
            },
            _4: {
                text: "Twitch Integration"
            },
            userBansSyncWithTwitch: {
                type: "switch",
                description: "\u0411\u0430\u043d\u0438\u0442\u044c/\u0440\u0430\u0437\u0431\u0430\u043d\u0438\u0432\u0430\u0442\u044c \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u043d\u0430 Twitch \u043f\u0440\u0438 \u0431\u0430\u043d\u0435/\u0440\u0430\u0437\u0431\u0430\u043d\u0435 \u0432 \u0438\u0433\u0440\u0435"
            },
            _5: {
                text: "Reports"
            },
            sendBanReports: {
                type: "switch",
                description: "\u041e\u0442\u0441\u044b\u043b\u0430\u0442\u044c \u043e\u0442\u0447\u0451\u0442\u044b, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0440\u0438\u0441\u0443\u043d\u043a\u0435 \u0438 \u0430\u0432\u0442\u043e\u0440\u0435, \u043f\u0440\u0438 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0435 \u0438\u0433\u0440\u043e\u043a\u0430 \u0447\u0435\u0440\u0435\u0437 \u043d\u0430\u0436\u0430\u0442\u0438\u0435 \u043d\u0430 \u0430\u0432\u0430\u0442\u0430\u0440 \u0432 \u0430\u043b\u044c\u0431\u043e\u043c\u0435"
            }
        };
        static newAccountPeriodFormatter(a,
            b) {
            return GPModeration_.NEW_ACCOUNT_PERIODS_ALIASES[b]
        }
        static MODULE = {
            title: "Moderation",
            alias: "mod",
            dependencies: "GPUtils_ GPAssets_ GPContentObserver_ GPKnownUsersDB_ GPImageReportSender_ GPPreview_".split(" "),
            settings: {
                storage: "gp_userlist",
                defaultSettings: this.DEFAULT_SETTINGS,
                ui: this.SETTINGS_UI
            },
            useCSS: !0
        };
        constructor(a, b) {
            if (GPModeration_.instance) return GPModeration_.instance;
            super();
            GPModeration_.instance = this;
            this.gpproxy = a.gpproxy;
            this.av = a.av;
            this.ac = a.ac;
            this.abt = a.abt;
            this.l = b;
            this.s =
                a.sm.setSettings(this, this.updateSettings);
            this.usersDB = new GPKnownUsersDB_;
            this.twitchAPI = new GPTwitchAPI_;
            this.twitchAPI.addEventListener("token", ({
                detail: {
                    type: c,
                    token: d
                }
            }) => {
                switch (c) {
                    case GPTwitchAPI_.TOKEN_TYPE.BAN_USERS:
                        this.s.twitchToken = d;
                        break;
                    case GPTwitchAPI_.TOKEN_TYPE.FOLLOWERS_SUBSCRIPTIONS:
                        this.s.twitchToken2 = d
                }
            });
            this.banlist = new Set(this.gpproxy.isTwitchOAuth ? null : JSON.parse(localStorage.getItem("ul_banlist")));
            this.twitchUserIds = new Map;
            this.localizedLogins = new Map;
            this.isMiddlewareActive = !1;
            this.searchPreviewTimer;
            GPUtils_.bindMethods([this.handlePlayerItem, this.handlePreviewImage, this.handleAlbumAvatars, this.handleAlbumItem, this.handlePreviewItem, this.handleAlbumUsername, this.handleAlbumHeader, this.handleAlbumFooter, this.handleAlbumRanking, this.handlePainterHeader], this);
            this.contentObserver = new GPContentObserver_(a.gpproxy);
            this.contentObserver.addPlayerListHandler(this.handlePlayerItem);
            this.contentObserver.addPainterHeaderHandler(this.handlePainterHeader);
            this.contentObserver.addDrawingPreviewHandler(this.handlePreviewImage);
            this.contentObserver.addAlbumItemsHandler(this.handleAlbumAvatars, this.handleAlbumItem, this.handlePreviewItem, this.handleAlbumUsername);
            this.albumItems = this.contentObserver.getAlbumItems();
            this.contentObserver.addAlbumHeaderHandler(this.handleAlbumHeader);
            this.contentObserver.addAlbumFooterHandler(this.handleAlbumFooter);
            this.contentObserver.addAlbumRankingHandler(this.handleAlbumRanking);
            this.reportSender = new GPImageReportSender_(GPImageReportSender_.BAN, this.gpproxy, a.act);
            this.preview = new GPPreview_(this.gpproxy,
                this.s.previewEnabled, this.s.previewPanelPos, this.s.previewPanelWidth, this.l);
            this.preview.addEventListener("status", ({
                detail: {
                    status: c
                }
            }) => {
                this.s.previewEnabled = c
            });
            this.preview.addEventListener("panel-pos-changed", ({
                detail: c
            }) => {
                this.s.previewPanelPos = c
            });
            this.preview.addEventListener("panel-width-changed", ({
                detail: {
                    width: c
                }
            }) => {
                this.s.previewPanelWidth = c
            });
            this.censorItems = new Map;
            this.unknownUsers = new Set;
            this.suspiciousItems = this.ac?.getSuspiciousItems() ?? new Set;
            this.userDatesCreated = {};
            this.followers = {};
            this.subscribers = {};
            this.isAlbumBgHidden = !1;
            this.newAccountLabels = this.l.NEW_ACCOUNT_AGE_LBLS.split("|").map(c => c.split(","));
            this.inGallerySettingsObserving = !1;
            this.safeModControl = null;
            this.safeItems = new Set;
            a = document.documentElement.style;
            a.setProperty("--mod-item-banned-player", `'${this.l.ITEM_BANNED_PLAYER}'`);
            a.setProperty("--mod-item-censored-bg", `'${this.l.ITEM_CENSORED_BG}'`);
            a.setProperty("--mod-item-unknown-player", `'${this.l.ITEM_UNKNOWN_PLAYER}'`);
            a.setProperty("--mod-item-new-account",
                `'${this.l.ITEM_NEW_ACCOUNT}'`);
            a.setProperty("--mod-item-censored", `'${this.l.ITEM_CENSORED}'`);
            a.setProperty("--mod-item-safe-mode", `'${this.l.ITEM_SAFE_MODE}'`);
            this.middleware = this.middleware.bind(this);
            this.usersClickHandler = this.usersClickHandler.bind(this);
            this.banlistClickHandler = this.banlistClickHandler.bind(this);
            this.albumItemClickHandler = this.albumItemClickHandler.bind(this);
            this.albumItemEnterHandler = this.albumItemEnterHandler.bind(this);
            this.albumItemLeaveHandler = this.albumItemLeaveHandler.bind(this);
            this.preventAlbumContentInteraction = this.preventAlbumContentInteraction.bind(this);
            this.imagePreviewOverHandler = this.imagePreviewOverHandler.bind(this);
            this.imagePreviewDownHandler = this.imagePreviewDownHandler.bind(this);
            this.painterHeaderTextOverHandler = this.painterHeaderTextOverHandler.bind(this);
            this.painterHeaderTextDownHandler = this.painterHeaderTextDownHandler.bind(this);
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: c
                }
            }) => {
                if (this.gpproxy.isAuthorized || this.gpproxy.isTwitchOAuth) c === GPProxy_.EVENT.GAME_STARTED ?
                    this.gpproxy.isAuthorized && this.parseUnknownUsers() : c === GPProxy_.EVENT.TURNS_ENDED ? this.gpproxy.isHost() && this.injectSafeModeControl() : c === GPProxy_.EVENT.GALLERY_SETTINGS && (this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.ALBUM_ITEM, GPProxy_.EVENT.ALBUM_INFO], this.middleware), this.isMiddlewareActive = !0, this.init()), this.isMiddlewareActive && [GPProxy_.EVENT.NEW_GAME, GPProxy_.EVENT.ALBUM_SCORE, GPProxy_.EVENT.GAME_QUIT, GPProxy_.EVENT.GAME_STARTED].includes(c) && (this.gpproxy.removeWSMsgMiddleware(this.middleware),
                        this.isMiddlewareActive = !1, this.terminate())
            });
            this.gpproxy.addEventListener("rejoin", ({
                detail: {
                    stage: c
                }
            }) => {
                switch (c) {
                    case GPProxy_.STAGE.GAME:
                        this.gpproxy.isAuthorized && this.parseUnknownUsers();
                        break;
                    case GPProxy_.STAGE.ALBUM:
                        if (this.gpproxy.isAuthorized || this.gpproxy.isTwitchOAuth) this.init(), this.gpproxy.addWSMsgMiddleware([GPProxy_.EVENT.ALBUM_ITEM, GPProxy_.EVENT.ALBUM_INFO], this.middleware), this.isMiddlewareActive = !0;
                        this.gpproxy.isTwitchAuth() && document.addEventListener("_tw_ids_usernames",
                            () => {
                                this.handleAlbumHeader();
                                this.handleAlbumFooter();
                                this.handleAlbumUsernames()
                            }, {
                                once: !0
                            });
                        break;
                    case GPProxy_.STAGE.SCORE:
                        this.gpproxy.isTwitchAuth() && document.addEventListener("_tw_ids_usernames", () => {
                            this.updateRankingUsers()
                        }, {
                            once: !0
                        })
                }
            });
            this.gpproxy.addEventListener("albums_ended", () => {
                if (this.gpproxy.isAuthorized && this.gpproxy.isHost()) {
                    var c = this.gpproxy.getUsers().filter(({
                        nick: d,
                        viewer: e
                    }) => !this.gpproxy.isYou(d) && !e && !this.banlist.has(this.gpproxy.formatNickname(d))).map(d => d.nick);
                    this.usersDB.addUsers(c)
                }
            });
            this.gpproxy.addEventListener("users_updated", ({
                detail: {
                    users: c
                }
            }) => {
                this.renderUsers(c)
            });
            this.gpproxy.addEventListener("player_joined", ({
                detail: c
            }) => {
                this.clearPlayers([c]);
                this.requestTwitchUsersData([c])
            });
            this.gpproxy.addEventListener("owner_status", () => {
                this.renderUsers();
                this.updatePlayerItems()
            });
            document.addEventListener("_tw_users_data", ({
                detail: {
                    userDatesCreated: c,
                    followers: d,
                    subscribers: e
                }
            }) => {
                this.updateUserDatesCreatedCache(c);
                this.updateFollowers(d);
                this.updateSubscribers(e);
                this.clearPlayers();
                this.renderUsers();
                this.s.twitchFollowerBadges || this.s.twitchSubscriberBadges ? this.updatePlayerItems() : Object.keys(c).length && this.gpproxy.getUsers().forEach(f => {
                    this.gpproxy.formatNickname(f.nick) in c && this.isNewAccount(f.nick) && this.updatePlayerItem(f.nick)
                })
            });
            document.addEventListener("_tw_ids_usernames", ({
                detail: {
                    usernamesMap: c,
                    localizedLoginsMap: d
                }
            }) => {
                this.updateUserIdsCache(c);
                this.updateLocalizedLogins(d);
                d.size && (this.gpproxy.getUsers().forEach(e => {
                        d.has(e.nick) && this.updatePlayerItem(e.nick)
                    }),
                    d.forEach((e, f) => {
                        this.updateBanlistUsername(f, e)
                    }))
            });
            document.addEventListener("_tw_invalid-token2", c => {
                this.showTwitchToken2Notice()
            });
            this.ac && this.ac.addEventListener("trigger", this.acTriggerHandler.bind(this));
            this.render();
            this.initInitialState();
            this.gpproxy.isTwitchAuth() && (this.s.userBansSyncWithTwitch && this.checkTwitchTokenStatus(), (this.s.twitchFollowerBadges || this.s.twitchSubscriberBadges) && this.checkTwitchToken2Status())
        }
        getElement() {
            return this.container
        }
        init() {
            document.addEventListener("pointerdown",
                this.albumItemClickHandler);
            document.addEventListener("click", this.preventAlbumContentInteraction, !0)
        }
        terminate() {
            this.censorItems.clear();
            this.safeItems.clear();
            this.unknownUsers.clear();
            this.safeModControl = null;
            document.removeEventListener("pointerdown", this.albumItemClickHandler);
            document.addEventListener("click", this.preventAlbumContentInteraction, !0)
        }
        initInitialState() {
            const a = this.gpproxy.getUsers();
            this.clearPlayers(a);
            this.renderUsers(a);
            this.requestTwitchUsersData(a);
            this.initUsernamesCopying()
        }
        initUsernamesCopying() {
            this.gpproxy.isAuthorized &&
                document.querySelector("#content")?.classList.toggle("gp-copy-username_", this.s.copyUsernamesWithClick)
        }
        render() {
            this.renderUserlist()
        }
        renderUserlist() {
            this.container = document.createElement("div");
            this.container.className = "userlist_";
            this.container.classList.toggle("shown_", this.s.showUI);
            this.container.classList.toggle("compact_", this.s.compactMode);
            this.container.classList.toggle("autokick_", this.s.autoKick);
            this.buttons = document.createElement("div");
            this.buttons.className = "ul-buttons_";
            this.container.appendChild(this.buttons);
            this.activateBtn = document.createElement("div");
            this.activateBtn.className = "ul-activate-btn_ ul-button_ gp-module-btn_";
            this.activateBtn.classList.toggle("pressed_", this.s.showUI);
            this.activateBtn.title = this.l.MODULE_BTN_TTL;
            this.activateBtn.addEventListener("click", b => {
                this.s.showUI = !this.s.showUI;
                this.container.classList.toggle("shown_", this.s.showUI);
                this.container.classList.remove("banlist_");
                this.renderUsers();
                this.activateBtn.classList.toggle("pressed_", this.s.showUI)
            });
            this.buttons.appendChild(this.activateBtn);
            var a = document.createElement("div");
            a.className = "ul-mode-btn_ ul-button_";
            a.title = this.l.MODE_BTN_TTL;
            a.addEventListener("click", b => {
                this.s.compactMode = !this.s.compactMode
            });
            this.buttons.appendChild(a);
            this.buttons.appendChild(document.createElement("div"));
            a = document.createElement("div");
            a.className = "ul-autokick-btn_ ul-button_";
            a.title = this.l.AUTOKICK_BTN_TTL;
            a.addEventListener("click", b => {
                this.s.autoKick = !this.s.autoKick;
                this.container.classList.toggle("autokick_", this.s.autoKick);
                this.clearPlayers()
            });
            this.buttons.appendChild(a);
            a = document.createElement("div");
            a.className = "ul-banlist-btn_ ul-button_";
            a.title = this.l.BANLIST_BTN_TTL;
            a.addEventListener("click", b => {
                this.container.classList.toggle("banlist_")
            });
            this.buttons.appendChild(a);
            this.list = document.createElement("div");
            this.list.className = "ul-users_";
            this.list.addEventListener("contextmenu", this.usersClickHandler);
            this.list.addEventListener("dblclick", this.usersClickHandler);
            this.list.addEventListener("click", b => {
                b.ctrlKey && this.usersClickHandler(b)
            });
            this.container.appendChild(this.list);
            this.banlistElem = document.createElement("div");
            this.banlistElem.className = "ul-banlist_";
            this.banlistElem.addEventListener("click", this.banlistClickHandler);
            this.container.appendChild(this.banlistElem);
            this.renderBanlist();
            document.body.appendChild(this.container)
        }
        renderBanlist() {
            const a = this.banlistElem.scrollTop;
            this.banlistElem.innerHTML = "";
            const b = document.createDocumentFragment();
            var c = document.createElement("span");
            c.className = "ul-title_";
            c.textContent = this.l.BANLIST_LBL;
            b.appendChild(c);
            this.banlist.size ? this.banlist.forEach(d => {
                var e = d;
                let f = !1;
                if (this.gpproxy.isTwitchAuth() && this.s.disableLocalizedTwitchUsernames) {
                    var g = this.localizedLogins.get(this.gpproxy.getUsers().find(k => this.gpproxy.formatNickname(k.nick) === d)?.nick);
                    g && (e = g, f = !0)
                }
                g = document.createElement("div");
                g.className = "ul-banned-user_";
                g.dataset.username = d;
                const h = document.createElement("div");
                h.className = "username_";
                h.title = f ? `${e}   |   ${d}` : d;
                h.textContent = e;
                f && (h.dataset.login = e);
                g.appendChild(h);
                e = document.createElement("div");
                e.className = "remove-btn_";
                e.textContent = "\u2716";
                e.addEventListener("click", k => {});
                g.appendChild(e);
                b.appendChild(g)
            }) : (c = document.createElement("div"), c.className = "ul-banlist-placeholder_", c.textContent = this.l.BANLIST_EMPTY_LBL, b.appendChild(c));
            this.banlistElem.appendChild(b);
            this.banlistElem.scrollTop = a
        }
        updateBanlistUsername(a, b) {
            a = this.gpproxy.formatNickname(a);
            const c = this.banlistElem.querySelector(`.ul-banned-user_[data-username="${a}"] .username_`);
            c && (c.title =
                b ? `${b}   |   ${a}` : a, c.textContent = b ?? a, b && (c.dataset.login = b))
        }
        renderBtn(a, b, c) {
            const d = document.createElement("div");
            d.className = `ul-button_ ul-${a}-btn_`;
            d.title = b || "";
            d.addEventListener("click", c);
            this.buttons.appendChild(d);
            return d
        }
        renderUsers(a) {
            if (this.s.showUI) {
                a = a || this.gpproxy.getUsers();
                var b = this.list.scrollTop;
                this.list.innerHTML = "";
                var c, d = document.createDocumentFragment();
                a.forEach(e => {
                    if (e.viewer && !c) {
                        c = !0;
                        const f = document.createElement("span");
                        f.className = "ul-title_";
                        f.textContent =
                            this.l.USERLIST_WAITING;
                        d.appendChild(f)
                    }
                    d.appendChild(this.renderUser(e))
                });
                this.list.appendChild(d);
                this.list.scrollTop = b
            }
        }
        renderUser(a) {
            const b = document.createElement("div");
            b.className = "ul-user_";
            b.classList.toggle("host_", !!a.owner);
            b.classList.toggle("away_", !!a.away);
            b.classList.toggle("ready_", !!a.ready);
            b.classList.toggle("viewer_", !!a.viewer);
            b.classList.toggle("you_", !!a.you);
            b.classList.toggle("banned_", !a.you && this.isUserBanned(a));
            b.dataset.nickname = a.nick;
            var c = document.createElement("div");
            c.className = "ul-av_";
            b.appendChild(c);
            const d = document.createElement("span");
            d.className = "img_";
            d.style.backgroundImage = `url(/images/avatar/${a.avatar}.svg)`;
            c.appendChild(d);
            this.gpproxy.isAuthorized && (c = this.gpproxy.formatNickname(a.nick), this.av.requestAvatarURL(c, g => {
                d.style.backgroundImage = `url(${g})`
            }));
            let e = a.nick;
            c = !1;
            if (this.gpproxy.isTwitchAuth()) {
                if (this.s.disableLocalizedTwitchUsernames) {
                    const g = this.localizedLogins.get(e);
                    g && (e = g, c = !0)
                }
                this.gpproxy.isHost() && !this.gpproxy.isYou(e) &&
                    (this.s.twitchFollowerBadges && this.followers[a.nick] && b.classList.add("follower_"), this.s.twitchSubscriberBadges && this.subscribers[a.nick] && b.classList.add("subscriber_"))
            }
            const f = document.createElement("div");
            f.className = "ul-nick_";
            f.title = c ? `${a.nick} (${e})` : a.nick;
            f.textContent = e;
            b.appendChild(f);
            a.you || this.gpproxy.isTwitchOAuth || this.usersDB.hasUser(a.nick).then(g => {
                g || (b.classList.toggle("unknown_", !g), f.dataset.sinceCreation = e, this.isNewAccount(a.nick) && (b.classList.add("new_"), b.dataset.created =
                    this.getDateCreated(a.nick), b.addEventListener("pointerenter", h => {
                        f.dataset.sinceCreation = this.getSinceCreationTime(b.dataset.created) ?? e
                    })))
            });
            c = document.createElement("div");
            c.className = "ul-state_";
            b.appendChild(c);
            return b
        }
        handlePlayerItem(a, b) {
            const c = a.querySelector(".nick"),
                d = b ?? c?.textContent;
            delete a.dataset.state;
            if (this.gpproxy.isHost() && this.s.playersColorIndication) {
                if (this.gpproxy.isYou(d)) return;
                this.isBannedUser(d) ? a.dataset.state = "banned" : this.gpproxy.isTwitchOAuth || this.usersDB.hasUser(d).then(e => {
                    e || (this.isNewAccount(d) ? a.dataset.state = "new" : a.dataset.state = "unknown")
                })
            }
            this.gpproxy.isTwitchAuth() && (this.s.disableLocalizedTwitchUsernames ? (b = this.localizedLogins.get(d)) ? c.dataset.login = b : delete c.dataset.login : delete c.dataset.login, delete a.dataset.badge, this.gpproxy.isHost() && !this.gpproxy.isYou(d) && (this.s.twitchFollowerBadges && this.followers[d] ? a.dataset.badge = "follower" : this.s.twitchSubscriberBadges && this.subscribers[d] && (a.dataset.badge = "subscriber")))
        }
        updatePlayerItem(a) {
            if (this.gpproxy.isHost()) {
                var b =
                    this.contentObserver.getPlayerItems().get(a);
                b && this.handlePlayerItem(b, a)
            }
        }
        updatePlayerItems() {
            this.contentObserver.getPlayerItems().size && this.gpproxy.getUsers().forEach(a => {
                this.updatePlayerItem(a.nick)
            })
        }
        getSinceCreationTime(a) {
            const b = Date.now() - (new Date(a)).getTime();
            a = this.newAccountLabels;
            var c = [26784E5, 864E5, 36E5, 6E4];
            const d = c.findIndex(f => b >= f);
            if (!~d) return a.at(-1)[0];
            c = Math.trunc(b / c[d]);
            let e;
            switch (this.l.lang) {
                case "ru":
                    const f = c % 100,
                        g = f % 10;
                    if (10 <= f && 20 > f) e = 2;
                    else if (1 === g) e = 0;
                    else if (1 <
                        g && 5 > g) e = 1;
                    else if (!g || 4 < g) e = 2;
                    return `${c} ${a[d][e]}`;
                default:
                    return `${c} ${a[d][1<c?1:0]}`
            }
        }
        isUserBanned({
            nick: a,
            id: b
        }) {
            return a && b ? !this.gpproxy.isYou(b) && this.banlist.has(this.gpproxy.formatNickname(a)) : !1
        }
        clearPlayers(a) {
            this.gpproxy.isHost() && (this.s.autoKick || this.s.autoKickNewAccounts) && (a = a || this.gpproxy.getUsers(), this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.LOBBY) && a.forEach(b => {
                this.gpproxy.isYou(b.nick) || this.usersDB.hasUser(b.nick).then(c => {
                    (this.s.autoKick && this.isUserBanned(b) || this.s.autoKickNewAccounts &&
                        this.isNewAccount(b.nick) && !c) && this.gpproxy.kickPlayer(b.id)
                })
            }))
        }
        usersClickHandler(a) {
            a.preventDefault();
            if (this.gpproxy.isAuthorized || this.gpproxy.isTwitchOAuth)
                if (a = a.target.closest(".ul-user_"), !a?.classList.contains("you_")) {
                    const b = this.toggleUserBan(a.dataset.nickname);
                    a.classList.toggle("banned_", b);
                    a.classList.add("unknown_")
                }
        }
        banlistClickHandler(a) {
            var b = a.target.closest(".ul-banned-user_");
            if (b)
                if (b = b.dataset.username, a.target.matches(".username_")) navigator.clipboard.writeText(a.target.dataset.login ??
                    b);
                else if (a.target.matches(".remove-btn_")) {
                const c = this.findNickname(b);
                this.banlist.delete(b);
                this.s.userBansSyncWithTwitch && this.gpproxy.isTwitchAuth() && this.unbanTwitchUser(b);
                this.renderBanlist();
                c && (this.renderUsers(), this.clearPlayers(), this.updatePlayerItem(c), this.handleItems());
                this.saveBanlist()
            }
            a.preventDefault()
        }
        findNickname(a) {
            return this.gpproxy.getUsers().find(b => a === this.gpproxy.formatNickname(b.nick))?.nick
        }
        middleware([a, b]) {
            if (!this.s.censorDrawings && !this.s.censorNicknames && !this.s.censorSentences) return [a,
                b
            ];
            if (a[1] === GPProxy_.EVENT.ALBUM_ITEM && a[2].active) {
                if (this.s.safeMode && a[2].type === GPProxy_.ALBUM_ITEM_TYPE.TEXT && (a[3] = null, b = !0), this.isUserBanned(a[2].user))
                    if (a[2].data?.length) switch (a[2].type) {
                        case GPProxy_.ALBUM_ITEM_TYPE.TEXT:
                            this.s.censorSentences && (a[3] = null, b = !0)
                    } else this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND) && this.s.censorDrawings && a[2].bg && (a[2].data = this.gpproxy.getAlbum().background, a[2].bg = !1, this.isAlbumBgHidden = b = !0)
            } else if (a[1] === GPProxy_.EVENT.ALBUM_INFO) {
                this.isAlbumBgHidden = !1;
                a[2].background && this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND) && this.isUserBanned(a[2].bookAuthor) && this.s.censorDrawings && (a[2].background = [], this.isAlbumBgHidden = b = !0);
                const c = this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND) && this.isUserBanned(this.gpproxy.getAlbum().bookAuthor) && this.s.censorDrawings;
                a[2].timeline?.length && (a[2].timeline = a[2].timeline.map(d => {
                    c && d.bg && (d.data = this.gpproxy.getAlbum().background, d.bg = !1, b = !0);
                    return d
                }))
            }
            return [a,
                b
            ]
        }
        async albumItemClickHandler(a) {
            if (0 === a.button) {
                var b = a.target.closest(".item");
                if (b && !this.isAIImageItem(b)) {
                    var c = this.getContentId(b),
                        d = this.getNickname(b);
                    if (this.s.copyUsernamesWithClick && this.isAlbumUsername(a.target)) navigator.clipboard.writeText(a.target.dataset.login ?? d);
                    else {
                        var e, f = !1;
                        if (this.isAlbumAvatar(a.target)) this.gpproxy.isYou(d) || this.isAnimationOrMultiPieceItem(b) || (e = this.toggleUserBan(d)) && this.s.sendBanReports && this.reportSender.send({
                            itemId: this.getItemId(b),
                            albumId: this.gpproxy.getCurrentAlbumId()
                        });
                        else if (this.isAlbumContent(a.target)) {
                            if (this.isEmptyItem(b)) return;
                            if (this.s.safeMode && !this.isBannedItem(b) && !this.safeItems.has(c)) {
                                this.safeItems.add(c);
                                this.isAnimationOrMultiPieceItem(b) && this.hasCensoredImageItems() && this.toggleAlbumItemPreview(b, !0);
                                this.handleAlbumItem(b);
                                return
                            }
                            this.shouldBeBannedItem(b, d) || this.isPreviewedItem(b) || b.dataset.cr && b.dataset.cr !== GPModeration_.CENSORING_REASON.BY_USER ? (this.toggleAlbumItemPreview(b), f = !0, this.preview.isEnabled() && (this.preview.clear(), b.classList.remove("previewed_"))) :
                                this.censorItems.has(c) ? this.censorItems.delete(c) : this.censorItems.set(c, b.dataset.type)
                        }
                        void 0 !== e || this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND_NO_PREVIEW) && 0 === this.getItemId(b) ? this.handleItems(f ? b : null) : (this.handleAlbumItem(b), this.gpproxy.isAnimateMode() && !this.isAnimationItem(b) && (a = this.getAnimationItem()) && (this.toggleAlbumItemPreview(a, !1), this.handleAlbumItem(a)), this.gpproxy.isMultiPieceMode() && !this.isMultiPieceItem(b) && (b = this.getMultiPieceItem()) && (this.toggleAlbumItemPreview(b,
                            !1), this.handleAlbumItem(b)))
                    }
                }
            }
        }
        isAlbumUsername(a) {
            return a.matches(":is(.answerBalloon, .drawBalloon) > div:not(.avatar) > span")
        }
        isAlbumAvatar(a) {
            return a.parentElement.classList.contains("avatar")
        }
        isAlbumContent(a) {
            return ("CANVAS" === a.tagName || "SPAN" === a.tagName) && a.closest(".drawBalloon:not(.load)") || ("SPAN" === a.tagName || a.classList.contains("balloon")) && a.closest(".answerBalloon:not(.load)")
        }
        handleAlbumItem(a) {
            this.resetItem(a);
            if (!this.isAIImageItem(a)) {
                var b = this.getNickname(a);
                if (this.isAnimationOrMultiPieceItem(a)) this.shouldBeCensoredBySafemode(a) ?
                    this.censorItem(a, GPModeration_.CENSORING_REASON.SAFE_MODE) : this.hasCensoredImageItems() ? this.censorItem(a, GPModeration_.CENSORING_REASON.ANIMATION_FRAME) : this.shouldBeCensoredItem(a) && this.censorItem(a, GPModeration_.CENSORING_REASON.BY_USER);
                else if (this.isBannedUser(b) && a.classList.add("banned_"), this.isSuspiciousItem(a) && a.classList.add("suspicious_"), this.shouldBeBannedItem(a, b)) this.censorItem(a, GPModeration_.CENSORING_REASON.BANNED_PLAYER);
                else {
                    if (this.s.safeMode && !this.isAnimationOrMultiPieceItem(a)) {
                        if (!this.safeItems.has(this.getContentId(a))) {
                            this.censorItem(a,
                                GPModeration_.CENSORING_REASON.SAFE_MODE);
                            return
                        }
                    } else {
                        if (this.shouldBeCensoredByUnknownPlayer(a, b)) {
                            this.censorItem(a, GPModeration_.CENSORING_REASON.UNKNOWN_PLAYER);
                            return
                        }
                        if (this.shouldBeCensoredByNewAccount(a, b)) {
                            this.censorItem(a, GPModeration_.CENSORING_REASON.NEW_ACCOUNT);
                            return
                        }
                    }
                    this.shouldByCensoredByBackground(a) ? this.censorItem(a, GPModeration_.CENSORING_REASON.BACKGROUND) : this.shouldBeCensoredItem(a) && this.censorItem(a, GPModeration_.CENSORING_REASON.BY_USER)
                }
            }
        }
        async handleItems(a) {
            for (const b of this.albumItems) b !==
                a && (this.toggleAlbumItemPreview(b, !1), await this.handleAlbumItem(b))
        }
        resetItem(a) {
            a.classList.remove("banned_", "censored_", "censored-nickname_", "suspicious_");
            delete a.dataset.cr
        }
        isEmptyItem(a) {
            return a.firstElementChild?.classList.contains("empty")
        }
        isPreviewedItem(a) {
            return a.classList.contains("preview_")
        }
        isSuspiciousItem(a) {
            return this.isImageItem(a) ? this.suspiciousItems.has(this.getContentId(a)) : !1
        }
        toggleAlbumItemPreview(a, b) {
            a.classList.toggle("preview_", b)
        }
        censorItem(a, b = GPModeration_.CENSORING_REASON.BY_USER) {
            a.classList.add("censored_");
            a.dataset.cr = b;
            b === GPModeration_.CENSORING_REASON.BANNED_PLAYER && a.classList.toggle("censored-nickname_", this.s.censorNicknames)
        }
        shouldBeCensoredBySafemode(a) {
            return this.s.safeMode && !this.safeItems.has(this.getContentId(a))
        }
        shouldByCensoredByBackground(a) {
            return (this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND_NO_PREVIEW) || this.gpproxy.isGameOrder(GPProxy_.GAME_ORDER.DRAWINGS_WITH_A_BACKGROUND) && !this.isAlbumBgHidden) && 0 < this.getItemId(a) ? (a = this.getNickname(this.albumItems[0]),
                this.shouldBeBannedItem(this.albumItems[0], a) || this.isCensoredItem(this.albumItems[0])) : !1
        }
        shouldBeCensoredItem(a) {
            return this.isCensoredItem(a)
        }
        shouldBeBannedItem(a, b) {
            return this.isAnimationOrMultiPieceItem(a) ? !1 : this.isBannedUser(b) && (this.isImageItem(a) && this.s.censorDrawings || this.isTextItem(a) && this.s.censorSentences) ? !0 : !1
        }
        shouldBeCensoredByUnknownPlayer(a, b) {
            a = this.isImageItem(a);
            return !this.gpproxy.isYou(b) && this.s.censorUnknownPlayers && (this.s.censorDrawings && a || this.s.censorSentences &&
                !a) ? this.unknownUsers.has(b) : !1
        }
        async parseUnknownUsers() {
            const a = this.gpproxy.getUsers().filter(c => !c.viewer && !c.owner).map(c => c.nick),
                b = await this.usersDB.hasUsers(a);
            this.unknownUsers = new Set(a.filter(c => !b.has(c)))
        }
        shouldBeCensoredByNewAccount(a, b) {
            a = this.isImageItem(a);
            return !this.gpproxy.isYou(b) && this.s.censorNewAccounts && this.unknownUsers.has(b) && (this.s.censorDrawings && a || this.s.censorSentences && !a) && this.isNewAccount(b) ? !0 : !1
        }
        getItemId(a) {
            return +a.dataset.id
        }
        isBannedUser(a) {
            return this.banlist.has(this.gpproxy.formatNickname(a))
        }
        getNickname(a) {
            return this.getNicknameElem(a)?.textContent
        }
        getNicknameElem(a) {
            return a.querySelector(":scope > :is(.answerBalloon, .drawBalloon) > div:not(.avatar) > span")
        }
        toggleUserBan(a) {
            const b =
                this.gpproxy.formatNickname(a),
                c = !this.banlist.has(b);
            c ? (this.banlist.add(b), this.gpproxy.isTwitchOAuth || (this.usersDB.deleteUser(a), this.unknownUsers.add(a))) : this.banlist.delete(b);
            this.s.userBansSyncWithTwitch && this.gpproxy.isTwitchAuth() && (c ? this.banTwitchUser(b) : this.unbanTwitchUser(b));
            this.renderUsers();
            this.renderBanlist();
            this.clearPlayers();
            this.updatePlayerItem(a);
            this.handleItems();
            this.saveBanlist();
            return c
        }
        getAnimationItem() {
            return this.albumItems.find(a => "animation" === a.dataset.type)
        }
        getMultiPieceItem() {
            return this.albumItems.find(a =>
                "multi-piece" === a.dataset.type)
        }
        getContentId(a) {
            return this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.ALBUM) ? `${this.gpproxy.getCurrentAlbumId()}_${this.getItemId(a)}` : `t_${this.gpproxy.getCurrentTurnId()}`
        }
        isCensoredItem(a, b) {
            a = this.censorItems.get(this.getContentId(a));
            return b ? b === a : !!a
        }
        isCensoredImageItem(a) {
            return this.isCensoredItem(a, GPModeration_.ALBUM_ITEM_TYPE.IMAGE)
        }
        isBannedItem(a) {
            return a.classList.contains("banned_")
        }
        hasCensoredImageItems() {
            return this.albumItems.some(a => this.isCensoredImageItem(a)) ?
                !0 : this.s.censorDrawings ? this.albumItems.some(a => this.isImageItem(a) && (a.dataset.cr === GPModeration_.CENSORING_REASON.BANNED_PLAYER || a.dataset.cr === GPModeration_.CENSORING_REASON.UNKNOWN_PLAYER || a.dataset.cr === GPModeration_.CENSORING_REASON.NEW_ACCOUNT)) : !1
        }
        isTextItem(a) {
            return "text" === a.dataset.type
        }
        isImageItem(a) {
            return "image" === a.dataset.type
        }
        isAnimationItem(a) {
            return "animation" === a.dataset.type
        }
        isMultiPieceItem(a) {
            return "multi-piece" === a.dataset.type
        }
        isAnimationOrMultiPieceItem(a) {
            return this.isAnimationItem(a) ||
                this.isMultiPieceItem(a)
        }
        isAIImageItem(a) {
            return "ai-image" === a.dataset.type
        }
        isNewAccount(a) {
            a = this.getDateCreated(a);
            return !!a && Date.now() - (new Date(a)).getTime() <= +this.s.newAccountPeriod
        }
        getDateCreated(a) {
            return this.userDatesCreated[this.gpproxy.formatNickname(a)]
        }
        updateUserDatesCreatedCache(a) {
            Object.assign(this.userDatesCreated, a)
        }
        requestUserDatesCreated(a) {
            this.gpproxy.isHost() && this.gpproxy.isTwitchAuth() && (a = a.filter(b => !this.hasUserDateCreated(b.nick) && !this.gpproxy.isYou(b.nick) && !this.gpproxy.isViewer(b)).map(b =>
                this.gpproxy.formatNickname(b.nick)), a.length && document.dispatchEvent(new CustomEvent("_request_user_dates_created", {
                detail: {
                    usernames: a
                }
            })))
        }
        hasUserDateCreated(a) {
            return void 0 !== this.userDatesCreated[this.gpproxy.formatNickname(a)]
        }
        requestTwitchUsersData(a) {
            if (this.gpproxy.isHost() && this.gpproxy.isTwitchAuth()) {
                var b = a.filter(d => !this.gpproxy.isYou(d.nick) && !this.gpproxy.isViewer(d)).map(d => this.gpproxy.formatNickname(d.nick));
                a = b.filter(d => !(d in this.userDatesCreated));
                b = this.s.twitchFollowerBadges ||
                    this.s.twitchSubscriberBadges ? b : [];
                if (a.length || b.length) {
                    var c = !!this.s.twitchToken2;
                    document.dispatchEvent(new CustomEvent("_request_users_data", {
                        detail: {
                            datesCreatedUsernames: a,
                            followerSubscriberUsernames: b,
                            broadcasterId: this.gpproxy.getUser().authId,
                            token: this.s.twitchToken2,
                            datesCreatedFlag: !0,
                            followersFlag: c && this.s.twitchFollowerBadges,
                            subscribersFlag: c && this.s.twitchSubscriberBadges
                        }
                    }))
                }
            }
        }
        updateFollowers(a) {
            a && Object.assign(this.followers, ...a.map(b => ({
                [b]: !0
            })))
        }
        updateSubscribers(a) {
            a && Object.assign(this.subscribers,
                ...a.map(b => ({
                    [b]: !0
                })))
        }
        saveBanlist() {
            this.gpproxy.isTwitchOAuth || localStorage.setItem("ul_banlist", JSON.stringify(Array.from(this.banlist)))
        }
        preventAlbumContentInteraction(a) {
            a.target.closest(".item") && this.isAlbumContent(a.target) && a.stopPropagation()
        }
        handlePreviewImage(a) {
            a.addEventListener("pointerover", this.imagePreviewOverHandler);
            a.addEventListener("pointerdown", this.imagePreviewDownHandler);
            a.dataset.type = "image";
            a.dataset.typeId = GPProxy_.ALBUM_ITEM_TYPE.IMAGE;
            this.handleCensorableItem(a)
        }
        searchPreviewImage(a = !1) {
            const b = Date.now();
            return new Promise(c => {
                const d = () => {
                    clearTimeout(this.searchPreviewTimer);
                    var e = document.querySelector(".screen > :is(.write, .memory) .core > div > canvas");
                    e ? (e = e.parentElement, e.dataset.type = "image", c(e)) : !a && Date.now() - b < GPModeration_.PREVIEW_MONITOR_TIMEOUT && (this.searchPreviewTimer = setTimeout(() => {
                        d()
                    }, GPModeration_.PREVIEW_MONITOR_INTERVAL))
                };
                d()
            })
        }
        handleCensorableItem(a) {
            this.resetItem(a);
            const b = this.gpproxy.getPrevData()?.user?.nick;
            if (b)
                if (this.isSuspiciousItem(a) &&
                    a.classList.add("suspicious_"), this.shouldBeBannedItem(a, b)) this.censorItem(a, GPModeration_.CENSORING_REASON.BANNED_PLAYER);
                else {
                    if (this.s.safeMode && !this.isAnimationOrMultiPieceItem(a)) {
                        if (!this.safeItems.has(this.getContentId(a))) {
                            this.censorItem(a, GPModeration_.CENSORING_REASON.SAFE_MODE);
                            return
                        }
                    } else {
                        if (this.shouldBeCensoredByUnknownPlayer(a, b)) {
                            this.censorItem(a, GPModeration_.CENSORING_REASON.UNKNOWN_PLAYER);
                            return
                        }
                        if (this.shouldBeCensoredByNewAccount(a, b)) {
                            this.censorItem(a, GPModeration_.CENSORING_REASON.NEW_ACCOUNT);
                            return
                        }
                    }
                    this.isCensoredItem(a) && this.censorItem(a, GPModeration_.CENSORING_REASON.BY_USER)
                }
        }
        handlePreviewItem(a) {
            this.isAnimationOrMultiPieceItem(a) || (a = a.querySelector(".balloon"), a.addEventListener("pointerenter", this.albumItemEnterHandler), a.addEventListener("pointerleave", this.albumItemLeaveHandler))
        }
        albumItemEnterHandler(a) {
            if (this.preview.isEnabled() && (a = a.currentTarget.closest(".item"), !this.isEmptyItem(a) && !this.isPreviewedItem(a) && a.matches(".banned_, .censored_, .suspicious_"))) {
                a.classList.add("previewed_");
                var b = this.getItemId(a);
                if (a = this.gpproxy.getAlbumItem(b)) b = `${this.gpproxy.getCurrentAlbumId()}_${b}`, this.preview.load(a.data, a.type, b)
            }
        }
        albumItemLeaveHandler(a) {
            this.preview.isEnabled() && (a = a.currentTarget.closest(".item"), a.classList.contains("previewed_") && (a.classList.remove("previewed_"), this.preview.clear()))
        }
        imagePreviewOverHandler(a) {
            this.preview.isEnabled() && this.isPreviewCanvas(a.target) && this.previewCensorableItem(a.target.parentElement)
        }
        previewCensorableItem(a) {
            const b = this.gpproxy.getPrevImageData();
            if (b && a.matches(".banned_, .censored_, .suspicious_")) {
                a.classList.add("previewed_");
                a.addEventListener("pointerleave", d => {
                    a.classList.remove("previewed_");
                    this.preview.clear()
                }, {
                    once: !0
                });
                const c = this.gpproxy.getCurrentTurnId();
                this.preview.load(b, Number(a.dataset.typeId), `t_${c}`)
            }
        }
        imagePreviewDownHandler(a) {
            0 === a.button && this.isPreviewCanvas(a.target) && this.handleCensorableItemDown(a.target.parentElement)
        }
        handleCensorableItemDown(a) {
            const b = this.getContentId(a),
                c = this.gpproxy.getPrevData()?.user?.nick;
            this.s.safeMode && !this.safeItems.has(b) ? this.safeItems.add(b) : this.shouldBeBannedItem(a, c) || this.isPreviewedItem(a) || a.dataset.cr && a.dataset.cr !== GPModeration_.CENSORING_REASON.BY_USER ? (a.classList.toggle("preview_"), this.preview.isEnabled() && (this.preview.clear(), a.classList.remove("previewed_"))) : this.censorItems.has(b) ? this.censorItems.delete(b) : this.censorItems.set(b, a.dataset.type);
            this.handleCensorableItem(a)
        }
        isPreviewCanvas(a) {
            return "CANVAS" === a.tagName
        }
        isPreviewScreen(a) {
            return GPModeration_.PREVIEW_PATHS.includes(a.slice(1))
        }
        handlePainterHeader(a) {
            if (a =
                a.querySelector("h4 + h3")) a.addEventListener("pointerover", this.painterHeaderTextOverHandler), a.addEventListener("pointerdown", this.painterHeaderTextDownHandler), a.dataset.type = "text", a.dataset.typeId = GPProxy_.ALBUM_ITEM_TYPE.TEXT, this.handleCensorableItem(a)
        }
        painterHeaderTextOverHandler(a) {
            this.preview.isEnabled() && this.previewCensorableItem(a.target)
        }
        painterHeaderTextDownHandler(a) {
            0 === a.button && this.handleCensorableItemDown(a.target)
        }
        acTriggerHandler({
            detail: {
                itemId: a,
                albumId: b
            }
        }) {
            this.gpproxy.getCurrentAlbumId() ===
                b && (b = this.albumItems.find(c => this.getItemId(c) === a)) && b.classList.add("suspicious_")
        }
        initTwitchTokenBtn() {
            this.twitchTokenBtn = document.createElement("div");
            this.twitchTokenBtn.className = "mod-twitch-token-btn_";
            this.twitchTokenBtn.title = "\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c Twitch-\u0442\u043e\u043a\u0435\u043d, \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0432 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u043f\u0440\u0430\u0432\u0430 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044e gp-mod (\u043d\u0435 \u0434\u0435\u043b\u0430\u0439\u0441\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u0438 \u0438 \u043d\u0435 \u0441\u043e\u043e\u0431\u0449\u0430\u0439\u0442\u0435 \u0442\u043e\u043a\u0435\u043d \u043d\u0438\u043a\u043e\u043c\u0443)";
            this.twitchTokenBtn.textContent = "Get Twitch Token";
            this.twitchTokenBtn.addEventListener("click", a => {
                this.twitchAuthWindow && this.twitchAuthWindow.close();
                this.twitchAuthWindow = window.open(GPModeration_.TWITCH_AUTH_URL)
            })
        }
        requestTwitchTokenStatus() {
            return this.s.twitchToken ? fetch("https://id.twitch.tv/oauth2/validate", {
                headers: {
                    Authorization: `OAuth ${this.s.twitchToken}`
                },
                credentials: "omit",
                cache: "no-cache"
            }).then(a => a.ok).catch(() => !1) : Promise.resolve(!1)
        }
        checkTwitchTokenStatus() {
            this.s.twitchToken &&
                this.twitchAPI.validateToken(this.s.twitchToken).then(a => {
                    a || this.showTwitchTokenNotice()
                })
        }
        checkTwitchToken2Status() {
            this.s.twitchToken2 && this.twitchAPI.validateToken(this.s.twitchToken2).then(a => {
                a || this.showTwitchToken2Notice()
            })
        }
        banTwitchUser(a) {
            if (a = this.twitchUserIds.get(a)) {
                const b = this.gpproxy.getUser().authId;
                this.twitchAPI.banUser(a, b, this.s.twitchToken).catch(() => {
                    this.twitchAPI.validateToken(this.s.twitchToken).then(c => {
                        c || this.showTwitchTokenNotice()
                    })
                })
            }
        }
        unbanTwitchUser(a) {
            if (a = this.twitchUserIds.get(a)) {
                const b =
                    this.gpproxy.getUser().authId;
                this.twitchAPI.unbanUser(a, b, this.s.twitchToken).catch(() => {
                    this.twitchAPI.validateToken(this.s.twitchToken).then(c => {
                        c || this.showTwitchTokenNotice()
                    })
                })
            }
        }
        showTwitchTokenNotice() {
            this.abt?.showTwitchTokenNotice({
                onButtonClick: () => {
                    this.twitchAPI.requestToken(GPTwitchAPI_.TOKEN_TYPE.BAN_USERS)
                },
                onClose: () => {
                    this.s.userBansSyncWithTwitch = !1
                }
            })
        }
        showTwitchToken2Notice() {
            this.abt?.showTwitchToken2Notice({
                onButtonClick: () => {
                    this.twitchAPI.requestToken(GPTwitchAPI_.TOKEN_TYPE.FOLLOWERS_SUBSCRIPTIONS)
                },
                onClose: () => {
                    this.s.twitchFollowerBadges = !1;
                    this.s.twitchSubscriberBadges = !1
                }
            })
        }
        updateUserIdsCache(a) {
            a.forEach((b, c) => {
                this.twitchUserIds.set(b, c)
            })
        }
        updateLocalizedLogins(a) {
            a.forEach((b, c) => {
                this.localizedLogins.set(c, b)
            })
        }
        handleAlbumUsernames() {
            this.contentObserver.getAlbumItems().forEach(a => {
                this.handleAlbumUsername(a)
            })
        }
        handleAlbumUsername(a) {
            this.gpproxy.isTwitchAuth() && this.handleAlbumLocalizedTwitchUsername(a)
        }
        handleAlbumAvatars(a) {
            const b = this.getNickname(a);
            a.classList.toggle("own_", this.gpproxy.isYou(b));
            a.classList.toggle("gartic_", !b)
        }
        handleAlbumLocalizedTwitchUsername(a) {
            if (this.gpproxy.isTwitchAuth())
                if (a = this.getNicknameElem(a), this.s.disableLocalizedTwitchUsernames) {
                    const b = this.localizedLogins.get(a?.textContent);
                    b && (a.classList.add("processing_"), a.dataset.login = b, a.style.width = getComputedStyle(a, "::before").width, a.classList.remove("processing_"))
                } else delete a.dataset.login, a.style.width = ""
        }
        handleAlbumHeader(a) {
            if (this.gpproxy.isTwitchAuth() && (a ??= this.contentObserver.getAlbumHeader(), a))
                if (this.s.disableLocalizedTwitchUsernames) {
                    const b =
                        this.gpproxy.getAlbumAuthor(),
                        c = this.localizedLogins.get(b);
                    c && (a.dataset.login = a.textContent.replace(b, c))
                } else delete a.dataset.login
        }
        handleAlbumFooter(a) {
            if (this.gpproxy.isTwitchAuth() && (a ??= this.contentObserver.getAlbumFooter(), a))
                if (this.s.disableLocalizedTwitchUsernames) {
                    const b = this.gpproxy.getAlbumAuthor(),
                        c = this.localizedLogins.get(b);
                    c && (a.classList.add("processing_"), a.dataset.login = a.textContent.replace(b, c), a.style.width = getComputedStyle(a, "::before").width, a.classList.remove("processing_"))
                } else delete a.dataset.login,
                    a.style.width = ""
        }
        updateRankingUsers() {
            this.gpproxy.isTwitchAuth() && this.contentObserver.getRankingUsers().forEach(a => {
                this.handleAlbumRanking(a)
            })
        }
        handleAlbumRanking(a) {
            if (this.gpproxy.isTwitchAuth()) {
                a = a.querySelector(".nick");
                var b = a?.textContent;
                if (this.s.disableLocalizedTwitchUsernames) {
                    if (b = this.localizedLogins.get(b)) a.dataset.login = b
                } else delete a.dataset.login
            }
        }
        injectSafeModeControl() {
            if (!this.inGallerySettingsObserving) {
                var a = document.querySelector("#content");
                a ? ((new MutationObserver(this.gallerySettingsObserverCallback.bind(this))).observe(a, {
                    childList: !0,
                    subtree: !0
                }), this.inGallerySettingsObserving = !0) : setTimeout(() => {
                    this.injectSafeModeControl()
                }, 200)
            }
        }
        gallerySettingsObserverCallback(a, b) {
            for (const c of a) "childList" === c.type && c.addedNodes[0]?.classList.contains("screen") && (a = c.addedNodes[0].querySelector(".scrapbook .controls > section"), this.renderSafeModeControl(a), b.disconnect(), this.inGallerySettingsObserving = !1)
        }
        renderSafeModeControl(a) {
            const b = document.createElement("div");
            b.className = "safe-mode-opt_ label";
            var c = GPModeration_.SAFE_MODE_OPT_L10N[window.__NEXT_DATA__.locale] ??
                GPModeration_.SAFE_MODE_OPT_L10N.en;
            b.innerHTML = `<div class="legend"><i class="icon_"></i><span><h5 class="title_">${c.TITLE}</h5><p class="description_">${c.DESC}</p></span></div><section class="toggle_"><form class="switch"><input type="radio" id="safe_mode_0" name="safe_mode" value="1"><label for="safe_mode_0">${c.ON}</label><input type="radio" id="safe_mode_1" name="safe_mode" value="0"><label for="safe_mode_1">${c.OFF}</label></form></section>`;
            c = b.querySelector("form.switch");
            c.elements.safe_mode.value = +this.s.safeMode;
            c.addEventListener("change", d => {
                this.s.safeMode = !!+d.target.value
            });
            this.safeModControl = c.elements.safe_mode;
            c = a.children.length + 1;
            c = Math.min(Math.round((393 - 50 * c) / (c - 1)), 3 < c ? 50 : 60);
            a.classList.add("gp-custom-options_");
            a.style.setProperty("--options-gap", `${c}px`);
            a.appendChild(b)
        }
        updateSafeModControl() {
            const a = this.safeModControl?.[0];
            a && (a.isConnected ? this.safeModControl.value = +this.s.safeMode : this.safeModControl = null)
        }
        updateSettings({
            detail: {
                settings: a
            }
        }) {
            "showUI" in a && (this.container.classList.toggle("shown_",
                a.showUI), this.container.classList.remove("banlist_"), this.renderUsers(), this.activateBtn.classList.toggle("pressed_", a.showUI));
            "autoKick" in a && (this.container.classList.toggle("autokick_", a.autoKick), this.clearPlayers());
            "autoKickNewAccounts" in a && this.clearPlayers();
            "copyUsernamesWithClick" in a && this.initUsernamesCopying();
            "compactMode" in a && this.container.classList.toggle("compact_", a.compactMode);
            "playersColorIndication" in a && this.updatePlayerItems();
            "disableLocalizedTwitchUsernames" in a && this.gpproxy.isTwitchAuth() &&
                (this.renderUsers(), this.renderBanlist(), this.gpproxy.isGameStages(GPProxy_.GAME_STAGE.LOBBY, GPProxy_.GAME_STAGE.ALBUM, GPProxy_.GAME_STAGE.SCORE) && this.updatePlayerItems(), this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.ALBUM) ? (this.handleAlbumHeader(), this.handleAlbumFooter(), this.handleAlbumUsernames()) : this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.SCORE) && this.updateRankingUsers());
            "newAccountPeriod" in a && this.renderUsers();
            ["censorSentences", "censorNicknames"].some(b => b in a) && this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.ALBUM) &&
                this.handleItems();
            ["censorDrawings", "censorUnknownPlayers", "censorNewAccounts", "safeMode"].some(b => b in a) && ("safeMode" in a && (this.safeItems.clear(), this.updateSafeModControl()), this.gpproxy.isGameStage(GPProxy_.GAME_STAGE.ALBUM) ? this.handleItems() : this.gpproxy.isScreen(GPProxy_.SCREEN.PAINTER) && this.searchPreviewImage(!0).then(this.handleCensorableItem));
            "userBansSyncWithTwitch" in a && a.userBansSyncWithTwitch && this.twitchAPI.validateToken(this.s.twitchToken).then(b => {
                b || this.twitchAPI.requestToken(GPTwitchAPI_.TOKEN_TYPE.BAN_USERS)
            });
            if ("twitchFollowerBadges" in a || "twitchSubscriberBadges" in a) a.twitchFollowerBadges && a.twitchSubscriberBadges || (this.renderUsers(), this.updatePlayerItems()), (a.twitchFollowerBadges || a.twitchSubscriberBadges) && this.twitchAPI.validateToken(this.s.twitchToken2).then(b => {
                b ? this.requestTwitchUsersData(this.gpproxy.getUsers()) : this.twitchAPI.requestToken(GPTwitchAPI_.TOKEN_TYPE.FOLLOWERS_SUBSCRIPTIONS)
            })
        }
    }
    window.GPModeration_ = GPModeration_;
    class GPPreview_ extends EventTarget {
        static CANVAS_WIDTH = 758;
        static CANVAS_HEIGHT = 424;
        static CANVAS_DENSITY = .5;
        static MAX_PANEL_WIDTH = window.screen.width / 3;
        static MIN_PANEL_WIDTH = 180;
        static PANEL_WIDTH_STEP = 10;
        static MIN_PANEL_BORDER_WIDTH = 2;
        static ORIENTATIONS = {
            t: "top",
            b: "bottom",
            l: "left",
            r: "right"
        };
        static ORIENTATION = {
            TOP: "top",
            BOTTOM: "bottom",
            LEFT: "left",
            RIGHT: "right"
        };
        static TYPES = {
            1: "image",
            2: "text",
            5: "animation"
        };
        static WINDOW_URL = "https://gpmod.github.io/preview";
        constructor(a, b, {
                x: c,
                y: d,
                o: e
            },
            f, g) {
            super();
            this.gpproxy = a;
            this.l = g;
            this.enabled = !!b;
            this.panelOffsetX = c;
            this.panelOffsetY = d;
            this.panelOrientation = e;
            this.panelWidth = f;
            this.panelBorderWidth = GPPreview_.MIN_PANEL_BORDER_WIDTH;
            this.window = null;
            this.cache = new Map;
            this.worker = null;
            this.addEventListener("rendered", () => {
                this.panel.classList.add("rendered_")
            });
            this.gpproxy.addEventListener("data", ({
                detail: {
                    event: h
                }
            }) => {
                h === GPProxy_.EVENT.GAME_STARTED && this.cache.clear()
            });
            window.addEventListener("message", h => {
                switch (h.data?.type) {
                    case "gp-preview-request-draw-function":
                        this.window.postMessage({
                            type: "draw_function",
                            drawFunctionString: GPUtils_.drawFunctionString
                        }, GPPreview_.WINDOW_URL);
                        break;
                    case "gp-preview-win-closed":
                        this.window = null, this.panel.classList.replace("win-mode_", "frame-mode_")
                }
            });
            window.addEventListener("resize", () => {
                this.updatePanelPosition()
            });
            this.render();
            this.toggle(b)
        }
        render() {
            this.showPanelBtn = document.createElement("div");
            this.showPanelBtn.className = "gp-preview-btn_ gp-module-btn_";
            this.showPanelBtn.title = this.l.PREVIEW_PANEL_BTN_TTL;
            this.showPanelBtn.addEventListener("click", () => {
                this.toggle()
            });
            this.showPanelBtn.addEventListener("pointerenter", () => {
                this.panel.classList.add("hover_")
            });
            this.showPanelBtn.addEventListener("pointerleave", () => {
                this.panel.classList.remove("hover_")
            });
            document.body.appendChild(this.showPanelBtn);
            this.panel = document.createElement("div");
            this.panel.className = "gp-preview_";
            this.panel.dataset.type = GPPreview_.TYPES[GPProxy_.ALBUM_ITEM_TYPE.IMAGE];
            this.panel.style.setProperty("--gp-preview-width", `${this.panelWidth}px`);
            this.panel.addEventListener("contextmenu", b => {
                b.preventDefault()
            });
            this.panel.addEventListener("wheel", b => {
                b.preventDefault();
                this.panelWidth = 0 < b.deltaY ? Math.max(this.panelWidth - GPPreview_.PANEL_WIDTH_STEP, GPPreview_.MIN_PANEL_WIDTH) : Math.min(this.panelWidth + GPPreview_.PANEL_WIDTH_STEP, GPPreview_.MAX_PANEL_WIDTH);
                this.updatePanelSize();
                this.updatePanelPosition();
                this.dispatchEvent(new CustomEvent("panel-width-changed", {
                    detail: {
                        width: this.panelWidth
                    }
                }))
            });
            this.panel.addEventListener("pointerdown", b => {
                if (0 === b.button) {
                    var [c, d, e, f] = this.getCoords(b), g = (h => {
                        this.setPanelPosition(h.pageX -
                            c, h.pageY - d, e, f)
                    }).bind(this);
                    this.panel.setPointerCapture(b.pointerId);
                    this.panel.addEventListener("pointermove", g);
                    this.panel.addEventListener("pointerup", () => {
                        this.dispatchEvent(new CustomEvent("panel-pos-changed", {
                            detail: {
                                x: this.panelOffsetX,
                                y: this.panelOffsetY,
                                o: this.panelOrientation
                            }
                        }));
                        this.panel.removeEventListener("pointermove", g)
                    }, {
                        once: !0
                    });
                    g(b)
                }
            });
            this.panel.addEventListener("pointerdown", b => {
                if (1 === b.button || 2 === b.button) this.panel.setPointerCapture(b.pointerId), this.panel.addEventListener("pointerup",
                    c => {
                        if (1 === c.button || 2 === c.button) this.window ? this.closeWindow() : this.openWindow()
                    }, {
                        once: !0
                    })
            });
            const a = document.createElement("div");
            a.className = "warning_";
            a.style.setProperty("--frame-mode-warning", `'${this.l.PREIVEW_PANEL_WARNING}'`);
            a.style.setProperty("--win-mode-warning", `'${this.l.PREIVEW_TAB_WARNING}'`);
            this.panel.appendChild(a);
            this.canvas = this.createCanvas();
            this.panel.appendChild(this.canvas);
            this.text = document.createElement("div");
            this.text.className = "text_";
            this.panel.appendChild(this.text);
            document.body.appendChild(this.panel);
            this.updatePanelPosition();
            this.updatePanelSize()
        }
        createCanvas() {
            const a = document.createElement("canvas");
            a.className = "canvas_";
            a.width = GPPreview_.CANVAS_WIDTH * GPPreview_.CANVAS_DENSITY;
            a.height = GPPreview_.CANVAS_HEIGHT * GPPreview_.CANVAS_DENSITY;
            return a
        }
        replaceCanvas() {
            const a = this.createCanvas();
            this.canvas.replaceWith(a);
            this.canvas = a
        }
        toggle(a) {
            this.enabled = void 0 !== a ? !!a : !this.enabled;
            this.panel.classList.toggle("shown_", this.enabled);
            this.enabled ? (this.panel.classList.add("frame-mode_"),
                this.initWorker()) : (this.clear(), this.window && this.closeWindow(), this.terminateWorker(), this.replaceCanvas());
            this.dispatchEvent(new CustomEvent("status", {
                detail: {
                    status: this.enabled
                }
            }));
            this.showPanelBtn.classList.toggle("pressed_", this.enabled)
        }
        openWindow() {
            this.window && this.window.close();
            this.window = window.open(GPPreview_.WINDOW_URL);
            this.panel.classList.replace("frame-mode_", "win-mode_")
        }
        closeWindow() {
            this.window.close();
            this.window = null;
            this.panel.classList.replace("win-mode_", "frame-mode_")
        }
        updatePanelSize() {
            this.panel.style.setProperty("--gp-preview-width",
                `${this.panelWidth}px`);
            this.panelBorderWidth = Math.max(Math.round(this.panelWidth / 142), GPPreview_.MIN_PANEL_BORDER_WIDTH);
            this.panel.style.setProperty("--gp-preview-border-width", `${this.panelBorderWidth}px`)
        }
        updatePanelPosition() {
            const a = Math.max(Math.min(this.panelOffsetX, document.documentElement.clientWidth - this.panelWidth - this.panelBorderWidth), this.panelBorderWidth),
                b = Math.max(Math.min(this.panelOffsetY, document.documentElement.clientHeight - this.panelWidth / (GPPreview_.CANVAS_WIDTH / GPPreview_.CANVAS_HEIGHT) -
                    this.panelBorderWidth), this.panelBorderWidth);
            this.panel.style.inset = "unset";
            this.panelOrientation.split("").map(c => GPPreview_.ORIENTATIONS[c]).forEach(c => {
                switch (c) {
                    case GPPreview_.ORIENTATION.TOP:
                    case GPPreview_.ORIENTATION.BOTTOM:
                        this.panel.style[c] = `${b}px`;
                        break;
                    case GPPreview_.ORIENTATION.LEFT:
                    case GPPreview_.ORIENTATION.RIGHT:
                        this.panel.style[c] = `${a}px`
                }
            })
        }
        setPanelPosition(a, b, c, d) {
            if (!c || !d) {
                const [k, l] = this.panel.getBoundingClientRect();
                c = k;
                d = l
            }
            const e = document.documentElement.clientWidth,
                f = document.documentElement.clientHeight,
                g = Math.max(Math.min(a, e - c - this.panelBorderWidth), this.panelBorderWidth),
                h = Math.max(Math.min(b, f - d - this.panelBorderWidth), this.panelBorderWidth);
            this.panel.style.inset = "unset";
            this.panel.dataset.orien = "";
            b + d / 2 > f / 2 ? (this.panelOffsetY = Math.round(f - (h + d)), this.panel.style.bottom = `${this.panelOffsetY}px`, this.panel.dataset.orien += "b") : (this.panelOffsetY = Math.round(h), this.panel.style.top = `${this.panelOffsetY}px`, this.panel.dataset.orien += "t");
            a + c / 2 > e / 2 ? (this.panelOffsetX =
                Math.round(e - (g + c)), this.panel.style.right = `${this.panelOffsetX}px`, this.panel.dataset.orien += "r") : (this.panelOffsetX = Math.round(g), this.panel.style.left = `${this.panelOffsetX}px`, this.panel.dataset.orien += "l");
            this.panelOrientation = this.panel.dataset.orien
        }
        getCoords(a) {
            const [b, c] = a.touches ? [a.touches[0].clientX, a.touches[0].clientY] : [a.clientX, a.clientY];
            a = a.currentTarget.getBoundingClientRect();
            return [Math.round(b - a.left), Math.round(c - a.top), a.width, a.height]
        }
        initWorker() {
            const a = this.canvas.transferControlToOffscreen();
            this.worker = GPUtils_.createWorker(this.workerBody);
            this.worker.postMessage({
                type: "init",
                data: {
                    canvas: a,
                    density: GPPreview_.CANVAS_DENSITY,
                    drawFunctionString: GPUtils_.drawFunctionString
                }
            }, [a]);
            this.worker.addEventListener("message", ({
                data: {
                    type: b,
                    ...c
                }
            }) => {
                switch (b) {
                    case "cache":
                        const {
                            imageData: d, cacheId: e
                        } = c;
                        this.cache.set(e, d);
                        break;
                    case "rendered":
                        this.dispatchEvent(new Event("rendered"))
                }
            })
        }
        terminateWorker() {
            this.worker && this.worker.terminate()
        }
        workerBody() {
            self.addEventListener("message", ({
                data: {
                    type: a,
                    data: b
                }
            }) => {
                switch (a) {
                    case "draw":
                        const {
                            strokes: c, cacheId: d
                        } = b;
                        self.clear();
                        self.draw(self.ctx, c, self.density, !0, !1);
                        a = self.ctx.getImageData(0, 0, self.canvas.width, self.canvas.height);
                        self.postMessage({
                            type: "cache",
                            imageData: a,
                            cacheId: d
                        });
                        self.postMessage({
                            type: "rendered"
                        });
                        break;
                    case "clear":
                        self.clear();
                        break;
                    case "cache":
                        self.clear();
                        self.ctx.putImageData(b, 0, 0);
                        self.postMessage({
                            type: "rendered"
                        });
                        break;
                    case "init":
                        const {
                            canvas: e, density: f
                        } = b;
                        self.density = f;
                        self.canvas = e;
                        self.ctx = self.canvas.getContext("2d");
                        self.ctx.imageSmoothingQuality = "high";
                        self.draw = (new Function(`return ${b.drawFunctionString}`))();
                        self.clear = () => {
                            self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)
                        }
                }
            })
        }
        load(a, b, c) {
            if (a) {
                var d = GPPreview_.TYPES[b];
                this.panel.classList.remove("rendered_");
                this.panel.classList.add("loading_");
                if (this.window) this.window.postMessage({
                    type: "data",
                    data: a,
                    itemType: d
                }, GPPreview_.WINDOW_URL);
                else switch (this.panel.dataset.type = d, b) {
                    case GPProxy_.ALBUM_ITEM_TYPE.IMAGE:
                        this.worker.postMessage({
                            type: "clear"
                        });
                        (b = this.cache.get(c)) ? this.worker.postMessage({
                            type: "cache",
                            data: b
                        }): this.worker.postMessage({
                            type: "draw",
                            data: {
                                strokes: a,
                                cacheId: c
                            }
                        });
                        break;
                    case GPProxy_.ALBUM_ITEM_TYPE.TEXT:
                        this.text.textContent = a, this.dispatchEvent(new Event("rendered"))
                }
            }
        }
        clear() {
            this.window ? this.window.postMessage({
                type: "clear"
            }, GPPreview_.WINDOW_URL) : this.worker?.postMessage({
                type: "clear"
            });
            this.text.textContent = "";
            this.panel.classList.remove("loading_")
        }
        isEnabled() {
            return this.enabled || this.window
        }
    }
    window.GPPreview_ = GPPreview_;
    class GPTwitchAPI_ extends EventTarget {
        static CLIENT_ID = "qrohytuwdc7d3uns3gnvtb4esylpqy";
        static BASE_URL = "https://api.twitch.tv/helix";
        static BANS_API = "/moderation/bans";
        static AUTH_URL = `https://id.twitch.tv/oauth2/authorize?client_id=${this.CLIENT_ID}&redirect_uri=${encodeURIComponent("https://gpmod.github.io/twitch-token?WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW&tokenType={token-type}")}&response_type=token&scope={scopes}`;
        static TOKEN_TYPE = {
            BAN_USERS: "ban-users",
            FOLLOWERS_SUBSCRIPTIONS: "followers-subscriptions"
        };
        static SCOPES = {
            [this.TOKEN_TYPE.BAN_USERS]: "moderator:manage:banned_users",
            [this.TOKEN_TYPE.FOLLOWERS_SUBSCRIPTIONS]: "moderator:read:followers channel:read:subscriptions"
        };
        constructor() {
            super();
            this.authWindow = null;
            window.addEventListener("message", a => {
                if (("https://gpmod.github.io" === a.origin || "https://localhost" === a.origin) && "gp-twitch-token" === a.data.type) {
                    switch (a.data.tokenType) {
                        case GPTwitchAPI_.TOKEN_TYPE.BAN_USERS:
                            this.dispatchEvent(new CustomEvent("token", {
                                detail: {
                                    type: GPTwitchAPI_.TOKEN_TYPE.BAN_USERS,
                                    token: a.data.token
                                }
                            }));
                            break;
                        case GPTwitchAPI_.TOKEN_TYPE.FOLLOWERS_SUBSCRIPTIONS:
                            this.dispatchEvent(new CustomEvent("token", {
                                detail: {
                                    type: GPTwitchAPI_.TOKEN_TYPE.FOLLOWERS_SUBSCRIPTIONS,
                                    token: a.data.token
                                }
                            }))
                    }
                    this.authWindow.postMessage({
                        type: "close"
                    }, a.origin);
                    this.authWindow = null
                }
            })
        }
        requestToken(a) {
            this.openAuthWindow(GPTwitchAPI_.SCOPES[a], a)
        }
        openAuthWindow(a, b) {
            this.authWindow && this.authWindow.close();
            a = GPTwitchAPI_.AUTH_URL.replace("{scopes}",
                encodeURIComponent(a)).replace("%7Btoken-type%7D", encodeURIComponent(b));
            this.authWindow = window.open(a)
        }
        validateToken(a) {
            return a ? fetch("https://id.twitch.tv/oauth2/validate", {
                headers: {
                    Authorization: `OAuth ${a}`
                },
                credentials: "omit",
                cache: "no-cache"
            }).then(b => b.ok).catch(() => !1) : Promise.resolve(!1)
        }
        banUser(a, b, c) {
            return fetch(`${GPTwitchAPI_.BASE_URL}${GPTwitchAPI_.BANS_API}?broadcaster_id=${b}&moderator_id=${b}`, {
                method: "POST",
                headers: {
                    Authorization: `Bearer ${c}`,
                    "Client-Id": GPTwitchAPI_.CLIENT_ID,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    data: {
                        user_id: a,
                        reason: "Gartic Phone"
                    }
                })
            }).then(d => {
                if (401 === d.status) throw Error("Unauthorized");
            })
        }
        unbanUser(a, b, c) {
            return fetch(`${GPTwitchAPI_.BASE_URL}${GPTwitchAPI_.BANS_API}?broadcaster_id=${b}&moderator_id=${b}&user_id=${a}`, {
                method: "DELETE",
                headers: {
                    Authorization: `Bearer ${c}`,
                    "Client-Id": GPTwitchAPI_.CLIENT_ID
                }
            }).then(d => {
                if (401 === d.status) throw Error("Unauthorized");
            })
        }
    };
}).call(this)